(function(){const vi=document.createElement("link").relList;if(vi&&vi.supports&&vi.supports("modulepreload"))return;for(const Oi of document.querySelectorAll('link[rel="modulepreload"]'))Mi(Oi);new MutationObserver(Oi=>{for(const Wr of Oi)if(Wr.type==="childList")for(const Qr of Wr.addedNodes)Qr.tagName==="LINK"&&Qr.rel==="modulepreload"&&Mi(Qr)}).observe(document,{childList:!0,subtree:!0});function Si(Oi){const Wr={};return Oi.integrity&&(Wr.integrity=Oi.integrity),Oi.referrerPolicy&&(Wr.referrerPolicy=Oi.referrerPolicy),Oi.crossOrigin==="use-credentials"?Wr.credentials="include":Oi.crossOrigin==="anonymous"?Wr.credentials="omit":Wr.credentials="same-origin",Wr}function Mi(Oi){if(Oi.ep)return;Oi.ep=!0;const Wr=Si(Oi);fetch(Oi.href,Wr)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},maplibreGl={exports:{}};(function(mi,vi){(function(Si,Mi){mi.exports=Mi()})(commonjsGlobal,function(){var Si,Mi,Oi;function Wr(li,po){if(!Si)Si=po;else if(!Mi)Mi=po;else{var Ki="var sharedChunk = {}; ("+Si+")(sharedChunk); ("+Mi+")(sharedChunk);",Lo={};Si(Lo),Oi=po(Lo),typeof window<"u"&&(Oi.workerUrl=window.URL.createObjectURL(new Blob([Ki],{type:"text/javascript"})))}}Wr(["exports"],function(li){function po(ti,ze,ii,oi){return new(ii||(ii=Promise))(function(ai,ui){function pi(xi){try{yi(oi.next(xi))}catch(wi){ui(wi)}}function di(xi){try{yi(oi.throw(xi))}catch(wi){ui(wi)}}function yi(xi){var wi;xi.done?ai(xi.value):(wi=xi.value,wi instanceof ii?wi:new ii(function(Ii){Ii(wi)})).then(pi,di)}yi((oi=oi.apply(ti,ze||[])).next())})}function Ki(ti){return ti&&ti.__esModule&&Object.prototype.hasOwnProperty.call(ti,"default")?ti.default:ti}typeof SuppressedError=="function"&&SuppressedError;var Lo=Ro;function Ro(ti,ze){this.x=ti,this.y=ze}Ro.prototype={clone:function(){return new Ro(this.x,this.y)},add:function(ti){return this.clone()._add(ti)},sub:function(ti){return this.clone()._sub(ti)},multByPoint:function(ti){return this.clone()._multByPoint(ti)},divByPoint:function(ti){return this.clone()._divByPoint(ti)},mult:function(ti){return this.clone()._mult(ti)},div:function(ti){return this.clone()._div(ti)},rotate:function(ti){return this.clone()._rotate(ti)},rotateAround:function(ti,ze){return this.clone()._rotateAround(ti,ze)},matMult:function(ti){return this.clone()._matMult(ti)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(ti){return this.x===ti.x&&this.y===ti.y},dist:function(ti){return Math.sqrt(this.distSqr(ti))},distSqr:function(ti){var ze=ti.x-this.x,ii=ti.y-this.y;return ze*ze+ii*ii},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(ti){return Math.atan2(this.y-ti.y,this.x-ti.x)},angleWith:function(ti){return this.angleWithSep(ti.x,ti.y)},angleWithSep:function(ti,ze){return Math.atan2(this.x*ze-this.y*ti,this.x*ti+this.y*ze)},_matMult:function(ti){var ze=ti[2]*this.x+ti[3]*this.y;return this.x=ti[0]*this.x+ti[1]*this.y,this.y=ze,this},_add:function(ti){return this.x+=ti.x,this.y+=ti.y,this},_sub:function(ti){return this.x-=ti.x,this.y-=ti.y,this},_mult:function(ti){return this.x*=ti,this.y*=ti,this},_div:function(ti){return this.x/=ti,this.y/=ti,this},_multByPoint:function(ti){return this.x*=ti.x,this.y*=ti.y,this},_divByPoint:function(ti){return this.x/=ti.x,this.y/=ti.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var ti=this.y;return this.y=this.x,this.x=-ti,this},_rotate:function(ti){var ze=Math.cos(ti),ii=Math.sin(ti),oi=ii*this.x+ze*this.y;return this.x=ze*this.x-ii*this.y,this.y=oi,this},_rotateAround:function(ti,ze){var ii=Math.cos(ti),oi=Math.sin(ti),ai=ze.y+oi*(this.x-ze.x)+ii*(this.y-ze.y);return this.x=ze.x+ii*(this.x-ze.x)-oi*(this.y-ze.y),this.y=ai,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ro.convert=function(ti){return ti instanceof Ro?ti:Array.isArray(ti)?new Ro(ti[0],ti[1]):ti};var fo=Ki(Lo),aa=wa;function wa(ti,ze,ii,oi){this.cx=3*ti,this.bx=3*(ii-ti)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*ze,this.by=3*(oi-ze)-this.cy,this.ay=1-this.cy-this.by,this.p1x=ti,this.p1y=ze,this.p2x=ii,this.p2y=oi}wa.prototype={sampleCurveX:function(ti){return((this.ax*ti+this.bx)*ti+this.cx)*ti},sampleCurveY:function(ti){return((this.ay*ti+this.by)*ti+this.cy)*ti},sampleCurveDerivativeX:function(ti){return(3*this.ax*ti+2*this.bx)*ti+this.cx},solveCurveX:function(ti,ze){if(ze===void 0&&(ze=1e-6),ti<0)return 0;if(ti>1)return 1;for(var ii=ti,oi=0;oi<8;oi++){var ai=this.sampleCurveX(ii)-ti;if(Math.abs(ai)<ze)return ii;var ui=this.sampleCurveDerivativeX(ii);if(Math.abs(ui)<1e-6)break;ii-=ai/ui}var pi=0,di=1;for(ii=ti,oi=0;oi<20&&(ai=this.sampleCurveX(ii),!(Math.abs(ai-ti)<ze));oi++)ti>ai?pi=ii:di=ii,ii=.5*(di-pi)+pi;return ii},solve:function(ti,ze){return this.sampleCurveY(this.solveCurveX(ti,ze))}};var $a=Ki(aa);let Ln,bn;function fs(){return Ln==null&&(Ln=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ln}function sa(){if(bn==null&&(bn=!1,fs())){const ze=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(ze){for(let oi=0;oi<5*5;oi++){const ai=4*oi;ze.fillStyle=`rgb(${ai},${ai+1},${ai+2})`,ze.fillRect(oi%5,Math.floor(oi/5),1,1)}const ii=ze.getImageData(0,0,5,5).data;for(let oi=0;oi<5*5*4;oi++)if(oi%4!=3&&ii[oi]!==oi){bn=!0;break}}}return bn||!1}function ma(ti,ze,ii,oi){const ai=new $a(ti,ze,ii,oi);return function(ui){return ai.solve(ui)}}const la=ma(.25,.1,.25,1);function Za(ti,ze,ii){return Math.min(ii,Math.max(ze,ti))}function oa(ti,ze,ii){const oi=ii-ze,ai=((ti-ze)%oi+oi)%oi+ze;return ai===ze?ii:ai}function ln(ti,...ze){for(const ii of ze)for(const oi in ii)ti[oi]=ii[oi];return ti}let vs=1;function Wo(ti,ze,ii){const oi={};for(const ai in ti)oi[ai]=ze.call(ii||this,ti[ai],ai,ti);return oi}function fn(ti,ze,ii){const oi={};for(const ai in ti)ze.call(ii||this,ti[ai],ai,ti)&&(oi[ai]=ti[ai]);return oi}function Pn(ti){return Array.isArray(ti)?ti.map(Pn):typeof ti=="object"&&ti?Wo(ti,Pn):ti}const Ra={};function On(ti){Ra[ti]||(typeof console<"u"&&console.warn(ti),Ra[ti]=!0)}function rn(ti,ze,ii){return(ii.y-ti.y)*(ze.x-ti.x)>(ze.y-ti.y)*(ii.x-ti.x)}function Sa(ti){let ze=0;for(let ii,oi,ai=0,ui=ti.length,pi=ui-1;ai<ui;pi=ai++)ii=ti[ai],oi=ti[pi],ze+=(oi.x-ii.x)*(ii.y+oi.y);return ze}function Gn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ca=null;function al(ti){return typeof ImageBitmap<"u"&&ti instanceof ImageBitmap}const sl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function rs(ti,ze,ii,oi,ai){return po(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const ui=new VideoFrame(ti,{timestamp:0});try{const pi=ui==null?void 0:ui.format;if(!pi||!pi.startsWith("BGR")&&!pi.startsWith("RGB"))throw new Error(`Unrecognized format ${pi}`);const di=pi.startsWith("BGR"),yi=new Uint8ClampedArray(oi*ai*4);if(yield ui.copyTo(yi,function(xi,wi,Ii,Pi,Ri){const Li=4*Math.max(-wi,0),Fi=(Math.max(0,Ii)-Ii)*Pi*4+Li,qi=4*Pi,Zi=Math.max(0,wi),Gr=Math.max(0,Ii);return{rect:{x:Zi,y:Gr,width:Math.min(xi.width,wi+Pi)-Zi,height:Math.min(xi.height,Ii+Ri)-Gr},layout:[{offset:Fi,stride:qi}]}}(ti,ze,ii,oi,ai)),di)for(let xi=0;xi<yi.length;xi+=4){const wi=yi[xi];yi[xi]=yi[xi+2],yi[xi+2]=wi}return yi}finally{ui.close()}})}let Ma,hn,Xn,Bn;const Ls={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(ti){const ze=requestAnimationFrame(ti);return{cancel:()=>cancelAnimationFrame(ze)}},getImageData(ti,ze=0){return this.getImageCanvasContext(ti).getImageData(-ze,-ze,ti.width+2*ze,ti.height+2*ze)},getImageCanvasContext(ti){const ze=window.document.createElement("canvas"),ii=ze.getContext("2d",{willReadFrequently:!0});if(!ii)throw new Error("failed to create canvas 2d context");return ze.width=ti.width,ze.height=ti.height,ii.drawImage(ti,0,0,ti.width,ti.height),ii},resolveURL:ti=>(Xn||(Xn=document.createElement("a")),Xn.href=ti,Xn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Bn==null&&(Bn=matchMedia("(prefers-reduced-motion: reduce)")),Bn.matches)}},Xs={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class os extends Error{constructor(ze,ii,oi,ai){super(`AJAXError: ${ii} (${ze}): ${oi}`),this.status=ze,this.statusText=ii,this.url=oi,this.body=ai}}const Nn=Gn()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,La=ti=>Xs.REGISTERED_PROTOCOLS[ti.substring(0,ti.indexOf("://"))];function Os(ti,ze){const ii=new AbortController,oi=new Request(ti.url,{method:ti.method||"GET",body:ti.body,credentials:ti.credentials,headers:ti.headers,cache:ti.cache,referrer:Nn(),signal:ii.signal});let ai=!1,ui=!1;return ti.type==="json"&&oi.headers.set("Accept","application/json"),ui||fetch(oi).then(pi=>pi.ok?(di=>{(ti.type==="arrayBuffer"||ti.type==="image"?di.arrayBuffer():ti.type==="json"?di.json():di.text()).then(yi=>{ui||(ai=!0,ze(null,yi,di.headers.get("Cache-Control"),di.headers.get("Expires")))}).catch(yi=>{ui||ze(new Error(yi.message))})})(pi):pi.blob().then(di=>ze(new os(pi.status,pi.statusText,ti.url,di)))).catch(pi=>{pi.code!==20&&ze(new Error(pi.message))}),{cancel:()=>{ui=!0,ai||ii.abort()}}}const bs=function(ti,ze){if(/:\/\//.test(ti.url)&&!/^https?:|^file:/.test(ti.url)){if(Gn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",ti,ze);if(!Gn())return(La(ti.url)||Os)(ti,ze)}if(!(/^file:/.test(ii=ti.url)||/^file:/.test(Nn())&&!/^\w+:/.test(ii))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Os(ti,ze);if(Gn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",ti,ze,void 0,!0)}var ii;return function(oi,ai){const ui=new XMLHttpRequest;ui.open(oi.method||"GET",oi.url,!0),oi.type!=="arrayBuffer"&&oi.type!=="image"||(ui.responseType="arraybuffer");for(const pi in oi.headers)ui.setRequestHeader(pi,oi.headers[pi]);return oi.type==="json"&&(ui.responseType="text",ui.setRequestHeader("Accept","application/json")),ui.withCredentials=oi.credentials==="include",ui.onerror=()=>{ai(new Error(ui.statusText))},ui.onload=()=>{if((ui.status>=200&&ui.status<300||ui.status===0)&&ui.response!==null){let pi=ui.response;if(oi.type==="json")try{pi=JSON.parse(ui.response)}catch(di){return ai(di)}ai(null,pi,ui.getResponseHeader("Cache-Control"),ui.getResponseHeader("Expires"))}else{const pi=new Blob([ui.response],{type:ui.getResponseHeader("Content-Type")});ai(new os(ui.status,ui.statusText,oi.url,pi))}},ui.send(oi.body),{cancel:()=>ui.abort()}}(ti,ze)},Un=function(ti,ze){return bs(ln(ti,{type:"arrayBuffer"}),ze)};function Oa(ti){if(!ti||ti.indexOf("://")<=0||ti.indexOf("data:image/")===0||ti.indexOf("blob:")===0)return!0;const ze=new URL(ti),ii=window.location;return ze.protocol===ii.protocol&&ze.host===ii.host}function ms(ti,ze,ii){ii[ti]&&ii[ti].indexOf(ze)!==-1||(ii[ti]=ii[ti]||[],ii[ti].push(ze))}function ks(ti,ze,ii){if(ii&&ii[ti]){const oi=ii[ti].indexOf(ze);oi!==-1&&ii[ti].splice(oi,1)}}class $n{constructor(ze,ii={}){ln(this,ii),this.type=ze}}class na extends $n{constructor(ze,ii={}){super("error",ln({error:ze},ii))}}class ka{on(ze,ii){return this._listeners=this._listeners||{},ms(ze,ii,this._listeners),this}off(ze,ii){return ks(ze,ii,this._listeners),ks(ze,ii,this._oneTimeListeners),this}once(ze,ii){return ii?(this._oneTimeListeners=this._oneTimeListeners||{},ms(ze,ii,this._oneTimeListeners),this):new Promise(oi=>this.once(ze,oi))}fire(ze,ii){typeof ze=="string"&&(ze=new $n(ze,ii||{}));const oi=ze.type;if(this.listens(oi)){ze.target=this;const ai=this._listeners&&this._listeners[oi]?this._listeners[oi].slice():[];for(const di of ai)di.call(this,ze);const ui=this._oneTimeListeners&&this._oneTimeListeners[oi]?this._oneTimeListeners[oi].slice():[];for(const di of ui)ks(oi,di,this._oneTimeListeners),di.call(this,ze);const pi=this._eventedParent;pi&&(ln(ze,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),pi.fire(ze))}else ze instanceof na&&console.error(ze.error);return this}listens(ze){return this._listeners&&this._listeners[ze]&&this._listeners[ze].length>0||this._oneTimeListeners&&this._oneTimeListeners[ze]&&this._oneTimeListeners[ze].length>0||this._eventedParent&&this._eventedParent.listens(ze)}setEventedParent(ze,ii){return this._eventedParent=ze,this._eventedParentData=ii,this}}var io={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Da=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ns(ti,ze){const ii={};for(const oi in ti)oi!=="ref"&&(ii[oi]=ti[oi]);return Da.forEach(oi=>{oi in ze&&(ii[oi]=ze[oi])}),ii}function mn(ti,ze){if(Array.isArray(ti)){if(!Array.isArray(ze)||ti.length!==ze.length)return!1;for(let ii=0;ii<ti.length;ii++)if(!mn(ti[ii],ze[ii]))return!1;return!0}if(typeof ti=="object"&&ti!==null&&ze!==null){if(typeof ze!="object"||Object.keys(ti).length!==Object.keys(ze).length)return!1;for(const ii in ti)if(!mn(ti[ii],ze[ii]))return!1;return!0}return ti===ze}const tn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ws(ti,ze,ii){ii.push({command:tn.addSource,args:[ti,ze[ti]]})}function Il(ti,ze,ii){ze.push({command:tn.removeSource,args:[ti]}),ii[ti]=!0}function Ds(ti,ze,ii,oi){Il(ti,ii,oi),ws(ti,ze,ii)}function mc(ti,ze,ii){let oi;for(oi in ti[ii])if(Object.prototype.hasOwnProperty.call(ti[ii],oi)&&oi!=="data"&&!mn(ti[ii][oi],ze[ii][oi]))return!1;for(oi in ze[ii])if(Object.prototype.hasOwnProperty.call(ze[ii],oi)&&oi!=="data"&&!mn(ti[ii][oi],ze[ii][oi]))return!1;return!0}function Al(ti,ze,ii,oi,ai,ui){let pi;for(pi in ze=ze||{},ti=ti||{})Object.prototype.hasOwnProperty.call(ti,pi)&&(mn(ti[pi],ze[pi])||ii.push({command:ui,args:[oi,pi,ze[pi],ai]}));for(pi in ze)Object.prototype.hasOwnProperty.call(ze,pi)&&!Object.prototype.hasOwnProperty.call(ti,pi)&&(mn(ti[pi],ze[pi])||ii.push({command:ui,args:[oi,pi,ze[pi],ai]}))}function Ws(ti){return ti.id}function ll(ti,ze){return ti[ze.id]=ze,ti}class _o{constructor(ze,ii,oi,ai){this.message=(ze?`${ze}: `:"")+oi,ai&&(this.identifier=ai),ii!=null&&ii.__line__&&(this.line=ii.__line__)}}function Ss(ti,...ze){for(const ii of ze)for(const oi in ii)ti[oi]=ii[oi];return ti}class Cn extends Error{constructor(ze,ii){super(ii),this.message=ii,this.key=ze}}class cl{constructor(ze,ii=[]){this.parent=ze,this.bindings={};for(const[oi,ai]of ii)this.bindings[oi]=ai}concat(ze){return new cl(this,ze)}get(ze){if(this.bindings[ze])return this.bindings[ze];if(this.parent)return this.parent.get(ze);throw new Error(`${ze} not found in scope.`)}has(ze){return!!this.bindings[ze]||!!this.parent&&this.parent.has(ze)}}const Fs={kind:"null"},go={kind:"number"},Go={kind:"string"},Uo={kind:"boolean"},Ea={kind:"color"},Es={kind:"object"},jo={kind:"value"},Bs={kind:"collator"},Ui={kind:"formatted"},Ai={kind:"padding"},Ci={kind:"resolvedImage"},ki={kind:"variableAnchorOffsetCollection"};function ji(ti,ze){return{kind:"array",itemType:ti,N:ze}}function Gi(ti){if(ti.kind==="array"){const ze=Gi(ti.itemType);return typeof ti.N=="number"?`array<${ze}, ${ti.N}>`:ti.itemType.kind==="value"?"array":`array<${ze}>`}return ti.kind}const Zr=[Fs,go,Go,Uo,Ea,Ui,Es,ji(jo),Ai,Ci,ki];function Xi(ti,ze){if(ze.kind==="error")return null;if(ti.kind==="array"){if(ze.kind==="array"&&(ze.N===0&&ze.itemType.kind==="value"||!Xi(ti.itemType,ze.itemType))&&(typeof ti.N!="number"||ti.N===ze.N))return null}else{if(ti.kind===ze.kind)return null;if(ti.kind==="value"){for(const ii of Zr)if(!Xi(ii,ze))return null}}return`Expected ${Gi(ti)} but found ${Gi(ze)} instead.`}function Hi(ti,ze){return ze.some(ii=>ii.kind===ti.kind)}function Qi(ti,ze){return ze.some(ii=>ii==="null"?ti===null:ii==="array"?Array.isArray(ti):ii==="object"?ti&&!Array.isArray(ti)&&typeof ti=="object":ii===typeof ti)}function ro(ti,ze){return ti.kind==="array"&&ze.kind==="array"?ti.itemType.kind===ze.itemType.kind&&typeof ti.N=="number":ti.kind===ze.kind}const oo=.96422,so=.82521,Oo=4/29,No=6/29,Io=3*No*No,Do=No*No*No,Vo=Math.PI/180,sn=180/Math.PI;function pn(ti){return(ti%=360)<0&&(ti+=360),ti}function en([ti,ze,ii,oi]){let ai,ui;const pi=_a((.2225045*(ti=Qo(ti))+.7168786*(ze=Qo(ze))+.0606169*(ii=Qo(ii)))/1);ti===ze&&ze===ii?ai=ui=pi:(ai=_a((.4360747*ti+.3850649*ze+.1430804*ii)/oo),ui=_a((.0139322*ti+.0971045*ze+.7141733*ii)/so));const di=116*pi-16;return[di<0?0:di,500*(ai-pi),200*(pi-ui),oi]}function Qo(ti){return ti<=.04045?ti/12.92:Math.pow((ti+.055)/1.055,2.4)}function _a(ti){return ti>Do?Math.pow(ti,1/3):ti/Io+Oo}function _n([ti,ze,ii,oi]){let ai=(ti+16)/116,ui=isNaN(ze)?ai:ai+ze/500,pi=isNaN(ii)?ai:ai-ii/200;return ai=1*ua(ai),ui=oo*ua(ui),pi=so*ua(pi),[Zn(3.1338561*ui-1.6168667*ai-.4906146*pi),Zn(-.9787684*ui+1.9161415*ai+.033454*pi),Zn(.0719453*ui-.2289914*ai+1.4052427*pi),oi]}function Zn(ti){return(ti=ti<=.00304?12.92*ti:1.055*Math.pow(ti,1/2.4)-.055)<0?0:ti>1?1:ti}function ua(ti){return ti>No?ti*ti*ti:Io*(ti-Oo)}function as(ti){return parseInt(ti.padEnd(2,ti),16)/255}function sh(ti,ze){return Pl(ze?ti/100:ti,0,1)}function Pl(ti,ze,ii){return Math.min(Math.max(ze,ti),ii)}function Cl(ti){return!ti.some(Number.isNaN)}const fp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class cn{constructor(ze,ii,oi,ai=1,ui=!0){this.r=ze,this.g=ii,this.b=oi,this.a=ai,ui||(this.r*=ai,this.g*=ai,this.b*=ai,ai||this.overwriteGetter("rgb",[ze,ii,oi,ai]))}static parse(ze){if(ze instanceof cn)return ze;if(typeof ze!="string")return;const ii=function(oi){if((oi=oi.toLowerCase().trim())==="transparent")return[0,0,0,0];const ai=fp[oi];if(ai){const[pi,di,yi]=ai;return[pi/255,di/255,yi/255,1]}if(oi.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(oi)){const pi=oi.length<6?1:2;let di=1;return[as(oi.slice(di,di+=pi)),as(oi.slice(di,di+=pi)),as(oi.slice(di,di+=pi)),as(oi.slice(di,di+pi)||"ff")]}if(oi.startsWith("rgb")){const pi=oi.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(pi){const[di,yi,xi,wi,Ii,Pi,Ri,Li,Fi,qi,Zi,Gr]=pi,Yi=[wi||" ",Ri||" ",qi].join("");if(Yi==="  "||Yi==="  /"||Yi===",,"||Yi===",,,"){const Yr=[xi,Pi,Fi].join(""),Jr=Yr==="%%%"?100:Yr===""?255:0;if(Jr){const ao=[Pl(+yi/Jr,0,1),Pl(+Ii/Jr,0,1),Pl(+Li/Jr,0,1),Zi?sh(+Zi,Gr):1];if(Cl(ao))return ao}}return}}const ui=oi.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(ui){const[pi,di,yi,xi,wi,Ii,Pi,Ri,Li]=ui,Fi=[yi||" ",wi||" ",Pi].join("");if(Fi==="  "||Fi==="  /"||Fi===",,"||Fi===",,,"){const qi=[+di,Pl(+xi,0,100),Pl(+Ii,0,100),Ri?sh(+Ri,Li):1];if(Cl(qi))return function([Zi,Gr,Yi,Yr]){function Jr(ao){const So=(ao+Zi/30)%12,Po=Gr*Math.min(Yi,1-Yi);return Yi-Po*Math.max(-1,Math.min(So-3,9-So,1))}return Zi=pn(Zi),Gr/=100,Yi/=100,[Jr(0),Jr(8),Jr(4),Yr]}(qi)}}}(ze);return ii?new cn(...ii,!1):void 0}get rgb(){const{r:ze,g:ii,b:oi,a:ai}=this,ui=ai||1/0;return this.overwriteGetter("rgb",[ze/ui,ii/ui,oi/ui,ai])}get hcl(){return this.overwriteGetter("hcl",function(ze){const[ii,oi,ai,ui]=en(ze),pi=Math.sqrt(oi*oi+ai*ai);return[Math.round(1e4*pi)?pn(Math.atan2(ai,oi)*sn):NaN,pi,ii,ui]}(this.rgb))}get lab(){return this.overwriteGetter("lab",en(this.rgb))}overwriteGetter(ze,ii){return Object.defineProperty(this,ze,{value:ii}),ii}toString(){const[ze,ii,oi,ai]=this.rgb;return`rgba(${[ze,ii,oi].map(ui=>Math.round(255*ui)).join(",")},${ai})`}}cn.black=new cn(0,0,0,1),cn.white=new cn(1,1,1,1),cn.transparent=new cn(0,0,0,0),cn.red=new cn(1,0,0,1);class tu{constructor(ze,ii,oi){this.sensitivity=ze?ii?"variant":"case":ii?"accent":"base",this.locale=oi,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(ze,ii){return this.collator.compare(ze,ii)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _c{constructor(ze,ii,oi,ai,ui){this.text=ze,this.image=ii,this.scale=oi,this.fontStack=ai,this.textColor=ui}}class ya{constructor(ze){this.sections=ze}static fromString(ze){return new ya([new _c(ze,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(ze=>ze.text.length!==0||ze.image&&ze.image.name.length!==0)}static factory(ze){return ze instanceof ya?ze:ya.fromString(ze)}toString(){return this.sections.length===0?"":this.sections.map(ze=>ze.text).join("")}}class Ha{constructor(ze){this.values=ze.slice()}static parse(ze){if(ze instanceof Ha)return ze;if(typeof ze=="number")return new Ha([ze,ze,ze,ze]);if(Array.isArray(ze)&&!(ze.length<1||ze.length>4)){for(const ii of ze)if(typeof ii!="number")return;switch(ze.length){case 1:ze=[ze[0],ze[0],ze[0],ze[0]];break;case 2:ze=[ze[0],ze[1],ze[0],ze[1]];break;case 3:ze=[ze[0],ze[1],ze[2],ze[1]]}return new Ha(ze)}}toString(){return JSON.stringify(this.values)}}const mp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ss{constructor(ze){this.values=ze.slice()}static parse(ze){if(ze instanceof ss)return ze;if(Array.isArray(ze)&&!(ze.length<1)&&ze.length%2==0){for(let ii=0;ii<ze.length;ii+=2){const oi=ze[ii],ai=ze[ii+1];if(typeof oi!="string"||!mp.has(oi)||!Array.isArray(ai)||ai.length!==2||typeof ai[0]!="number"||typeof ai[1]!="number")return}return new ss(ze)}}toString(){return JSON.stringify(this.values)}}class ha{constructor(ze){this.name=ze.name,this.available=ze.available}toString(){return this.name}static fromString(ze){return ze?new ha({name:ze,available:!1}):null}}function yc(ti,ze,ii,oi){return typeof ti=="number"&&ti>=0&&ti<=255&&typeof ze=="number"&&ze>=0&&ze<=255&&typeof ii=="number"&&ii>=0&&ii<=255?oi===void 0||typeof oi=="number"&&oi>=0&&oi<=1?null:`Invalid rgba value [${[ti,ze,ii,oi].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof oi=="number"?[ti,ze,ii,oi]:[ti,ze,ii]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zl(ti){if(ti===null||typeof ti=="string"||typeof ti=="boolean"||typeof ti=="number"||ti instanceof cn||ti instanceof tu||ti instanceof ya||ti instanceof Ha||ti instanceof ss||ti instanceof ha)return!0;if(Array.isArray(ti)){for(const ze of ti)if(!zl(ze))return!1;return!0}if(typeof ti=="object"){for(const ze in ti)if(!zl(ti[ze]))return!1;return!0}return!1}function En(ti){if(ti===null)return Fs;if(typeof ti=="string")return Go;if(typeof ti=="boolean")return Uo;if(typeof ti=="number")return go;if(ti instanceof cn)return Ea;if(ti instanceof tu)return Bs;if(ti instanceof ya)return Ui;if(ti instanceof Ha)return Ai;if(ti instanceof ss)return ki;if(ti instanceof ha)return Ci;if(Array.isArray(ti)){const ze=ti.length;let ii;for(const oi of ti){const ai=En(oi);if(ii){if(ii===ai)continue;ii=jo;break}ii=ai}return ji(ii||jo,ze)}return Es}function on(ti){const ze=typeof ti;return ti===null?"":ze==="string"||ze==="number"||ze==="boolean"?String(ti):ti instanceof cn||ti instanceof ya||ti instanceof Ha||ti instanceof ss||ti instanceof ha?ti.toString():JSON.stringify(ti)}class ul{constructor(ze,ii){this.type=ze,this.value=ii}static parse(ze,ii){if(ze.length!==2)return ii.error(`'literal' expression requires exactly one argument, but found ${ze.length-1} instead.`);if(!zl(ze[1]))return ii.error("invalid value");const oi=ze[1];let ai=En(oi);const ui=ii.expectedType;return ai.kind!=="array"||ai.N!==0||!ui||ui.kind!=="array"||typeof ui.N=="number"&&ui.N!==0||(ai=ui),new ul(ai,oi)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class zn{constructor(ze){this.name="ExpressionEvaluationError",this.message=ze}toJSON(){return this.message}}const gc={string:Go,number:go,boolean:Uo,object:Es};class ls{constructor(ze,ii){this.type=ze,this.args=ii}static parse(ze,ii){if(ze.length<2)return ii.error("Expected at least one argument.");let oi,ai=1;const ui=ze[0];if(ui==="array"){let di,yi;if(ze.length>2){const xi=ze[1];if(typeof xi!="string"||!(xi in gc)||xi==="object")return ii.error('The item type argument of "array" must be one of string, number, boolean',1);di=gc[xi],ai++}else di=jo;if(ze.length>3){if(ze[2]!==null&&(typeof ze[2]!="number"||ze[2]<0||ze[2]!==Math.floor(ze[2])))return ii.error('The length argument to "array" must be a positive integer literal',2);yi=ze[2],ai++}oi=ji(di,yi)}else{if(!gc[ui])throw new Error(`Types doesn't contain name = ${ui}`);oi=gc[ui]}const pi=[];for(;ai<ze.length;ai++){const di=ii.parse(ze[ai],ai,jo);if(!di)return null;pi.push(di)}return new ls(oi,pi)}evaluate(ze){for(let ii=0;ii<this.args.length;ii++){const oi=this.args[ii].evaluate(ze);if(!Xi(this.type,En(oi)))return oi;if(ii===this.args.length-1)throw new zn(`Expected value to be of type ${Gi(this.type)}, but found ${Gi(En(oi))} instead.`)}throw new Error}eachChild(ze){this.args.forEach(ze)}outputDefined(){return this.args.every(ze=>ze.outputDefined())}}const iu={"to-boolean":Uo,"to-color":Ea,"to-number":go,"to-string":Go};class Ks{constructor(ze,ii){this.type=ze,this.args=ii}static parse(ze,ii){if(ze.length<2)return ii.error("Expected at least one argument.");const oi=ze[0];if(!iu[oi])throw new Error(`Can't parse ${oi} as it is not part of the known types`);if((oi==="to-boolean"||oi==="to-string")&&ze.length!==2)return ii.error("Expected one argument.");const ai=iu[oi],ui=[];for(let pi=1;pi<ze.length;pi++){const di=ii.parse(ze[pi],pi,jo);if(!di)return null;ui.push(di)}return new Ks(ai,ui)}evaluate(ze){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(ze);case"color":{let ii,oi;for(const ai of this.args){if(ii=ai.evaluate(ze),oi=null,ii instanceof cn)return ii;if(typeof ii=="string"){const ui=ze.parseColor(ii);if(ui)return ui}else if(Array.isArray(ii)&&(oi=ii.length<3||ii.length>4?`Invalid rbga value ${JSON.stringify(ii)}: expected an array containing either three or four numeric values.`:yc(ii[0],ii[1],ii[2],ii[3]),!oi))return new cn(ii[0]/255,ii[1]/255,ii[2]/255,ii[3])}throw new zn(oi||`Could not parse color from value '${typeof ii=="string"?ii:JSON.stringify(ii)}'`)}case"padding":{let ii;for(const oi of this.args){ii=oi.evaluate(ze);const ai=Ha.parse(ii);if(ai)return ai}throw new zn(`Could not parse padding from value '${typeof ii=="string"?ii:JSON.stringify(ii)}'`)}case"variableAnchorOffsetCollection":{let ii;for(const oi of this.args){ii=oi.evaluate(ze);const ai=ss.parse(ii);if(ai)return ai}throw new zn(`Could not parse variableAnchorOffsetCollection from value '${typeof ii=="string"?ii:JSON.stringify(ii)}'`)}case"number":{let ii=null;for(const oi of this.args){if(ii=oi.evaluate(ze),ii===null)return 0;const ai=Number(ii);if(!isNaN(ai))return ai}throw new zn(`Could not convert ${JSON.stringify(ii)} to number.`)}case"formatted":return ya.fromString(on(this.args[0].evaluate(ze)));case"resolvedImage":return ha.fromString(on(this.args[0].evaluate(ze)));default:return on(this.args[0].evaluate(ze))}}eachChild(ze){this.args.forEach(ze)}outputDefined(){return this.args.every(ze=>ze.outputDefined())}}const lh=["Unknown","Point","LineString","Polygon"];class ru{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?lh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(ze){let ii=this._parseColorCache[ze];return ii||(ii=this._parseColorCache[ze]=cn.parse(ze)),ii}}class xc{constructor(ze,ii,oi=[],ai,ui=new cl,pi=[]){this.registry=ze,this.path=oi,this.key=oi.map(di=>`[${di}]`).join(""),this.scope=ui,this.errors=pi,this.expectedType=ai,this._isConstant=ii}parse(ze,ii,oi,ai,ui={}){return ii?this.concat(ii,oi,ai)._parse(ze,ui):this._parse(ze,ui)}_parse(ze,ii){function oi(ai,ui,pi){return pi==="assert"?new ls(ui,[ai]):pi==="coerce"?new Ks(ui,[ai]):ai}if(ze!==null&&typeof ze!="string"&&typeof ze!="boolean"&&typeof ze!="number"||(ze=["literal",ze]),Array.isArray(ze)){if(ze.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const ai=ze[0];if(typeof ai!="string")return this.error(`Expression name must be a string, but found ${typeof ai} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const ui=this.registry[ai];if(ui){let pi=ui.parse(ze,this);if(!pi)return null;if(this.expectedType){const di=this.expectedType,yi=pi.type;if(di.kind!=="string"&&di.kind!=="number"&&di.kind!=="boolean"&&di.kind!=="object"&&di.kind!=="array"||yi.kind!=="value")if(di.kind!=="color"&&di.kind!=="formatted"&&di.kind!=="resolvedImage"||yi.kind!=="value"&&yi.kind!=="string")if(di.kind!=="padding"||yi.kind!=="value"&&yi.kind!=="number"&&yi.kind!=="array")if(di.kind!=="variableAnchorOffsetCollection"||yi.kind!=="value"&&yi.kind!=="array"){if(this.checkSubtype(di,yi))return null}else pi=oi(pi,di,ii.typeAnnotation||"coerce");else pi=oi(pi,di,ii.typeAnnotation||"coerce");else pi=oi(pi,di,ii.typeAnnotation||"coerce");else pi=oi(pi,di,ii.typeAnnotation||"assert")}if(!(pi instanceof ul)&&pi.type.kind!=="resolvedImage"&&this._isConstant(pi)){const di=new ru;try{pi=new ul(pi.type,pi.evaluate(di))}catch(yi){return this.error(yi.message),null}}return pi}return this.error(`Unknown expression "${ai}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(ze===void 0?"'undefined' value invalid. Use null instead.":typeof ze=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof ze} instead.`)}concat(ze,ii,oi){const ai=typeof ze=="number"?this.path.concat(ze):this.path,ui=oi?this.scope.concat(oi):this.scope;return new xc(this.registry,this._isConstant,ai,ii||null,ui,this.errors)}error(ze,...ii){const oi=`${this.key}${ii.map(ai=>`[${ai}]`).join("")}`;this.errors.push(new Cn(oi,ze))}checkSubtype(ze,ii){const oi=Xi(ze,ii);return oi&&this.error(oi),oi}}class vc{constructor(ze,ii,oi){this.type=Bs,this.locale=oi,this.caseSensitive=ze,this.diacriticSensitive=ii}static parse(ze,ii){if(ze.length!==2)return ii.error("Expected one argument.");const oi=ze[1];if(typeof oi!="object"||Array.isArray(oi))return ii.error("Collator options argument must be an object.");const ai=ii.parse(oi["case-sensitive"]!==void 0&&oi["case-sensitive"],1,Uo);if(!ai)return null;const ui=ii.parse(oi["diacritic-sensitive"]!==void 0&&oi["diacritic-sensitive"],1,Uo);if(!ui)return null;let pi=null;return oi.locale&&(pi=ii.parse(oi.locale,1,Go),!pi)?null:new vc(ai,ui,pi)}evaluate(ze){return new tu(this.caseSensitive.evaluate(ze),this.diacriticSensitive.evaluate(ze),this.locale?this.locale.evaluate(ze):null)}eachChild(ze){ze(this.caseSensitive),ze(this.diacriticSensitive),this.locale&&ze(this.locale)}outputDefined(){return!1}}const Js=8192;function ou(ti,ze){ti[0]=Math.min(ti[0],ze[0]),ti[1]=Math.min(ti[1],ze[1]),ti[2]=Math.max(ti[2],ze[0]),ti[3]=Math.max(ti[3],ze[1])}function Yl(ti,ze){return!(ti[0]<=ze[0]||ti[2]>=ze[2]||ti[1]<=ze[1]||ti[3]>=ze[3])}function ch(ti,ze){const ii=(180+ti[0])/360,oi=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+ti[1]*Math.PI/360)))/360,ai=Math.pow(2,ze.z);return[Math.round(ii*ai*Js),Math.round(oi*ai*Js)]}function _p(ti,ze,ii){const oi=ti[0]-ze[0],ai=ti[1]-ze[1],ui=ti[0]-ii[0],pi=ti[1]-ii[1];return oi*pi-ui*ai==0&&oi*ui<=0&&ai*pi<=0}function nu(ti,ze){let ii=!1;for(let pi=0,di=ze.length;pi<di;pi++){const yi=ze[pi];for(let xi=0,wi=yi.length;xi<wi-1;xi++){if(_p(ti,yi[xi],yi[xi+1]))return!1;(ai=yi[xi])[1]>(oi=ti)[1]!=(ui=yi[xi+1])[1]>oi[1]&&oi[0]<(ui[0]-ai[0])*(oi[1]-ai[1])/(ui[1]-ai[1])+ai[0]&&(ii=!ii)}}var oi,ai,ui;return ii}function au(ti,ze){for(let ii=0;ii<ze.length;ii++)if(nu(ti,ze[ii]))return!0;return!1}function uh(ti,ze,ii,oi){const ai=oi[0]-ii[0],ui=oi[1]-ii[1],pi=(ti[0]-ii[0])*ui-ai*(ti[1]-ii[1]),di=(ze[0]-ii[0])*ui-ai*(ze[1]-ii[1]);return pi>0&&di<0||pi<0&&di>0}function yp(ti,ze,ii){for(const xi of ii)for(let wi=0;wi<xi.length-1;++wi)if((di=[(pi=xi[wi+1])[0]-(ui=xi[wi])[0],pi[1]-ui[1]])[0]*(yi=[(ai=ze)[0]-(oi=ti)[0],ai[1]-oi[1]])[1]-di[1]*yi[0]!=0&&uh(oi,ai,ui,pi)&&uh(ui,pi,oi,ai))return!0;var oi,ai,ui,pi,di,yi;return!1}function hh(ti,ze){for(let ii=0;ii<ti.length;++ii)if(!nu(ti[ii],ze))return!1;for(let ii=0;ii<ti.length-1;++ii)if(yp(ti[ii],ti[ii+1],ze))return!1;return!0}function ph(ti,ze){for(let ii=0;ii<ze.length;ii++)if(hh(ti,ze[ii]))return!0;return!1}function bc(ti,ze,ii){const oi=[];for(let ai=0;ai<ti.length;ai++){const ui=[];for(let pi=0;pi<ti[ai].length;pi++){const di=ch(ti[ai][pi],ii);ou(ze,di),ui.push(di)}oi.push(ui)}return oi}function dh(ti,ze,ii){const oi=[];for(let ai=0;ai<ti.length;ai++){const ui=bc(ti[ai],ze,ii);oi.push(ui)}return oi}function fh(ti,ze,ii,oi){if(ti[0]<ii[0]||ti[0]>ii[2]){const ai=.5*oi;let ui=ti[0]-ii[0]>ai?-oi:ii[0]-ti[0]>ai?oi:0;ui===0&&(ui=ti[0]-ii[2]>ai?-oi:ii[2]-ti[0]>ai?oi:0),ti[0]+=ui}ou(ze,ti)}function su(ti,ze,ii,oi){const ai=Math.pow(2,oi.z)*Js,ui=[oi.x*Js,oi.y*Js],pi=[];for(const di of ti)for(const yi of di){const xi=[yi.x+ui[0],yi.y+ui[1]];fh(xi,ze,ii,ai),pi.push(xi)}return pi}function lu(ti,ze,ii,oi){const ai=Math.pow(2,oi.z)*Js,ui=[oi.x*Js,oi.y*Js],pi=[];for(const yi of ti){const xi=[];for(const wi of yi){const Ii=[wi.x+ui[0],wi.y+ui[1]];ou(ze,Ii),xi.push(Ii)}pi.push(xi)}if(ze[2]-ze[0]<=ai/2){(di=ze)[0]=di[1]=1/0,di[2]=di[3]=-1/0;for(const yi of pi)for(const xi of yi)fh(xi,ze,ii,ai)}var di;return pi}class hl{constructor(ze,ii){this.type=Uo,this.geojson=ze,this.geometries=ii}static parse(ze,ii){if(ze.length!==2)return ii.error(`'within' expression requires exactly one argument, but found ${ze.length-1} instead.`);if(zl(ze[1])){const oi=ze[1];if(oi.type==="FeatureCollection")for(let ai=0;ai<oi.features.length;++ai){const ui=oi.features[ai].geometry.type;if(ui==="Polygon"||ui==="MultiPolygon")return new hl(oi,oi.features[ai].geometry)}else if(oi.type==="Feature"){const ai=oi.geometry.type;if(ai==="Polygon"||ai==="MultiPolygon")return new hl(oi,oi.geometry)}else if(oi.type==="Polygon"||oi.type==="MultiPolygon")return new hl(oi,oi)}return ii.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(ze){if(ze.geometry()!=null&&ze.canonicalID()!=null){if(ze.geometryType()==="Point")return function(ii,oi){const ai=[1/0,1/0,-1/0,-1/0],ui=[1/0,1/0,-1/0,-1/0],pi=ii.canonicalID();if(oi.type==="Polygon"){const di=bc(oi.coordinates,ui,pi),yi=su(ii.geometry(),ai,ui,pi);if(!Yl(ai,ui))return!1;for(const xi of yi)if(!nu(xi,di))return!1}if(oi.type==="MultiPolygon"){const di=dh(oi.coordinates,ui,pi),yi=su(ii.geometry(),ai,ui,pi);if(!Yl(ai,ui))return!1;for(const xi of yi)if(!au(xi,di))return!1}return!0}(ze,this.geometries);if(ze.geometryType()==="LineString")return function(ii,oi){const ai=[1/0,1/0,-1/0,-1/0],ui=[1/0,1/0,-1/0,-1/0],pi=ii.canonicalID();if(oi.type==="Polygon"){const di=bc(oi.coordinates,ui,pi),yi=lu(ii.geometry(),ai,ui,pi);if(!Yl(ai,ui))return!1;for(const xi of yi)if(!hh(xi,di))return!1}if(oi.type==="MultiPolygon"){const di=dh(oi.coordinates,ui,pi),yi=lu(ii.geometry(),ai,ui,pi);if(!Yl(ai,ui))return!1;for(const xi of yi)if(!ph(xi,di))return!1}return!0}(ze,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class wc{constructor(ze,ii){this.type=ii.type,this.name=ze,this.boundExpression=ii}static parse(ze,ii){if(ze.length!==2||typeof ze[1]!="string")return ii.error("'var' expression requires exactly one string literal argument.");const oi=ze[1];return ii.scope.has(oi)?new wc(oi,ii.scope.get(oi)):ii.error(`Unknown variable "${oi}". Make sure "${oi}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(ze){return this.boundExpression.evaluate(ze)}eachChild(){}outputDefined(){return!1}}class cs{constructor(ze,ii,oi,ai){this.name=ze,this.type=ii,this._evaluate=oi,this.args=ai}evaluate(ze){return this._evaluate(ze,this.args)}eachChild(ze){this.args.forEach(ze)}outputDefined(){return!1}static parse(ze,ii){const oi=ze[0],ai=cs.definitions[oi];if(!ai)return ii.error(`Unknown expression "${oi}". If you wanted a literal array, use ["literal", [...]].`,0);const ui=Array.isArray(ai)?ai[0]:ai.type,pi=Array.isArray(ai)?[[ai[1],ai[2]]]:ai.overloads,di=pi.filter(([xi])=>!Array.isArray(xi)||xi.length===ze.length-1);let yi=null;for(const[xi,wi]of di){yi=new xc(ii.registry,Sc,ii.path,null,ii.scope);const Ii=[];let Pi=!1;for(let Ri=1;Ri<ze.length;Ri++){const Li=ze[Ri],Fi=Array.isArray(xi)?xi[Ri-1]:xi.type,qi=yi.parse(Li,1+Ii.length,Fi);if(!qi){Pi=!0;break}Ii.push(qi)}if(!Pi)if(Array.isArray(xi)&&xi.length!==Ii.length)yi.error(`Expected ${xi.length} arguments, but found ${Ii.length} instead.`);else{for(let Ri=0;Ri<Ii.length;Ri++){const Li=Array.isArray(xi)?xi[Ri]:xi.type,Fi=Ii[Ri];yi.concat(Ri+1).checkSubtype(Li,Fi.type)}if(yi.errors.length===0)return new cs(oi,ui,wi,Ii)}}if(di.length===1)ii.errors.push(...yi.errors);else{const xi=(di.length?di:pi).map(([Ii])=>{return Pi=Ii,Array.isArray(Pi)?`(${Pi.map(Gi).join(", ")})`:`(${Gi(Pi.type)}...)`;var Pi}).join(" | "),wi=[];for(let Ii=1;Ii<ze.length;Ii++){const Pi=ii.parse(ze[Ii],1+wi.length);if(!Pi)return null;wi.push(Gi(Pi.type))}ii.error(`Expected arguments of type ${xi}, but found (${wi.join(", ")}) instead.`)}return null}static register(ze,ii){cs.definitions=ii;for(const oi in ii)ze[oi]=cs}}function Sc(ti){if(ti instanceof wc)return Sc(ti.boundExpression);if(ti instanceof cs&&ti.name==="error"||ti instanceof vc||ti instanceof hl)return!1;const ze=ti instanceof Ks||ti instanceof ls;let ii=!0;return ti.eachChild(oi=>{ii=ze?ii&&Sc(oi):ii&&oi instanceof ul}),!!ii&&Ec(ti)&&Tc(ti,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ec(ti){if(ti instanceof cs&&(ti.name==="get"&&ti.args.length===1||ti.name==="feature-state"||ti.name==="has"&&ti.args.length===1||ti.name==="properties"||ti.name==="geometry-type"||ti.name==="id"||/^filter-/.test(ti.name))||ti instanceof hl)return!1;let ze=!0;return ti.eachChild(ii=>{ze&&!Ec(ii)&&(ze=!1)}),ze}function Xl(ti){if(ti instanceof cs&&ti.name==="feature-state")return!1;let ze=!0;return ti.eachChild(ii=>{ze&&!Xl(ii)&&(ze=!1)}),ze}function Tc(ti,ze){if(ti instanceof cs&&ze.indexOf(ti.name)>=0)return!1;let ii=!0;return ti.eachChild(oi=>{ii&&!Tc(oi,ze)&&(ii=!1)}),ii}function Rl(ti,ze){const ii=ti.length-1;let oi,ai,ui=0,pi=ii,di=0;for(;ui<=pi;)if(di=Math.floor((ui+pi)/2),oi=ti[di],ai=ti[di+1],oi<=ze){if(di===ii||ze<ai)return di;ui=di+1}else{if(!(oi>ze))throw new zn("Input is not a number.");pi=di-1}return 0}class Qs{constructor(ze,ii,oi){this.type=ze,this.input=ii,this.labels=[],this.outputs=[];for(const[ai,ui]of oi)this.labels.push(ai),this.outputs.push(ui)}static parse(ze,ii){if(ze.length-1<4)return ii.error(`Expected at least 4 arguments, but found only ${ze.length-1}.`);if((ze.length-1)%2!=0)return ii.error("Expected an even number of arguments.");const oi=ii.parse(ze[1],1,go);if(!oi)return null;const ai=[];let ui=null;ii.expectedType&&ii.expectedType.kind!=="value"&&(ui=ii.expectedType);for(let pi=1;pi<ze.length;pi+=2){const di=pi===1?-1/0:ze[pi],yi=ze[pi+1],xi=pi,wi=pi+1;if(typeof di!="number")return ii.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',xi);if(ai.length&&ai[ai.length-1][0]>=di)return ii.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',xi);const Ii=ii.parse(yi,wi,ui);if(!Ii)return null;ui=ui||Ii.type,ai.push([di,Ii])}return new Qs(ui,oi,ai)}evaluate(ze){const ii=this.labels,oi=this.outputs;if(ii.length===1)return oi[0].evaluate(ze);const ai=this.input.evaluate(ze);if(ai<=ii[0])return oi[0].evaluate(ze);const ui=ii.length;return ai>=ii[ui-1]?oi[ui-1].evaluate(ze):oi[Rl(ii,ai)].evaluate(ze)}eachChild(ze){ze(this.input);for(const ii of this.outputs)ze(ii)}outputDefined(){return this.outputs.every(ze=>ze.outputDefined())}}function Ko(ti,ze,ii){return ti+ii*(ze-ti)}function Ic(ti,ze,ii){return ti.map((oi,ai)=>Ko(oi,ze[ai],ii))}const Ya={number:Ko,color:function(ti,ze,ii,oi="rgb"){switch(oi){case"rgb":{const[ai,ui,pi,di]=Ic(ti.rgb,ze.rgb,ii);return new cn(ai,ui,pi,di,!1)}case"hcl":{const[ai,ui,pi,di]=ti.hcl,[yi,xi,wi,Ii]=ze.hcl;let Pi,Ri;if(isNaN(ai)||isNaN(yi))isNaN(ai)?isNaN(yi)?Pi=NaN:(Pi=yi,pi!==1&&pi!==0||(Ri=xi)):(Pi=ai,wi!==1&&wi!==0||(Ri=ui));else{let Gr=yi-ai;yi>ai&&Gr>180?Gr-=360:yi<ai&&ai-yi>180&&(Gr+=360),Pi=ai+ii*Gr}const[Li,Fi,qi,Zi]=function([Gr,Yi,Yr,Jr]){return Gr=isNaN(Gr)?0:Gr*Vo,_n([Yr,Math.cos(Gr)*Yi,Math.sin(Gr)*Yi,Jr])}([Pi,Ri??Ko(ui,xi,ii),Ko(pi,wi,ii),Ko(di,Ii,ii)]);return new cn(Li,Fi,qi,Zi,!1)}case"lab":{const[ai,ui,pi,di]=_n(Ic(ti.lab,ze.lab,ii));return new cn(ai,ui,pi,di,!1)}}},array:Ic,padding:function(ti,ze,ii){return new Ha(Ic(ti.values,ze.values,ii))},variableAnchorOffsetCollection:function(ti,ze,ii){const oi=ti.values,ai=ze.values;if(oi.length!==ai.length)throw new zn(`Cannot interpolate values of different length. from: ${ti.toString()}, to: ${ze.toString()}`);const ui=[];for(let pi=0;pi<oi.length;pi+=2){if(oi[pi]!==ai[pi])throw new zn(`Cannot interpolate values containing mismatched anchors. from[${pi}]: ${oi[pi]}, to[${pi}]: ${ai[pi]}`);ui.push(oi[pi]);const[di,yi]=oi[pi+1],[xi,wi]=ai[pi+1];ui.push([Ko(di,xi,ii),Ko(yi,wi,ii)])}return new ss(ui)}};class Xa{constructor(ze,ii,oi,ai,ui){this.type=ze,this.operator=ii,this.interpolation=oi,this.input=ai,this.labels=[],this.outputs=[];for(const[pi,di]of ui)this.labels.push(pi),this.outputs.push(di)}static interpolationFactor(ze,ii,oi,ai){let ui=0;if(ze.name==="exponential")ui=cu(ii,ze.base,oi,ai);else if(ze.name==="linear")ui=cu(ii,1,oi,ai);else if(ze.name==="cubic-bezier"){const pi=ze.controlPoints;ui=new $a(pi[0],pi[1],pi[2],pi[3]).solve(cu(ii,1,oi,ai))}return ui}static parse(ze,ii){let[oi,ai,ui,...pi]=ze;if(!Array.isArray(ai)||ai.length===0)return ii.error("Expected an interpolation type expression.",1);if(ai[0]==="linear")ai={name:"linear"};else if(ai[0]==="exponential"){const xi=ai[1];if(typeof xi!="number")return ii.error("Exponential interpolation requires a numeric base.",1,1);ai={name:"exponential",base:xi}}else{if(ai[0]!=="cubic-bezier")return ii.error(`Unknown interpolation type ${String(ai[0])}`,1,0);{const xi=ai.slice(1);if(xi.length!==4||xi.some(wi=>typeof wi!="number"||wi<0||wi>1))return ii.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);ai={name:"cubic-bezier",controlPoints:xi}}}if(ze.length-1<4)return ii.error(`Expected at least 4 arguments, but found only ${ze.length-1}.`);if((ze.length-1)%2!=0)return ii.error("Expected an even number of arguments.");if(ui=ii.parse(ui,2,go),!ui)return null;const di=[];let yi=null;oi==="interpolate-hcl"||oi==="interpolate-lab"?yi=Ea:ii.expectedType&&ii.expectedType.kind!=="value"&&(yi=ii.expectedType);for(let xi=0;xi<pi.length;xi+=2){const wi=pi[xi],Ii=pi[xi+1],Pi=xi+3,Ri=xi+4;if(typeof wi!="number")return ii.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Pi);if(di.length&&di[di.length-1][0]>=wi)return ii.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Pi);const Li=ii.parse(Ii,Ri,yi);if(!Li)return null;yi=yi||Li.type,di.push([wi,Li])}return ro(yi,go)||ro(yi,Ea)||ro(yi,Ai)||ro(yi,ki)||ro(yi,ji(go))?new Xa(yi,oi,ai,ui,di):ii.error(`Type ${Gi(yi)} is not interpolatable.`)}evaluate(ze){const ii=this.labels,oi=this.outputs;if(ii.length===1)return oi[0].evaluate(ze);const ai=this.input.evaluate(ze);if(ai<=ii[0])return oi[0].evaluate(ze);const ui=ii.length;if(ai>=ii[ui-1])return oi[ui-1].evaluate(ze);const pi=Rl(ii,ai),di=Xa.interpolationFactor(this.interpolation,ai,ii[pi],ii[pi+1]),yi=oi[pi].evaluate(ze),xi=oi[pi+1].evaluate(ze);switch(this.operator){case"interpolate":return Ya[this.type.kind](yi,xi,di);case"interpolate-hcl":return Ya.color(yi,xi,di,"hcl");case"interpolate-lab":return Ya.color(yi,xi,di,"lab")}}eachChild(ze){ze(this.input);for(const ii of this.outputs)ze(ii)}outputDefined(){return this.outputs.every(ze=>ze.outputDefined())}}function cu(ti,ze,ii,oi){const ai=oi-ii,ui=ti-ii;return ai===0?0:ze===1?ui/ai:(Math.pow(ze,ui)-1)/(Math.pow(ze,ai)-1)}class Ac{constructor(ze,ii){this.type=ze,this.args=ii}static parse(ze,ii){if(ze.length<2)return ii.error("Expectected at least one argument.");let oi=null;const ai=ii.expectedType;ai&&ai.kind!=="value"&&(oi=ai);const ui=[];for(const di of ze.slice(1)){const yi=ii.parse(di,1+ui.length,oi,void 0,{typeAnnotation:"omit"});if(!yi)return null;oi=oi||yi.type,ui.push(yi)}if(!oi)throw new Error("No output type");const pi=ai&&ui.some(di=>Xi(ai,di.type));return new Ac(pi?jo:oi,ui)}evaluate(ze){let ii,oi=null,ai=0;for(const ui of this.args)if(ai++,oi=ui.evaluate(ze),oi&&oi instanceof ha&&!oi.available&&(ii||(ii=oi.name),oi=null,ai===this.args.length&&(oi=ii)),oi!==null)break;return oi}eachChild(ze){this.args.forEach(ze)}outputDefined(){return this.args.every(ze=>ze.outputDefined())}}class Pc{constructor(ze,ii){this.type=ii.type,this.bindings=[].concat(ze),this.result=ii}evaluate(ze){return this.result.evaluate(ze)}eachChild(ze){for(const ii of this.bindings)ze(ii[1]);ze(this.result)}static parse(ze,ii){if(ze.length<4)return ii.error(`Expected at least 3 arguments, but found ${ze.length-1} instead.`);const oi=[];for(let ui=1;ui<ze.length-1;ui+=2){const pi=ze[ui];if(typeof pi!="string")return ii.error(`Expected string, but found ${typeof pi} instead.`,ui);if(/[^a-zA-Z0-9_]/.test(pi))return ii.error("Variable names must contain only alphanumeric characters or '_'.",ui);const di=ii.parse(ze[ui+1],ui+1);if(!di)return null;oi.push([pi,di])}const ai=ii.parse(ze[ze.length-1],ze.length-1,ii.expectedType,oi);return ai?new Pc(oi,ai):null}outputDefined(){return this.result.outputDefined()}}class uu{constructor(ze,ii,oi){this.type=ze,this.index=ii,this.input=oi}static parse(ze,ii){if(ze.length!==3)return ii.error(`Expected 2 arguments, but found ${ze.length-1} instead.`);const oi=ii.parse(ze[1],1,go),ai=ii.parse(ze[2],2,ji(ii.expectedType||jo));return oi&&ai?new uu(ai.type.itemType,oi,ai):null}evaluate(ze){const ii=this.index.evaluate(ze),oi=this.input.evaluate(ze);if(ii<0)throw new zn(`Array index out of bounds: ${ii} < 0.`);if(ii>=oi.length)throw new zn(`Array index out of bounds: ${ii} > ${oi.length-1}.`);if(ii!==Math.floor(ii))throw new zn(`Array index must be an integer, but found ${ii} instead.`);return oi[ii]}eachChild(ze){ze(this.index),ze(this.input)}outputDefined(){return!1}}class hu{constructor(ze,ii){this.type=Uo,this.needle=ze,this.haystack=ii}static parse(ze,ii){if(ze.length!==3)return ii.error(`Expected 2 arguments, but found ${ze.length-1} instead.`);const oi=ii.parse(ze[1],1,jo),ai=ii.parse(ze[2],2,jo);return oi&&ai?Hi(oi.type,[Uo,Go,go,Fs,jo])?new hu(oi,ai):ii.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(oi.type)} instead`):null}evaluate(ze){const ii=this.needle.evaluate(ze),oi=this.haystack.evaluate(ze);if(!oi)return!1;if(!Qi(ii,["boolean","string","number","null"]))throw new zn(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(En(ii))} instead.`);if(!Qi(oi,["string","array"]))throw new zn(`Expected second argument to be of type array or string, but found ${Gi(En(oi))} instead.`);return oi.indexOf(ii)>=0}eachChild(ze){ze(this.needle),ze(this.haystack)}outputDefined(){return!0}}class Cc{constructor(ze,ii,oi){this.type=go,this.needle=ze,this.haystack=ii,this.fromIndex=oi}static parse(ze,ii){if(ze.length<=2||ze.length>=5)return ii.error(`Expected 3 or 4 arguments, but found ${ze.length-1} instead.`);const oi=ii.parse(ze[1],1,jo),ai=ii.parse(ze[2],2,jo);if(!oi||!ai)return null;if(!Hi(oi.type,[Uo,Go,go,Fs,jo]))return ii.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(oi.type)} instead`);if(ze.length===4){const ui=ii.parse(ze[3],3,go);return ui?new Cc(oi,ai,ui):null}return new Cc(oi,ai)}evaluate(ze){const ii=this.needle.evaluate(ze),oi=this.haystack.evaluate(ze);if(!Qi(ii,["boolean","string","number","null"]))throw new zn(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(En(ii))} instead.`);if(!Qi(oi,["string","array"]))throw new zn(`Expected second argument to be of type array or string, but found ${Gi(En(oi))} instead.`);if(this.fromIndex){const ai=this.fromIndex.evaluate(ze);return oi.indexOf(ii,ai)}return oi.indexOf(ii)}eachChild(ze){ze(this.needle),ze(this.haystack),this.fromIndex&&ze(this.fromIndex)}outputDefined(){return!1}}class pu{constructor(ze,ii,oi,ai,ui,pi){this.inputType=ze,this.type=ii,this.input=oi,this.cases=ai,this.outputs=ui,this.otherwise=pi}static parse(ze,ii){if(ze.length<5)return ii.error(`Expected at least 4 arguments, but found only ${ze.length-1}.`);if(ze.length%2!=1)return ii.error("Expected an even number of arguments.");let oi,ai;ii.expectedType&&ii.expectedType.kind!=="value"&&(ai=ii.expectedType);const ui={},pi=[];for(let xi=2;xi<ze.length-1;xi+=2){let wi=ze[xi];const Ii=ze[xi+1];Array.isArray(wi)||(wi=[wi]);const Pi=ii.concat(xi);if(wi.length===0)return Pi.error("Expected at least one branch label.");for(const Li of wi){if(typeof Li!="number"&&typeof Li!="string")return Pi.error("Branch labels must be numbers or strings.");if(typeof Li=="number"&&Math.abs(Li)>Number.MAX_SAFE_INTEGER)return Pi.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Li=="number"&&Math.floor(Li)!==Li)return Pi.error("Numeric branch labels must be integer values.");if(oi){if(Pi.checkSubtype(oi,En(Li)))return null}else oi=En(Li);if(ui[String(Li)]!==void 0)return Pi.error("Branch labels must be unique.");ui[String(Li)]=pi.length}const Ri=ii.parse(Ii,xi,ai);if(!Ri)return null;ai=ai||Ri.type,pi.push(Ri)}const di=ii.parse(ze[1],1,jo);if(!di)return null;const yi=ii.parse(ze[ze.length-1],ze.length-1,ai);return yi?di.type.kind!=="value"&&ii.concat(1).checkSubtype(oi,di.type)?null:new pu(oi,ai,di,ui,pi,yi):null}evaluate(ze){const ii=this.input.evaluate(ze);return(En(ii)===this.inputType&&this.outputs[this.cases[ii]]||this.otherwise).evaluate(ze)}eachChild(ze){ze(this.input),this.outputs.forEach(ze),ze(this.otherwise)}outputDefined(){return this.outputs.every(ze=>ze.outputDefined())&&this.otherwise.outputDefined()}}class du{constructor(ze,ii,oi){this.type=ze,this.branches=ii,this.otherwise=oi}static parse(ze,ii){if(ze.length<4)return ii.error(`Expected at least 3 arguments, but found only ${ze.length-1}.`);if(ze.length%2!=0)return ii.error("Expected an odd number of arguments.");let oi;ii.expectedType&&ii.expectedType.kind!=="value"&&(oi=ii.expectedType);const ai=[];for(let pi=1;pi<ze.length-1;pi+=2){const di=ii.parse(ze[pi],pi,Uo);if(!di)return null;const yi=ii.parse(ze[pi+1],pi+1,oi);if(!yi)return null;ai.push([di,yi]),oi=oi||yi.type}const ui=ii.parse(ze[ze.length-1],ze.length-1,oi);if(!ui)return null;if(!oi)throw new Error("Can't infer output type");return new du(oi,ai,ui)}evaluate(ze){for(const[ii,oi]of this.branches)if(ii.evaluate(ze))return oi.evaluate(ze);return this.otherwise.evaluate(ze)}eachChild(ze){for(const[ii,oi]of this.branches)ze(ii),ze(oi);ze(this.otherwise)}outputDefined(){return this.branches.every(([ze,ii])=>ii.outputDefined())&&this.otherwise.outputDefined()}}class zc{constructor(ze,ii,oi,ai){this.type=ze,this.input=ii,this.beginIndex=oi,this.endIndex=ai}static parse(ze,ii){if(ze.length<=2||ze.length>=5)return ii.error(`Expected 3 or 4 arguments, but found ${ze.length-1} instead.`);const oi=ii.parse(ze[1],1,jo),ai=ii.parse(ze[2],2,go);if(!oi||!ai)return null;if(!Hi(oi.type,[ji(jo),Go,jo]))return ii.error(`Expected first argument to be of type array or string, but found ${Gi(oi.type)} instead`);if(ze.length===4){const ui=ii.parse(ze[3],3,go);return ui?new zc(oi.type,oi,ai,ui):null}return new zc(oi.type,oi,ai)}evaluate(ze){const ii=this.input.evaluate(ze),oi=this.beginIndex.evaluate(ze);if(!Qi(ii,["string","array"]))throw new zn(`Expected first argument to be of type array or string, but found ${Gi(En(ii))} instead.`);if(this.endIndex){const ai=this.endIndex.evaluate(ze);return ii.slice(oi,ai)}return ii.slice(oi)}eachChild(ze){ze(this.input),ze(this.beginIndex),this.endIndex&&ze(this.endIndex)}outputDefined(){return!1}}function mh(ti,ze){return ti==="=="||ti==="!="?ze.kind==="boolean"||ze.kind==="string"||ze.kind==="number"||ze.kind==="null"||ze.kind==="value":ze.kind==="string"||ze.kind==="number"||ze.kind==="value"}function _h(ti,ze,ii,oi){return oi.compare(ze,ii)===0}function Ml(ti,ze,ii){const oi=ti!=="=="&&ti!=="!=";return class om{constructor(ui,pi,di){this.type=Uo,this.lhs=ui,this.rhs=pi,this.collator=di,this.hasUntypedArgument=ui.type.kind==="value"||pi.type.kind==="value"}static parse(ui,pi){if(ui.length!==3&&ui.length!==4)return pi.error("Expected two or three arguments.");const di=ui[0];let yi=pi.parse(ui[1],1,jo);if(!yi)return null;if(!mh(di,yi.type))return pi.concat(1).error(`"${di}" comparisons are not supported for type '${Gi(yi.type)}'.`);let xi=pi.parse(ui[2],2,jo);if(!xi)return null;if(!mh(di,xi.type))return pi.concat(2).error(`"${di}" comparisons are not supported for type '${Gi(xi.type)}'.`);if(yi.type.kind!==xi.type.kind&&yi.type.kind!=="value"&&xi.type.kind!=="value")return pi.error(`Cannot compare types '${Gi(yi.type)}' and '${Gi(xi.type)}'.`);oi&&(yi.type.kind==="value"&&xi.type.kind!=="value"?yi=new ls(xi.type,[yi]):yi.type.kind!=="value"&&xi.type.kind==="value"&&(xi=new ls(yi.type,[xi])));let wi=null;if(ui.length===4){if(yi.type.kind!=="string"&&xi.type.kind!=="string"&&yi.type.kind!=="value"&&xi.type.kind!=="value")return pi.error("Cannot use collator to compare non-string types.");if(wi=pi.parse(ui[3],3,Bs),!wi)return null}return new om(yi,xi,wi)}evaluate(ui){const pi=this.lhs.evaluate(ui),di=this.rhs.evaluate(ui);if(oi&&this.hasUntypedArgument){const yi=En(pi),xi=En(di);if(yi.kind!==xi.kind||yi.kind!=="string"&&yi.kind!=="number")throw new zn(`Expected arguments for "${ti}" to be (string, string) or (number, number), but found (${yi.kind}, ${xi.kind}) instead.`)}if(this.collator&&!oi&&this.hasUntypedArgument){const yi=En(pi),xi=En(di);if(yi.kind!=="string"||xi.kind!=="string")return ze(ui,pi,di)}return this.collator?ii(ui,pi,di,this.collator.evaluate(ui)):ze(ui,pi,di)}eachChild(ui){ui(this.lhs),ui(this.rhs),this.collator&&ui(this.collator)}outputDefined(){return!0}}}const gp=Ml("==",function(ti,ze,ii){return ze===ii},_h),xp=Ml("!=",function(ti,ze,ii){return ze!==ii},function(ti,ze,ii,oi){return!_h(0,ze,ii,oi)}),vp=Ml("<",function(ti,ze,ii){return ze<ii},function(ti,ze,ii,oi){return oi.compare(ze,ii)<0}),bp=Ml(">",function(ti,ze,ii){return ze>ii},function(ti,ze,ii,oi){return oi.compare(ze,ii)>0}),wp=Ml("<=",function(ti,ze,ii){return ze<=ii},function(ti,ze,ii,oi){return oi.compare(ze,ii)<=0}),Sp=Ml(">=",function(ti,ze,ii){return ze>=ii},function(ti,ze,ii,oi){return oi.compare(ze,ii)>=0});class fu{constructor(ze,ii,oi,ai,ui){this.type=Go,this.number=ze,this.locale=ii,this.currency=oi,this.minFractionDigits=ai,this.maxFractionDigits=ui}static parse(ze,ii){if(ze.length!==3)return ii.error("Expected two arguments.");const oi=ii.parse(ze[1],1,go);if(!oi)return null;const ai=ze[2];if(typeof ai!="object"||Array.isArray(ai))return ii.error("NumberFormat options argument must be an object.");let ui=null;if(ai.locale&&(ui=ii.parse(ai.locale,1,Go),!ui))return null;let pi=null;if(ai.currency&&(pi=ii.parse(ai.currency,1,Go),!pi))return null;let di=null;if(ai["min-fraction-digits"]&&(di=ii.parse(ai["min-fraction-digits"],1,go),!di))return null;let yi=null;return ai["max-fraction-digits"]&&(yi=ii.parse(ai["max-fraction-digits"],1,go),!yi)?null:new fu(oi,ui,pi,di,yi)}evaluate(ze){return new Intl.NumberFormat(this.locale?this.locale.evaluate(ze):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(ze):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(ze):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(ze):void 0}).format(this.number.evaluate(ze))}eachChild(ze){ze(this.number),this.locale&&ze(this.locale),this.currency&&ze(this.currency),this.minFractionDigits&&ze(this.minFractionDigits),this.maxFractionDigits&&ze(this.maxFractionDigits)}outputDefined(){return!1}}class Rc{constructor(ze){this.type=Ui,this.sections=ze}static parse(ze,ii){if(ze.length<2)return ii.error("Expected at least one argument.");const oi=ze[1];if(!Array.isArray(oi)&&typeof oi=="object")return ii.error("First argument must be an image or text section.");const ai=[];let ui=!1;for(let pi=1;pi<=ze.length-1;++pi){const di=ze[pi];if(ui&&typeof di=="object"&&!Array.isArray(di)){ui=!1;let yi=null;if(di["font-scale"]&&(yi=ii.parse(di["font-scale"],1,go),!yi))return null;let xi=null;if(di["text-font"]&&(xi=ii.parse(di["text-font"],1,ji(Go)),!xi))return null;let wi=null;if(di["text-color"]&&(wi=ii.parse(di["text-color"],1,Ea),!wi))return null;const Ii=ai[ai.length-1];Ii.scale=yi,Ii.font=xi,Ii.textColor=wi}else{const yi=ii.parse(ze[pi],1,jo);if(!yi)return null;const xi=yi.type.kind;if(xi!=="string"&&xi!=="value"&&xi!=="null"&&xi!=="resolvedImage")return ii.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");ui=!0,ai.push({content:yi,scale:null,font:null,textColor:null})}}return new Rc(ai)}evaluate(ze){return new ya(this.sections.map(ii=>{const oi=ii.content.evaluate(ze);return En(oi)===Ci?new _c("",oi,null,null,null):new _c(on(oi),null,ii.scale?ii.scale.evaluate(ze):null,ii.font?ii.font.evaluate(ze).join(","):null,ii.textColor?ii.textColor.evaluate(ze):null)}))}eachChild(ze){for(const ii of this.sections)ze(ii.content),ii.scale&&ze(ii.scale),ii.font&&ze(ii.font),ii.textColor&&ze(ii.textColor)}outputDefined(){return!1}}class mu{constructor(ze){this.type=Ci,this.input=ze}static parse(ze,ii){if(ze.length!==2)return ii.error("Expected two arguments.");const oi=ii.parse(ze[1],1,Go);return oi?new mu(oi):ii.error("No image name provided.")}evaluate(ze){const ii=this.input.evaluate(ze),oi=ha.fromString(ii);return oi&&ze.availableImages&&(oi.available=ze.availableImages.indexOf(ii)>-1),oi}eachChild(ze){ze(this.input)}outputDefined(){return!1}}class _u{constructor(ze){this.type=go,this.input=ze}static parse(ze,ii){if(ze.length!==2)return ii.error(`Expected 1 argument, but found ${ze.length-1} instead.`);const oi=ii.parse(ze[1],1);return oi?oi.type.kind!=="array"&&oi.type.kind!=="string"&&oi.type.kind!=="value"?ii.error(`Expected argument of type string or array, but found ${Gi(oi.type)} instead.`):new _u(oi):null}evaluate(ze){const ii=this.input.evaluate(ze);if(typeof ii=="string"||Array.isArray(ii))return ii.length;throw new zn(`Expected value to be of type string or array, but found ${Gi(En(ii))} instead.`)}eachChild(ze){ze(this.input)}outputDefined(){return!1}}const Ll={"==":gp,"!=":xp,">":bp,"<":vp,">=":Sp,"<=":wp,array:ls,at:uu,boolean:ls,case:du,coalesce:Ac,collator:vc,format:Rc,image:mu,in:hu,"index-of":Cc,interpolate:Xa,"interpolate-hcl":Xa,"interpolate-lab":Xa,length:_u,let:Pc,literal:ul,match:pu,number:ls,"number-format":fu,object:ls,slice:zc,step:Qs,string:ls,"to-boolean":Ks,"to-color":Ks,"to-number":Ks,"to-string":Ks,var:wc,within:hl};function yh(ti,[ze,ii,oi,ai]){ze=ze.evaluate(ti),ii=ii.evaluate(ti),oi=oi.evaluate(ti);const ui=ai?ai.evaluate(ti):1,pi=yc(ze,ii,oi,ui);if(pi)throw new zn(pi);return new cn(ze/255,ii/255,oi/255,ui,!1)}function gh(ti,ze){return ti in ze}function yu(ti,ze){const ii=ze[ti];return ii===void 0?null:ii}function pl(ti){return{type:ti}}function xh(ti){return{result:"success",value:ti}}function el(ti){return{result:"error",value:ti}}function Ol(ti){return ti["property-type"]==="data-driven"||ti["property-type"]==="cross-faded-data-driven"}function vh(ti){return!!ti.expression&&ti.expression.parameters.indexOf("zoom")>-1}function gu(ti){return!!ti.expression&&ti.expression.interpolated}function nn(ti){return ti instanceof Number?"number":ti instanceof String?"string":ti instanceof Boolean?"boolean":Array.isArray(ti)?"array":ti===null?"null":typeof ti}function Tn(ti){return typeof ti=="object"&&ti!==null&&!Array.isArray(ti)}function Ep(ti){return ti}function Jo(ti,ze){const ii=ze.type==="color",oi=ti.stops&&typeof ti.stops[0][0]=="object",ai=oi||!(oi||ti.property!==void 0),ui=ti.type||(gu(ze)?"exponential":"interval");if(ii||ze.type==="padding"){const wi=ii?cn.parse:Ha.parse;(ti=Ss({},ti)).stops&&(ti.stops=ti.stops.map(Ii=>[Ii[0],wi(Ii[1])])),ti.default=wi(ti.default?ti.default:ze.default)}if(ti.colorSpace&&(pi=ti.colorSpace)!=="rgb"&&pi!=="hcl"&&pi!=="lab")throw new Error(`Unknown color space: "${ti.colorSpace}"`);var pi;let di,yi,xi;if(ui==="exponential")di=Wl;else if(ui==="interval")di=wn;else if(ui==="categorical"){di=In,yi=Object.create(null);for(const wi of ti.stops)yi[wi[0]]=wi[1];xi=typeof ti.stops[0][0]}else{if(ui!=="identity")throw new Error(`Unknown function type "${ui}"`);di=bh}if(oi){const wi={},Ii=[];for(let Li=0;Li<ti.stops.length;Li++){const Fi=ti.stops[Li],qi=Fi[0].zoom;wi[qi]===void 0&&(wi[qi]={zoom:qi,type:ti.type,property:ti.property,default:ti.default,stops:[]},Ii.push(qi)),wi[qi].stops.push([Fi[0].value,Fi[1]])}const Pi=[];for(const Li of Ii)Pi.push([wi[Li].zoom,Jo(wi[Li],ze)]);const Ri={name:"linear"};return{kind:"composite",interpolationType:Ri,interpolationFactor:Xa.interpolationFactor.bind(void 0,Ri),zoomStops:Pi.map(Li=>Li[0]),evaluate:({zoom:Li},Fi)=>Wl({stops:Pi,base:ti.base},ze,Li).evaluate(Li,Fi)}}if(ai){const wi=ui==="exponential"?{name:"exponential",base:ti.base!==void 0?ti.base:1}:null;return{kind:"camera",interpolationType:wi,interpolationFactor:Xa.interpolationFactor.bind(void 0,wi),zoomStops:ti.stops.map(Ii=>Ii[0]),evaluate:({zoom:Ii})=>di(ti,ze,Ii,yi,xi)}}return{kind:"source",evaluate(wi,Ii){const Pi=Ii&&Ii.properties?Ii.properties[ti.property]:void 0;return Pi===void 0?dl(ti.default,ze.default):di(ti,ze,Pi,yi,xi)}}}function dl(ti,ze,ii){return ti!==void 0?ti:ze!==void 0?ze:ii!==void 0?ii:void 0}function In(ti,ze,ii,oi,ai){return dl(typeof ii===ai?oi[ii]:void 0,ti.default,ze.default)}function wn(ti,ze,ii){if(nn(ii)!=="number")return dl(ti.default,ze.default);const oi=ti.stops.length;if(oi===1||ii<=ti.stops[0][0])return ti.stops[0][1];if(ii>=ti.stops[oi-1][0])return ti.stops[oi-1][1];const ai=Rl(ti.stops.map(ui=>ui[0]),ii);return ti.stops[ai][1]}function Wl(ti,ze,ii){const oi=ti.base!==void 0?ti.base:1;if(nn(ii)!=="number")return dl(ti.default,ze.default);const ai=ti.stops.length;if(ai===1||ii<=ti.stops[0][0])return ti.stops[0][1];if(ii>=ti.stops[ai-1][0])return ti.stops[ai-1][1];const ui=Rl(ti.stops.map(wi=>wi[0]),ii),pi=function(wi,Ii,Pi,Ri){const Li=Ri-Pi,Fi=wi-Pi;return Li===0?0:Ii===1?Fi/Li:(Math.pow(Ii,Fi)-1)/(Math.pow(Ii,Li)-1)}(ii,oi,ti.stops[ui][0],ti.stops[ui+1][0]),di=ti.stops[ui][1],yi=ti.stops[ui+1][1],xi=Ya[ze.type]||Ep;return typeof di.evaluate=="function"?{evaluate(...wi){const Ii=di.evaluate.apply(void 0,wi),Pi=yi.evaluate.apply(void 0,wi);if(Ii!==void 0&&Pi!==void 0)return xi(Ii,Pi,pi,ti.colorSpace)}}:xi(di,yi,pi,ti.colorSpace)}function bh(ti,ze,ii){switch(ze.type){case"color":ii=cn.parse(ii);break;case"formatted":ii=ya.fromString(ii.toString());break;case"resolvedImage":ii=ha.fromString(ii.toString());break;case"padding":ii=Ha.parse(ii);break;default:nn(ii)===ze.type||ze.type==="enum"&&ze.values[ii]||(ii=void 0)}return dl(ii,ti.default,ze.default)}cs.register(Ll,{error:[{kind:"error"},[Go],(ti,[ze])=>{throw new zn(ze.evaluate(ti))}],typeof:[Go,[jo],(ti,[ze])=>Gi(En(ze.evaluate(ti)))],"to-rgba":[ji(go,4),[Ea],(ti,[ze])=>{const[ii,oi,ai,ui]=ze.evaluate(ti).rgb;return[255*ii,255*oi,255*ai,ui]}],rgb:[Ea,[go,go,go],yh],rgba:[Ea,[go,go,go,go],yh],has:{type:Uo,overloads:[[[Go],(ti,[ze])=>gh(ze.evaluate(ti),ti.properties())],[[Go,Es],(ti,[ze,ii])=>gh(ze.evaluate(ti),ii.evaluate(ti))]]},get:{type:jo,overloads:[[[Go],(ti,[ze])=>yu(ze.evaluate(ti),ti.properties())],[[Go,Es],(ti,[ze,ii])=>yu(ze.evaluate(ti),ii.evaluate(ti))]]},"feature-state":[jo,[Go],(ti,[ze])=>yu(ze.evaluate(ti),ti.featureState||{})],properties:[Es,[],ti=>ti.properties()],"geometry-type":[Go,[],ti=>ti.geometryType()],id:[jo,[],ti=>ti.id()],zoom:[go,[],ti=>ti.globals.zoom],"heatmap-density":[go,[],ti=>ti.globals.heatmapDensity||0],"line-progress":[go,[],ti=>ti.globals.lineProgress||0],accumulated:[jo,[],ti=>ti.globals.accumulated===void 0?null:ti.globals.accumulated],"+":[go,pl(go),(ti,ze)=>{let ii=0;for(const oi of ze)ii+=oi.evaluate(ti);return ii}],"*":[go,pl(go),(ti,ze)=>{let ii=1;for(const oi of ze)ii*=oi.evaluate(ti);return ii}],"-":{type:go,overloads:[[[go,go],(ti,[ze,ii])=>ze.evaluate(ti)-ii.evaluate(ti)],[[go],(ti,[ze])=>-ze.evaluate(ti)]]},"/":[go,[go,go],(ti,[ze,ii])=>ze.evaluate(ti)/ii.evaluate(ti)],"%":[go,[go,go],(ti,[ze,ii])=>ze.evaluate(ti)%ii.evaluate(ti)],ln2:[go,[],()=>Math.LN2],pi:[go,[],()=>Math.PI],e:[go,[],()=>Math.E],"^":[go,[go,go],(ti,[ze,ii])=>Math.pow(ze.evaluate(ti),ii.evaluate(ti))],sqrt:[go,[go],(ti,[ze])=>Math.sqrt(ze.evaluate(ti))],log10:[go,[go],(ti,[ze])=>Math.log(ze.evaluate(ti))/Math.LN10],ln:[go,[go],(ti,[ze])=>Math.log(ze.evaluate(ti))],log2:[go,[go],(ti,[ze])=>Math.log(ze.evaluate(ti))/Math.LN2],sin:[go,[go],(ti,[ze])=>Math.sin(ze.evaluate(ti))],cos:[go,[go],(ti,[ze])=>Math.cos(ze.evaluate(ti))],tan:[go,[go],(ti,[ze])=>Math.tan(ze.evaluate(ti))],asin:[go,[go],(ti,[ze])=>Math.asin(ze.evaluate(ti))],acos:[go,[go],(ti,[ze])=>Math.acos(ze.evaluate(ti))],atan:[go,[go],(ti,[ze])=>Math.atan(ze.evaluate(ti))],min:[go,pl(go),(ti,ze)=>Math.min(...ze.map(ii=>ii.evaluate(ti)))],max:[go,pl(go),(ti,ze)=>Math.max(...ze.map(ii=>ii.evaluate(ti)))],abs:[go,[go],(ti,[ze])=>Math.abs(ze.evaluate(ti))],round:[go,[go],(ti,[ze])=>{const ii=ze.evaluate(ti);return ii<0?-Math.round(-ii):Math.round(ii)}],floor:[go,[go],(ti,[ze])=>Math.floor(ze.evaluate(ti))],ceil:[go,[go],(ti,[ze])=>Math.ceil(ze.evaluate(ti))],"filter-==":[Uo,[Go,jo],(ti,[ze,ii])=>ti.properties()[ze.value]===ii.value],"filter-id-==":[Uo,[jo],(ti,[ze])=>ti.id()===ze.value],"filter-type-==":[Uo,[Go],(ti,[ze])=>ti.geometryType()===ze.value],"filter-<":[Uo,[Go,jo],(ti,[ze,ii])=>{const oi=ti.properties()[ze.value],ai=ii.value;return typeof oi==typeof ai&&oi<ai}],"filter-id-<":[Uo,[jo],(ti,[ze])=>{const ii=ti.id(),oi=ze.value;return typeof ii==typeof oi&&ii<oi}],"filter->":[Uo,[Go,jo],(ti,[ze,ii])=>{const oi=ti.properties()[ze.value],ai=ii.value;return typeof oi==typeof ai&&oi>ai}],"filter-id->":[Uo,[jo],(ti,[ze])=>{const ii=ti.id(),oi=ze.value;return typeof ii==typeof oi&&ii>oi}],"filter-<=":[Uo,[Go,jo],(ti,[ze,ii])=>{const oi=ti.properties()[ze.value],ai=ii.value;return typeof oi==typeof ai&&oi<=ai}],"filter-id-<=":[Uo,[jo],(ti,[ze])=>{const ii=ti.id(),oi=ze.value;return typeof ii==typeof oi&&ii<=oi}],"filter->=":[Uo,[Go,jo],(ti,[ze,ii])=>{const oi=ti.properties()[ze.value],ai=ii.value;return typeof oi==typeof ai&&oi>=ai}],"filter-id->=":[Uo,[jo],(ti,[ze])=>{const ii=ti.id(),oi=ze.value;return typeof ii==typeof oi&&ii>=oi}],"filter-has":[Uo,[jo],(ti,[ze])=>ze.value in ti.properties()],"filter-has-id":[Uo,[],ti=>ti.id()!==null&&ti.id()!==void 0],"filter-type-in":[Uo,[ji(Go)],(ti,[ze])=>ze.value.indexOf(ti.geometryType())>=0],"filter-id-in":[Uo,[ji(jo)],(ti,[ze])=>ze.value.indexOf(ti.id())>=0],"filter-in-small":[Uo,[Go,ji(jo)],(ti,[ze,ii])=>ii.value.indexOf(ti.properties()[ze.value])>=0],"filter-in-large":[Uo,[Go,ji(jo)],(ti,[ze,ii])=>function(oi,ai,ui,pi){for(;ui<=pi;){const di=ui+pi>>1;if(ai[di]===oi)return!0;ai[di]>oi?pi=di-1:ui=di+1}return!1}(ti.properties()[ze.value],ii.value,0,ii.value.length-1)],all:{type:Uo,overloads:[[[Uo,Uo],(ti,[ze,ii])=>ze.evaluate(ti)&&ii.evaluate(ti)],[pl(Uo),(ti,ze)=>{for(const ii of ze)if(!ii.evaluate(ti))return!1;return!0}]]},any:{type:Uo,overloads:[[[Uo,Uo],(ti,[ze,ii])=>ze.evaluate(ti)||ii.evaluate(ti)],[pl(Uo),(ti,ze)=>{for(const ii of ze)if(ii.evaluate(ti))return!0;return!1}]]},"!":[Uo,[Uo],(ti,[ze])=>!ze.evaluate(ti)],"is-supported-script":[Uo,[Go],(ti,[ze])=>{const ii=ti.globals&&ti.globals.isSupportedScript;return!ii||ii(ze.evaluate(ti))}],upcase:[Go,[Go],(ti,[ze])=>ze.evaluate(ti).toUpperCase()],downcase:[Go,[Go],(ti,[ze])=>ze.evaluate(ti).toLowerCase()],concat:[Go,pl(jo),(ti,ze)=>ze.map(ii=>on(ii.evaluate(ti))).join("")],"resolved-locale":[Go,[Bs],(ti,[ze])=>ze.evaluate(ti).resolvedLocale()]});class xu{constructor(ze,ii){var oi;this.expression=ze,this._warningHistory={},this._evaluator=new ru,this._defaultValue=ii?(oi=ii).type==="color"&&Tn(oi.default)?new cn(0,0,0,0):oi.type==="color"?cn.parse(oi.default)||null:oi.type==="padding"?Ha.parse(oi.default)||null:oi.type==="variableAnchorOffsetCollection"?ss.parse(oi.default)||null:oi.default===void 0?null:oi.default:null,this._enumValues=ii&&ii.type==="enum"?ii.values:null}evaluateWithoutErrorHandling(ze,ii,oi,ai,ui,pi){return this._evaluator.globals=ze,this._evaluator.feature=ii,this._evaluator.featureState=oi,this._evaluator.canonical=ai,this._evaluator.availableImages=ui||null,this._evaluator.formattedSection=pi,this.expression.evaluate(this._evaluator)}evaluate(ze,ii,oi,ai,ui,pi){this._evaluator.globals=ze,this._evaluator.feature=ii||null,this._evaluator.featureState=oi||null,this._evaluator.canonical=ai,this._evaluator.availableImages=ui||null,this._evaluator.formattedSection=pi||null;try{const di=this.expression.evaluate(this._evaluator);if(di==null||typeof di=="number"&&di!=di)return this._defaultValue;if(this._enumValues&&!(di in this._enumValues))throw new zn(`Expected value to be one of ${Object.keys(this._enumValues).map(yi=>JSON.stringify(yi)).join(", ")}, but found ${JSON.stringify(di)} instead.`);return di}catch(di){return this._warningHistory[di.message]||(this._warningHistory[di.message]=!0,typeof console<"u"&&console.warn(di.message)),this._defaultValue}}}function Mc(ti){return Array.isArray(ti)&&ti.length>0&&typeof ti[0]=="string"&&ti[0]in Ll}function Lc(ti,ze){const ii=new xc(Ll,Sc,[],ze?function(ai){const ui={color:Ea,string:Go,number:go,enum:Go,boolean:Uo,formatted:Ui,padding:Ai,resolvedImage:Ci,variableAnchorOffsetCollection:ki};return ai.type==="array"?ji(ui[ai.value]||jo,ai.length):ui[ai.type]}(ze):void 0),oi=ii.parse(ti,void 0,void 0,void 0,ze&&ze.type==="string"?{typeAnnotation:"coerce"}:void 0);return oi?xh(new xu(oi,ze)):el(ii.errors)}class vu{constructor(ze,ii){this.kind=ze,this._styleExpression=ii,this.isStateDependent=ze!=="constant"&&!Xl(ii.expression)}evaluateWithoutErrorHandling(ze,ii,oi,ai,ui,pi){return this._styleExpression.evaluateWithoutErrorHandling(ze,ii,oi,ai,ui,pi)}evaluate(ze,ii,oi,ai,ui,pi){return this._styleExpression.evaluate(ze,ii,oi,ai,ui,pi)}}class Oc{constructor(ze,ii,oi,ai){this.kind=ze,this.zoomStops=oi,this._styleExpression=ii,this.isStateDependent=ze!=="camera"&&!Xl(ii.expression),this.interpolationType=ai}evaluateWithoutErrorHandling(ze,ii,oi,ai,ui,pi){return this._styleExpression.evaluateWithoutErrorHandling(ze,ii,oi,ai,ui,pi)}evaluate(ze,ii,oi,ai,ui,pi){return this._styleExpression.evaluate(ze,ii,oi,ai,ui,pi)}interpolationFactor(ze,ii,oi){return this.interpolationType?Xa.interpolationFactor(this.interpolationType,ze,ii,oi):0}}function bu(ti,ze){const ii=Lc(ti,ze);if(ii.result==="error")return ii;const oi=ii.value.expression,ai=Ec(oi);if(!ai&&!Ol(ze))return el([new Cn("","data expressions not supported")]);const ui=Tc(oi,["zoom"]);if(!ui&&!vh(ze))return el([new Cn("","zoom expressions not supported")]);const pi=Jl(oi);return pi||ui?pi instanceof Cn?el([pi]):pi instanceof Xa&&!gu(ze)?el([new Cn("",'"interpolate" expressions cannot be used with this property')]):xh(pi?new Oc(ai?"camera":"composite",ii.value,pi.labels,pi instanceof Xa?pi.interpolation:void 0):new vu(ai?"constant":"source",ii.value)):el([new Cn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Kl{constructor(ze,ii){this._parameters=ze,this._specification=ii,Ss(this,Jo(this._parameters,this._specification))}static deserialize(ze){return new Kl(ze._parameters,ze._specification)}static serialize(ze){return{_parameters:ze._parameters,_specification:ze._specification}}}function Jl(ti){let ze=null;if(ti instanceof Pc)ze=Jl(ti.result);else if(ti instanceof Ac){for(const ii of ti.args)if(ze=Jl(ii),ze)break}else(ti instanceof Qs||ti instanceof Xa)&&ti.input instanceof cs&&ti.input.name==="zoom"&&(ze=ti);return ze instanceof Cn||ti.eachChild(ii=>{const oi=Jl(ii);oi instanceof Cn?ze=oi:!ze&&oi?ze=new Cn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):ze&&oi&&ze!==oi&&(ze=new Cn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),ze}function Ql(ti){if(ti===!0||ti===!1)return!0;if(!Array.isArray(ti)||ti.length===0)return!1;switch(ti[0]){case"has":return ti.length>=2&&ti[1]!=="$id"&&ti[1]!=="$type";case"in":return ti.length>=3&&(typeof ti[1]!="string"||Array.isArray(ti[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return ti.length!==3||Array.isArray(ti[1])||Array.isArray(ti[2]);case"any":case"all":for(const ze of ti.slice(1))if(!Ql(ze)&&typeof ze!="boolean")return!1;return!0;default:return!0}}const Tp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wu(ti){if(ti==null)return{filter:()=>!0,needGeometry:!1};Ql(ti)||(ti=kc(ti));const ze=Lc(ti,Tp);if(ze.result==="error")throw new Error(ze.value.map(ii=>`${ii.key}: ${ii.message}`).join(", "));return{filter:(ii,oi,ai)=>ze.value.evaluate(ii,oi,{},ai),needGeometry:wh(ti)}}function Ip(ti,ze){return ti<ze?-1:ti>ze?1:0}function wh(ti){if(!Array.isArray(ti))return!1;if(ti[0]==="within")return!0;for(let ze=1;ze<ti.length;ze++)if(wh(ti[ze]))return!0;return!1}function kc(ti){if(!ti)return!0;const ze=ti[0];return ti.length<=1?ze!=="any":ze==="=="?Su(ti[1],ti[2],"=="):ze==="!="?ec(Su(ti[1],ti[2],"==")):ze==="<"||ze===">"||ze==="<="||ze===">="?Su(ti[1],ti[2],ze):ze==="any"?(ii=ti.slice(1),["any"].concat(ii.map(kc))):ze==="all"?["all"].concat(ti.slice(1).map(kc)):ze==="none"?["all"].concat(ti.slice(1).map(kc).map(ec)):ze==="in"?Sh(ti[1],ti.slice(2)):ze==="!in"?ec(Sh(ti[1],ti.slice(2))):ze==="has"?Eh(ti[1]):ze==="!has"?ec(Eh(ti[1])):ze!=="within"||ti;var ii}function Su(ti,ze,ii){switch(ti){case"$type":return[`filter-type-${ii}`,ze];case"$id":return[`filter-id-${ii}`,ze];default:return[`filter-${ii}`,ti,ze]}}function Sh(ti,ze){if(ze.length===0)return!1;switch(ti){case"$type":return["filter-type-in",["literal",ze]];case"$id":return["filter-id-in",["literal",ze]];default:return ze.length>200&&!ze.some(ii=>typeof ii!=typeof ze[0])?["filter-in-large",ti,["literal",ze.sort(Ip)]]:["filter-in-small",ti,["literal",ze]]}}function Eh(ti){switch(ti){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",ti]}}function ec(ti){return["!",ti]}function Dc(ti){const ze=typeof ti;if(ze==="number"||ze==="boolean"||ze==="string"||ti==null)return JSON.stringify(ti);if(Array.isArray(ti)){let ai="[";for(const ui of ti)ai+=`${Dc(ui)},`;return`${ai}]`}const ii=Object.keys(ti).sort();let oi="{";for(let ai=0;ai<ii.length;ai++)oi+=`${JSON.stringify(ii[ai])}:${Dc(ti[ii[ai]])},`;return`${oi}}`}function Fc(ti){let ze="";for(const ii of Da)ze+=`/${Dc(ti[ii])}`;return ze}function Th(ti){const ze=ti.value;return ze?[new _o(ti.key,ze,"constants have been deprecated as of v8")]:[]}function Rn(ti){return ti instanceof Number||ti instanceof String||ti instanceof Boolean?ti.valueOf():ti}function fl(ti){if(Array.isArray(ti))return ti.map(fl);if(ti instanceof Object&&!(ti instanceof Number||ti instanceof String||ti instanceof Boolean)){const ze={};for(const ii in ti)ze[ii]=fl(ti[ii]);return ze}return Rn(ti)}function Fa(ti){const ze=ti.key,ii=ti.value,oi=ti.valueSpec||{},ai=ti.objectElementValidators||{},ui=ti.style,pi=ti.styleSpec,di=ti.validateSpec;let yi=[];const xi=nn(ii);if(xi!=="object")return[new _o(ze,ii,`object expected, ${xi} found`)];for(const wi in ii){const Ii=wi.split(".")[0],Pi=oi[Ii]||oi["*"];let Ri;if(ai[Ii])Ri=ai[Ii];else if(oi[Ii])Ri=di;else if(ai["*"])Ri=ai["*"];else{if(!oi["*"]){yi.push(new _o(ze,ii[wi],`unknown property "${wi}"`));continue}Ri=di}yi=yi.concat(Ri({key:(ze&&`${ze}.`)+wi,value:ii[wi],valueSpec:Pi,style:ui,styleSpec:pi,object:ii,objectKey:wi,validateSpec:di},ii))}for(const wi in oi)ai[wi]||oi[wi].required&&oi[wi].default===void 0&&ii[wi]===void 0&&yi.push(new _o(ze,ii,`missing required property "${wi}"`));return yi}function kl(ti){const ze=ti.value,ii=ti.valueSpec,oi=ti.style,ai=ti.styleSpec,ui=ti.key,pi=ti.arrayElementValidator||ti.validateSpec;if(nn(ze)!=="array")return[new _o(ui,ze,`array expected, ${nn(ze)} found`)];if(ii.length&&ze.length!==ii.length)return[new _o(ui,ze,`array length ${ii.length} expected, length ${ze.length} found`)];if(ii["min-length"]&&ze.length<ii["min-length"])return[new _o(ui,ze,`array length at least ${ii["min-length"]} expected, length ${ze.length} found`)];let di={type:ii.value,values:ii.values};ai.$version<7&&(di.function=ii.function),nn(ii.value)==="object"&&(di=ii.value);let yi=[];for(let xi=0;xi<ze.length;xi++)yi=yi.concat(pi({array:ze,arrayIndex:xi,value:ze[xi],valueSpec:di,validateSpec:ti.validateSpec,style:oi,styleSpec:ai,key:`${ui}[${xi}]`}));return yi}function tc(ti){const ze=ti.key,ii=ti.value,oi=ti.valueSpec;let ai=nn(ii);return ai==="number"&&ii!=ii&&(ai="NaN"),ai!=="number"?[new _o(ze,ii,`number expected, ${ai} found`)]:"minimum"in oi&&ii<oi.minimum?[new _o(ze,ii,`${ii} is less than the minimum value ${oi.minimum}`)]:"maximum"in oi&&ii>oi.maximum?[new _o(ze,ii,`${ii} is greater than the maximum value ${oi.maximum}`)]:[]}function Bc(ti){const ze=ti.valueSpec,ii=Rn(ti.value.type);let oi,ai,ui,pi={};const di=ii!=="categorical"&&ti.value.property===void 0,yi=!di,xi=nn(ti.value.stops)==="array"&&nn(ti.value.stops[0])==="array"&&nn(ti.value.stops[0][0])==="object",wi=Fa({key:ti.key,value:ti.value,valueSpec:ti.styleSpec.function,validateSpec:ti.validateSpec,style:ti.style,styleSpec:ti.styleSpec,objectElementValidators:{stops:function(Ri){if(ii==="identity")return[new _o(Ri.key,Ri.value,'identity function may not have a "stops" property')];let Li=[];const Fi=Ri.value;return Li=Li.concat(kl({key:Ri.key,value:Fi,valueSpec:Ri.valueSpec,validateSpec:Ri.validateSpec,style:Ri.style,styleSpec:Ri.styleSpec,arrayElementValidator:Ii})),nn(Fi)==="array"&&Fi.length===0&&Li.push(new _o(Ri.key,Fi,"array must have at least one stop")),Li},default:function(Ri){return Ri.validateSpec({key:Ri.key,value:Ri.value,valueSpec:ze,validateSpec:Ri.validateSpec,style:Ri.style,styleSpec:Ri.styleSpec})}}});return ii==="identity"&&di&&wi.push(new _o(ti.key,ti.value,'missing required property "property"')),ii==="identity"||ti.value.stops||wi.push(new _o(ti.key,ti.value,'missing required property "stops"')),ii==="exponential"&&ti.valueSpec.expression&&!gu(ti.valueSpec)&&wi.push(new _o(ti.key,ti.value,"exponential functions not supported")),ti.styleSpec.$version>=8&&(yi&&!Ol(ti.valueSpec)?wi.push(new _o(ti.key,ti.value,"property functions not supported")):di&&!vh(ti.valueSpec)&&wi.push(new _o(ti.key,ti.value,"zoom functions not supported"))),ii!=="categorical"&&!xi||ti.value.property!==void 0||wi.push(new _o(ti.key,ti.value,'"property" property is required')),wi;function Ii(Ri){let Li=[];const Fi=Ri.value,qi=Ri.key;if(nn(Fi)!=="array")return[new _o(qi,Fi,`array expected, ${nn(Fi)} found`)];if(Fi.length!==2)return[new _o(qi,Fi,`array length 2 expected, length ${Fi.length} found`)];if(xi){if(nn(Fi[0])!=="object")return[new _o(qi,Fi,`object expected, ${nn(Fi[0])} found`)];if(Fi[0].zoom===void 0)return[new _o(qi,Fi,"object stop key must have zoom")];if(Fi[0].value===void 0)return[new _o(qi,Fi,"object stop key must have value")];if(ui&&ui>Rn(Fi[0].zoom))return[new _o(qi,Fi[0].zoom,"stop zoom values must appear in ascending order")];Rn(Fi[0].zoom)!==ui&&(ui=Rn(Fi[0].zoom),ai=void 0,pi={}),Li=Li.concat(Fa({key:`${qi}[0]`,value:Fi[0],valueSpec:{zoom:{}},validateSpec:Ri.validateSpec,style:Ri.style,styleSpec:Ri.styleSpec,objectElementValidators:{zoom:tc,value:Pi}}))}else Li=Li.concat(Pi({key:`${qi}[0]`,value:Fi[0],valueSpec:{},validateSpec:Ri.validateSpec,style:Ri.style,styleSpec:Ri.styleSpec},Fi));return Mc(fl(Fi[1]))?Li.concat([new _o(`${qi}[1]`,Fi[1],"expressions are not allowed in function stops.")]):Li.concat(Ri.validateSpec({key:`${qi}[1]`,value:Fi[1],valueSpec:ze,validateSpec:Ri.validateSpec,style:Ri.style,styleSpec:Ri.styleSpec}))}function Pi(Ri,Li){const Fi=nn(Ri.value),qi=Rn(Ri.value),Zi=Ri.value!==null?Ri.value:Li;if(oi){if(Fi!==oi)return[new _o(Ri.key,Zi,`${Fi} stop domain type must match previous stop domain type ${oi}`)]}else oi=Fi;if(Fi!=="number"&&Fi!=="string"&&Fi!=="boolean")return[new _o(Ri.key,Zi,"stop domain value must be a number, string, or boolean")];if(Fi!=="number"&&ii!=="categorical"){let Gr=`number expected, ${Fi} found`;return Ol(ze)&&ii===void 0&&(Gr+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _o(Ri.key,Zi,Gr)]}return ii!=="categorical"||Fi!=="number"||isFinite(qi)&&Math.floor(qi)===qi?ii!=="categorical"&&Fi==="number"&&ai!==void 0&&qi<ai?[new _o(Ri.key,Zi,"stop domain values must appear in ascending order")]:(ai=qi,ii==="categorical"&&qi in pi?[new _o(Ri.key,Zi,"stop domain values must be unique")]:(pi[qi]=!0,[])):[new _o(Ri.key,Zi,`integer expected, found ${qi}`)]}}function ml(ti){const ze=(ti.expressionContext==="property"?bu:Lc)(fl(ti.value),ti.valueSpec);if(ze.result==="error")return ze.value.map(oi=>new _o(`${ti.key}${oi.key}`,ti.value,oi.message));const ii=ze.value.expression||ze.value._styleExpression.expression;if(ti.expressionContext==="property"&&ti.propertyKey==="text-font"&&!ii.outputDefined())return[new _o(ti.key,ti.value,`Invalid data expression for "${ti.propertyKey}". Output values must be contained as literals within the expression.`)];if(ti.expressionContext==="property"&&ti.propertyType==="layout"&&!Xl(ii))return[new _o(ti.key,ti.value,'"feature-state" data expressions are not supported with layout properties.')];if(ti.expressionContext==="filter"&&!Xl(ii))return[new _o(ti.key,ti.value,'"feature-state" data expressions are not supported with filters.')];if(ti.expressionContext&&ti.expressionContext.indexOf("cluster")===0){if(!Tc(ii,["zoom","feature-state"]))return[new _o(ti.key,ti.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(ti.expressionContext==="cluster-initial"&&!Ec(ii))return[new _o(ti.key,ti.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ic(ti){const ze=ti.key,ii=ti.value,oi=ti.valueSpec,ai=[];return Array.isArray(oi.values)?oi.values.indexOf(Rn(ii))===-1&&ai.push(new _o(ze,ii,`expected one of [${oi.values.join(", ")}], ${JSON.stringify(ii)} found`)):Object.keys(oi.values).indexOf(Rn(ii))===-1&&ai.push(new _o(ze,ii,`expected one of [${Object.keys(oi.values).join(", ")}], ${JSON.stringify(ii)} found`)),ai}function Dl(ti){return Ql(fl(ti.value))?ml(Ss({},ti,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ih(ti)}function Ih(ti){const ze=ti.value,ii=ti.key;if(nn(ze)!=="array")return[new _o(ii,ze,`array expected, ${nn(ze)} found`)];const oi=ti.styleSpec;let ai,ui=[];if(ze.length<1)return[new _o(ii,ze,"filter array must have at least 1 element")];switch(ui=ui.concat(ic({key:`${ii}[0]`,value:ze[0],valueSpec:oi.filter_operator,style:ti.style,styleSpec:ti.styleSpec})),Rn(ze[0])){case"<":case"<=":case">":case">=":ze.length>=2&&Rn(ze[1])==="$type"&&ui.push(new _o(ii,ze,`"$type" cannot be use with operator "${ze[0]}"`));case"==":case"!=":ze.length!==3&&ui.push(new _o(ii,ze,`filter array for operator "${ze[0]}" must have 3 elements`));case"in":case"!in":ze.length>=2&&(ai=nn(ze[1]),ai!=="string"&&ui.push(new _o(`${ii}[1]`,ze[1],`string expected, ${ai} found`)));for(let pi=2;pi<ze.length;pi++)ai=nn(ze[pi]),Rn(ze[1])==="$type"?ui=ui.concat(ic({key:`${ii}[${pi}]`,value:ze[pi],valueSpec:oi.geometry_type,style:ti.style,styleSpec:ti.styleSpec})):ai!=="string"&&ai!=="number"&&ai!=="boolean"&&ui.push(new _o(`${ii}[${pi}]`,ze[pi],`string, number, or boolean expected, ${ai} found`));break;case"any":case"all":case"none":for(let pi=1;pi<ze.length;pi++)ui=ui.concat(Ih({key:`${ii}[${pi}]`,value:ze[pi],style:ti.style,styleSpec:ti.styleSpec}));break;case"has":case"!has":ai=nn(ze[1]),ze.length!==2?ui.push(new _o(ii,ze,`filter array for "${ze[0]}" operator must have 2 elements`)):ai!=="string"&&ui.push(new _o(`${ii}[1]`,ze[1],`string expected, ${ai} found`));break;case"within":ai=nn(ze[1]),ze.length!==2?ui.push(new _o(ii,ze,`filter array for "${ze[0]}" operator must have 2 elements`)):ai!=="object"&&ui.push(new _o(`${ii}[1]`,ze[1],`object expected, ${ai} found`))}return ui}function Ah(ti,ze){const ii=ti.key,oi=ti.validateSpec,ai=ti.style,ui=ti.styleSpec,pi=ti.value,di=ti.objectKey,yi=ui[`${ze}_${ti.layerType}`];if(!yi)return[];const xi=di.match(/^(.*)-transition$/);if(ze==="paint"&&xi&&yi[xi[1]]&&yi[xi[1]].transition)return oi({key:ii,value:pi,valueSpec:ui.transition,style:ai,styleSpec:ui});const wi=ti.valueSpec||yi[di];if(!wi)return[new _o(ii,pi,`unknown property "${di}"`)];let Ii;if(nn(pi)==="string"&&Ol(wi)&&!wi.tokens&&(Ii=/^{([^}]+)}$/.exec(pi)))return[new _o(ii,pi,`"${di}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Ii[1])} }\`.`)];const Pi=[];return ti.layerType==="symbol"&&(di==="text-field"&&ai&&!ai.glyphs&&Pi.push(new _o(ii,pi,'use of "text-field" requires a style "glyphs" property')),di==="text-font"&&Tn(fl(pi))&&Rn(pi.type)==="identity"&&Pi.push(new _o(ii,pi,'"text-font" does not support identity functions'))),Pi.concat(oi({key:ti.key,value:pi,valueSpec:wi,style:ai,styleSpec:ui,expressionContext:"property",propertyType:ze,propertyKey:di}))}function Ph(ti){return Ah(ti,"paint")}function Ch(ti){return Ah(ti,"layout")}function zh(ti){let ze=[];const ii=ti.value,oi=ti.key,ai=ti.style,ui=ti.styleSpec;ii.type||ii.ref||ze.push(new _o(oi,ii,'either "type" or "ref" is required'));let pi=Rn(ii.type);const di=Rn(ii.ref);if(ii.id){const yi=Rn(ii.id);for(let xi=0;xi<ti.arrayIndex;xi++){const wi=ai.layers[xi];Rn(wi.id)===yi&&ze.push(new _o(oi,ii.id,`duplicate layer id "${ii.id}", previously used at line ${wi.id.__line__}`))}}if("ref"in ii){let yi;["type","source","source-layer","filter","layout"].forEach(xi=>{xi in ii&&ze.push(new _o(oi,ii[xi],`"${xi}" is prohibited for ref layers`))}),ai.layers.forEach(xi=>{Rn(xi.id)===di&&(yi=xi)}),yi?yi.ref?ze.push(new _o(oi,ii.ref,"ref cannot reference another ref layer")):pi=Rn(yi.type):ze.push(new _o(oi,ii.ref,`ref layer "${di}" not found`))}else if(pi!=="background")if(ii.source){const yi=ai.sources&&ai.sources[ii.source],xi=yi&&Rn(yi.type);yi?xi==="vector"&&pi==="raster"?ze.push(new _o(oi,ii.source,`layer "${ii.id}" requires a raster source`)):xi!=="raster-dem"&&pi==="hillshade"?ze.push(new _o(oi,ii.source,`layer "${ii.id}" requires a raster-dem source`)):xi==="raster"&&pi!=="raster"?ze.push(new _o(oi,ii.source,`layer "${ii.id}" requires a vector source`)):xi!=="vector"||ii["source-layer"]?xi==="raster-dem"&&pi!=="hillshade"?ze.push(new _o(oi,ii.source,"raster-dem source can only be used with layer type 'hillshade'.")):pi!=="line"||!ii.paint||!ii.paint["line-gradient"]||xi==="geojson"&&yi.lineMetrics||ze.push(new _o(oi,ii,`layer "${ii.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):ze.push(new _o(oi,ii,`layer "${ii.id}" must specify a "source-layer"`)):ze.push(new _o(oi,ii.source,`source "${ii.source}" not found`))}else ze.push(new _o(oi,ii,'missing required property "source"'));return ze=ze.concat(Fa({key:oi,value:ii,valueSpec:ui.layer,style:ti.style,styleSpec:ti.styleSpec,validateSpec:ti.validateSpec,objectElementValidators:{"*":()=>[],type:()=>ti.validateSpec({key:`${oi}.type`,value:ii.type,valueSpec:ui.layer.type,style:ti.style,styleSpec:ti.styleSpec,validateSpec:ti.validateSpec,object:ii,objectKey:"type"}),filter:Dl,layout:yi=>Fa({layer:ii,key:yi.key,value:yi.value,style:yi.style,styleSpec:yi.styleSpec,validateSpec:yi.validateSpec,objectElementValidators:{"*":xi=>Ch(Ss({layerType:pi},xi))}}),paint:yi=>Fa({layer:ii,key:yi.key,value:yi.value,style:yi.style,styleSpec:yi.styleSpec,validateSpec:yi.validateSpec,objectElementValidators:{"*":xi=>Ph(Ss({layerType:pi},xi))}})}})),ze}function Ts(ti){const ze=ti.value,ii=ti.key,oi=nn(ze);return oi!=="string"?[new _o(ii,ze,`string expected, ${oi} found`)]:[]}const rc={promoteId:function({key:ti,value:ze}){if(nn(ze)==="string")return Ts({key:ti,value:ze});{const ii=[];for(const oi in ze)ii.push(...Ts({key:`${ti}.${oi}`,value:ze[oi]}));return ii}}};function Wa(ti){const ze=ti.value,ii=ti.key,oi=ti.styleSpec,ai=ti.style,ui=ti.validateSpec;if(!ze.type)return[new _o(ii,ze,'"type" is required')];const pi=Rn(ze.type);let di;switch(pi){case"vector":case"raster":return di=Fa({key:ii,value:ze,valueSpec:oi[`source_${pi.replace("-","_")}`],style:ti.style,styleSpec:oi,objectElementValidators:rc,validateSpec:ui}),di;case"raster-dem":return di=function(yi){var xi;const wi=(xi=yi.sourceName)!==null&&xi!==void 0?xi:"",Ii=yi.value,Pi=yi.styleSpec,Ri=Pi.source_raster_dem,Li=yi.style;let Fi=[];const qi=nn(Ii);if(Ii===void 0)return Fi;if(qi!=="object")return Fi.push(new _o("source_raster_dem",Ii,`object expected, ${qi} found`)),Fi;const Zi=Rn(Ii.encoding)==="custom",Gr=["redFactor","greenFactor","blueFactor","baseShift"],Yi=yi.value.encoding?`"${yi.value.encoding}"`:"Default";for(const Yr in Ii)!Zi&&Gr.includes(Yr)?Fi.push(new _o(Yr,Ii[Yr],`In "${wi}": "${Yr}" is only valid when "encoding" is set to "custom". ${Yi} encoding found`)):Ri[Yr]?Fi=Fi.concat(yi.validateSpec({key:Yr,value:Ii[Yr],valueSpec:Ri[Yr],validateSpec:yi.validateSpec,style:Li,styleSpec:Pi})):Fi.push(new _o(Yr,Ii[Yr],`unknown property "${Yr}"`));return Fi}({sourceName:ii,value:ze,style:ti.style,styleSpec:oi,validateSpec:ui}),di;case"geojson":if(di=Fa({key:ii,value:ze,valueSpec:oi.source_geojson,style:ai,styleSpec:oi,validateSpec:ui,objectElementValidators:rc}),ze.cluster)for(const yi in ze.clusterProperties){const[xi,wi]=ze.clusterProperties[yi],Ii=typeof xi=="string"?[xi,["accumulated"],["get",yi]]:xi;di.push(...ml({key:`${ii}.${yi}.map`,value:wi,validateSpec:ui,expressionContext:"cluster-map"})),di.push(...ml({key:`${ii}.${yi}.reduce`,value:Ii,validateSpec:ui,expressionContext:"cluster-reduce"}))}return di;case"video":return Fa({key:ii,value:ze,valueSpec:oi.source_video,style:ai,validateSpec:ui,styleSpec:oi});case"image":return Fa({key:ii,value:ze,valueSpec:oi.source_image,style:ai,validateSpec:ui,styleSpec:oi});case"canvas":return[new _o(ii,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ic({key:`${ii}.type`,value:ze.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:ai,validateSpec:ui,styleSpec:oi})}}function oc(ti){const ze=ti.value,ii=ti.styleSpec,oi=ii.light,ai=ti.style;let ui=[];const pi=nn(ze);if(ze===void 0)return ui;if(pi!=="object")return ui=ui.concat([new _o("light",ze,`object expected, ${pi} found`)]),ui;for(const di in ze){const yi=di.match(/^(.*)-transition$/);ui=ui.concat(yi&&oi[yi[1]]&&oi[yi[1]].transition?ti.validateSpec({key:di,value:ze[di],valueSpec:ii.transition,validateSpec:ti.validateSpec,style:ai,styleSpec:ii}):oi[di]?ti.validateSpec({key:di,value:ze[di],valueSpec:oi[di],validateSpec:ti.validateSpec,style:ai,styleSpec:ii}):[new _o(di,ze[di],`unknown property "${di}"`)])}return ui}function Rh(ti){const ze=ti.value,ii=ti.styleSpec,oi=ii.terrain,ai=ti.style;let ui=[];const pi=nn(ze);if(ze===void 0)return ui;if(pi!=="object")return ui=ui.concat([new _o("terrain",ze,`object expected, ${pi} found`)]),ui;for(const di in ze)ui=ui.concat(oi[di]?ti.validateSpec({key:di,value:ze[di],valueSpec:oi[di],validateSpec:ti.validateSpec,style:ai,styleSpec:ii}):[new _o(di,ze[di],`unknown property "${di}"`)]);return ui}function Mh(ti){let ze=[];const ii=ti.value,oi=ti.key;if(Array.isArray(ii)){const ai=[],ui=[];for(const pi in ii)ii[pi].id&&ai.includes(ii[pi].id)&&ze.push(new _o(oi,ii,`all the sprites' ids must be unique, but ${ii[pi].id} is duplicated`)),ai.push(ii[pi].id),ii[pi].url&&ui.includes(ii[pi].url)&&ze.push(new _o(oi,ii,`all the sprites' URLs must be unique, but ${ii[pi].url} is duplicated`)),ui.push(ii[pi].url),ze=ze.concat(Fa({key:`${oi}[${pi}]`,value:ii[pi],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:ti.validateSpec}));return ze}return Ts({key:oi,value:ii})}const Lh={"*":()=>[],array:kl,boolean:function(ti){const ze=ti.value,ii=ti.key,oi=nn(ze);return oi!=="boolean"?[new _o(ii,ze,`boolean expected, ${oi} found`)]:[]},number:tc,color:function(ti){const ze=ti.key,ii=ti.value,oi=nn(ii);return oi!=="string"?[new _o(ze,ii,`color expected, ${oi} found`)]:cn.parse(String(ii))?[]:[new _o(ze,ii,`color expected, "${ii}" found`)]},constants:Th,enum:ic,filter:Dl,function:Bc,layer:zh,object:Fa,source:Wa,light:oc,terrain:Rh,string:Ts,formatted:function(ti){return Ts(ti).length===0?[]:ml(ti)},resolvedImage:function(ti){return Ts(ti).length===0?[]:ml(ti)},padding:function(ti){const ze=ti.key,ii=ti.value;if(nn(ii)==="array"){if(ii.length<1||ii.length>4)return[new _o(ze,ii,`padding requires 1 to 4 values; ${ii.length} values found`)];const oi={type:"number"};let ai=[];for(let ui=0;ui<ii.length;ui++)ai=ai.concat(ti.validateSpec({key:`${ze}[${ui}]`,value:ii[ui],validateSpec:ti.validateSpec,valueSpec:oi}));return ai}return tc({key:ze,value:ii,valueSpec:{}})},variableAnchorOffsetCollection:function(ti){const ze=ti.key,ii=ti.value,oi=nn(ii),ai=ti.styleSpec;if(oi!=="array"||ii.length<1||ii.length%2!=0)return[new _o(ze,ii,"variableAnchorOffsetCollection requires a non-empty array of even length")];let ui=[];for(let pi=0;pi<ii.length;pi+=2)ui=ui.concat(ic({key:`${ze}[${pi}]`,value:ii[pi],valueSpec:ai.layout_symbol["text-anchor"]})),ui=ui.concat(kl({key:`${ze}[${pi+1}]`,value:ii[pi+1],valueSpec:{length:2,value:"number"},validateSpec:ti.validateSpec,style:ti.style,styleSpec:ai}));return ui},sprite:Mh};function Ns(ti){const ze=ti.value,ii=ti.valueSpec,oi=ti.styleSpec;return ti.validateSpec=Ns,ii.expression&&Tn(Rn(ze))?Bc(ti):ii.expression&&Mc(fl(ze))?ml(ti):ii.type&&Lh[ii.type]?Lh[ii.type](ti):Fa(Ss({},ti,{valueSpec:ii.type?oi[ii.type]:ii}))}function Oh(ti){const ze=ti.value,ii=ti.key,oi=Ts(ti);return oi.length||(ze.indexOf("{fontstack}")===-1&&oi.push(new _o(ii,ze,'"glyphs" url must include a "{fontstack}" token')),ze.indexOf("{range}")===-1&&oi.push(new _o(ii,ze,'"glyphs" url must include a "{range}" token'))),oi}function us(ti,ze=io){let ii=[];return ii=ii.concat(Ns({key:"",value:ti,valueSpec:ze.$root,styleSpec:ze,style:ti,validateSpec:Ns,objectElementValidators:{glyphs:Oh,"*":()=>[]}})),ti.constants&&(ii=ii.concat(Th({key:"constants",value:ti.constants,style:ti,styleSpec:ze,validateSpec:Ns}))),Nc(ii)}function Us(ti){return function(ze){return ti({...ze,validateSpec:Ns})}}function Nc(ti){return[].concat(ti).sort((ze,ii)=>ze.line-ii.line)}function Vs(ti){return function(...ze){return Nc(ti.apply(this,ze))}}us.source=Vs(Us(Wa)),us.sprite=Vs(Us(Mh)),us.glyphs=Vs(Us(Oh)),us.light=Vs(Us(oc)),us.terrain=Vs(Us(Rh)),us.layer=Vs(Us(zh)),us.filter=Vs(Us(Dl)),us.paintProperty=Vs(Us(Ph)),us.layoutProperty=Vs(Us(Ch));const js=us,Ap=js.light,Eu=js.paintProperty,kh=js.layoutProperty;function Uc(ti,ze){let ii=!1;if(ze&&ze.length)for(const oi of ze)ti.fire(new na(new Error(oi.message))),ii=!0;return ii}class Fl{constructor(ze,ii,oi){const ai=this.cells=[];if(ze instanceof ArrayBuffer){this.arrayBuffer=ze;const pi=new Int32Array(this.arrayBuffer);ze=pi[0],this.d=(ii=pi[1])+2*(oi=pi[2]);for(let yi=0;yi<this.d*this.d;yi++){const xi=pi[3+yi],wi=pi[3+yi+1];ai.push(xi===wi?null:pi.subarray(xi,wi))}const di=pi[3+ai.length+1];this.keys=pi.subarray(pi[3+ai.length],di),this.bboxes=pi.subarray(di),this.insert=this._insertReadonly}else{this.d=ii+2*oi;for(let pi=0;pi<this.d*this.d;pi++)ai.push([]);this.keys=[],this.bboxes=[]}this.n=ii,this.extent=ze,this.padding=oi,this.scale=ii/ze,this.uid=0;const ui=oi/ii*ze;this.min=-ui,this.max=ze+ui}insert(ze,ii,oi,ai,ui){this._forEachCell(ii,oi,ai,ui,this._insertCell,this.uid++,void 0,void 0),this.keys.push(ze),this.bboxes.push(ii),this.bboxes.push(oi),this.bboxes.push(ai),this.bboxes.push(ui)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(ze,ii,oi,ai,ui,pi){this.cells[ui].push(pi)}query(ze,ii,oi,ai,ui){const pi=this.min,di=this.max;if(ze<=pi&&ii<=pi&&di<=oi&&di<=ai&&!ui)return Array.prototype.slice.call(this.keys);{const yi=[];return this._forEachCell(ze,ii,oi,ai,this._queryCell,yi,{},ui),yi}}_queryCell(ze,ii,oi,ai,ui,pi,di,yi){const xi=this.cells[ui];if(xi!==null){const wi=this.keys,Ii=this.bboxes;for(let Pi=0;Pi<xi.length;Pi++){const Ri=xi[Pi];if(di[Ri]===void 0){const Li=4*Ri;(yi?yi(Ii[Li+0],Ii[Li+1],Ii[Li+2],Ii[Li+3]):ze<=Ii[Li+2]&&ii<=Ii[Li+3]&&oi>=Ii[Li+0]&&ai>=Ii[Li+1])?(di[Ri]=!0,pi.push(wi[Ri])):di[Ri]=!1}}}}_forEachCell(ze,ii,oi,ai,ui,pi,di,yi){const xi=this._convertToCellCoord(ze),wi=this._convertToCellCoord(ii),Ii=this._convertToCellCoord(oi),Pi=this._convertToCellCoord(ai);for(let Ri=xi;Ri<=Ii;Ri++)for(let Li=wi;Li<=Pi;Li++){const Fi=this.d*Li+Ri;if((!yi||yi(this._convertFromCellCoord(Ri),this._convertFromCellCoord(Li),this._convertFromCellCoord(Ri+1),this._convertFromCellCoord(Li+1)))&&ui.call(this,ze,ii,oi,ai,Fi,pi,di,yi))return}}_convertFromCellCoord(ze){return(ze-this.padding)/this.scale}_convertToCellCoord(ze){return Math.max(0,Math.min(this.d-1,Math.floor(ze*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const ze=this.cells,ii=3+this.cells.length+1+1;let oi=0;for(let pi=0;pi<this.cells.length;pi++)oi+=this.cells[pi].length;const ai=new Int32Array(ii+oi+this.keys.length+this.bboxes.length);ai[0]=this.extent,ai[1]=this.n,ai[2]=this.padding;let ui=ii;for(let pi=0;pi<ze.length;pi++){const di=ze[pi];ai[3+pi]=ui,ai.set(di,ui),ui+=di.length}return ai[3+ze.length]=ui,ai.set(this.keys,ui),ui+=this.keys.length,ai[3+ze.length+1]=ui,ai.set(this.bboxes,ui),ui+=this.bboxes.length,ai.buffer}static serialize(ze,ii){const oi=ze.toArrayBuffer();return ii&&ii.push(oi),{buffer:oi}}static deserialize(ze){return new Fl(ze.buffer)}}const qs={};function Eo(ti,ze,ii={}){if(qs[ti])throw new Error(`${ti} is already registered.`);Object.defineProperty(ze,"_classRegistryKey",{value:ti,writeable:!1}),qs[ti]={klass:ze,omit:ii.omit||[],shallow:ii.shallow||[]}}Eo("Object",Object),Eo("TransferableGridIndex",Fl),Eo("Color",cn),Eo("Error",Error),Eo("AJAXError",os),Eo("ResolvedImage",ha),Eo("StylePropertyFunction",Kl),Eo("StyleExpression",xu,{omit:["_evaluator"]}),Eo("ZoomDependentExpression",Oc),Eo("ZoomConstantExpression",vu),Eo("CompoundExpression",cs,{omit:["_evaluate"]});for(const ti in Ll)Ll[ti]._classRegistryKey||Eo(`Expression_${ti}`,Ll[ti]);function Vc(ti){return ti&&typeof ArrayBuffer<"u"&&(ti instanceof ArrayBuffer||ti.constructor&&ti.constructor.name==="ArrayBuffer")}function tl(ti,ze){if(ti==null||typeof ti=="boolean"||typeof ti=="number"||typeof ti=="string"||ti instanceof Boolean||ti instanceof Number||ti instanceof String||ti instanceof Date||ti instanceof RegExp||ti instanceof Blob)return ti;if(Vc(ti)||al(ti))return ze&&ze.push(ti),ti;if(ArrayBuffer.isView(ti)){const ii=ti;return ze&&ze.push(ii.buffer),ii}if(ti instanceof ImageData)return ze&&ze.push(ti.data.buffer),ti;if(Array.isArray(ti)){const ii=[];for(const oi of ti)ii.push(tl(oi,ze));return ii}if(typeof ti=="object"){const ii=ti.constructor,oi=ii._classRegistryKey;if(!oi)throw new Error("can't serialize object of unregistered class");if(!qs[oi])throw new Error(`${oi} is not registered.`);const ai=ii.serialize?ii.serialize(ti,ze):{};if(ii.serialize){if(ze&&ai===ze[ze.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const ui in ti){if(!ti.hasOwnProperty(ui)||qs[oi].omit.indexOf(ui)>=0)continue;const pi=ti[ui];ai[ui]=qs[oi].shallow.indexOf(ui)>=0?pi:tl(pi,ze)}ti instanceof Error&&(ai.message=ti.message)}if(ai.$name)throw new Error("$name property is reserved for worker serialization logic.");return oi!=="Object"&&(ai.$name=oi),ai}throw new Error("can't serialize object of type "+typeof ti)}function Bl(ti){if(ti==null||typeof ti=="boolean"||typeof ti=="number"||typeof ti=="string"||ti instanceof Boolean||ti instanceof Number||ti instanceof String||ti instanceof Date||ti instanceof RegExp||ti instanceof Blob||Vc(ti)||al(ti)||ArrayBuffer.isView(ti)||ti instanceof ImageData)return ti;if(Array.isArray(ti))return ti.map(Bl);if(typeof ti=="object"){const ze=ti.$name||"Object";if(!qs[ze])throw new Error(`can't deserialize unregistered class ${ze}`);const{klass:ii}=qs[ze];if(!ii)throw new Error(`can't deserialize unregistered class ${ze}`);if(ii.deserialize)return ii.deserialize(ti);const oi=Object.create(ii.prototype);for(const ai of Object.keys(ti)){if(ai==="$name")continue;const ui=ti[ai];oi[ai]=qs[ze].shallow.indexOf(ai)>=0?ui:Bl(ui)}return oi}throw new Error("can't deserialize object of type "+typeof ti)}class Dh{constructor(){this.first=!0}update(ze,ii){const oi=Math.floor(ze);return this.first?(this.first=!1,this.lastIntegerZoom=oi,this.lastIntegerZoomTime=0,this.lastZoom=ze,this.lastFloorZoom=oi,!0):(this.lastFloorZoom>oi?(this.lastIntegerZoom=oi+1,this.lastIntegerZoomTime=ii):this.lastFloorZoom<oi&&(this.lastIntegerZoom=oi,this.lastIntegerZoomTime=ii),ze!==this.lastZoom&&(this.lastZoom=ze,this.lastFloorZoom=oi,!0))}}const wo={"Latin-1 Supplement":ti=>ti>=128&&ti<=255,Arabic:ti=>ti>=1536&&ti<=1791,"Arabic Supplement":ti=>ti>=1872&&ti<=1919,"Arabic Extended-A":ti=>ti>=2208&&ti<=2303,"Hangul Jamo":ti=>ti>=4352&&ti<=4607,"Unified Canadian Aboriginal Syllabics":ti=>ti>=5120&&ti<=5759,Khmer:ti=>ti>=6016&&ti<=6143,"Unified Canadian Aboriginal Syllabics Extended":ti=>ti>=6320&&ti<=6399,"General Punctuation":ti=>ti>=8192&&ti<=8303,"Letterlike Symbols":ti=>ti>=8448&&ti<=8527,"Number Forms":ti=>ti>=8528&&ti<=8591,"Miscellaneous Technical":ti=>ti>=8960&&ti<=9215,"Control Pictures":ti=>ti>=9216&&ti<=9279,"Optical Character Recognition":ti=>ti>=9280&&ti<=9311,"Enclosed Alphanumerics":ti=>ti>=9312&&ti<=9471,"Geometric Shapes":ti=>ti>=9632&&ti<=9727,"Miscellaneous Symbols":ti=>ti>=9728&&ti<=9983,"Miscellaneous Symbols and Arrows":ti=>ti>=11008&&ti<=11263,"CJK Radicals Supplement":ti=>ti>=11904&&ti<=12031,"Kangxi Radicals":ti=>ti>=12032&&ti<=12255,"Ideographic Description Characters":ti=>ti>=12272&&ti<=12287,"CJK Symbols and Punctuation":ti=>ti>=12288&&ti<=12351,Hiragana:ti=>ti>=12352&&ti<=12447,Katakana:ti=>ti>=12448&&ti<=12543,Bopomofo:ti=>ti>=12544&&ti<=12591,"Hangul Compatibility Jamo":ti=>ti>=12592&&ti<=12687,Kanbun:ti=>ti>=12688&&ti<=12703,"Bopomofo Extended":ti=>ti>=12704&&ti<=12735,"CJK Strokes":ti=>ti>=12736&&ti<=12783,"Katakana Phonetic Extensions":ti=>ti>=12784&&ti<=12799,"Enclosed CJK Letters and Months":ti=>ti>=12800&&ti<=13055,"CJK Compatibility":ti=>ti>=13056&&ti<=13311,"CJK Unified Ideographs Extension A":ti=>ti>=13312&&ti<=19903,"Yijing Hexagram Symbols":ti=>ti>=19904&&ti<=19967,"CJK Unified Ideographs":ti=>ti>=19968&&ti<=40959,"Yi Syllables":ti=>ti>=40960&&ti<=42127,"Yi Radicals":ti=>ti>=42128&&ti<=42191,"Hangul Jamo Extended-A":ti=>ti>=43360&&ti<=43391,"Hangul Syllables":ti=>ti>=44032&&ti<=55215,"Hangul Jamo Extended-B":ti=>ti>=55216&&ti<=55295,"Private Use Area":ti=>ti>=57344&&ti<=63743,"CJK Compatibility Ideographs":ti=>ti>=63744&&ti<=64255,"Arabic Presentation Forms-A":ti=>ti>=64336&&ti<=65023,"Vertical Forms":ti=>ti>=65040&&ti<=65055,"CJK Compatibility Forms":ti=>ti>=65072&&ti<=65103,"Small Form Variants":ti=>ti>=65104&&ti<=65135,"Arabic Presentation Forms-B":ti=>ti>=65136&&ti<=65279,"Halfwidth and Fullwidth Forms":ti=>ti>=65280&&ti<=65519};function Tu(ti){for(const ze of ti)if(Au(ze.charCodeAt(0)))return!0;return!1}function Iu(ti){for(const ze of ti)if(!Pp(ze.charCodeAt(0)))return!1;return!0}function Pp(ti){return!(wo.Arabic(ti)||wo["Arabic Supplement"](ti)||wo["Arabic Extended-A"](ti)||wo["Arabic Presentation Forms-A"](ti)||wo["Arabic Presentation Forms-B"](ti))}function Au(ti){return!(ti!==746&&ti!==747&&(ti<4352||!(wo["Bopomofo Extended"](ti)||wo.Bopomofo(ti)||wo["CJK Compatibility Forms"](ti)&&!(ti>=65097&&ti<=65103)||wo["CJK Compatibility Ideographs"](ti)||wo["CJK Compatibility"](ti)||wo["CJK Radicals Supplement"](ti)||wo["CJK Strokes"](ti)||!(!wo["CJK Symbols and Punctuation"](ti)||ti>=12296&&ti<=12305||ti>=12308&&ti<=12319||ti===12336)||wo["CJK Unified Ideographs Extension A"](ti)||wo["CJK Unified Ideographs"](ti)||wo["Enclosed CJK Letters and Months"](ti)||wo["Hangul Compatibility Jamo"](ti)||wo["Hangul Jamo Extended-A"](ti)||wo["Hangul Jamo Extended-B"](ti)||wo["Hangul Jamo"](ti)||wo["Hangul Syllables"](ti)||wo.Hiragana(ti)||wo["Ideographic Description Characters"](ti)||wo.Kanbun(ti)||wo["Kangxi Radicals"](ti)||wo["Katakana Phonetic Extensions"](ti)||wo.Katakana(ti)&&ti!==12540||!(!wo["Halfwidth and Fullwidth Forms"](ti)||ti===65288||ti===65289||ti===65293||ti>=65306&&ti<=65310||ti===65339||ti===65341||ti===65343||ti>=65371&&ti<=65503||ti===65507||ti>=65512&&ti<=65519)||!(!wo["Small Form Variants"](ti)||ti>=65112&&ti<=65118||ti>=65123&&ti<=65126)||wo["Unified Canadian Aboriginal Syllabics"](ti)||wo["Unified Canadian Aboriginal Syllabics Extended"](ti)||wo["Vertical Forms"](ti)||wo["Yijing Hexagram Symbols"](ti)||wo["Yi Syllables"](ti)||wo["Yi Radicals"](ti))))}function Fh(ti){return!(Au(ti)||function(ze){return!!(wo["Latin-1 Supplement"](ze)&&(ze===167||ze===169||ze===174||ze===177||ze===188||ze===189||ze===190||ze===215||ze===247)||wo["General Punctuation"](ze)&&(ze===8214||ze===8224||ze===8225||ze===8240||ze===8241||ze===8251||ze===8252||ze===8258||ze===8263||ze===8264||ze===8265||ze===8273)||wo["Letterlike Symbols"](ze)||wo["Number Forms"](ze)||wo["Miscellaneous Technical"](ze)&&(ze>=8960&&ze<=8967||ze>=8972&&ze<=8991||ze>=8996&&ze<=9e3||ze===9003||ze>=9085&&ze<=9114||ze>=9150&&ze<=9165||ze===9167||ze>=9169&&ze<=9179||ze>=9186&&ze<=9215)||wo["Control Pictures"](ze)&&ze!==9251||wo["Optical Character Recognition"](ze)||wo["Enclosed Alphanumerics"](ze)||wo["Geometric Shapes"](ze)||wo["Miscellaneous Symbols"](ze)&&!(ze>=9754&&ze<=9759)||wo["Miscellaneous Symbols and Arrows"](ze)&&(ze>=11026&&ze<=11055||ze>=11088&&ze<=11097||ze>=11192&&ze<=11243)||wo["CJK Symbols and Punctuation"](ze)||wo.Katakana(ze)||wo["Private Use Area"](ze)||wo["CJK Compatibility Forms"](ze)||wo["Small Form Variants"](ze)||wo["Halfwidth and Fullwidth Forms"](ze)||ze===8734||ze===8756||ze===8757||ze>=9984&&ze<=10087||ze>=10102&&ze<=10131||ze===65532||ze===65533)}(ti))}function Bh(ti){return ti>=1424&&ti<=2303||wo["Arabic Presentation Forms-A"](ti)||wo["Arabic Presentation Forms-B"](ti)}function Nh(ti,ze){return!(!ze&&Bh(ti)||ti>=2304&&ti<=3583||ti>=3840&&ti<=4255||wo.Khmer(ti))}function Cp(ti){for(const ze of ti)if(Bh(ze.charCodeAt(0)))return!0;return!1}const Pu="deferred",Cu="loading",zu="loaded";let Ru=null,Ba="unavailable",il=null;const nc=function(ti){ti&&typeof ti=="string"&&ti.indexOf("NetworkError")>-1&&(Ba="error"),Ru&&Ru(ti)};function Mu(){ac.fire(new $n("pluginStateChange",{pluginStatus:Ba,pluginURL:il}))}const ac=new ka,Lu=function(){return Ba},Uh=function(){if(Ba!==Pu||!il)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ba=Cu,Mu(),il&&Un({url:il},ti=>{ti?nc(ti):(Ba=zu,Mu())})},Ka={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ba===zu||Ka.applyArabicShaping!=null,isLoading:()=>Ba===Cu,setState(ti){if(!Gn())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Ba=ti.pluginStatus,il=ti.pluginURL},isParsed(){if(!Gn())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Ka.applyArabicShaping!=null&&Ka.processBidirectionalText!=null&&Ka.processStyledBidirectionalText!=null},getPluginURL(){if(!Gn())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return il}};class gn{constructor(ze,ii){this.zoom=ze,ii?(this.now=ii.now,this.fadeDuration=ii.fadeDuration,this.zoomHistory=ii.zoomHistory,this.transition=ii.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Dh,this.transition={})}isSupportedScript(ze){return function(ii,oi){for(const ai of ii)if(!Nh(ai.charCodeAt(0),oi))return!1;return!0}(ze,Ka.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const ze=this.zoom,ii=ze-Math.floor(ze),oi=this.crossFadingFactor();return ze>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:ii+(1-ii)*oi}:{fromScale:.5,toScale:1,t:1-(1-oi)*ii}}}class jc{constructor(ze,ii){this.property=ze,this.value=ii,this.expression=function(oi,ai){if(Tn(oi))return new Kl(oi,ai);if(Mc(oi)){const ui=bu(oi,ai);if(ui.result==="error")throw new Error(ui.value.map(pi=>`${pi.key}: ${pi.message}`).join(", "));return ui.value}{let ui=oi;return ai.type==="color"&&typeof oi=="string"?ui=cn.parse(oi):ai.type!=="padding"||typeof oi!="number"&&!Array.isArray(oi)?ai.type==="variableAnchorOffsetCollection"&&Array.isArray(oi)&&(ui=ss.parse(oi)):ui=Ha.parse(oi),{kind:"constant",evaluate:()=>ui}}}(ii===void 0?ze.specification.default:ii,ze.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(ze,ii,oi){return this.property.possiblyEvaluate(this,ze,ii,oi)}}class Ou{constructor(ze){this.property=ze,this.value=new jc(ze,void 0)}transitioned(ze,ii){return new jh(this.property,this.value,ii,ln({},ze.transition,this.transition),ze.now)}untransitioned(){return new jh(this.property,this.value,null,{},0)}}class Vh{constructor(ze){this._properties=ze,this._values=Object.create(ze.defaultTransitionablePropertyValues)}getValue(ze){return Pn(this._values[ze].value.value)}setValue(ze,ii){Object.prototype.hasOwnProperty.call(this._values,ze)||(this._values[ze]=new Ou(this._values[ze].property)),this._values[ze].value=new jc(this._values[ze].property,ii===null?void 0:Pn(ii))}getTransition(ze){return Pn(this._values[ze].transition)}setTransition(ze,ii){Object.prototype.hasOwnProperty.call(this._values,ze)||(this._values[ze]=new Ou(this._values[ze].property)),this._values[ze].transition=Pn(ii)||void 0}serialize(){const ze={};for(const ii of Object.keys(this._values)){const oi=this.getValue(ii);oi!==void 0&&(ze[ii]=oi);const ai=this.getTransition(ii);ai!==void 0&&(ze[`${ii}-transition`]=ai)}return ze}transitioned(ze,ii){const oi=new qh(this._properties);for(const ai of Object.keys(this._values))oi._values[ai]=this._values[ai].transitioned(ze,ii._values[ai]);return oi}untransitioned(){const ze=new qh(this._properties);for(const ii of Object.keys(this._values))ze._values[ii]=this._values[ii].untransitioned();return ze}}class jh{constructor(ze,ii,oi,ai,ui){this.property=ze,this.value=ii,this.begin=ui+ai.delay||0,this.end=this.begin+ai.duration||0,ze.specification.transition&&(ai.delay||ai.duration)&&(this.prior=oi)}possiblyEvaluate(ze,ii,oi){const ai=ze.now||0,ui=this.value.possiblyEvaluate(ze,ii,oi),pi=this.prior;if(pi){if(ai>this.end)return this.prior=null,ui;if(this.value.isDataDriven())return this.prior=null,ui;if(ai<this.begin)return pi.possiblyEvaluate(ze,ii,oi);{const di=(ai-this.begin)/(this.end-this.begin);return this.property.interpolate(pi.possiblyEvaluate(ze,ii,oi),ui,function(yi){if(yi<=0)return 0;if(yi>=1)return 1;const xi=yi*yi,wi=xi*yi;return 4*(yi<.5?wi:3*(yi-xi)+wi-.75)}(di))}}return ui}}class qh{constructor(ze){this._properties=ze,this._values=Object.create(ze.defaultTransitioningPropertyValues)}possiblyEvaluate(ze,ii,oi){const ai=new qc(this._properties);for(const ui of Object.keys(this._values))ai._values[ui]=this._values[ui].possiblyEvaluate(ze,ii,oi);return ai}hasTransition(){for(const ze of Object.keys(this._values))if(this._values[ze].prior)return!0;return!1}}class zp{constructor(ze){this._properties=ze,this._values=Object.create(ze.defaultPropertyValues)}hasValue(ze){return this._values[ze].value!==void 0}getValue(ze){return Pn(this._values[ze].value)}setValue(ze,ii){this._values[ze]=new jc(this._values[ze].property,ii===null?void 0:Pn(ii))}serialize(){const ze={};for(const ii of Object.keys(this._values)){const oi=this.getValue(ii);oi!==void 0&&(ze[ii]=oi)}return ze}possiblyEvaluate(ze,ii,oi){const ai=new qc(this._properties);for(const ui of Object.keys(this._values))ai._values[ui]=this._values[ui].possiblyEvaluate(ze,ii,oi);return ai}}class Ta{constructor(ze,ii,oi){this.property=ze,this.value=ii,this.parameters=oi}isConstant(){return this.value.kind==="constant"}constantOr(ze){return this.value.kind==="constant"?this.value.value:ze}evaluate(ze,ii,oi,ai){return this.property.evaluate(this.value,this.parameters,ze,ii,oi,ai)}}class qc{constructor(ze){this._properties=ze,this._values=Object.create(ze.defaultPossiblyEvaluatedValues)}get(ze){return this._values[ze]}}class Mo{constructor(ze){this.specification=ze}possiblyEvaluate(ze,ii){if(ze.isDataDriven())throw new Error("Value should not be data driven");return ze.expression.evaluate(ii)}interpolate(ze,ii,oi){const ai=Ya[this.specification.type];return ai?ai(ze,ii,oi):ze}}class Fo{constructor(ze,ii){this.specification=ze,this.overrides=ii}possiblyEvaluate(ze,ii,oi,ai){return new Ta(this,ze.expression.kind==="constant"||ze.expression.kind==="camera"?{kind:"constant",value:ze.expression.evaluate(ii,null,{},oi,ai)}:ze.expression,ii)}interpolate(ze,ii,oi){if(ze.value.kind!=="constant"||ii.value.kind!=="constant")return ze;if(ze.value.value===void 0||ii.value.value===void 0)return new Ta(this,{kind:"constant",value:void 0},ze.parameters);const ai=Ya[this.specification.type];if(ai){const ui=ai(ze.value.value,ii.value.value,oi);return new Ta(this,{kind:"constant",value:ui},ze.parameters)}return ze}evaluate(ze,ii,oi,ai,ui,pi){return ze.kind==="constant"?ze.value:ze.evaluate(ii,oi,ai,ui,pi)}}class sc extends Fo{possiblyEvaluate(ze,ii,oi,ai){if(ze.value===void 0)return new Ta(this,{kind:"constant",value:void 0},ii);if(ze.expression.kind==="constant"){const ui=ze.expression.evaluate(ii,null,{},oi,ai),pi=ze.property.specification.type==="resolvedImage"&&typeof ui!="string"?ui.name:ui,di=this._calculate(pi,pi,pi,ii);return new Ta(this,{kind:"constant",value:di},ii)}if(ze.expression.kind==="camera"){const ui=this._calculate(ze.expression.evaluate({zoom:ii.zoom-1}),ze.expression.evaluate({zoom:ii.zoom}),ze.expression.evaluate({zoom:ii.zoom+1}),ii);return new Ta(this,{kind:"constant",value:ui},ii)}return new Ta(this,ze.expression,ii)}evaluate(ze,ii,oi,ai,ui,pi){if(ze.kind==="source"){const di=ze.evaluate(ii,oi,ai,ui,pi);return this._calculate(di,di,di,ii)}return ze.kind==="composite"?this._calculate(ze.evaluate({zoom:Math.floor(ii.zoom)-1},oi,ai),ze.evaluate({zoom:Math.floor(ii.zoom)},oi,ai),ze.evaluate({zoom:Math.floor(ii.zoom)+1},oi,ai),ii):ze.value}_calculate(ze,ii,oi,ai){return ai.zoom>ai.zoomHistory.lastIntegerZoom?{from:ze,to:ii}:{from:oi,to:ii}}interpolate(ze){return ze}}class ku{constructor(ze){this.specification=ze}possiblyEvaluate(ze,ii,oi,ai){if(ze.value!==void 0){if(ze.expression.kind==="constant"){const ui=ze.expression.evaluate(ii,null,{},oi,ai);return this._calculate(ui,ui,ui,ii)}return this._calculate(ze.expression.evaluate(new gn(Math.floor(ii.zoom-1),ii)),ze.expression.evaluate(new gn(Math.floor(ii.zoom),ii)),ze.expression.evaluate(new gn(Math.floor(ii.zoom+1),ii)),ii)}}_calculate(ze,ii,oi,ai){return ai.zoom>ai.zoomHistory.lastIntegerZoom?{from:ze,to:ii}:{from:oi,to:ii}}interpolate(ze){return ze}}class Du{constructor(ze){this.specification=ze}possiblyEvaluate(ze,ii,oi,ai){return!!ze.expression.evaluate(ii,null,{},oi,ai)}interpolate(){return!1}}class Vn{constructor(ze){this.properties=ze,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const ii in ze){const oi=ze[ii];oi.specification.overridable&&this.overridableProperties.push(ii);const ai=this.defaultPropertyValues[ii]=new jc(oi,void 0),ui=this.defaultTransitionablePropertyValues[ii]=new Ou(oi);this.defaultTransitioningPropertyValues[ii]=ui.untransitioned(),this.defaultPossiblyEvaluatedValues[ii]=ai.possiblyEvaluate({})}}}Eo("DataDrivenProperty",Fo),Eo("DataConstantProperty",Mo),Eo("CrossFadedDataDrivenProperty",sc),Eo("CrossFadedProperty",ku),Eo("ColorRampProperty",Du);const Fu="-transition";class hs extends ka{constructor(ze,ii){if(super(),this.id=ze.id,this.type=ze.type,this._featureFilter={filter:()=>!0,needGeometry:!1},ze.type!=="custom"&&(this.metadata=ze.metadata,this.minzoom=ze.minzoom,this.maxzoom=ze.maxzoom,ze.type!=="background"&&(this.source=ze.source,this.sourceLayer=ze["source-layer"],this.filter=ze.filter),ii.layout&&(this._unevaluatedLayout=new zp(ii.layout)),ii.paint)){this._transitionablePaint=new Vh(ii.paint);for(const oi in ze.paint)this.setPaintProperty(oi,ze.paint[oi],{validate:!1});for(const oi in ze.layout)this.setLayoutProperty(oi,ze.layout[oi],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new qc(ii.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(ze){return ze==="visibility"?this.visibility:this._unevaluatedLayout.getValue(ze)}setLayoutProperty(ze,ii,oi={}){ii!=null&&this._validate(kh,`layers.${this.id}.layout.${ze}`,ze,ii,oi)||(ze!=="visibility"?this._unevaluatedLayout.setValue(ze,ii):this.visibility=ii)}getPaintProperty(ze){return ze.endsWith(Fu)?this._transitionablePaint.getTransition(ze.slice(0,-11)):this._transitionablePaint.getValue(ze)}setPaintProperty(ze,ii,oi={}){if(ii!=null&&this._validate(Eu,`layers.${this.id}.paint.${ze}`,ze,ii,oi))return!1;if(ze.endsWith(Fu))return this._transitionablePaint.setTransition(ze.slice(0,-11),ii||void 0),!1;{const ai=this._transitionablePaint._values[ze],ui=ai.property.specification["property-type"]==="cross-faded-data-driven",pi=ai.value.isDataDriven(),di=ai.value;this._transitionablePaint.setValue(ze,ii),this._handleSpecialPaintPropertyUpdate(ze);const yi=this._transitionablePaint._values[ze].value;return yi.isDataDriven()||pi||ui||this._handleOverridablePaintPropertyUpdate(ze,di,yi)}}_handleSpecialPaintPropertyUpdate(ze){}_handleOverridablePaintPropertyUpdate(ze,ii,oi){return!1}isHidden(ze){return!!(this.minzoom&&ze<this.minzoom)||!!(this.maxzoom&&ze>=this.maxzoom)||this.visibility==="none"}updateTransitions(ze){this._transitioningPaint=this._transitionablePaint.transitioned(ze,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(ze,ii){ze.getCrossfadeParameters&&(this._crossfadeParameters=ze.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(ze,void 0,ii)),this.paint=this._transitioningPaint.possiblyEvaluate(ze,void 0,ii)}serialize(){const ze={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(ze.layout=ze.layout||{},ze.layout.visibility=this.visibility),fn(ze,(ii,oi)=>!(ii===void 0||oi==="layout"&&!Object.keys(ii).length||oi==="paint"&&!Object.keys(ii).length))}_validate(ze,ii,oi,ai,ui={}){return(!ui||ui.validate!==!1)&&Uc(this,ze.call(js,{key:ii,layerType:this.type,objectKey:oi,value:ai,styleSpec:io,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const ze in this.paint._values){const ii=this.paint.get(ze);if(ii instanceof Ta&&Ol(ii.property.specification)&&(ii.value.kind==="source"||ii.value.kind==="composite")&&ii.value.isStateDependent)return!0}return!1}}const Gh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _l{constructor(ze,ii){this._structArray=ze,this._pos1=ii*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(ze,ii){return ze._trim(),ii&&(ze.isTransferred=!0,ii.push(ze.arrayBuffer)),{length:ze.length,arrayBuffer:ze.arrayBuffer}}static deserialize(ze){const ii=Object.create(this.prototype);return ii.arrayBuffer=ze.arrayBuffer,ii.length=ze.length,ii.capacity=ze.arrayBuffer.byteLength/ii.bytesPerElement,ii._refreshViews(),ii}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(ze){this.reserve(ze),this.length=ze}reserve(ze){if(ze>this.capacity){this.capacity=Math.max(ze,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const ii=this.uint8;this._refreshViews(),ii&&this.uint8.set(ii)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function An(ti,ze=1){let ii=0,oi=0;return{members:ti.map(ai=>{const ui=Gh[ai.type].BYTES_PER_ELEMENT,pi=ii=Nl(ii,Math.max(ze,ui)),di=ai.components||1;return oi=Math.max(oi,ui),ii+=ui*di,{name:ai.name,type:ai.type,components:di,offset:pi}}),size:Nl(ii,Math.max(oi,ze)),alignment:ze}}function Nl(ti,ze){return Math.ceil(ti/ze)*ze}class lc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(ze,ii){const oi=this.length;return this.resize(oi+1),this.emplace(oi,ze,ii)}emplace(ze,ii,oi){const ai=2*ze;return this.int16[ai+0]=ii,this.int16[ai+1]=oi,ze}}lc.prototype.bytesPerElement=4,Eo("StructArrayLayout2i4",lc);class cc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi){const ai=this.length;return this.resize(ai+1),this.emplace(ai,ze,ii,oi)}emplace(ze,ii,oi,ai){const ui=3*ze;return this.int16[ui+0]=ii,this.int16[ui+1]=oi,this.int16[ui+2]=ai,ze}}cc.prototype.bytesPerElement=6,Eo("StructArrayLayout3i6",cc);class yl extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai){const ui=this.length;return this.resize(ui+1),this.emplace(ui,ze,ii,oi,ai)}emplace(ze,ii,oi,ai,ui){const pi=4*ze;return this.int16[pi+0]=ii,this.int16[pi+1]=oi,this.int16[pi+2]=ai,this.int16[pi+3]=ui,ze}}yl.prototype.bytesPerElement=8,Eo("StructArrayLayout4i8",yl);class Bu extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai,ui,pi){const di=this.length;return this.resize(di+1),this.emplace(di,ze,ii,oi,ai,ui,pi)}emplace(ze,ii,oi,ai,ui,pi,di){const yi=6*ze;return this.int16[yi+0]=ii,this.int16[yi+1]=oi,this.int16[yi+2]=ai,this.int16[yi+3]=ui,this.int16[yi+4]=pi,this.int16[yi+5]=di,ze}}Bu.prototype.bytesPerElement=12,Eo("StructArrayLayout2i4i12",Bu);class Nu extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai,ui,pi){const di=this.length;return this.resize(di+1),this.emplace(di,ze,ii,oi,ai,ui,pi)}emplace(ze,ii,oi,ai,ui,pi,di){const yi=4*ze,xi=8*ze;return this.int16[yi+0]=ii,this.int16[yi+1]=oi,this.uint8[xi+4]=ai,this.uint8[xi+5]=ui,this.uint8[xi+6]=pi,this.uint8[xi+7]=di,ze}}Nu.prototype.bytesPerElement=8,Eo("StructArrayLayout2i4ub8",Nu);class Ul extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(ze,ii){const oi=this.length;return this.resize(oi+1),this.emplace(oi,ze,ii)}emplace(ze,ii,oi){const ai=2*ze;return this.float32[ai+0]=ii,this.float32[ai+1]=oi,ze}}Ul.prototype.bytesPerElement=8,Eo("StructArrayLayout2f8",Ul);class Uu extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai,ui,pi,di,yi,xi,wi){const Ii=this.length;return this.resize(Ii+1),this.emplace(Ii,ze,ii,oi,ai,ui,pi,di,yi,xi,wi)}emplace(ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii){const Pi=10*ze;return this.uint16[Pi+0]=ii,this.uint16[Pi+1]=oi,this.uint16[Pi+2]=ai,this.uint16[Pi+3]=ui,this.uint16[Pi+4]=pi,this.uint16[Pi+5]=di,this.uint16[Pi+6]=yi,this.uint16[Pi+7]=xi,this.uint16[Pi+8]=wi,this.uint16[Pi+9]=Ii,ze}}Uu.prototype.bytesPerElement=20,Eo("StructArrayLayout10ui20",Uu);class Vu extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi){const Ri=this.length;return this.resize(Ri+1),this.emplace(Ri,ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi)}emplace(ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri){const Li=12*ze;return this.int16[Li+0]=ii,this.int16[Li+1]=oi,this.int16[Li+2]=ai,this.int16[Li+3]=ui,this.uint16[Li+4]=pi,this.uint16[Li+5]=di,this.uint16[Li+6]=yi,this.uint16[Li+7]=xi,this.int16[Li+8]=wi,this.int16[Li+9]=Ii,this.int16[Li+10]=Pi,this.int16[Li+11]=Ri,ze}}Vu.prototype.bytesPerElement=24,Eo("StructArrayLayout4i4ui4i24",Vu);class an extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(ze,ii,oi){const ai=this.length;return this.resize(ai+1),this.emplace(ai,ze,ii,oi)}emplace(ze,ii,oi,ai){const ui=3*ze;return this.float32[ui+0]=ii,this.float32[ui+1]=oi,this.float32[ui+2]=ai,ze}}an.prototype.bytesPerElement=12,Eo("StructArrayLayout3f12",an);class ci extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(ze){const ii=this.length;return this.resize(ii+1),this.emplace(ii,ze)}emplace(ze,ii){return this.uint32[1*ze+0]=ii,ze}}ci.prototype.bytesPerElement=4,Eo("StructArrayLayout1ul4",ci);class ei extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai,ui,pi,di,yi,xi){const wi=this.length;return this.resize(wi+1),this.emplace(wi,ze,ii,oi,ai,ui,pi,di,yi,xi)}emplace(ze,ii,oi,ai,ui,pi,di,yi,xi,wi){const Ii=10*ze,Pi=5*ze;return this.int16[Ii+0]=ii,this.int16[Ii+1]=oi,this.int16[Ii+2]=ai,this.int16[Ii+3]=ui,this.int16[Ii+4]=pi,this.int16[Ii+5]=di,this.uint32[Pi+3]=yi,this.uint16[Ii+8]=xi,this.uint16[Ii+9]=wi,ze}}ei.prototype.bytesPerElement=20,Eo("StructArrayLayout6i1ul2ui20",ei);class ri extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai,ui,pi){const di=this.length;return this.resize(di+1),this.emplace(di,ze,ii,oi,ai,ui,pi)}emplace(ze,ii,oi,ai,ui,pi,di){const yi=6*ze;return this.int16[yi+0]=ii,this.int16[yi+1]=oi,this.int16[yi+2]=ai,this.int16[yi+3]=ui,this.int16[yi+4]=pi,this.int16[yi+5]=di,ze}}ri.prototype.bytesPerElement=12,Eo("StructArrayLayout2i2i2i12",ri);class ni extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai,ui){const pi=this.length;return this.resize(pi+1),this.emplace(pi,ze,ii,oi,ai,ui)}emplace(ze,ii,oi,ai,ui,pi){const di=4*ze,yi=8*ze;return this.float32[di+0]=ii,this.float32[di+1]=oi,this.float32[di+2]=ai,this.int16[yi+6]=ui,this.int16[yi+7]=pi,ze}}ni.prototype.bytesPerElement=16,Eo("StructArrayLayout2f1f2i16",ni);class si extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai){const ui=this.length;return this.resize(ui+1),this.emplace(ui,ze,ii,oi,ai)}emplace(ze,ii,oi,ai,ui){const pi=12*ze,di=3*ze;return this.uint8[pi+0]=ii,this.uint8[pi+1]=oi,this.float32[di+1]=ai,this.float32[di+2]=ui,ze}}si.prototype.bytesPerElement=12,Eo("StructArrayLayout2ub2f12",si);class hi extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi){const ai=this.length;return this.resize(ai+1),this.emplace(ai,ze,ii,oi)}emplace(ze,ii,oi,ai){const ui=3*ze;return this.uint16[ui+0]=ii,this.uint16[ui+1]=oi,this.uint16[ui+2]=ai,ze}}hi.prototype.bytesPerElement=6,Eo("StructArrayLayout3ui6",hi);class fi extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri,Li,Fi,qi,Zi){const Gr=this.length;return this.resize(Gr+1),this.emplace(Gr,ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri,Li,Fi,qi,Zi)}emplace(ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri,Li,Fi,qi,Zi,Gr){const Yi=24*ze,Yr=12*ze,Jr=48*ze;return this.int16[Yi+0]=ii,this.int16[Yi+1]=oi,this.uint16[Yi+2]=ai,this.uint16[Yi+3]=ui,this.uint32[Yr+2]=pi,this.uint32[Yr+3]=di,this.uint32[Yr+4]=yi,this.uint16[Yi+10]=xi,this.uint16[Yi+11]=wi,this.uint16[Yi+12]=Ii,this.float32[Yr+7]=Pi,this.float32[Yr+8]=Ri,this.uint8[Jr+36]=Li,this.uint8[Jr+37]=Fi,this.uint8[Jr+38]=qi,this.uint32[Yr+10]=Zi,this.int16[Yi+22]=Gr,ze}}fi.prototype.bytesPerElement=48,Eo("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",fi);class _i extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri,Li,Fi,qi,Zi,Gr,Yi,Yr,Jr,ao,So,Po,bo,vo,mo,To){const yo=this.length;return this.resize(yo+1),this.emplace(yo,ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri,Li,Fi,qi,Zi,Gr,Yi,Yr,Jr,ao,So,Po,bo,vo,mo,To)}emplace(ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri,Li,Fi,qi,Zi,Gr,Yi,Yr,Jr,ao,So,Po,bo,vo,mo,To,yo){const uo=32*ze,ko=16*ze;return this.int16[uo+0]=ii,this.int16[uo+1]=oi,this.int16[uo+2]=ai,this.int16[uo+3]=ui,this.int16[uo+4]=pi,this.int16[uo+5]=di,this.int16[uo+6]=yi,this.int16[uo+7]=xi,this.uint16[uo+8]=wi,this.uint16[uo+9]=Ii,this.uint16[uo+10]=Pi,this.uint16[uo+11]=Ri,this.uint16[uo+12]=Li,this.uint16[uo+13]=Fi,this.uint16[uo+14]=qi,this.uint16[uo+15]=Zi,this.uint16[uo+16]=Gr,this.uint16[uo+17]=Yi,this.uint16[uo+18]=Yr,this.uint16[uo+19]=Jr,this.uint16[uo+20]=ao,this.uint16[uo+21]=So,this.uint16[uo+22]=Po,this.uint32[ko+12]=bo,this.float32[ko+13]=vo,this.float32[ko+14]=mo,this.uint16[uo+30]=To,this.uint16[uo+31]=yo,ze}}_i.prototype.bytesPerElement=64,Eo("StructArrayLayout8i15ui1ul2f2ui64",_i);class gi extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(ze){const ii=this.length;return this.resize(ii+1),this.emplace(ii,ze)}emplace(ze,ii){return this.float32[1*ze+0]=ii,ze}}gi.prototype.bytesPerElement=4,Eo("StructArrayLayout1f4",gi);class bi extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(ze,ii,oi){const ai=this.length;return this.resize(ai+1),this.emplace(ai,ze,ii,oi)}emplace(ze,ii,oi,ai){const ui=3*ze;return this.uint16[6*ze+0]=ii,this.float32[ui+1]=oi,this.float32[ui+2]=ai,ze}}bi.prototype.bytesPerElement=12,Eo("StructArrayLayout1ui2f12",bi);class Ei extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(ze,ii,oi){const ai=this.length;return this.resize(ai+1),this.emplace(ai,ze,ii,oi)}emplace(ze,ii,oi,ai){const ui=4*ze;return this.uint32[2*ze+0]=ii,this.uint16[ui+2]=oi,this.uint16[ui+3]=ai,ze}}Ei.prototype.bytesPerElement=8,Eo("StructArrayLayout1ul2ui8",Ei);class Ti extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(ze,ii){const oi=this.length;return this.resize(oi+1),this.emplace(oi,ze,ii)}emplace(ze,ii,oi){const ai=2*ze;return this.uint16[ai+0]=ii,this.uint16[ai+1]=oi,ze}}Ti.prototype.bytesPerElement=4,Eo("StructArrayLayout2ui4",Ti);class zi extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(ze){const ii=this.length;return this.resize(ii+1),this.emplace(ii,ze)}emplace(ze,ii){return this.uint16[1*ze+0]=ii,ze}}zi.prototype.bytesPerElement=2,Eo("StructArrayLayout1ui2",zi);class Ni extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(ze,ii,oi,ai){const ui=this.length;return this.resize(ui+1),this.emplace(ui,ze,ii,oi,ai)}emplace(ze,ii,oi,ai,ui){const pi=4*ze;return this.float32[pi+0]=ii,this.float32[pi+1]=oi,this.float32[pi+2]=ai,this.float32[pi+3]=ui,ze}}Ni.prototype.bytesPerElement=16,Eo("StructArrayLayout4f16",Ni);class Bi extends _l{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new fo(this.anchorPointX,this.anchorPointY)}}Bi.prototype.size=20;class Vi extends ei{get(ze){return new Bi(this,ze)}}Eo("CollisionBoxArray",Vi);class Di extends _l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(ze){this._structArray.uint8[this._pos1+37]=ze}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(ze){this._structArray.uint8[this._pos1+38]=ze}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(ze){this._structArray.uint32[this._pos4+10]=ze}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Di.prototype.size=48;class Wi extends fi{get(ze){return new Di(this,ze)}}Eo("PlacedSymbolArray",Wi);class Kr extends _l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(ze){this._structArray.uint32[this._pos4+12]=ze}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Kr.prototype.size=64;class $i extends _i{get(ze){return new Kr(this,ze)}}Eo("SymbolInstanceArray",$i);class Ji extends gi{getoffsetX(ze){return this.float32[1*ze+0]}}Eo("GlyphOffsetArray",Ji);class eo extends cc{getx(ze){return this.int16[3*ze+0]}gety(ze){return this.int16[3*ze+1]}gettileUnitDistanceFromAnchor(ze){return this.int16[3*ze+2]}}Eo("SymbolLineVertexArray",eo);class to extends _l{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}to.prototype.size=12;class no extends bi{get(ze){return new to(this,ze)}}Eo("TextAnchorOffsetArray",no);class co extends _l{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}co.prototype.size=8;class lo extends Ei{get(ze){return new co(this,ze)}}Eo("FeatureIndexArray",lo);class ho extends lc{}class Ao extends lc{}class Ho extends lc{}class xo extends Bu{}class Bo extends Nu{}class Co extends Ul{}class un extends Uu{}class Zo extends Vu{}class qo extends an{}class Yo extends ci{}class kn extends ri{}class yn extends si{}class pa extends hi{}class Wn extends Ti{}const jn=An([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ja}=jn;class xn{constructor(ze=[]){this.segments=ze}prepareSegment(ze,ii,oi,ai){let ui=this.segments[this.segments.length-1];return ze>xn.MAX_VERTEX_ARRAY_LENGTH&&On(`Max vertices per segment is ${xn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${ze}`),(!ui||ui.vertexLength+ze>xn.MAX_VERTEX_ARRAY_LENGTH||ui.sortKey!==ai)&&(ui={vertexOffset:ii.length,primitiveOffset:oi.length,vertexLength:0,primitiveLength:0},ai!==void 0&&(ui.sortKey=ai),this.segments.push(ui)),ui}get(){return this.segments}destroy(){for(const ze of this.segments)for(const ii in ze.vaos)ze.vaos[ii].destroy()}static simpleSegment(ze,ii,oi,ai){return new xn([{vertexOffset:ze,primitiveOffset:ii,vertexLength:oi,primitiveLength:ai,vaos:{},sortKey:0}])}}function Is(ti,ze){return 256*(ti=Za(Math.floor(ti),0,255))+Za(Math.floor(ze),0,255)}xn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Eo("SegmentVector",xn);const As=An([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var rl={exports:{}},gl={exports:{}};gl.exports=function(ti,ze){var ii,oi,ai,ui,pi,di,yi,xi;for(oi=ti.length-(ii=3&ti.length),ai=ze,pi=3432918353,di=461845907,xi=0;xi<oi;)yi=255&ti.charCodeAt(xi)|(255&ti.charCodeAt(++xi))<<8|(255&ti.charCodeAt(++xi))<<16|(255&ti.charCodeAt(++xi))<<24,++xi,ai=27492+(65535&(ui=5*(65535&(ai=(ai^=yi=(65535&(yi=(yi=(65535&yi)*pi+(((yi>>>16)*pi&65535)<<16)&4294967295)<<15|yi>>>17))*di+(((yi>>>16)*di&65535)<<16)&4294967295)<<13|ai>>>19))+((5*(ai>>>16)&65535)<<16)&4294967295))+((58964+(ui>>>16)&65535)<<16);switch(yi=0,ii){case 3:yi^=(255&ti.charCodeAt(xi+2))<<16;case 2:yi^=(255&ti.charCodeAt(xi+1))<<8;case 1:ai^=yi=(65535&(yi=(yi=(65535&(yi^=255&ti.charCodeAt(xi)))*pi+(((yi>>>16)*pi&65535)<<16)&4294967295)<<15|yi>>>17))*di+(((yi>>>16)*di&65535)<<16)&4294967295}return ai^=ti.length,ai=2246822507*(65535&(ai^=ai>>>16))+((2246822507*(ai>>>16)&65535)<<16)&4294967295,ai=3266489909*(65535&(ai^=ai>>>13))+((3266489909*(ai>>>16)&65535)<<16)&4294967295,(ai^=ai>>>16)>>>0};var Vl=gl.exports,ga={exports:{}};ga.exports=function(ti,ze){for(var ii,oi=ti.length,ai=ze^oi,ui=0;oi>=4;)ii=1540483477*(65535&(ii=255&ti.charCodeAt(ui)|(255&ti.charCodeAt(++ui))<<8|(255&ti.charCodeAt(++ui))<<16|(255&ti.charCodeAt(++ui))<<24))+((1540483477*(ii>>>16)&65535)<<16),ai=1540483477*(65535&ai)+((1540483477*(ai>>>16)&65535)<<16)^(ii=1540483477*(65535&(ii^=ii>>>24))+((1540483477*(ii>>>16)&65535)<<16)),oi-=4,++ui;switch(oi){case 3:ai^=(255&ti.charCodeAt(ui+2))<<16;case 2:ai^=(255&ti.charCodeAt(ui+1))<<8;case 1:ai=1540483477*(65535&(ai^=255&ti.charCodeAt(ui)))+((1540483477*(ai>>>16)&65535)<<16)}return ai=1540483477*(65535&(ai^=ai>>>13))+((1540483477*(ai>>>16)&65535)<<16),(ai^=ai>>>15)>>>0};var da=Vl,Ia=ga.exports;rl.exports=da,rl.exports.murmur3=da,rl.exports.murmur2=Ia;var xl=Ki(rl.exports);class Dn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(ze,ii,oi,ai){this.ids.push(Kn(ze)),this.positions.push(ii,oi,ai)}getPositions(ze){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const ii=Kn(ze);let oi=0,ai=this.ids.length-1;for(;oi<ai;){const pi=oi+ai>>1;this.ids[pi]>=ii?ai=pi:oi=pi+1}const ui=[];for(;this.ids[oi]===ii;)ui.push({index:this.positions[3*oi],start:this.positions[3*oi+1],end:this.positions[3*oi+2]}),oi++;return ui}static serialize(ze,ii){const oi=new Float64Array(ze.ids),ai=new Uint32Array(ze.positions);return Na(oi,ai,0,oi.length-1),ii&&ii.push(oi.buffer,ai.buffer),{ids:oi,positions:ai}}static deserialize(ze){const ii=new Dn;return ii.ids=ze.ids,ii.positions=ze.positions,ii.indexed=!0,ii}}function Kn(ti){const ze=+ti;return!isNaN(ze)&&ze<=Number.MAX_SAFE_INTEGER?ze:xl(String(ti))}function Na(ti,ze,ii,oi){for(;ii<oi;){const ai=ti[ii+oi>>1];let ui=ii-1,pi=oi+1;for(;;){do ui++;while(ti[ui]<ai);do pi--;while(ti[pi]>ai);if(ui>=pi)break;Fn(ti,ui,pi),Fn(ze,3*ui,3*pi),Fn(ze,3*ui+1,3*pi+1),Fn(ze,3*ui+2,3*pi+2)}pi-ii<oi-pi?(Na(ti,ze,ii,pi),ii=pi+1):(Na(ti,ze,pi+1,oi),oi=pi)}}function Fn(ti,ze,ii){const oi=ti[ze];ti[ze]=ti[ii],ti[ii]=oi}Eo("FeaturePositionMap",Dn);class vl{constructor(ze,ii){this.gl=ze.gl,this.location=ii}}class Gc extends vl{constructor(ze,ii){super(ze,ii),this.current=0}set(ze){this.current!==ze&&(this.current=ze,this.gl.uniform1f(this.location,ze))}}class $h extends vl{constructor(ze,ii){super(ze,ii),this.current=[0,0,0,0]}set(ze){ze[0]===this.current[0]&&ze[1]===this.current[1]&&ze[2]===this.current[2]&&ze[3]===this.current[3]||(this.current=ze,this.gl.uniform4f(this.location,ze[0],ze[1],ze[2],ze[3]))}}class Zh extends vl{constructor(ze,ii){super(ze,ii),this.current=cn.transparent}set(ze){ze.r===this.current.r&&ze.g===this.current.g&&ze.b===this.current.b&&ze.a===this.current.a||(this.current=ze,this.gl.uniform4f(this.location,ze.r,ze.g,ze.b,ze.a))}}const Rp=new Float32Array(16);function ju(ti){return[Is(255*ti.r,255*ti.g),Is(255*ti.b,255*ti.a)]}class Ps{constructor(ze,ii,oi){this.value=ze,this.uniformNames=ii.map(ai=>`u_${ai}`),this.type=oi}setUniform(ze,ii,oi){ze.set(oi.constantOr(this.value))}getBinding(ze,ii,oi){return this.type==="color"?new Zh(ze,ii):new Gc(ze,ii)}}class bl{constructor(ze,ii){this.uniformNames=ii.map(oi=>`u_${oi}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(ze,ii){this.pixelRatioFrom=ii.pixelRatio,this.pixelRatioTo=ze.pixelRatio,this.patternFrom=ii.tlbr,this.patternTo=ze.tlbr}setUniform(ze,ii,oi,ai){const ui=ai==="u_pattern_to"?this.patternTo:ai==="u_pattern_from"?this.patternFrom:ai==="u_pixel_ratio_to"?this.pixelRatioTo:ai==="u_pixel_ratio_from"?this.pixelRatioFrom:null;ui&&ze.set(ui)}getBinding(ze,ii,oi){return oi.substr(0,9)==="u_pattern"?new $h(ze,ii):new Gc(ze,ii)}}class Cs{constructor(ze,ii,oi,ai){this.expression=ze,this.type=oi,this.maxValue=0,this.paintVertexAttributes=ii.map(ui=>({name:`a_${ui}`,type:"Float32",components:oi==="color"?2:1,offset:0})),this.paintVertexArray=new ai}populatePaintArray(ze,ii,oi,ai,ui){const pi=this.paintVertexArray.length,di=this.expression.evaluate(new gn(0),ii,{},ai,[],ui);this.paintVertexArray.resize(ze),this._setPaintValue(pi,ze,di)}updatePaintArray(ze,ii,oi,ai){const ui=this.expression.evaluate({zoom:0},oi,ai);this._setPaintValue(ze,ii,ui)}_setPaintValue(ze,ii,oi){if(this.type==="color"){const ai=ju(oi);for(let ui=ze;ui<ii;ui++)this.paintVertexArray.emplace(ui,ai[0],ai[1])}else{for(let ai=ze;ai<ii;ai++)this.paintVertexArray.emplace(ai,oi);this.maxValue=Math.max(this.maxValue,Math.abs(oi))}}upload(ze){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=ze.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ps{constructor(ze,ii,oi,ai,ui,pi){this.expression=ze,this.uniformNames=ii.map(di=>`u_${di}_t`),this.type=oi,this.useIntegerZoom=ai,this.zoom=ui,this.maxValue=0,this.paintVertexAttributes=ii.map(di=>({name:`a_${di}`,type:"Float32",components:oi==="color"?4:2,offset:0})),this.paintVertexArray=new pi}populatePaintArray(ze,ii,oi,ai,ui){const pi=this.expression.evaluate(new gn(this.zoom),ii,{},ai,[],ui),di=this.expression.evaluate(new gn(this.zoom+1),ii,{},ai,[],ui),yi=this.paintVertexArray.length;this.paintVertexArray.resize(ze),this._setPaintValue(yi,ze,pi,di)}updatePaintArray(ze,ii,oi,ai){const ui=this.expression.evaluate({zoom:this.zoom},oi,ai),pi=this.expression.evaluate({zoom:this.zoom+1},oi,ai);this._setPaintValue(ze,ii,ui,pi)}_setPaintValue(ze,ii,oi,ai){if(this.type==="color"){const ui=ju(oi),pi=ju(ai);for(let di=ze;di<ii;di++)this.paintVertexArray.emplace(di,ui[0],ui[1],pi[0],pi[1])}else{for(let ui=ze;ui<ii;ui++)this.paintVertexArray.emplace(ui,oi,ai);this.maxValue=Math.max(this.maxValue,Math.abs(oi),Math.abs(ai))}}upload(ze){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=ze.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(ze,ii){const oi=this.useIntegerZoom?Math.floor(ii.zoom):ii.zoom,ai=Za(this.expression.interpolationFactor(oi,this.zoom,this.zoom+1),0,1);ze.set(ai)}getBinding(ze,ii,oi){return new Gc(ze,ii)}}class zs{constructor(ze,ii,oi,ai,ui,pi){this.expression=ze,this.type=ii,this.useIntegerZoom=oi,this.zoom=ai,this.layerId=pi,this.zoomInPaintVertexArray=new ui,this.zoomOutPaintVertexArray=new ui}populatePaintArray(ze,ii,oi){const ai=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(ze),this.zoomOutPaintVertexArray.resize(ze),this._setPaintValues(ai,ze,ii.patterns&&ii.patterns[this.layerId],oi)}updatePaintArray(ze,ii,oi,ai,ui){this._setPaintValues(ze,ii,oi.patterns&&oi.patterns[this.layerId],ui)}_setPaintValues(ze,ii,oi,ai){if(!ai||!oi)return;const{min:ui,mid:pi,max:di}=oi,yi=ai[ui],xi=ai[pi],wi=ai[di];if(yi&&xi&&wi)for(let Ii=ze;Ii<ii;Ii++)this.zoomInPaintVertexArray.emplace(Ii,xi.tl[0],xi.tl[1],xi.br[0],xi.br[1],yi.tl[0],yi.tl[1],yi.br[0],yi.br[1],xi.pixelRatio,yi.pixelRatio),this.zoomOutPaintVertexArray.emplace(Ii,xi.tl[0],xi.tl[1],xi.br[0],xi.br[1],wi.tl[0],wi.tl[1],wi.br[0],wi.br[1],xi.pixelRatio,wi.pixelRatio)}upload(ze){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=ze.createVertexBuffer(this.zoomInPaintVertexArray,As.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=ze.createVertexBuffer(this.zoomOutPaintVertexArray,As.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qu{constructor(ze,ii,oi){this.binders={},this._buffers=[];const ai=[];for(const ui in ze.paint._values){if(!oi(ui))continue;const pi=ze.paint.get(ui);if(!(pi instanceof Ta&&Ol(pi.property.specification)))continue;const di=nm(ui,ze.type),yi=pi.value,xi=pi.property.specification.type,wi=pi.property.useIntegerZoom,Ii=pi.property.specification["property-type"],Pi=Ii==="cross-faded"||Ii==="cross-faded-data-driven";if(yi.kind==="constant")this.binders[ui]=Pi?new bl(yi.value,di):new Ps(yi.value,di,xi),ai.push(`/u_${ui}`);else if(yi.kind==="source"||Pi){const Ri=bd(ui,xi,"source");this.binders[ui]=Pi?new zs(yi,xi,wi,ii,Ri,ze.id):new Cs(yi,di,xi,Ri),ai.push(`/a_${ui}`)}else{const Ri=bd(ui,xi,"composite");this.binders[ui]=new ps(yi,di,xi,wi,ii,Ri),ai.push(`/z_${ui}`)}}this.cacheKey=ai.sort().join("")}getMaxValue(ze){const ii=this.binders[ze];return ii instanceof Cs||ii instanceof ps?ii.maxValue:0}populatePaintArrays(ze,ii,oi,ai,ui){for(const pi in this.binders){const di=this.binders[pi];(di instanceof Cs||di instanceof ps||di instanceof zs)&&di.populatePaintArray(ze,ii,oi,ai,ui)}}setConstantPatternPositions(ze,ii){for(const oi in this.binders){const ai=this.binders[oi];ai instanceof bl&&ai.setConstantPatternPositions(ze,ii)}}updatePaintArrays(ze,ii,oi,ai,ui){let pi=!1;for(const di in ze){const yi=ii.getPositions(di);for(const xi of yi){const wi=oi.feature(xi.index);for(const Ii in this.binders){const Pi=this.binders[Ii];if((Pi instanceof Cs||Pi instanceof ps||Pi instanceof zs)&&Pi.expression.isStateDependent===!0){const Ri=ai.paint.get(Ii);Pi.expression=Ri.value,Pi.updatePaintArray(xi.start,xi.end,wi,ze[di],ui),pi=!0}}}}return pi}defines(){const ze=[];for(const ii in this.binders){const oi=this.binders[ii];(oi instanceof Ps||oi instanceof bl)&&ze.push(...oi.uniformNames.map(ai=>`#define HAS_UNIFORM_${ai}`))}return ze}getBinderAttributes(){const ze=[];for(const ii in this.binders){const oi=this.binders[ii];if(oi instanceof Cs||oi instanceof ps)for(let ai=0;ai<oi.paintVertexAttributes.length;ai++)ze.push(oi.paintVertexAttributes[ai].name);else if(oi instanceof zs)for(let ai=0;ai<As.members.length;ai++)ze.push(As.members[ai].name)}return ze}getBinderUniforms(){const ze=[];for(const ii in this.binders){const oi=this.binders[ii];if(oi instanceof Ps||oi instanceof bl||oi instanceof ps)for(const ai of oi.uniformNames)ze.push(ai)}return ze}getPaintVertexBuffers(){return this._buffers}getUniforms(ze,ii){const oi=[];for(const ai in this.binders){const ui=this.binders[ai];if(ui instanceof Ps||ui instanceof bl||ui instanceof ps){for(const pi of ui.uniformNames)if(ii[pi]){const di=ui.getBinding(ze,ii[pi],pi);oi.push({name:pi,property:ai,binding:di})}}}return oi}setUniforms(ze,ii,oi,ai){for(const{name:ui,property:pi,binding:di}of ii)this.binders[pi].setUniform(di,ai,oi.get(pi),ui)}updatePaintBuffers(ze){this._buffers=[];for(const ii in this.binders){const oi=this.binders[ii];if(ze&&oi instanceof zs){const ai=ze.fromScale===2?oi.zoomInPaintVertexBuffer:oi.zoomOutPaintVertexBuffer;ai&&this._buffers.push(ai)}else(oi instanceof Cs||oi instanceof ps)&&oi.paintVertexBuffer&&this._buffers.push(oi.paintVertexBuffer)}}upload(ze){for(const ii in this.binders){const oi=this.binders[ii];(oi instanceof Cs||oi instanceof ps||oi instanceof zs)&&oi.upload(ze)}this.updatePaintBuffers()}destroy(){for(const ze in this.binders){const ii=this.binders[ze];(ii instanceof Cs||ii instanceof ps||ii instanceof zs)&&ii.destroy()}}}class Gs{constructor(ze,ii,oi=()=>!0){this.programConfigurations={};for(const ai of ze)this.programConfigurations[ai.id]=new qu(ai,ii,oi);this.needsUpload=!1,this._featureMap=new Dn,this._bufferOffset=0}populatePaintArrays(ze,ii,oi,ai,ui,pi){for(const di in this.programConfigurations)this.programConfigurations[di].populatePaintArrays(ze,ii,ai,ui,pi);ii.id!==void 0&&this._featureMap.add(ii.id,oi,this._bufferOffset,ze),this._bufferOffset=ze,this.needsUpload=!0}updatePaintArrays(ze,ii,oi,ai){for(const ui of oi)this.needsUpload=this.programConfigurations[ui.id].updatePaintArrays(ze,this._featureMap,ii,ui,ai)||this.needsUpload}get(ze){return this.programConfigurations[ze]}upload(ze){if(this.needsUpload){for(const ii in this.programConfigurations)this.programConfigurations[ii].upload(ze);this.needsUpload=!1}}destroy(){for(const ze in this.programConfigurations)this.programConfigurations[ze].destroy()}}function nm(ti,ze){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[ti]||[ti.replace(`${ze}-`,"").replace(/-/g,"_")]}function bd(ti,ze,ii){const oi={color:{source:Ul,composite:Ni},number:{source:gi,composite:Ul}},ai=function(ui){return{"line-pattern":{source:un,composite:un},"fill-pattern":{source:un,composite:un},"fill-extrusion-pattern":{source:un,composite:un}}[ui]}(ti);return ai&&ai[ii]||oi[ze][ii]}Eo("ConstantBinder",Ps),Eo("CrossFadedConstantBinder",bl),Eo("SourceExpressionBinder",Cs),Eo("CrossFadedCompositeBinder",zs),Eo("CompositeExpressionBinder",ps),Eo("ProgramConfiguration",qu,{omit:["_buffers"]}),Eo("ProgramConfigurationSet",Gs);const Hn=8192,Mp=Math.pow(2,14)-1,wd=-Mp-1;function uc(ti){const ze=Hn/ti.extent,ii=ti.loadGeometry();for(let oi=0;oi<ii.length;oi++){const ai=ii[oi];for(let ui=0;ui<ai.length;ui++){const pi=ai[ui],di=Math.round(pi.x*ze),yi=Math.round(pi.y*ze);pi.x=Za(di,wd,Mp),pi.y=Za(yi,wd,Mp),(di<pi.x||di>pi.x+1||yi<pi.y||yi>pi.y+1)&&On("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return ii}function hc(ti,ze){return{type:ti.type,id:ti.id,properties:ti.properties,geometry:ze?uc(ti):[]}}function Hh(ti,ze,ii,oi,ai){ti.emplaceBack(2*ze+(oi+1)/2,2*ii+(ai+1)/2)}class Lp{constructor(ze){this.zoom=ze.zoom,this.overscaling=ze.overscaling,this.layers=ze.layers,this.layerIds=this.layers.map(ii=>ii.id),this.index=ze.index,this.hasPattern=!1,this.layoutVertexArray=new Ao,this.indexArray=new pa,this.segments=new xn,this.programConfigurations=new Gs(ze.layers,ze.zoom),this.stateDependentLayerIds=this.layers.filter(ii=>ii.isStateDependent()).map(ii=>ii.id)}populate(ze,ii,oi){const ai=this.layers[0],ui=[];let pi=null,di=!1;ai.type==="circle"&&(pi=ai.layout.get("circle-sort-key"),di=!pi.isConstant());for(const{feature:yi,id:xi,index:wi,sourceLayerIndex:Ii}of ze){const Pi=this.layers[0]._featureFilter.needGeometry,Ri=hc(yi,Pi);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),Ri,oi))continue;const Li=di?pi.evaluate(Ri,{},oi):void 0,Fi={id:xi,properties:yi.properties,type:yi.type,sourceLayerIndex:Ii,index:wi,geometry:Pi?Ri.geometry:uc(yi),patterns:{},sortKey:Li};ui.push(Fi)}di&&ui.sort((yi,xi)=>yi.sortKey-xi.sortKey);for(const yi of ui){const{geometry:xi,index:wi,sourceLayerIndex:Ii}=yi,Pi=ze[wi].feature;this.addFeature(yi,xi,wi,oi),ii.featureIndex.insert(Pi,xi,wi,Ii,this.index)}}update(ze,ii,oi){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(ze,ii,this.stateDependentLayers,oi)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(ze){this.uploaded||(this.layoutVertexBuffer=ze.createVertexBuffer(this.layoutVertexArray,Ja),this.indexBuffer=ze.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(ze),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(ze,ii,oi,ai){for(const ui of ii)for(const pi of ui){const di=pi.x,yi=pi.y;if(di<0||di>=Hn||yi<0||yi>=Hn)continue;const xi=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,ze.sortKey),wi=xi.vertexLength;Hh(this.layoutVertexArray,di,yi,-1,-1),Hh(this.layoutVertexArray,di,yi,1,-1),Hh(this.layoutVertexArray,di,yi,1,1),Hh(this.layoutVertexArray,di,yi,-1,1),this.indexArray.emplaceBack(wi,wi+1,wi+2),this.indexArray.emplaceBack(wi,wi+3,wi+2),xi.vertexLength+=4,xi.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,ze,oi,{},ai)}}function Sd(ti,ze){for(let ii=0;ii<ti.length;ii++)if($c(ze,ti[ii]))return!0;for(let ii=0;ii<ze.length;ii++)if($c(ti,ze[ii]))return!0;return!!Op(ti,ze)}function am(ti,ze,ii){return!!$c(ti,ze)||!!kp(ze,ti,ii)}function Ed(ti,ze){if(ti.length===1)return Id(ze,ti[0]);for(let ii=0;ii<ze.length;ii++){const oi=ze[ii];for(let ai=0;ai<oi.length;ai++)if($c(ti,oi[ai]))return!0}for(let ii=0;ii<ti.length;ii++)if(Id(ze,ti[ii]))return!0;for(let ii=0;ii<ze.length;ii++)if(Op(ti,ze[ii]))return!0;return!1}function sm(ti,ze,ii){if(ti.length>1){if(Op(ti,ze))return!0;for(let oi=0;oi<ze.length;oi++)if(kp(ze[oi],ti,ii))return!0}for(let oi=0;oi<ti.length;oi++)if(kp(ti[oi],ze,ii))return!0;return!1}function Op(ti,ze){if(ti.length===0||ze.length===0)return!1;for(let ii=0;ii<ti.length-1;ii++){const oi=ti[ii],ai=ti[ii+1];for(let ui=0;ui<ze.length-1;ui++)if(lm(oi,ai,ze[ui],ze[ui+1]))return!0}return!1}function lm(ti,ze,ii,oi){return rn(ti,ii,oi)!==rn(ze,ii,oi)&&rn(ti,ze,ii)!==rn(ti,ze,oi)}function kp(ti,ze,ii){const oi=ii*ii;if(ze.length===1)return ti.distSqr(ze[0])<oi;for(let ai=1;ai<ze.length;ai++)if(Td(ti,ze[ai-1],ze[ai])<oi)return!0;return!1}function Td(ti,ze,ii){const oi=ze.distSqr(ii);if(oi===0)return ti.distSqr(ze);const ai=((ti.x-ze.x)*(ii.x-ze.x)+(ti.y-ze.y)*(ii.y-ze.y))/oi;return ti.distSqr(ai<0?ze:ai>1?ii:ii.sub(ze)._mult(ai)._add(ze))}function Id(ti,ze){let ii,oi,ai,ui=!1;for(let pi=0;pi<ti.length;pi++){ii=ti[pi];for(let di=0,yi=ii.length-1;di<ii.length;yi=di++)oi=ii[di],ai=ii[yi],oi.y>ze.y!=ai.y>ze.y&&ze.x<(ai.x-oi.x)*(ze.y-oi.y)/(ai.y-oi.y)+oi.x&&(ui=!ui)}return ui}function $c(ti,ze){let ii=!1;for(let oi=0,ai=ti.length-1;oi<ti.length;ai=oi++){const ui=ti[oi],pi=ti[ai];ui.y>ze.y!=pi.y>ze.y&&ze.x<(pi.x-ui.x)*(ze.y-ui.y)/(pi.y-ui.y)+ui.x&&(ii=!ii)}return ii}function cm(ti,ze,ii){const oi=ii[0],ai=ii[2];if(ti.x<oi.x&&ze.x<oi.x||ti.x>ai.x&&ze.x>ai.x||ti.y<oi.y&&ze.y<oi.y||ti.y>ai.y&&ze.y>ai.y)return!1;const ui=rn(ti,ze,ii[0]);return ui!==rn(ti,ze,ii[1])||ui!==rn(ti,ze,ii[2])||ui!==rn(ti,ze,ii[3])}function Gu(ti,ze,ii){const oi=ze.paint.get(ti).value;return oi.kind==="constant"?oi.value:ii.programConfigurations.get(ze.id).getMaxValue(ti)}function Yh(ti){return Math.sqrt(ti[0]*ti[0]+ti[1]*ti[1])}function Xh(ti,ze,ii,oi,ai){if(!ze[0]&&!ze[1])return ti;const ui=fo.convert(ze)._mult(ai);ii==="viewport"&&ui._rotate(-oi);const pi=[];for(let di=0;di<ti.length;di++)pi.push(ti[di].sub(ui));return pi}let Ad,Pd;Eo("CircleBucket",Lp,{omit:["layers"]});var um={get paint(){return Pd=Pd||new Vn({"circle-radius":new Fo(io.paint_circle["circle-radius"]),"circle-color":new Fo(io.paint_circle["circle-color"]),"circle-blur":new Fo(io.paint_circle["circle-blur"]),"circle-opacity":new Fo(io.paint_circle["circle-opacity"]),"circle-translate":new Mo(io.paint_circle["circle-translate"]),"circle-translate-anchor":new Mo(io.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mo(io.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mo(io.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fo(io.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fo(io.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fo(io.paint_circle["circle-stroke-opacity"])})},get layout(){return Ad=Ad||new Vn({"circle-sort-key":new Fo(io.layout_circle["circle-sort-key"])})}},Ua=1e-6,Zc=typeof Float32Array<"u"?Float32Array:Array;function Dp(ti){return ti[0]=1,ti[1]=0,ti[2]=0,ti[3]=0,ti[4]=0,ti[5]=1,ti[6]=0,ti[7]=0,ti[8]=0,ti[9]=0,ti[10]=1,ti[11]=0,ti[12]=0,ti[13]=0,ti[14]=0,ti[15]=1,ti}function Cd(ti,ze,ii){var oi=ze[0],ai=ze[1],ui=ze[2],pi=ze[3],di=ze[4],yi=ze[5],xi=ze[6],wi=ze[7],Ii=ze[8],Pi=ze[9],Ri=ze[10],Li=ze[11],Fi=ze[12],qi=ze[13],Zi=ze[14],Gr=ze[15],Yi=ii[0],Yr=ii[1],Jr=ii[2],ao=ii[3];return ti[0]=Yi*oi+Yr*di+Jr*Ii+ao*Fi,ti[1]=Yi*ai+Yr*yi+Jr*Pi+ao*qi,ti[2]=Yi*ui+Yr*xi+Jr*Ri+ao*Zi,ti[3]=Yi*pi+Yr*wi+Jr*Li+ao*Gr,ti[4]=(Yi=ii[4])*oi+(Yr=ii[5])*di+(Jr=ii[6])*Ii+(ao=ii[7])*Fi,ti[5]=Yi*ai+Yr*yi+Jr*Pi+ao*qi,ti[6]=Yi*ui+Yr*xi+Jr*Ri+ao*Zi,ti[7]=Yi*pi+Yr*wi+Jr*Li+ao*Gr,ti[8]=(Yi=ii[8])*oi+(Yr=ii[9])*di+(Jr=ii[10])*Ii+(ao=ii[11])*Fi,ti[9]=Yi*ai+Yr*yi+Jr*Pi+ao*qi,ti[10]=Yi*ui+Yr*xi+Jr*Ri+ao*Zi,ti[11]=Yi*pi+Yr*wi+Jr*Li+ao*Gr,ti[12]=(Yi=ii[12])*oi+(Yr=ii[13])*di+(Jr=ii[14])*Ii+(ao=ii[15])*Fi,ti[13]=Yi*ai+Yr*yi+Jr*Pi+ao*qi,ti[14]=Yi*ui+Yr*xi+Jr*Ri+ao*Zi,ti[15]=Yi*pi+Yr*wi+Jr*Li+ao*Gr,ti}Math.hypot||(Math.hypot=function(){for(var ti=0,ze=arguments.length;ze--;)ti+=arguments[ze]*arguments[ze];return Math.sqrt(ti)});var $u,hm=Cd;function Wh(ti,ze,ii){var oi=ze[0],ai=ze[1],ui=ze[2],pi=ze[3];return ti[0]=ii[0]*oi+ii[4]*ai+ii[8]*ui+ii[12]*pi,ti[1]=ii[1]*oi+ii[5]*ai+ii[9]*ui+ii[13]*pi,ti[2]=ii[2]*oi+ii[6]*ai+ii[10]*ui+ii[14]*pi,ti[3]=ii[3]*oi+ii[7]*ai+ii[11]*ui+ii[15]*pi,ti}$u=new Zc(4),Zc!=Float32Array&&($u[0]=0,$u[1]=0,$u[2]=0,$u[3]=0);class pm extends hs{constructor(ze){super(ze,um)}createBucket(ze){return new Lp(ze)}queryRadius(ze){const ii=ze;return Gu("circle-radius",this,ii)+Gu("circle-stroke-width",this,ii)+Yh(this.paint.get("circle-translate"))}queryIntersectsFeature(ze,ii,oi,ai,ui,pi,di,yi){const xi=Xh(ze,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),pi.angle,di),wi=this.paint.get("circle-radius").evaluate(ii,oi)+this.paint.get("circle-stroke-width").evaluate(ii,oi),Ii=this.paint.get("circle-pitch-alignment")==="map",Pi=Ii?xi:function(Li,Fi){return Li.map(qi=>zd(qi,Fi))}(xi,yi),Ri=Ii?wi*di:wi;for(const Li of ai)for(const Fi of Li){const qi=Ii?Fi:zd(Fi,yi);let Zi=Ri;const Gr=Wh([],[Fi.x,Fi.y,0,1],yi);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Zi*=Gr[3]/pi.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Zi*=pi.cameraToCenterDistance/Gr[3]),am(Pi,qi,Zi))return!0}return!1}}function zd(ti,ze){const ii=Wh([],[ti.x,ti.y,0,1],ze);return new fo(ii[0]/ii[3],ii[1]/ii[3])}class Rd extends Lp{}let Md;Eo("HeatmapBucket",Rd,{omit:["layers"]});var dm={get paint(){return Md=Md||new Vn({"heatmap-radius":new Fo(io.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fo(io.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mo(io.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Du(io.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mo(io.paint_heatmap["heatmap-opacity"])})}};function Fp(ti,{width:ze,height:ii},oi,ai){if(ai){if(ai instanceof Uint8ClampedArray)ai=new Uint8Array(ai.buffer);else if(ai.length!==ze*ii*oi)throw new RangeError(`mismatched image size. expected: ${ai.length} but got: ${ze*ii*oi}`)}else ai=new Uint8Array(ze*ii*oi);return ti.width=ze,ti.height=ii,ti.data=ai,ti}function Ld(ti,{width:ze,height:ii},oi){if(ze===ti.width&&ii===ti.height)return;const ai=Fp({},{width:ze,height:ii},oi);Bp(ti,ai,{x:0,y:0},{x:0,y:0},{width:Math.min(ti.width,ze),height:Math.min(ti.height,ii)},oi),ti.width=ze,ti.height=ii,ti.data=ai.data}function Bp(ti,ze,ii,oi,ai,ui){if(ai.width===0||ai.height===0)return ze;if(ai.width>ti.width||ai.height>ti.height||ii.x>ti.width-ai.width||ii.y>ti.height-ai.height)throw new RangeError("out of range source coordinates for image copy");if(ai.width>ze.width||ai.height>ze.height||oi.x>ze.width-ai.width||oi.y>ze.height-ai.height)throw new RangeError("out of range destination coordinates for image copy");const pi=ti.data,di=ze.data;if(pi===di)throw new Error("srcData equals dstData, so image is already copied");for(let yi=0;yi<ai.height;yi++){const xi=((ii.y+yi)*ti.width+ii.x)*ui,wi=((oi.y+yi)*ze.width+oi.x)*ui;for(let Ii=0;Ii<ai.width*ui;Ii++)di[wi+Ii]=pi[xi+Ii]}return ze}class Zu{constructor(ze,ii){Fp(this,ze,1,ii)}resize(ze){Ld(this,ze,1)}clone(){return new Zu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(ze,ii,oi,ai,ui){Bp(ze,ii,oi,ai,ui,1)}}class _s{constructor(ze,ii){Fp(this,ze,4,ii)}resize(ze){Ld(this,ze,4)}replace(ze,ii){ii?this.data.set(ze):this.data=ze instanceof Uint8ClampedArray?new Uint8Array(ze.buffer):ze}clone(){return new _s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(ze,ii,oi,ai,ui){Bp(ze,ii,oi,ai,ui,4)}}function Od(ti){const ze={},ii=ti.resolution||256,oi=ti.clips?ti.clips.length:1,ai=ti.image||new _s({width:ii,height:oi});if(Math.log(ii)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${ii}`);const ui=(pi,di,yi)=>{ze[ti.evaluationKey]=yi;const xi=ti.expression.evaluate(ze);ai.data[pi+di+0]=Math.floor(255*xi.r/xi.a),ai.data[pi+di+1]=Math.floor(255*xi.g/xi.a),ai.data[pi+di+2]=Math.floor(255*xi.b/xi.a),ai.data[pi+di+3]=Math.floor(255*xi.a)};if(ti.clips)for(let pi=0,di=0;pi<oi;++pi,di+=4*ii)for(let yi=0,xi=0;yi<ii;yi++,xi+=4){const wi=yi/(ii-1),{start:Ii,end:Pi}=ti.clips[pi];ui(di,xi,Ii*(1-wi)+Pi*wi)}else for(let pi=0,di=0;pi<ii;pi++,di+=4)ui(0,di,pi/(ii-1));return ai}Eo("AlphaImage",Zu),Eo("RGBAImage",_s);class fm extends hs{createBucket(ze){return new Rd(ze)}constructor(ze){super(ze,dm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(ze){ze==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Od({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let kd;var mm={get paint(){return kd=kd||new Vn({"hillshade-illumination-direction":new Mo(io.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mo(io.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mo(io.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mo(io.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mo(io.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mo(io.paint_hillshade["hillshade-accent-color"])})}};class _m extends hs{constructor(ze){super(ze,mm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const ym=An([{name:"a_pos",components:2,type:"Int16"}],4),{members:gm}=ym;var Np={exports:{}};function Kh(ti,ze,ii){ii=ii||2;var oi,ai,ui,pi,di,yi,xi,wi=ze&&ze.length,Ii=wi?ze[0]*ii:ti.length,Pi=Dd(ti,0,Ii,ii,!0),Ri=[];if(!Pi||Pi.next===Pi.prev)return Ri;if(wi&&(Pi=function(Fi,qi,Zi,Gr){var Yi,Yr,Jr,ao=[];for(Yi=0,Yr=qi.length;Yi<Yr;Yi++)(Jr=Dd(Fi,qi[Yi]*Gr,Yi<Yr-1?qi[Yi+1]*Gr:Fi.length,Gr,!1))===Jr.next&&(Jr.steiner=!0),ao.push(Im(Jr));for(ao.sort(Sm),Yi=0;Yi<ao.length;Yi++)Zi=Em(ao[Yi],Zi);return Zi}(ti,ze,Pi,ii)),ti.length>80*ii){oi=ui=ti[0],ai=pi=ti[1];for(var Li=ii;Li<Ii;Li+=ii)(di=ti[Li])<oi&&(oi=di),(yi=ti[Li+1])<ai&&(ai=yi),di>ui&&(ui=di),yi>pi&&(pi=yi);xi=(xi=Math.max(ui-oi,pi-ai))!==0?32767/xi:0}return Hu(Pi,Ri,ii,oi,ai,xi,0),Ri}function Dd(ti,ze,ii,oi,ai){var ui,pi;if(ai===jp(ti,ze,ii,oi)>0)for(ui=ze;ui<ii;ui+=oi)pi=Nd(ui,ti[ui],ti[ui+1],pi);else for(ui=ii-oi;ui>=ze;ui-=oi)pi=Nd(ui,ti[ui],ti[ui+1],pi);return pi&&Jh(pi,pi.next)&&(Xu(pi),pi=pi.next),pi}function pc(ti,ze){if(!ti)return ti;ze||(ze=ti);var ii,oi=ti;do if(ii=!1,oi.steiner||!Jh(oi,oi.next)&&qn(oi.prev,oi,oi.next)!==0)oi=oi.next;else{if(Xu(oi),(oi=ze=oi.prev)===oi.next)break;ii=!0}while(ii||oi!==ze);return ze}function Hu(ti,ze,ii,oi,ai,ui,pi){if(ti){!pi&&ui&&function(wi,Ii,Pi,Ri){var Li=wi;do Li.z===0&&(Li.z=Up(Li.x,Li.y,Ii,Pi,Ri)),Li.prevZ=Li.prev,Li.nextZ=Li.next,Li=Li.next;while(Li!==wi);Li.prevZ.nextZ=null,Li.prevZ=null,function(Fi){var qi,Zi,Gr,Yi,Yr,Jr,ao,So,Po=1;do{for(Zi=Fi,Fi=null,Yr=null,Jr=0;Zi;){for(Jr++,Gr=Zi,ao=0,qi=0;qi<Po&&(ao++,Gr=Gr.nextZ);qi++);for(So=Po;ao>0||So>0&&Gr;)ao!==0&&(So===0||!Gr||Zi.z<=Gr.z)?(Yi=Zi,Zi=Zi.nextZ,ao--):(Yi=Gr,Gr=Gr.nextZ,So--),Yr?Yr.nextZ=Yi:Fi=Yi,Yi.prevZ=Yr,Yr=Yi;Zi=Gr}Yr.nextZ=null,Po*=2}while(Jr>1)}(Li)}(ti,oi,ai,ui);for(var di,yi,xi=ti;ti.prev!==ti.next;)if(di=ti.prev,yi=ti.next,ui?vm(ti,oi,ai,ui):xm(ti))ze.push(di.i/ii|0),ze.push(ti.i/ii|0),ze.push(yi.i/ii|0),Xu(ti),ti=yi.next,xi=yi.next;else if((ti=yi)===xi){pi?pi===1?Hu(ti=bm(pc(ti),ze,ii),ze,ii,oi,ai,ui,2):pi===2&&wm(ti,ze,ii,oi,ai,ui):Hu(pc(ti),ze,ii,oi,ai,ui,1);break}}}function xm(ti){var ze=ti.prev,ii=ti,oi=ti.next;if(qn(ze,ii,oi)>=0)return!1;for(var ai=ze.x,ui=ii.x,pi=oi.x,di=ze.y,yi=ii.y,xi=oi.y,wi=ai<ui?ai<pi?ai:pi:ui<pi?ui:pi,Ii=di<yi?di<xi?di:xi:yi<xi?yi:xi,Pi=ai>ui?ai>pi?ai:pi:ui>pi?ui:pi,Ri=di>yi?di>xi?di:xi:yi>xi?yi:xi,Li=oi.next;Li!==ze;){if(Li.x>=wi&&Li.x<=Pi&&Li.y>=Ii&&Li.y<=Ri&&Hc(ai,di,ui,yi,pi,xi,Li.x,Li.y)&&qn(Li.prev,Li,Li.next)>=0)return!1;Li=Li.next}return!0}function vm(ti,ze,ii,oi){var ai=ti.prev,ui=ti,pi=ti.next;if(qn(ai,ui,pi)>=0)return!1;for(var di=ai.x,yi=ui.x,xi=pi.x,wi=ai.y,Ii=ui.y,Pi=pi.y,Ri=di<yi?di<xi?di:xi:yi<xi?yi:xi,Li=wi<Ii?wi<Pi?wi:Pi:Ii<Pi?Ii:Pi,Fi=di>yi?di>xi?di:xi:yi>xi?yi:xi,qi=wi>Ii?wi>Pi?wi:Pi:Ii>Pi?Ii:Pi,Zi=Up(Ri,Li,ze,ii,oi),Gr=Up(Fi,qi,ze,ii,oi),Yi=ti.prevZ,Yr=ti.nextZ;Yi&&Yi.z>=Zi&&Yr&&Yr.z<=Gr;){if(Yi.x>=Ri&&Yi.x<=Fi&&Yi.y>=Li&&Yi.y<=qi&&Yi!==ai&&Yi!==pi&&Hc(di,wi,yi,Ii,xi,Pi,Yi.x,Yi.y)&&qn(Yi.prev,Yi,Yi.next)>=0||(Yi=Yi.prevZ,Yr.x>=Ri&&Yr.x<=Fi&&Yr.y>=Li&&Yr.y<=qi&&Yr!==ai&&Yr!==pi&&Hc(di,wi,yi,Ii,xi,Pi,Yr.x,Yr.y)&&qn(Yr.prev,Yr,Yr.next)>=0))return!1;Yr=Yr.nextZ}for(;Yi&&Yi.z>=Zi;){if(Yi.x>=Ri&&Yi.x<=Fi&&Yi.y>=Li&&Yi.y<=qi&&Yi!==ai&&Yi!==pi&&Hc(di,wi,yi,Ii,xi,Pi,Yi.x,Yi.y)&&qn(Yi.prev,Yi,Yi.next)>=0)return!1;Yi=Yi.prevZ}for(;Yr&&Yr.z<=Gr;){if(Yr.x>=Ri&&Yr.x<=Fi&&Yr.y>=Li&&Yr.y<=qi&&Yr!==ai&&Yr!==pi&&Hc(di,wi,yi,Ii,xi,Pi,Yr.x,Yr.y)&&qn(Yr.prev,Yr,Yr.next)>=0)return!1;Yr=Yr.nextZ}return!0}function bm(ti,ze,ii){var oi=ti;do{var ai=oi.prev,ui=oi.next.next;!Jh(ai,ui)&&Fd(ai,oi,oi.next,ui)&&Yu(ai,ui)&&Yu(ui,ai)&&(ze.push(ai.i/ii|0),ze.push(oi.i/ii|0),ze.push(ui.i/ii|0),Xu(oi),Xu(oi.next),oi=ti=ui),oi=oi.next}while(oi!==ti);return pc(oi)}function wm(ti,ze,ii,oi,ai,ui){var pi=ti;do{for(var di=pi.next.next;di!==pi.prev;){if(pi.i!==di.i&&Am(pi,di)){var yi=Bd(pi,di);return pi=pc(pi,pi.next),yi=pc(yi,yi.next),Hu(pi,ze,ii,oi,ai,ui,0),void Hu(yi,ze,ii,oi,ai,ui,0)}di=di.next}pi=pi.next}while(pi!==ti)}function Sm(ti,ze){return ti.x-ze.x}function Em(ti,ze){var ii=function(ai,ui){var pi,di=ui,yi=ai.x,xi=ai.y,wi=-1/0;do{if(xi<=di.y&&xi>=di.next.y&&di.next.y!==di.y){var Ii=di.x+(xi-di.y)*(di.next.x-di.x)/(di.next.y-di.y);if(Ii<=yi&&Ii>wi&&(wi=Ii,pi=di.x<di.next.x?di:di.next,Ii===yi))return pi}di=di.next}while(di!==ui);if(!pi)return null;var Pi,Ri=pi,Li=pi.x,Fi=pi.y,qi=1/0;di=pi;do yi>=di.x&&di.x>=Li&&yi!==di.x&&Hc(xi<Fi?yi:wi,xi,Li,Fi,xi<Fi?wi:yi,xi,di.x,di.y)&&(Pi=Math.abs(xi-di.y)/(yi-di.x),Yu(di,ai)&&(Pi<qi||Pi===qi&&(di.x>pi.x||di.x===pi.x&&Tm(pi,di)))&&(pi=di,qi=Pi)),di=di.next;while(di!==Ri);return pi}(ti,ze);if(!ii)return ze;var oi=Bd(ii,ti);return pc(oi,oi.next),pc(ii,ii.next)}function Tm(ti,ze){return qn(ti.prev,ti,ze.prev)<0&&qn(ze.next,ti,ti.next)<0}function Up(ti,ze,ii,oi,ai){return(ti=1431655765&((ti=858993459&((ti=252645135&((ti=16711935&((ti=(ti-ii)*ai|0)|ti<<8))|ti<<4))|ti<<2))|ti<<1))|(ze=1431655765&((ze=858993459&((ze=252645135&((ze=16711935&((ze=(ze-oi)*ai|0)|ze<<8))|ze<<4))|ze<<2))|ze<<1))<<1}function Im(ti){var ze=ti,ii=ti;do(ze.x<ii.x||ze.x===ii.x&&ze.y<ii.y)&&(ii=ze),ze=ze.next;while(ze!==ti);return ii}function Hc(ti,ze,ii,oi,ai,ui,pi,di){return(ai-pi)*(ze-di)>=(ti-pi)*(ui-di)&&(ti-pi)*(oi-di)>=(ii-pi)*(ze-di)&&(ii-pi)*(ui-di)>=(ai-pi)*(oi-di)}function Am(ti,ze){return ti.next.i!==ze.i&&ti.prev.i!==ze.i&&!function(ii,oi){var ai=ii;do{if(ai.i!==ii.i&&ai.next.i!==ii.i&&ai.i!==oi.i&&ai.next.i!==oi.i&&Fd(ai,ai.next,ii,oi))return!0;ai=ai.next}while(ai!==ii);return!1}(ti,ze)&&(Yu(ti,ze)&&Yu(ze,ti)&&function(ii,oi){var ai=ii,ui=!1,pi=(ii.x+oi.x)/2,di=(ii.y+oi.y)/2;do ai.y>di!=ai.next.y>di&&ai.next.y!==ai.y&&pi<(ai.next.x-ai.x)*(di-ai.y)/(ai.next.y-ai.y)+ai.x&&(ui=!ui),ai=ai.next;while(ai!==ii);return ui}(ti,ze)&&(qn(ti.prev,ti,ze.prev)||qn(ti,ze.prev,ze))||Jh(ti,ze)&&qn(ti.prev,ti,ti.next)>0&&qn(ze.prev,ze,ze.next)>0)}function qn(ti,ze,ii){return(ze.y-ti.y)*(ii.x-ze.x)-(ze.x-ti.x)*(ii.y-ze.y)}function Jh(ti,ze){return ti.x===ze.x&&ti.y===ze.y}function Fd(ti,ze,ii,oi){var ai=ep(qn(ti,ze,ii)),ui=ep(qn(ti,ze,oi)),pi=ep(qn(ii,oi,ti)),di=ep(qn(ii,oi,ze));return ai!==ui&&pi!==di||!(ai!==0||!Qh(ti,ii,ze))||!(ui!==0||!Qh(ti,oi,ze))||!(pi!==0||!Qh(ii,ti,oi))||!(di!==0||!Qh(ii,ze,oi))}function Qh(ti,ze,ii){return ze.x<=Math.max(ti.x,ii.x)&&ze.x>=Math.min(ti.x,ii.x)&&ze.y<=Math.max(ti.y,ii.y)&&ze.y>=Math.min(ti.y,ii.y)}function ep(ti){return ti>0?1:ti<0?-1:0}function Yu(ti,ze){return qn(ti.prev,ti,ti.next)<0?qn(ti,ze,ti.next)>=0&&qn(ti,ti.prev,ze)>=0:qn(ti,ze,ti.prev)<0||qn(ti,ti.next,ze)<0}function Bd(ti,ze){var ii=new Vp(ti.i,ti.x,ti.y),oi=new Vp(ze.i,ze.x,ze.y),ai=ti.next,ui=ze.prev;return ti.next=ze,ze.prev=ti,ii.next=ai,ai.prev=ii,oi.next=ii,ii.prev=oi,ui.next=oi,oi.prev=ui,oi}function Nd(ti,ze,ii,oi){var ai=new Vp(ti,ze,ii);return oi?(ai.next=oi.next,ai.prev=oi,oi.next.prev=ai,oi.next=ai):(ai.prev=ai,ai.next=ai),ai}function Xu(ti){ti.next.prev=ti.prev,ti.prev.next=ti.next,ti.prevZ&&(ti.prevZ.nextZ=ti.nextZ),ti.nextZ&&(ti.nextZ.prevZ=ti.prevZ)}function Vp(ti,ze,ii){this.i=ti,this.x=ze,this.y=ii,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jp(ti,ze,ii,oi){for(var ai=0,ui=ze,pi=ii-oi;ui<ii;ui+=oi)ai+=(ti[pi]-ti[ui])*(ti[ui+1]+ti[pi+1]),pi=ui;return ai}Np.exports=Kh,Np.exports.default=Kh,Kh.deviation=function(ti,ze,ii,oi){var ai=ze&&ze.length,ui=Math.abs(jp(ti,0,ai?ze[0]*ii:ti.length,ii));if(ai)for(var pi=0,di=ze.length;pi<di;pi++)ui-=Math.abs(jp(ti,ze[pi]*ii,pi<di-1?ze[pi+1]*ii:ti.length,ii));var yi=0;for(pi=0;pi<oi.length;pi+=3){var xi=oi[pi]*ii,wi=oi[pi+1]*ii,Ii=oi[pi+2]*ii;yi+=Math.abs((ti[xi]-ti[Ii])*(ti[wi+1]-ti[xi+1])-(ti[xi]-ti[wi])*(ti[Ii+1]-ti[xi+1]))}return ui===0&&yi===0?0:Math.abs((yi-ui)/ui)},Kh.flatten=function(ti){for(var ze=ti[0][0].length,ii={vertices:[],holes:[],dimensions:ze},oi=0,ai=0;ai<ti.length;ai++){for(var ui=0;ui<ti[ai].length;ui++)for(var pi=0;pi<ze;pi++)ii.vertices.push(ti[ai][ui][pi]);ai>0&&ii.holes.push(oi+=ti[ai-1].length)}return ii};var Ud=Ki(Np.exports);function Pm(ti,ze,ii,oi,ai){Vd(ti,ze,ii||0,oi||ti.length-1,ai||Cm)}function Vd(ti,ze,ii,oi,ai){for(;oi>ii;){if(oi-ii>600){var ui=oi-ii+1,pi=ze-ii+1,di=Math.log(ui),yi=.5*Math.exp(2*di/3),xi=.5*Math.sqrt(di*yi*(ui-yi)/ui)*(pi-ui/2<0?-1:1);Vd(ti,ze,Math.max(ii,Math.floor(ze-pi*yi/ui+xi)),Math.min(oi,Math.floor(ze+(ui-pi)*yi/ui+xi)),ai)}var wi=ti[ze],Ii=ii,Pi=oi;for(Wu(ti,ii,ze),ai(ti[oi],wi)>0&&Wu(ti,ii,oi);Ii<Pi;){for(Wu(ti,Ii,Pi),Ii++,Pi--;ai(ti[Ii],wi)<0;)Ii++;for(;ai(ti[Pi],wi)>0;)Pi--}ai(ti[ii],wi)===0?Wu(ti,ii,Pi):Wu(ti,++Pi,oi),Pi<=ze&&(ii=Pi+1),ze<=Pi&&(oi=Pi-1)}}function Wu(ti,ze,ii){var oi=ti[ze];ti[ze]=ti[ii],ti[ii]=oi}function Cm(ti,ze){return ti<ze?-1:ti>ze?1:0}function qp(ti,ze){const ii=ti.length;if(ii<=1)return[ti];const oi=[];let ai,ui;for(let pi=0;pi<ii;pi++){const di=Sa(ti[pi]);di!==0&&(ti[pi].area=Math.abs(di),ui===void 0&&(ui=di<0),ui===di<0?(ai&&oi.push(ai),ai=[ti[pi]]):ai.push(ti[pi]))}if(ai&&oi.push(ai),ze>1)for(let pi=0;pi<oi.length;pi++)oi[pi].length<=ze||(Pm(oi[pi],ze,1,oi[pi].length-1,zm),oi[pi]=oi[pi].slice(0,ze));return oi}function zm(ti,ze){return ze.area-ti.area}function Gp(ti,ze,ii){const oi=ii.patternDependencies;let ai=!1;for(const ui of ze){const pi=ui.paint.get(`${ti}-pattern`);pi.isConstant()||(ai=!0);const di=pi.constantOr(null);di&&(ai=!0,oi[di.to]=!0,oi[di.from]=!0)}return ai}function $p(ti,ze,ii,oi,ai){const ui=ai.patternDependencies;for(const pi of ze){const di=pi.paint.get(`${ti}-pattern`).value;if(di.kind!=="constant"){let yi=di.evaluate({zoom:oi-1},ii,{},ai.availableImages),xi=di.evaluate({zoom:oi},ii,{},ai.availableImages),wi=di.evaluate({zoom:oi+1},ii,{},ai.availableImages);yi=yi&&yi.name?yi.name:yi,xi=xi&&xi.name?xi.name:xi,wi=wi&&wi.name?wi.name:wi,ui[yi]=!0,ui[xi]=!0,ui[wi]=!0,ii.patterns[pi.id]={min:yi,mid:xi,max:wi}}}return ii}class Zp{constructor(ze){this.zoom=ze.zoom,this.overscaling=ze.overscaling,this.layers=ze.layers,this.layerIds=this.layers.map(ii=>ii.id),this.index=ze.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ho,this.indexArray=new pa,this.indexArray2=new Wn,this.programConfigurations=new Gs(ze.layers,ze.zoom),this.segments=new xn,this.segments2=new xn,this.stateDependentLayerIds=this.layers.filter(ii=>ii.isStateDependent()).map(ii=>ii.id)}populate(ze,ii,oi){this.hasPattern=Gp("fill",this.layers,ii);const ai=this.layers[0].layout.get("fill-sort-key"),ui=!ai.isConstant(),pi=[];for(const{feature:di,id:yi,index:xi,sourceLayerIndex:wi}of ze){const Ii=this.layers[0]._featureFilter.needGeometry,Pi=hc(di,Ii);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),Pi,oi))continue;const Ri=ui?ai.evaluate(Pi,{},oi,ii.availableImages):void 0,Li={id:yi,properties:di.properties,type:di.type,sourceLayerIndex:wi,index:xi,geometry:Ii?Pi.geometry:uc(di),patterns:{},sortKey:Ri};pi.push(Li)}ui&&pi.sort((di,yi)=>di.sortKey-yi.sortKey);for(const di of pi){const{geometry:yi,index:xi,sourceLayerIndex:wi}=di;if(this.hasPattern){const Ii=$p("fill",this.layers,di,this.zoom,ii);this.patternFeatures.push(Ii)}else this.addFeature(di,yi,xi,oi,{});ii.featureIndex.insert(ze[xi].feature,yi,xi,wi,this.index)}}update(ze,ii,oi){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(ze,ii,this.stateDependentLayers,oi)}addFeatures(ze,ii,oi){for(const ai of this.patternFeatures)this.addFeature(ai,ai.geometry,ai.index,ii,oi)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(ze){this.uploaded||(this.layoutVertexBuffer=ze.createVertexBuffer(this.layoutVertexArray,gm),this.indexBuffer=ze.createIndexBuffer(this.indexArray),this.indexBuffer2=ze.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(ze),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(ze,ii,oi,ai,ui){for(const pi of qp(ii,500)){let di=0;for(const Ri of pi)di+=Ri.length;const yi=this.segments.prepareSegment(di,this.layoutVertexArray,this.indexArray),xi=yi.vertexLength,wi=[],Ii=[];for(const Ri of pi){if(Ri.length===0)continue;Ri!==pi[0]&&Ii.push(wi.length/2);const Li=this.segments2.prepareSegment(Ri.length,this.layoutVertexArray,this.indexArray2),Fi=Li.vertexLength;this.layoutVertexArray.emplaceBack(Ri[0].x,Ri[0].y),this.indexArray2.emplaceBack(Fi+Ri.length-1,Fi),wi.push(Ri[0].x),wi.push(Ri[0].y);for(let qi=1;qi<Ri.length;qi++)this.layoutVertexArray.emplaceBack(Ri[qi].x,Ri[qi].y),this.indexArray2.emplaceBack(Fi+qi-1,Fi+qi),wi.push(Ri[qi].x),wi.push(Ri[qi].y);Li.vertexLength+=Ri.length,Li.primitiveLength+=Ri.length}const Pi=Ud(wi,Ii);for(let Ri=0;Ri<Pi.length;Ri+=3)this.indexArray.emplaceBack(xi+Pi[Ri],xi+Pi[Ri+1],xi+Pi[Ri+2]);yi.vertexLength+=di,yi.primitiveLength+=Pi.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,ze,oi,ui,ai)}}let jd,qd;Eo("FillBucket",Zp,{omit:["layers","patternFeatures"]});var Rm={get paint(){return qd=qd||new Vn({"fill-antialias":new Mo(io.paint_fill["fill-antialias"]),"fill-opacity":new Fo(io.paint_fill["fill-opacity"]),"fill-color":new Fo(io.paint_fill["fill-color"]),"fill-outline-color":new Fo(io.paint_fill["fill-outline-color"]),"fill-translate":new Mo(io.paint_fill["fill-translate"]),"fill-translate-anchor":new Mo(io.paint_fill["fill-translate-anchor"]),"fill-pattern":new sc(io.paint_fill["fill-pattern"])})},get layout(){return jd=jd||new Vn({"fill-sort-key":new Fo(io.layout_fill["fill-sort-key"])})}};class Mm extends hs{constructor(ze){super(ze,Rm)}recalculate(ze,ii){super.recalculate(ze,ii);const oi=this.paint._values["fill-outline-color"];oi.value.kind==="constant"&&oi.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(ze){return new Zp(ze)}queryRadius(){return Yh(this.paint.get("fill-translate"))}queryIntersectsFeature(ze,ii,oi,ai,ui,pi,di){return Ed(Xh(ze,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),pi.angle,di),ai)}isTileClipped(){return!0}}const Lm=An([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Om=An([{name:"a_centroid",components:2,type:"Int16"}],4),{members:km}=Lm;var jl={},Dm=Lo,Gd=Yc;function Yc(ti,ze,ii,oi,ai){this.properties={},this.extent=ii,this.type=0,this._pbf=ti,this._geometry=-1,this._keys=oi,this._values=ai,ti.readFields(Fm,this,ze)}function Fm(ti,ze,ii){ti==1?ze.id=ii.readVarint():ti==2?function(oi,ai){for(var ui=oi.readVarint()+oi.pos;oi.pos<ui;){var pi=ai._keys[oi.readVarint()],di=ai._values[oi.readVarint()];ai.properties[pi]=di}}(ii,ze):ti==3?ze.type=ii.readVarint():ti==4&&(ze._geometry=ii.pos)}function Bm(ti){for(var ze,ii,oi=0,ai=0,ui=ti.length,pi=ui-1;ai<ui;pi=ai++)oi+=((ii=ti[pi]).x-(ze=ti[ai]).x)*(ze.y+ii.y);return oi}Yc.types=["Unknown","Point","LineString","Polygon"],Yc.prototype.loadGeometry=function(){var ti=this._pbf;ti.pos=this._geometry;for(var ze,ii=ti.readVarint()+ti.pos,oi=1,ai=0,ui=0,pi=0,di=[];ti.pos<ii;){if(ai<=0){var yi=ti.readVarint();oi=7&yi,ai=yi>>3}if(ai--,oi===1||oi===2)ui+=ti.readSVarint(),pi+=ti.readSVarint(),oi===1&&(ze&&di.push(ze),ze=[]),ze.push(new Dm(ui,pi));else{if(oi!==7)throw new Error("unknown command "+oi);ze&&ze.push(ze[0].clone())}}return ze&&di.push(ze),di},Yc.prototype.bbox=function(){var ti=this._pbf;ti.pos=this._geometry;for(var ze=ti.readVarint()+ti.pos,ii=1,oi=0,ai=0,ui=0,pi=1/0,di=-1/0,yi=1/0,xi=-1/0;ti.pos<ze;){if(oi<=0){var wi=ti.readVarint();ii=7&wi,oi=wi>>3}if(oi--,ii===1||ii===2)(ai+=ti.readSVarint())<pi&&(pi=ai),ai>di&&(di=ai),(ui+=ti.readSVarint())<yi&&(yi=ui),ui>xi&&(xi=ui);else if(ii!==7)throw new Error("unknown command "+ii)}return[pi,yi,di,xi]},Yc.prototype.toGeoJSON=function(ti,ze,ii){var oi,ai,ui=this.extent*Math.pow(2,ii),pi=this.extent*ti,di=this.extent*ze,yi=this.loadGeometry(),xi=Yc.types[this.type];function wi(Ri){for(var Li=0;Li<Ri.length;Li++){var Fi=Ri[Li];Ri[Li]=[360*(Fi.x+pi)/ui-180,360/Math.PI*Math.atan(Math.exp((180-360*(Fi.y+di)/ui)*Math.PI/180))-90]}}switch(this.type){case 1:var Ii=[];for(oi=0;oi<yi.length;oi++)Ii[oi]=yi[oi][0];wi(yi=Ii);break;case 2:for(oi=0;oi<yi.length;oi++)wi(yi[oi]);break;case 3:for(yi=function(Ri){var Li=Ri.length;if(Li<=1)return[Ri];for(var Fi,qi,Zi=[],Gr=0;Gr<Li;Gr++){var Yi=Bm(Ri[Gr]);Yi!==0&&(qi===void 0&&(qi=Yi<0),qi===Yi<0?(Fi&&Zi.push(Fi),Fi=[Ri[Gr]]):Fi.push(Ri[Gr]))}return Fi&&Zi.push(Fi),Zi}(yi),oi=0;oi<yi.length;oi++)for(ai=0;ai<yi[oi].length;ai++)wi(yi[oi][ai])}yi.length===1?yi=yi[0]:xi="Multi"+xi;var Pi={type:"Feature",geometry:{type:xi,coordinates:yi},properties:this.properties};return"id"in this&&(Pi.id=this.id),Pi};var Nm=Gd,$d=Zd;function Zd(ti,ze){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=ti,this._keys=[],this._values=[],this._features=[],ti.readFields(Um,this,ze),this.length=this._features.length}function Um(ti,ze,ii){ti===15?ze.version=ii.readVarint():ti===1?ze.name=ii.readString():ti===5?ze.extent=ii.readVarint():ti===2?ze._features.push(ii.pos):ti===3?ze._keys.push(ii.readString()):ti===4&&ze._values.push(function(oi){for(var ai=null,ui=oi.readVarint()+oi.pos;oi.pos<ui;){var pi=oi.readVarint()>>3;ai=pi===1?oi.readString():pi===2?oi.readFloat():pi===3?oi.readDouble():pi===4?oi.readVarint64():pi===5?oi.readVarint():pi===6?oi.readSVarint():pi===7?oi.readBoolean():null}return ai}(ii))}Zd.prototype.feature=function(ti){if(ti<0||ti>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[ti];var ze=this._pbf.readVarint()+this._pbf.pos;return new Nm(this._pbf,ze,this.extent,this._keys,this._values)};var Vm=$d;function jm(ti,ze,ii){if(ti===3){var oi=new Vm(ii,ii.readVarint()+ii.pos);oi.length&&(ze[oi.name]=oi)}}jl.VectorTile=function(ti,ze){this.layers=ti.readFields(jm,{},ze)},jl.VectorTileFeature=Gd,jl.VectorTileLayer=$d;const qm=jl.VectorTileFeature.types,Hp=Math.pow(2,13);function Ku(ti,ze,ii,oi,ai,ui,pi,di){ti.emplaceBack(ze,ii,2*Math.floor(oi*Hp)+pi,ai*Hp*2,ui*Hp*2,Math.round(di))}class Yp{constructor(ze){this.zoom=ze.zoom,this.overscaling=ze.overscaling,this.layers=ze.layers,this.layerIds=this.layers.map(ii=>ii.id),this.index=ze.index,this.hasPattern=!1,this.layoutVertexArray=new xo,this.centroidVertexArray=new ho,this.indexArray=new pa,this.programConfigurations=new Gs(ze.layers,ze.zoom),this.segments=new xn,this.stateDependentLayerIds=this.layers.filter(ii=>ii.isStateDependent()).map(ii=>ii.id)}populate(ze,ii,oi){this.features=[],this.hasPattern=Gp("fill-extrusion",this.layers,ii);for(const{feature:ai,id:ui,index:pi,sourceLayerIndex:di}of ze){const yi=this.layers[0]._featureFilter.needGeometry,xi=hc(ai,yi);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),xi,oi))continue;const wi={id:ui,sourceLayerIndex:di,index:pi,geometry:yi?xi.geometry:uc(ai),properties:ai.properties,type:ai.type,patterns:{}};this.hasPattern?this.features.push($p("fill-extrusion",this.layers,wi,this.zoom,ii)):this.addFeature(wi,wi.geometry,pi,oi,{}),ii.featureIndex.insert(ai,wi.geometry,pi,di,this.index,!0)}}addFeatures(ze,ii,oi){for(const ai of this.features){const{geometry:ui}=ai;this.addFeature(ai,ui,ai.index,ii,oi)}}update(ze,ii,oi){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(ze,ii,this.stateDependentLayers,oi)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(ze){this.uploaded||(this.layoutVertexBuffer=ze.createVertexBuffer(this.layoutVertexArray,km),this.centroidVertexBuffer=ze.createVertexBuffer(this.centroidVertexArray,Om.members,!0),this.indexBuffer=ze.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(ze),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(ze,ii,oi,ai,ui){const pi={x:0,y:0,vertexCount:0};for(const di of qp(ii,500)){let yi=0;for(const Li of di)yi+=Li.length;let xi=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Li of di){if(Li.length===0||$m(Li))continue;let Fi=0;for(let qi=0;qi<Li.length;qi++){const Zi=Li[qi];if(qi>=1){const Gr=Li[qi-1];if(!Gm(Zi,Gr)){xi.vertexLength+4>xn.MAX_VERTEX_ARRAY_LENGTH&&(xi=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Yi=Zi.sub(Gr)._perp()._unit(),Yr=Gr.dist(Zi);Fi+Yr>32768&&(Fi=0),Ku(this.layoutVertexArray,Zi.x,Zi.y,Yi.x,Yi.y,0,0,Fi),Ku(this.layoutVertexArray,Zi.x,Zi.y,Yi.x,Yi.y,0,1,Fi),pi.x+=2*Zi.x,pi.y+=2*Zi.y,pi.vertexCount+=2,Fi+=Yr,Ku(this.layoutVertexArray,Gr.x,Gr.y,Yi.x,Yi.y,0,0,Fi),Ku(this.layoutVertexArray,Gr.x,Gr.y,Yi.x,Yi.y,0,1,Fi),pi.x+=2*Gr.x,pi.y+=2*Gr.y,pi.vertexCount+=2;const Jr=xi.vertexLength;this.indexArray.emplaceBack(Jr,Jr+2,Jr+1),this.indexArray.emplaceBack(Jr+1,Jr+2,Jr+3),xi.vertexLength+=4,xi.primitiveLength+=2}}}}if(xi.vertexLength+yi>xn.MAX_VERTEX_ARRAY_LENGTH&&(xi=this.segments.prepareSegment(yi,this.layoutVertexArray,this.indexArray)),qm[ze.type]!=="Polygon")continue;const wi=[],Ii=[],Pi=xi.vertexLength;for(const Li of di)if(Li.length!==0){Li!==di[0]&&Ii.push(wi.length/2);for(let Fi=0;Fi<Li.length;Fi++){const qi=Li[Fi];Ku(this.layoutVertexArray,qi.x,qi.y,0,0,1,1,0),pi.x+=qi.x,pi.y+=qi.y,pi.vertexCount+=1,wi.push(qi.x),wi.push(qi.y)}}const Ri=Ud(wi,Ii);for(let Li=0;Li<Ri.length;Li+=3)this.indexArray.emplaceBack(Pi+Ri[Li],Pi+Ri[Li+2],Pi+Ri[Li+1]);xi.primitiveLength+=Ri.length/3,xi.vertexLength+=yi}for(let di=0;di<pi.vertexCount;di++)this.centroidVertexArray.emplaceBack(Math.floor(pi.x/pi.vertexCount),Math.floor(pi.y/pi.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,ze,oi,ui,ai)}}function Gm(ti,ze){return ti.x===ze.x&&(ti.x<0||ti.x>Hn)||ti.y===ze.y&&(ti.y<0||ti.y>Hn)}function $m(ti){return ti.every(ze=>ze.x<0)||ti.every(ze=>ze.x>Hn)||ti.every(ze=>ze.y<0)||ti.every(ze=>ze.y>Hn)}let Hd;Eo("FillExtrusionBucket",Yp,{omit:["layers","features"]});var Zm={get paint(){return Hd=Hd||new Vn({"fill-extrusion-opacity":new Mo(io["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fo(io["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mo(io["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mo(io["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sc(io["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fo(io["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fo(io["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Mo(io["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Hm extends hs{constructor(ze){super(ze,Zm)}createBucket(ze){return new Yp(ze)}queryRadius(){return Yh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(ze,ii,oi,ai,ui,pi,di,yi){const xi=Xh(ze,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),pi.angle,di),wi=this.paint.get("fill-extrusion-height").evaluate(ii,oi),Ii=this.paint.get("fill-extrusion-base").evaluate(ii,oi),Pi=function(Li,Fi,qi,Zi){const Gr=[];for(const Yi of Li){const Yr=[Yi.x,Yi.y,0,1];Wh(Yr,Yr,Fi),Gr.push(new fo(Yr[0]/Yr[3],Yr[1]/Yr[3]))}return Gr}(xi,yi),Ri=function(Li,Fi,qi,Zi){const Gr=[],Yi=[],Yr=Zi[8]*Fi,Jr=Zi[9]*Fi,ao=Zi[10]*Fi,So=Zi[11]*Fi,Po=Zi[8]*qi,bo=Zi[9]*qi,vo=Zi[10]*qi,mo=Zi[11]*qi;for(const To of Li){const yo=[],uo=[];for(const ko of To){const zo=ko.x,$o=ko.y,vn=Zi[0]*zo+Zi[4]*$o+Zi[12],Sn=Zi[1]*zo+Zi[5]*$o+Zi[13],Qn=Zi[2]*zo+Zi[6]*$o+Zi[14],ds=Zi[3]*zo+Zi[7]*$o+Zi[15],Va=Qn+ao,Yn=ds+So,fa=vn+Po,va=Sn+bo,ja=Qn+vo,qa=ds+mo,ea=new fo((vn+Yr)/Yn,(Sn+Jr)/Yn);ea.z=Va/Yn,yo.push(ea);const ta=new fo(fa/qa,va/qa);ta.z=ja/qa,uo.push(ta)}Gr.push(yo),Yi.push(uo)}return[Gr,Yi]}(ai,Ii,wi,yi);return function(Li,Fi,qi){let Zi=1/0;Ed(qi,Fi)&&(Zi=Yd(qi,Fi[0]));for(let Gr=0;Gr<Fi.length;Gr++){const Yi=Fi[Gr],Yr=Li[Gr];for(let Jr=0;Jr<Yi.length-1;Jr++){const ao=Yi[Jr],So=[ao,Yi[Jr+1],Yr[Jr+1],Yr[Jr],ao];Sd(qi,So)&&(Zi=Math.min(Zi,Yd(qi,So)))}}return Zi!==1/0&&Zi}(Ri[0],Ri[1],Pi)}}function Ju(ti,ze){return ti.x*ze.x+ti.y*ze.y}function Yd(ti,ze){if(ti.length===1){let ii=0;const oi=ze[ii++];let ai;for(;!ai||oi.equals(ai);)if(ai=ze[ii++],!ai)return 1/0;for(;ii<ze.length;ii++){const ui=ze[ii],pi=ti[0],di=ai.sub(oi),yi=ui.sub(oi),xi=pi.sub(oi),wi=Ju(di,di),Ii=Ju(di,yi),Pi=Ju(yi,yi),Ri=Ju(xi,di),Li=Ju(xi,yi),Fi=wi*Pi-Ii*Ii,qi=(Pi*Ri-Ii*Li)/Fi,Zi=(wi*Li-Ii*Ri)/Fi,Gr=oi.z*(1-qi-Zi)+ai.z*qi+ui.z*Zi;if(isFinite(Gr))return Gr}return 1/0}{let ii=1/0;for(const oi of ze)ii=Math.min(ii,oi.z);return ii}}const Ym=An([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Xm}=Ym,Wm=An([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Km}=Wm,Jm=jl.VectorTileFeature.types,Qm=Math.cos(Math.PI/180*37.5),Xd=Math.pow(2,14)/.5;class Xp{constructor(ze){this.zoom=ze.zoom,this.overscaling=ze.overscaling,this.layers=ze.layers,this.layerIds=this.layers.map(ii=>ii.id),this.index=ze.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(ii=>{this.gradients[ii.id]={}}),this.layoutVertexArray=new Bo,this.layoutVertexArray2=new Co,this.indexArray=new pa,this.programConfigurations=new Gs(ze.layers,ze.zoom),this.segments=new xn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(ii=>ii.isStateDependent()).map(ii=>ii.id)}populate(ze,ii,oi){this.hasPattern=Gp("line",this.layers,ii);const ai=this.layers[0].layout.get("line-sort-key"),ui=!ai.isConstant(),pi=[];for(const{feature:di,id:yi,index:xi,sourceLayerIndex:wi}of ze){const Ii=this.layers[0]._featureFilter.needGeometry,Pi=hc(di,Ii);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),Pi,oi))continue;const Ri=ui?ai.evaluate(Pi,{},oi):void 0,Li={id:yi,properties:di.properties,type:di.type,sourceLayerIndex:wi,index:xi,geometry:Ii?Pi.geometry:uc(di),patterns:{},sortKey:Ri};pi.push(Li)}ui&&pi.sort((di,yi)=>di.sortKey-yi.sortKey);for(const di of pi){const{geometry:yi,index:xi,sourceLayerIndex:wi}=di;if(this.hasPattern){const Ii=$p("line",this.layers,di,this.zoom,ii);this.patternFeatures.push(Ii)}else this.addFeature(di,yi,xi,oi,{});ii.featureIndex.insert(ze[xi].feature,yi,xi,wi,this.index)}}update(ze,ii,oi){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(ze,ii,this.stateDependentLayers,oi)}addFeatures(ze,ii,oi){for(const ai of this.patternFeatures)this.addFeature(ai,ai.geometry,ai.index,ii,oi)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(ze){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=ze.createVertexBuffer(this.layoutVertexArray2,Km)),this.layoutVertexBuffer=ze.createVertexBuffer(this.layoutVertexArray,Xm),this.indexBuffer=ze.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(ze),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(ze){if(ze.properties&&Object.prototype.hasOwnProperty.call(ze.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(ze.properties,"mapbox_clip_end"))return{start:+ze.properties.mapbox_clip_start,end:+ze.properties.mapbox_clip_end}}addFeature(ze,ii,oi,ai,ui){const pi=this.layers[0].layout,di=pi.get("line-join").evaluate(ze,{}),yi=pi.get("line-cap"),xi=pi.get("line-miter-limit"),wi=pi.get("line-round-limit");this.lineClips=this.lineFeatureClips(ze);for(const Ii of ii)this.addLine(Ii,ze,di,yi,xi,wi);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,ze,oi,ui,ai)}addLine(ze,ii,oi,ai,ui,pi){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Zi=0;Zi<ze.length-1;Zi++)this.totalDistance+=ze[Zi].dist(ze[Zi+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const di=Jm[ii.type]==="Polygon";let yi=ze.length;for(;yi>=2&&ze[yi-1].equals(ze[yi-2]);)yi--;let xi=0;for(;xi<yi-1&&ze[xi].equals(ze[xi+1]);)xi++;if(yi<(di?3:2))return;oi==="bevel"&&(ui=1.05);const wi=this.overscaling<=16?15*Hn/(512*this.overscaling):0,Ii=this.segments.prepareSegment(10*yi,this.layoutVertexArray,this.indexArray);let Pi,Ri,Li,Fi,qi;this.e1=this.e2=-1,di&&(Pi=ze[yi-2],qi=ze[xi].sub(Pi)._unit()._perp());for(let Zi=xi;Zi<yi;Zi++){if(Li=Zi===yi-1?di?ze[xi+1]:void 0:ze[Zi+1],Li&&ze[Zi].equals(Li))continue;qi&&(Fi=qi),Pi&&(Ri=Pi),Pi=ze[Zi],qi=Li?Li.sub(Pi)._unit()._perp():Fi,Fi=Fi||qi;let Gr=Fi.add(qi);Gr.x===0&&Gr.y===0||Gr._unit();const Yi=Fi.x*qi.x+Fi.y*qi.y,Yr=Gr.x*qi.x+Gr.y*qi.y,Jr=Yr!==0?1/Yr:1/0,ao=2*Math.sqrt(2-2*Yr),So=Yr<Qm&&Ri&&Li,Po=Fi.x*qi.y-Fi.y*qi.x>0;if(So&&Zi>xi){const mo=Pi.dist(Ri);if(mo>2*wi){const To=Pi.sub(Pi.sub(Ri)._mult(wi/mo)._round());this.updateDistance(Ri,To),this.addCurrentVertex(To,Fi,0,0,Ii),Ri=To}}const bo=Ri&&Li;let vo=bo?oi:di?"butt":ai;if(bo&&vo==="round"&&(Jr<pi?vo="miter":Jr<=2&&(vo="fakeround")),vo==="miter"&&Jr>ui&&(vo="bevel"),vo==="bevel"&&(Jr>2&&(vo="flipbevel"),Jr<ui&&(vo="miter")),Ri&&this.updateDistance(Ri,Pi),vo==="miter")Gr._mult(Jr),this.addCurrentVertex(Pi,Gr,0,0,Ii);else if(vo==="flipbevel"){if(Jr>100)Gr=qi.mult(-1);else{const mo=Jr*Fi.add(qi).mag()/Fi.sub(qi).mag();Gr._perp()._mult(mo*(Po?-1:1))}this.addCurrentVertex(Pi,Gr,0,0,Ii),this.addCurrentVertex(Pi,Gr.mult(-1),0,0,Ii)}else if(vo==="bevel"||vo==="fakeround"){const mo=-Math.sqrt(Jr*Jr-1),To=Po?mo:0,yo=Po?0:mo;if(Ri&&this.addCurrentVertex(Pi,Fi,To,yo,Ii),vo==="fakeround"){const uo=Math.round(180*ao/Math.PI/20);for(let ko=1;ko<uo;ko++){let zo=ko/uo;if(zo!==.5){const vn=zo-.5;zo+=zo*vn*(zo-1)*((1.0904+Yi*(Yi*(3.55645-1.43519*Yi)-3.2452))*vn*vn+(.848013+Yi*(.215638*Yi-1.06021)))}const $o=qi.sub(Fi)._mult(zo)._add(Fi)._unit()._mult(Po?-1:1);this.addHalfVertex(Pi,$o.x,$o.y,!1,Po,0,Ii)}}Li&&this.addCurrentVertex(Pi,qi,-To,-yo,Ii)}else if(vo==="butt")this.addCurrentVertex(Pi,Gr,0,0,Ii);else if(vo==="square"){const mo=Ri?1:-1;this.addCurrentVertex(Pi,Gr,mo,mo,Ii)}else vo==="round"&&(Ri&&(this.addCurrentVertex(Pi,Fi,0,0,Ii),this.addCurrentVertex(Pi,Fi,1,1,Ii,!0)),Li&&(this.addCurrentVertex(Pi,qi,-1,-1,Ii,!0),this.addCurrentVertex(Pi,qi,0,0,Ii)));if(So&&Zi<yi-1){const mo=Pi.dist(Li);if(mo>2*wi){const To=Pi.add(Li.sub(Pi)._mult(wi/mo)._round());this.updateDistance(Pi,To),this.addCurrentVertex(To,qi,0,0,Ii),Pi=To}}}}addCurrentVertex(ze,ii,oi,ai,ui,pi=!1){const di=ii.y*ai-ii.x,yi=-ii.y-ii.x*ai;this.addHalfVertex(ze,ii.x+ii.y*oi,ii.y-ii.x*oi,pi,!1,oi,ui),this.addHalfVertex(ze,di,yi,pi,!0,-ai,ui),this.distance>Xd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(ze,ii,oi,ai,ui,pi))}addHalfVertex({x:ze,y:ii},oi,ai,ui,pi,di,yi){const xi=.5*(this.lineClips?this.scaledDistance*(Xd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((ze<<1)+(ui?1:0),(ii<<1)+(pi?1:0),Math.round(63*oi)+128,Math.round(63*ai)+128,1+(di===0?0:di<0?-1:1)|(63&xi)<<2,xi>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const wi=yi.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,wi),yi.primitiveLength++),pi?this.e2=wi:this.e1=wi}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(ze,ii){this.distance+=ze.dist(ii),this.updateScaledDistance()}}let Wd,Kd;Eo("LineBucket",Xp,{omit:["layers","patternFeatures"]});var Jd={get paint(){return Kd=Kd||new Vn({"line-opacity":new Fo(io.paint_line["line-opacity"]),"line-color":new Fo(io.paint_line["line-color"]),"line-translate":new Mo(io.paint_line["line-translate"]),"line-translate-anchor":new Mo(io.paint_line["line-translate-anchor"]),"line-width":new Fo(io.paint_line["line-width"]),"line-gap-width":new Fo(io.paint_line["line-gap-width"]),"line-offset":new Fo(io.paint_line["line-offset"]),"line-blur":new Fo(io.paint_line["line-blur"]),"line-dasharray":new ku(io.paint_line["line-dasharray"]),"line-pattern":new sc(io.paint_line["line-pattern"]),"line-gradient":new Du(io.paint_line["line-gradient"])})},get layout(){return Wd=Wd||new Vn({"line-cap":new Mo(io.layout_line["line-cap"]),"line-join":new Fo(io.layout_line["line-join"]),"line-miter-limit":new Mo(io.layout_line["line-miter-limit"]),"line-round-limit":new Mo(io.layout_line["line-round-limit"]),"line-sort-key":new Fo(io.layout_line["line-sort-key"])})}};class e_ extends Fo{possiblyEvaluate(ze,ii){return ii=new gn(Math.floor(ii.zoom),{now:ii.now,fadeDuration:ii.fadeDuration,zoomHistory:ii.zoomHistory,transition:ii.transition}),super.possiblyEvaluate(ze,ii)}evaluate(ze,ii,oi,ai){return ii=ln({},ii,{zoom:Math.floor(ii.zoom)}),super.evaluate(ze,ii,oi,ai)}}let tp;class t_ extends hs{constructor(ze){super(ze,Jd),this.gradientVersion=0,tp||(tp=new e_(Jd.paint.properties["line-width"].specification),tp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(ze){if(ze==="line-gradient"){const ii=this.gradientExpression();this.stepInterpolant=!!function(oi){return oi._styleExpression!==void 0}(ii)&&ii._styleExpression.expression instanceof Qs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(ze,ii){super.recalculate(ze,ii),this.paint._values["line-floorwidth"]=tp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,ze)}createBucket(ze){return new Xp(ze)}queryRadius(ze){const ii=ze,oi=Qd(Gu("line-width",this,ii),Gu("line-gap-width",this,ii)),ai=Gu("line-offset",this,ii);return oi/2+Math.abs(ai)+Yh(this.paint.get("line-translate"))}queryIntersectsFeature(ze,ii,oi,ai,ui,pi,di){const yi=Xh(ze,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),pi.angle,di),xi=di/2*Qd(this.paint.get("line-width").evaluate(ii,oi),this.paint.get("line-gap-width").evaluate(ii,oi)),wi=this.paint.get("line-offset").evaluate(ii,oi);return wi&&(ai=function(Ii,Pi){const Ri=[];for(let Li=0;Li<Ii.length;Li++){const Fi=Ii[Li],qi=[];for(let Zi=0;Zi<Fi.length;Zi++){const Gr=Fi[Zi-1],Yi=Fi[Zi],Yr=Fi[Zi+1],Jr=Zi===0?new fo(0,0):Yi.sub(Gr)._unit()._perp(),ao=Zi===Fi.length-1?new fo(0,0):Yr.sub(Yi)._unit()._perp(),So=Jr._add(ao)._unit(),Po=So.x*ao.x+So.y*ao.y;Po!==0&&So._mult(1/Po),qi.push(So._mult(Pi)._add(Yi))}Ri.push(qi)}return Ri}(ai,wi*di)),function(Ii,Pi,Ri){for(let Li=0;Li<Pi.length;Li++){const Fi=Pi[Li];if(Ii.length>=3){for(let qi=0;qi<Fi.length;qi++)if($c(Ii,Fi[qi]))return!0}if(sm(Ii,Fi,Ri))return!0}return!1}(yi,ai,xi)}isTileClipped(){return!0}}function Qd(ti,ze){return ze>0?ze+2*ti:ti}const i_=An([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),r_=An([{name:"a_projected_pos",components:3,type:"Float32"}],4);An([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const o_=An([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);An([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ef=An([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),n_=An([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function a_(ti,ze,ii){return ti.sections.forEach(oi=>{oi.text=function(ai,ui,pi){const di=ui.layout.get("text-transform").evaluate(pi,{});return di==="uppercase"?ai=ai.toLocaleUpperCase():di==="lowercase"&&(ai=ai.toLocaleLowerCase()),Ka.applyArabicShaping&&(ai=Ka.applyArabicShaping(ai)),ai}(oi.text,ze,ii)}),ti}An([{name:"triangle",components:3,type:"Uint16"}]),An([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),An([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),An([{type:"Float32",name:"offsetX"}]),An([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),An([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Jn=24,tf=dn,rf=function(ti,ze,ii,oi,ai){var ui,pi,di=8*ai-oi-1,yi=(1<<di)-1,xi=yi>>1,wi=-7,Ii=ii?ai-1:0,Pi=ii?-1:1,Ri=ti[ze+Ii];for(Ii+=Pi,ui=Ri&(1<<-wi)-1,Ri>>=-wi,wi+=di;wi>0;ui=256*ui+ti[ze+Ii],Ii+=Pi,wi-=8);for(pi=ui&(1<<-wi)-1,ui>>=-wi,wi+=oi;wi>0;pi=256*pi+ti[ze+Ii],Ii+=Pi,wi-=8);if(ui===0)ui=1-xi;else{if(ui===yi)return pi?NaN:1/0*(Ri?-1:1);pi+=Math.pow(2,oi),ui-=xi}return(Ri?-1:1)*pi*Math.pow(2,ui-oi)},of=function(ti,ze,ii,oi,ai,ui){var pi,di,yi,xi=8*ui-ai-1,wi=(1<<xi)-1,Ii=wi>>1,Pi=ai===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ri=oi?0:ui-1,Li=oi?1:-1,Fi=ze<0||ze===0&&1/ze<0?1:0;for(ze=Math.abs(ze),isNaN(ze)||ze===1/0?(di=isNaN(ze)?1:0,pi=wi):(pi=Math.floor(Math.log(ze)/Math.LN2),ze*(yi=Math.pow(2,-pi))<1&&(pi--,yi*=2),(ze+=pi+Ii>=1?Pi/yi:Pi*Math.pow(2,1-Ii))*yi>=2&&(pi++,yi/=2),pi+Ii>=wi?(di=0,pi=wi):pi+Ii>=1?(di=(ze*yi-1)*Math.pow(2,ai),pi+=Ii):(di=ze*Math.pow(2,Ii-1)*Math.pow(2,ai),pi=0));ai>=8;ti[ii+Ri]=255&di,Ri+=Li,di/=256,ai-=8);for(pi=pi<<ai|di,xi+=ai;xi>0;ti[ii+Ri]=255&pi,Ri+=Li,pi/=256,xi-=8);ti[ii+Ri-Li]|=128*Fi};function dn(ti){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ti)?ti:new Uint8Array(ti||0),this.pos=0,this.type=0,this.length=this.buf.length}dn.Varint=0,dn.Fixed64=1,dn.Bytes=2,dn.Fixed32=5;var Wp=4294967296,nf=1/Wp,af=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function wl(ti){return ti.type===dn.Bytes?ti.readVarint()+ti.pos:ti.pos+1}function Xc(ti,ze,ii){return ii?4294967296*ze+(ti>>>0):4294967296*(ze>>>0)+(ti>>>0)}function sf(ti,ze,ii){var oi=ze<=16383?1:ze<=2097151?2:ze<=268435455?3:Math.floor(Math.log(ze)/(7*Math.LN2));ii.realloc(oi);for(var ai=ii.pos-1;ai>=ti;ai--)ii.buf[ai+oi]=ii.buf[ai]}function s_(ti,ze){for(var ii=0;ii<ti.length;ii++)ze.writeVarint(ti[ii])}function l_(ti,ze){for(var ii=0;ii<ti.length;ii++)ze.writeSVarint(ti[ii])}function c_(ti,ze){for(var ii=0;ii<ti.length;ii++)ze.writeFloat(ti[ii])}function u_(ti,ze){for(var ii=0;ii<ti.length;ii++)ze.writeDouble(ti[ii])}function h_(ti,ze){for(var ii=0;ii<ti.length;ii++)ze.writeBoolean(ti[ii])}function p_(ti,ze){for(var ii=0;ii<ti.length;ii++)ze.writeFixed32(ti[ii])}function d_(ti,ze){for(var ii=0;ii<ti.length;ii++)ze.writeSFixed32(ti[ii])}function f_(ti,ze){for(var ii=0;ii<ti.length;ii++)ze.writeFixed64(ti[ii])}function m_(ti,ze){for(var ii=0;ii<ti.length;ii++)ze.writeSFixed64(ti[ii])}function ip(ti,ze){return(ti[ze]|ti[ze+1]<<8|ti[ze+2]<<16)+16777216*ti[ze+3]}function Wc(ti,ze,ii){ti[ii]=ze,ti[ii+1]=ze>>>8,ti[ii+2]=ze>>>16,ti[ii+3]=ze>>>24}function lf(ti,ze){return(ti[ze]|ti[ze+1]<<8|ti[ze+2]<<16)+(ti[ze+3]<<24)}dn.prototype={destroy:function(){this.buf=null},readFields:function(ti,ze,ii){for(ii=ii||this.length;this.pos<ii;){var oi=this.readVarint(),ai=oi>>3,ui=this.pos;this.type=7&oi,ti(ai,ze,this),this.pos===ui&&this.skip(oi)}return ze},readMessage:function(ti,ze){return this.readFields(ti,ze,this.readVarint()+this.pos)},readFixed32:function(){var ti=ip(this.buf,this.pos);return this.pos+=4,ti},readSFixed32:function(){var ti=lf(this.buf,this.pos);return this.pos+=4,ti},readFixed64:function(){var ti=ip(this.buf,this.pos)+ip(this.buf,this.pos+4)*Wp;return this.pos+=8,ti},readSFixed64:function(){var ti=ip(this.buf,this.pos)+lf(this.buf,this.pos+4)*Wp;return this.pos+=8,ti},readFloat:function(){var ti=rf(this.buf,this.pos,!0,23,4);return this.pos+=4,ti},readDouble:function(){var ti=rf(this.buf,this.pos,!0,52,8);return this.pos+=8,ti},readVarint:function(ti){var ze,ii,oi=this.buf;return ze=127&(ii=oi[this.pos++]),ii<128?ze:(ze|=(127&(ii=oi[this.pos++]))<<7,ii<128?ze:(ze|=(127&(ii=oi[this.pos++]))<<14,ii<128?ze:(ze|=(127&(ii=oi[this.pos++]))<<21,ii<128?ze:function(ai,ui,pi){var di,yi,xi=pi.buf;if(di=(112&(yi=xi[pi.pos++]))>>4,yi<128||(di|=(127&(yi=xi[pi.pos++]))<<3,yi<128)||(di|=(127&(yi=xi[pi.pos++]))<<10,yi<128)||(di|=(127&(yi=xi[pi.pos++]))<<17,yi<128)||(di|=(127&(yi=xi[pi.pos++]))<<24,yi<128)||(di|=(1&(yi=xi[pi.pos++]))<<31,yi<128))return Xc(ai,di,ui);throw new Error("Expected varint not more than 10 bytes")}(ze|=(15&(ii=oi[this.pos]))<<28,ti,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ti=this.readVarint();return ti%2==1?(ti+1)/-2:ti/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ti=this.readVarint()+this.pos,ze=this.pos;return this.pos=ti,ti-ze>=12&&af?function(ii,oi,ai){return af.decode(ii.subarray(oi,ai))}(this.buf,ze,ti):function(ii,oi,ai){for(var ui="",pi=oi;pi<ai;){var di,yi,xi,wi=ii[pi],Ii=null,Pi=wi>239?4:wi>223?3:wi>191?2:1;if(pi+Pi>ai)break;Pi===1?wi<128&&(Ii=wi):Pi===2?(192&(di=ii[pi+1]))==128&&(Ii=(31&wi)<<6|63&di)<=127&&(Ii=null):Pi===3?(yi=ii[pi+2],(192&(di=ii[pi+1]))==128&&(192&yi)==128&&((Ii=(15&wi)<<12|(63&di)<<6|63&yi)<=2047||Ii>=55296&&Ii<=57343)&&(Ii=null)):Pi===4&&(yi=ii[pi+2],xi=ii[pi+3],(192&(di=ii[pi+1]))==128&&(192&yi)==128&&(192&xi)==128&&((Ii=(15&wi)<<18|(63&di)<<12|(63&yi)<<6|63&xi)<=65535||Ii>=1114112)&&(Ii=null)),Ii===null?(Ii=65533,Pi=1):Ii>65535&&(Ii-=65536,ui+=String.fromCharCode(Ii>>>10&1023|55296),Ii=56320|1023&Ii),ui+=String.fromCharCode(Ii),pi+=Pi}return ui}(this.buf,ze,ti)},readBytes:function(){var ti=this.readVarint()+this.pos,ze=this.buf.subarray(this.pos,ti);return this.pos=ti,ze},readPackedVarint:function(ti,ze){if(this.type!==dn.Bytes)return ti.push(this.readVarint(ze));var ii=wl(this);for(ti=ti||[];this.pos<ii;)ti.push(this.readVarint(ze));return ti},readPackedSVarint:function(ti){if(this.type!==dn.Bytes)return ti.push(this.readSVarint());var ze=wl(this);for(ti=ti||[];this.pos<ze;)ti.push(this.readSVarint());return ti},readPackedBoolean:function(ti){if(this.type!==dn.Bytes)return ti.push(this.readBoolean());var ze=wl(this);for(ti=ti||[];this.pos<ze;)ti.push(this.readBoolean());return ti},readPackedFloat:function(ti){if(this.type!==dn.Bytes)return ti.push(this.readFloat());var ze=wl(this);for(ti=ti||[];this.pos<ze;)ti.push(this.readFloat());return ti},readPackedDouble:function(ti){if(this.type!==dn.Bytes)return ti.push(this.readDouble());var ze=wl(this);for(ti=ti||[];this.pos<ze;)ti.push(this.readDouble());return ti},readPackedFixed32:function(ti){if(this.type!==dn.Bytes)return ti.push(this.readFixed32());var ze=wl(this);for(ti=ti||[];this.pos<ze;)ti.push(this.readFixed32());return ti},readPackedSFixed32:function(ti){if(this.type!==dn.Bytes)return ti.push(this.readSFixed32());var ze=wl(this);for(ti=ti||[];this.pos<ze;)ti.push(this.readSFixed32());return ti},readPackedFixed64:function(ti){if(this.type!==dn.Bytes)return ti.push(this.readFixed64());var ze=wl(this);for(ti=ti||[];this.pos<ze;)ti.push(this.readFixed64());return ti},readPackedSFixed64:function(ti){if(this.type!==dn.Bytes)return ti.push(this.readSFixed64());var ze=wl(this);for(ti=ti||[];this.pos<ze;)ti.push(this.readSFixed64());return ti},skip:function(ti){var ze=7&ti;if(ze===dn.Varint)for(;this.buf[this.pos++]>127;);else if(ze===dn.Bytes)this.pos=this.readVarint()+this.pos;else if(ze===dn.Fixed32)this.pos+=4;else{if(ze!==dn.Fixed64)throw new Error("Unimplemented type: "+ze);this.pos+=8}},writeTag:function(ti,ze){this.writeVarint(ti<<3|ze)},realloc:function(ti){for(var ze=this.length||16;ze<this.pos+ti;)ze*=2;if(ze!==this.length){var ii=new Uint8Array(ze);ii.set(this.buf),this.buf=ii,this.length=ze}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ti){this.realloc(4),Wc(this.buf,ti,this.pos),this.pos+=4},writeSFixed32:function(ti){this.realloc(4),Wc(this.buf,ti,this.pos),this.pos+=4},writeFixed64:function(ti){this.realloc(8),Wc(this.buf,-1&ti,this.pos),Wc(this.buf,Math.floor(ti*nf),this.pos+4),this.pos+=8},writeSFixed64:function(ti){this.realloc(8),Wc(this.buf,-1&ti,this.pos),Wc(this.buf,Math.floor(ti*nf),this.pos+4),this.pos+=8},writeVarint:function(ti){(ti=+ti||0)>268435455||ti<0?function(ze,ii){var oi,ai;if(ze>=0?(oi=ze%4294967296|0,ai=ze/4294967296|0):(ai=~(-ze/4294967296),4294967295^(oi=~(-ze%4294967296))?oi=oi+1|0:(oi=0,ai=ai+1|0)),ze>=18446744073709552e3||ze<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ii.realloc(10),function(ui,pi,di){di.buf[di.pos++]=127&ui|128,ui>>>=7,di.buf[di.pos++]=127&ui|128,ui>>>=7,di.buf[di.pos++]=127&ui|128,ui>>>=7,di.buf[di.pos++]=127&ui|128,di.buf[di.pos]=127&(ui>>>=7)}(oi,0,ii),function(ui,pi){var di=(7&ui)<<4;pi.buf[pi.pos++]|=di|((ui>>>=3)?128:0),ui&&(pi.buf[pi.pos++]=127&ui|((ui>>>=7)?128:0),ui&&(pi.buf[pi.pos++]=127&ui|((ui>>>=7)?128:0),ui&&(pi.buf[pi.pos++]=127&ui|((ui>>>=7)?128:0),ui&&(pi.buf[pi.pos++]=127&ui|((ui>>>=7)?128:0),ui&&(pi.buf[pi.pos++]=127&ui)))))}(ai,ii)}(ti,this):(this.realloc(4),this.buf[this.pos++]=127&ti|(ti>127?128:0),ti<=127||(this.buf[this.pos++]=127&(ti>>>=7)|(ti>127?128:0),ti<=127||(this.buf[this.pos++]=127&(ti>>>=7)|(ti>127?128:0),ti<=127||(this.buf[this.pos++]=ti>>>7&127))))},writeSVarint:function(ti){this.writeVarint(ti<0?2*-ti-1:2*ti)},writeBoolean:function(ti){this.writeVarint(!!ti)},writeString:function(ti){ti=String(ti),this.realloc(4*ti.length),this.pos++;var ze=this.pos;this.pos=function(oi,ai,ui){for(var pi,di,yi=0;yi<ai.length;yi++){if((pi=ai.charCodeAt(yi))>55295&&pi<57344){if(!di){pi>56319||yi+1===ai.length?(oi[ui++]=239,oi[ui++]=191,oi[ui++]=189):di=pi;continue}if(pi<56320){oi[ui++]=239,oi[ui++]=191,oi[ui++]=189,di=pi;continue}pi=di-55296<<10|pi-56320|65536,di=null}else di&&(oi[ui++]=239,oi[ui++]=191,oi[ui++]=189,di=null);pi<128?oi[ui++]=pi:(pi<2048?oi[ui++]=pi>>6|192:(pi<65536?oi[ui++]=pi>>12|224:(oi[ui++]=pi>>18|240,oi[ui++]=pi>>12&63|128),oi[ui++]=pi>>6&63|128),oi[ui++]=63&pi|128)}return ui}(this.buf,ti,this.pos);var ii=this.pos-ze;ii>=128&&sf(ze,ii,this),this.pos=ze-1,this.writeVarint(ii),this.pos+=ii},writeFloat:function(ti){this.realloc(4),of(this.buf,ti,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ti){this.realloc(8),of(this.buf,ti,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ti){var ze=ti.length;this.writeVarint(ze),this.realloc(ze);for(var ii=0;ii<ze;ii++)this.buf[this.pos++]=ti[ii]},writeRawMessage:function(ti,ze){this.pos++;var ii=this.pos;ti(ze,this);var oi=this.pos-ii;oi>=128&&sf(ii,oi,this),this.pos=ii-1,this.writeVarint(oi),this.pos+=oi},writeMessage:function(ti,ze,ii){this.writeTag(ti,dn.Bytes),this.writeRawMessage(ze,ii)},writePackedVarint:function(ti,ze){ze.length&&this.writeMessage(ti,s_,ze)},writePackedSVarint:function(ti,ze){ze.length&&this.writeMessage(ti,l_,ze)},writePackedBoolean:function(ti,ze){ze.length&&this.writeMessage(ti,h_,ze)},writePackedFloat:function(ti,ze){ze.length&&this.writeMessage(ti,c_,ze)},writePackedDouble:function(ti,ze){ze.length&&this.writeMessage(ti,u_,ze)},writePackedFixed32:function(ti,ze){ze.length&&this.writeMessage(ti,p_,ze)},writePackedSFixed32:function(ti,ze){ze.length&&this.writeMessage(ti,d_,ze)},writePackedFixed64:function(ti,ze){ze.length&&this.writeMessage(ti,f_,ze)},writePackedSFixed64:function(ti,ze){ze.length&&this.writeMessage(ti,m_,ze)},writeBytesField:function(ti,ze){this.writeTag(ti,dn.Bytes),this.writeBytes(ze)},writeFixed32Field:function(ti,ze){this.writeTag(ti,dn.Fixed32),this.writeFixed32(ze)},writeSFixed32Field:function(ti,ze){this.writeTag(ti,dn.Fixed32),this.writeSFixed32(ze)},writeFixed64Field:function(ti,ze){this.writeTag(ti,dn.Fixed64),this.writeFixed64(ze)},writeSFixed64Field:function(ti,ze){this.writeTag(ti,dn.Fixed64),this.writeSFixed64(ze)},writeVarintField:function(ti,ze){this.writeTag(ti,dn.Varint),this.writeVarint(ze)},writeSVarintField:function(ti,ze){this.writeTag(ti,dn.Varint),this.writeSVarint(ze)},writeStringField:function(ti,ze){this.writeTag(ti,dn.Bytes),this.writeString(ze)},writeFloatField:function(ti,ze){this.writeTag(ti,dn.Fixed32),this.writeFloat(ze)},writeDoubleField:function(ti,ze){this.writeTag(ti,dn.Fixed64),this.writeDouble(ze)},writeBooleanField:function(ti,ze){this.writeVarintField(ti,!!ze)}};var Kp=Ki(tf);const Jp=3;function __(ti,ze,ii){ti===1&&ii.readMessage(y_,ze)}function y_(ti,ze,ii){if(ti===3){const{id:oi,bitmap:ai,width:ui,height:pi,left:di,top:yi,advance:xi}=ii.readMessage(g_,{});ze.push({id:oi,bitmap:new Zu({width:ui+2*Jp,height:pi+2*Jp},ai),metrics:{width:ui,height:pi,left:di,top:yi,advance:xi}})}}function g_(ti,ze,ii){ti===1?ze.id=ii.readVarint():ti===2?ze.bitmap=ii.readBytes():ti===3?ze.width=ii.readVarint():ti===4?ze.height=ii.readVarint():ti===5?ze.left=ii.readSVarint():ti===6?ze.top=ii.readSVarint():ti===7&&(ze.advance=ii.readVarint())}const cf=Jp;function uf(ti){let ze=0,ii=0;for(const pi of ti)ze+=pi.w*pi.h,ii=Math.max(ii,pi.w);ti.sort((pi,di)=>di.h-pi.h);const oi=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(ze/.95)),ii),h:1/0}];let ai=0,ui=0;for(const pi of ti)for(let di=oi.length-1;di>=0;di--){const yi=oi[di];if(!(pi.w>yi.w||pi.h>yi.h)){if(pi.x=yi.x,pi.y=yi.y,ui=Math.max(ui,pi.y+pi.h),ai=Math.max(ai,pi.x+pi.w),pi.w===yi.w&&pi.h===yi.h){const xi=oi.pop();di<oi.length&&(oi[di]=xi)}else pi.h===yi.h?(yi.x+=pi.w,yi.w-=pi.w):pi.w===yi.w?(yi.y+=pi.h,yi.h-=pi.h):(oi.push({x:yi.x+pi.w,y:yi.y,w:yi.w-pi.w,h:pi.h}),yi.y+=pi.h,yi.h-=pi.h);break}}return{w:ai,h:ui,fill:ze/(ai*ui)||0}}const Qa=1;class Qp{constructor(ze,{pixelRatio:ii,version:oi,stretchX:ai,stretchY:ui,content:pi}){this.paddedRect=ze,this.pixelRatio=ii,this.stretchX=ai,this.stretchY=ui,this.content=pi,this.version=oi}get tl(){return[this.paddedRect.x+Qa,this.paddedRect.y+Qa]}get br(){return[this.paddedRect.x+this.paddedRect.w-Qa,this.paddedRect.y+this.paddedRect.h-Qa]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Qa)/this.pixelRatio,(this.paddedRect.h-2*Qa)/this.pixelRatio]}}class hf{constructor(ze,ii){const oi={},ai={};this.haveRenderCallbacks=[];const ui=[];this.addImages(ze,oi,ui),this.addImages(ii,ai,ui);const{w:pi,h:di}=uf(ui),yi=new _s({width:pi||1,height:di||1});for(const xi in ze){const wi=ze[xi],Ii=oi[xi].paddedRect;_s.copy(wi.data,yi,{x:0,y:0},{x:Ii.x+Qa,y:Ii.y+Qa},wi.data)}for(const xi in ii){const wi=ii[xi],Ii=ai[xi].paddedRect,Pi=Ii.x+Qa,Ri=Ii.y+Qa,Li=wi.data.width,Fi=wi.data.height;_s.copy(wi.data,yi,{x:0,y:0},{x:Pi,y:Ri},wi.data),_s.copy(wi.data,yi,{x:0,y:Fi-1},{x:Pi,y:Ri-1},{width:Li,height:1}),_s.copy(wi.data,yi,{x:0,y:0},{x:Pi,y:Ri+Fi},{width:Li,height:1}),_s.copy(wi.data,yi,{x:Li-1,y:0},{x:Pi-1,y:Ri},{width:1,height:Fi}),_s.copy(wi.data,yi,{x:0,y:0},{x:Pi+Li,y:Ri},{width:1,height:Fi})}this.image=yi,this.iconPositions=oi,this.patternPositions=ai}addImages(ze,ii,oi){for(const ai in ze){const ui=ze[ai],pi={x:0,y:0,w:ui.data.width+2*Qa,h:ui.data.height+2*Qa};oi.push(pi),ii[ai]=new Qp(pi,ui),ui.hasRenderCallback&&this.haveRenderCallbacks.push(ai)}}patchUpdatedImages(ze,ii){ze.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const oi in ze.updatedImages)this.patchUpdatedImage(this.iconPositions[oi],ze.getImage(oi),ii),this.patchUpdatedImage(this.patternPositions[oi],ze.getImage(oi),ii)}patchUpdatedImage(ze,ii,oi){if(!ze||!ii||ze.version===ii.version)return;ze.version=ii.version;const[ai,ui]=ze.tl;oi.update(ii.data,void 0,{x:ai,y:ui})}}var ql;Eo("ImagePosition",Qp),Eo("ImageAtlas",hf),li.ai=void 0,(ql=li.ai||(li.ai={}))[ql.none=0]="none",ql[ql.horizontal=1]="horizontal",ql[ql.vertical=2]="vertical",ql[ql.horizontalOnly=3]="horizontalOnly";const eh=-17;class th{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(ze,ii){const oi=new th;return oi.scale=ze||1,oi.fontStack=ii,oi}static forImage(ze){const ii=new th;return ii.imageName=ze,ii}}class Kc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(ze,ii){const oi=new Kc;for(let ai=0;ai<ze.sections.length;ai++){const ui=ze.sections[ai];ui.image?oi.addImageSection(ui):oi.addTextSection(ui,ii)}return oi}length(){return this.text.length}getSection(ze){return this.sections[this.sectionIndex[ze]]}getSectionIndex(ze){return this.sectionIndex[ze]}getCharCode(ze){return this.text.charCodeAt(ze)}verticalizePunctuation(){this.text=function(ze){let ii="";for(let oi=0;oi<ze.length;oi++){const ai=ze.charCodeAt(oi+1)||null,ui=ze.charCodeAt(oi-1)||null;ii+=ai&&Fh(ai)&&!Qu[ze[oi+1]]||ui&&Fh(ui)&&!Qu[ze[oi-1]]||!Qu[ze[oi]]?ze[oi]:Qu[ze[oi]]}return ii}(this.text)}trim(){let ze=0;for(let oi=0;oi<this.text.length&&op[this.text.charCodeAt(oi)];oi++)ze++;let ii=this.text.length;for(let oi=this.text.length-1;oi>=0&&oi>=ze&&op[this.text.charCodeAt(oi)];oi--)ii--;this.text=this.text.substring(ze,ii),this.sectionIndex=this.sectionIndex.slice(ze,ii)}substring(ze,ii){const oi=new Kc;return oi.text=this.text.substring(ze,ii),oi.sectionIndex=this.sectionIndex.slice(ze,ii),oi.sections=this.sections,oi}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((ze,ii)=>Math.max(ze,this.sections[ii].scale),0)}addTextSection(ze,ii){this.text+=ze.text,this.sections.push(th.forText(ze.scale,ze.fontStack||ii));const oi=this.sections.length-1;for(let ai=0;ai<ze.text.length;++ai)this.sectionIndex.push(oi)}addImageSection(ze){const ii=ze.image?ze.image.name:"";if(ii.length===0)return void On("Can't add FormattedSection with an empty image.");const oi=this.getNextImageSectionCharCode();oi?(this.text+=String.fromCharCode(oi),this.sections.push(th.forImage(ii)),this.sectionIndex.push(this.sections.length-1)):On("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rp(ti,ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri,Li,Fi){const qi=Kc.fromFeature(ti,ai);let Zi;Ii===li.ai.vertical&&qi.verticalizePunctuation();const{processBidirectionalText:Gr,processStyledBidirectionalText:Yi}=Ka;if(Gr&&qi.sections.length===1){Zi=[];const ao=Gr(qi.toString(),ed(qi,xi,ui,ze,oi,Ri,Li));for(const So of ao){const Po=new Kc;Po.text=So,Po.sections=qi.sections;for(let bo=0;bo<So.length;bo++)Po.sectionIndex.push(0);Zi.push(Po)}}else if(Yi){Zi=[];const ao=Yi(qi.text,qi.sectionIndex,ed(qi,xi,ui,ze,oi,Ri,Li));for(const So of ao){const Po=new Kc;Po.text=So[0],Po.sectionIndex=So[1],Po.sections=qi.sections,Zi.push(Po)}}else Zi=function(ao,So){const Po=[],bo=ao.text;let vo=0;for(const mo of So)Po.push(ao.substring(vo,mo)),vo=mo;return vo<bo.length&&Po.push(ao.substring(vo,bo.length)),Po}(qi,ed(qi,xi,ui,ze,oi,Ri,Li));const Yr=[],Jr={positionedLines:Yr,text:qi.toString(),top:wi[1],bottom:wi[1],left:wi[0],right:wi[0],writingMode:Ii,iconsInText:!1,verticalizable:!1};return function(ao,So,Po,bo,vo,mo,To,yo,uo,ko,zo,$o){let vn=0,Sn=eh,Qn=0,ds=0;const Va=yo==="right"?1:yo==="left"?0:.5;let Yn=0;for(const ea of vo){ea.trim();const ta=ea.getMaxScale(),Aa=(ta-1)*Jn,Ga={positionedGlyphs:[],lineOffset:0};ao.positionedLines[Yn]=Ga;const Pa=Ga.positionedGlyphs;let es=0;if(!ea.length()){Sn+=mo,++Yn;continue}for(let ia=0;ia<ea.length();ia++){const Xo=ea.getSection(ia),Ca=ea.getSectionIndex(ia),ba=ea.getCharCode(ia);let ra=0,Rs=null,$s=null,Zs=null,Sl=Jn;const Ms=!(uo===li.ai.horizontal||!zo&&!Au(ba)||zo&&(op[ba]||(fa=ba,wo.Arabic(fa)||wo["Arabic Supplement"](fa)||wo["Arabic Extended-A"](fa)||wo["Arabic Presentation Forms-A"](fa)||wo["Arabic Presentation Forms-B"](fa))));if(Xo.imageName){const gs=bo[Xo.imageName];if(!gs)continue;Zs=Xo.imageName,ao.iconsInText=ao.iconsInText||!0,$s=gs.paddedRect;const is=gs.displaySize;Xo.scale=Xo.scale*Jn/$o,Rs={width:is[0],height:is[1],left:Qa,top:-cf,advance:Ms?is[1]:is[0]},ra=Aa+(Jn-is[1]*Xo.scale),Sl=Rs.advance;const El=Ms?is[0]*Xo.scale-Jn*ta:is[1]*Xo.scale-Jn*ta;El>0&&El>es&&(es=El)}else{const gs=Po[Xo.fontStack],is=gs&&gs[ba];if(is&&is.rect)$s=is.rect,Rs=is.metrics;else{const El=So[Xo.fontStack],ah=El&&El[ba];if(!ah)continue;Rs=ah.metrics}ra=(ta-Xo.scale)*Jn}Ms?(ao.verticalizable=!0,Pa.push({glyph:ba,imageName:Zs,x:vn,y:Sn+ra,vertical:Ms,scale:Xo.scale,fontStack:Xo.fontStack,sectionIndex:Ca,metrics:Rs,rect:$s}),vn+=Sl*Xo.scale+ko):(Pa.push({glyph:ba,imageName:Zs,x:vn,y:Sn+ra,vertical:Ms,scale:Xo.scale,fontStack:Xo.fontStack,sectionIndex:Ca,metrics:Rs,rect:$s}),vn+=Rs.advance*Xo.scale+ko)}Pa.length!==0&&(Qn=Math.max(vn-ko,Qn),b_(Pa,0,Pa.length-1,Va,es)),vn=0;const ts=mo*ta+es;Ga.lineOffset=Math.max(es,Aa),Sn+=ts,ds=Math.max(ts,ds),++Yn}var fa;const va=Sn-eh,{horizontalAlign:ja,verticalAlign:qa}=td(To);(function(ea,ta,Aa,Ga,Pa,es,ts,ia,Xo){const Ca=(ta-Aa)*Pa;let ba=0;ba=es!==ts?-ia*Ga-eh:(-Ga*Xo+.5)*ts;for(const ra of ea)for(const Rs of ra.positionedGlyphs)Rs.x+=Ca,Rs.y+=ba})(ao.positionedLines,Va,ja,qa,Qn,ds,mo,va,vo.length),ao.top+=-qa*va,ao.bottom=ao.top+va,ao.left+=-ja*Qn,ao.right=ao.left+Qn}(Jr,ze,ii,oi,Zi,pi,di,yi,Ii,xi,Pi,Fi),!function(ao){for(const So of ao)if(So.positionedGlyphs.length!==0)return!1;return!0}(Yr)&&Jr}const op={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},x_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function pf(ti,ze,ii,oi,ai,ui){if(ze.imageName){const pi=oi[ze.imageName];return pi?pi.displaySize[0]*ze.scale*Jn/ui+ai:0}{const pi=ii[ze.fontStack],di=pi&&pi[ti];return di?di.metrics.advance*ze.scale+ai:0}}function df(ti,ze,ii,oi){const ai=Math.pow(ti-ze,2);return oi?ti<ze?ai/2:2*ai:ai+Math.abs(ii)*ii}function v_(ti,ze,ii){let oi=0;return ti===10&&(oi-=1e4),ii&&(oi+=150),ti!==40&&ti!==65288||(oi+=50),ze!==41&&ze!==65289||(oi+=50),oi}function ff(ti,ze,ii,oi,ai,ui){let pi=null,di=df(ze,ii,ai,ui);for(const yi of oi){const xi=df(ze-yi.x,ii,ai,ui)+yi.badness;xi<=di&&(pi=yi,di=xi)}return{index:ti,x:ze,priorBreak:pi,badness:di}}function mf(ti){return ti?mf(ti.priorBreak).concat(ti.index):[]}function ed(ti,ze,ii,oi,ai,ui,pi){if(ui!=="point")return[];if(!ti)return[];const di=[],yi=function(Pi,Ri,Li,Fi,qi,Zi){let Gr=0;for(let Yi=0;Yi<Pi.length();Yi++){const Yr=Pi.getSection(Yi);Gr+=pf(Pi.getCharCode(Yi),Yr,Fi,qi,Ri,Zi)}return Gr/Math.max(1,Math.ceil(Gr/Li))}(ti,ze,ii,oi,ai,pi),xi=ti.text.indexOf("​")>=0;let wi=0;for(let Pi=0;Pi<ti.length();Pi++){const Ri=ti.getSection(Pi),Li=ti.getCharCode(Pi);if(op[Li]||(wi+=pf(Li,Ri,oi,ai,ze,pi)),Pi<ti.length()-1){const Fi=!((Ii=Li)<11904||!(wo["Bopomofo Extended"](Ii)||wo.Bopomofo(Ii)||wo["CJK Compatibility Forms"](Ii)||wo["CJK Compatibility Ideographs"](Ii)||wo["CJK Compatibility"](Ii)||wo["CJK Radicals Supplement"](Ii)||wo["CJK Strokes"](Ii)||wo["CJK Symbols and Punctuation"](Ii)||wo["CJK Unified Ideographs Extension A"](Ii)||wo["CJK Unified Ideographs"](Ii)||wo["Enclosed CJK Letters and Months"](Ii)||wo["Halfwidth and Fullwidth Forms"](Ii)||wo.Hiragana(Ii)||wo["Ideographic Description Characters"](Ii)||wo["Kangxi Radicals"](Ii)||wo["Katakana Phonetic Extensions"](Ii)||wo.Katakana(Ii)||wo["Vertical Forms"](Ii)||wo["Yi Radicals"](Ii)||wo["Yi Syllables"](Ii)));(x_[Li]||Fi||Ri.imageName)&&di.push(ff(Pi+1,wi,yi,di,v_(Li,ti.getCharCode(Pi+1),Fi&&xi),!1))}}var Ii;return mf(ff(ti.length(),wi,yi,di,0,!0))}function td(ti){let ze=.5,ii=.5;switch(ti){case"right":case"top-right":case"bottom-right":ze=1;break;case"left":case"top-left":case"bottom-left":ze=0}switch(ti){case"bottom":case"bottom-right":case"bottom-left":ii=1;break;case"top":case"top-right":case"top-left":ii=0}return{horizontalAlign:ze,verticalAlign:ii}}function b_(ti,ze,ii,oi,ai){if(!oi&&!ai)return;const ui=ti[ii],pi=(ti[ii].x+ui.metrics.advance*ui.scale)*oi;for(let di=ze;di<=ii;di++)ti[di].x-=pi,ti[di].y+=ai}function w_(ti,ze,ii){const{horizontalAlign:oi,verticalAlign:ai}=td(ii),ui=ze[0]-ti.displaySize[0]*oi,pi=ze[1]-ti.displaySize[1]*ai;return{image:ti,top:pi,bottom:pi+ti.displaySize[1],left:ui,right:ui+ti.displaySize[0]}}function _f(ti,ze,ii,oi,ai,ui){const pi=ti.image;let di;if(pi.content){const qi=pi.content,Zi=pi.pixelRatio||1;di=[qi[0]/Zi,qi[1]/Zi,pi.displaySize[0]-qi[2]/Zi,pi.displaySize[1]-qi[3]/Zi]}const yi=ze.left*ui,xi=ze.right*ui;let wi,Ii,Pi,Ri;ii==="width"||ii==="both"?(Ri=ai[0]+yi-oi[3],Ii=ai[0]+xi+oi[1]):(Ri=ai[0]+(yi+xi-pi.displaySize[0])/2,Ii=Ri+pi.displaySize[0]);const Li=ze.top*ui,Fi=ze.bottom*ui;return ii==="height"||ii==="both"?(wi=ai[1]+Li-oi[0],Pi=ai[1]+Fi+oi[2]):(wi=ai[1]+(Li+Fi-pi.displaySize[1])/2,Pi=wi+pi.displaySize[1]),{image:pi,top:wi,right:Ii,bottom:Pi,left:Ri,collisionPadding:di}}const ih=255,ol=128,Gl=ih*ol;function yf(ti,ze){const{expression:ii}=ze;if(ii.kind==="constant")return{kind:"constant",layoutSize:ii.evaluate(new gn(ti+1))};if(ii.kind==="source")return{kind:"source"};{const{zoomStops:oi,interpolationType:ai}=ii;let ui=0;for(;ui<oi.length&&oi[ui]<=ti;)ui++;ui=Math.max(0,ui-1);let pi=ui;for(;pi<oi.length&&oi[pi]<ti+1;)pi++;pi=Math.min(oi.length-1,pi);const di=oi[ui],yi=oi[pi];return ii.kind==="composite"?{kind:"composite",minZoom:di,maxZoom:yi,interpolationType:ai}:{kind:"camera",minZoom:di,maxZoom:yi,minSize:ii.evaluate(new gn(di)),maxSize:ii.evaluate(new gn(yi)),interpolationType:ai}}}function id(ti,ze,ii){let oi="never";const ai=ti.get(ze);return ai?oi=ai:ti.get(ii)&&(oi="always"),oi}const S_=jl.VectorTileFeature.types,E_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function np(ti,ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi){const Ri=di?Math.min(Gl,Math.round(di[0])):0,Li=di?Math.min(Gl,Math.round(di[1])):0;ti.emplaceBack(ze,ii,Math.round(32*oi),Math.round(32*ai),ui,pi,(Ri<<1)+(yi?1:0),Li,16*xi,16*wi,256*Ii,256*Pi)}function rd(ti,ze,ii){ti.emplaceBack(ze.x,ze.y,ii),ti.emplaceBack(ze.x,ze.y,ii),ti.emplaceBack(ze.x,ze.y,ii),ti.emplaceBack(ze.x,ze.y,ii)}function T_(ti){for(const ze of ti.sections)if(Cp(ze.text))return!0;return!1}class od{constructor(ze){this.layoutVertexArray=new Zo,this.indexArray=new pa,this.programConfigurations=ze,this.segments=new xn,this.dynamicLayoutVertexArray=new qo,this.opacityVertexArray=new Yo,this.hasVisibleVertices=!1,this.placedSymbolArray=new Wi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(ze,ii,oi,ai){this.isEmpty()||(oi&&(this.layoutVertexBuffer=ze.createVertexBuffer(this.layoutVertexArray,i_.members),this.indexBuffer=ze.createIndexBuffer(this.indexArray,ii),this.dynamicLayoutVertexBuffer=ze.createVertexBuffer(this.dynamicLayoutVertexArray,r_.members,!0),this.opacityVertexBuffer=ze.createVertexBuffer(this.opacityVertexArray,E_,!0),this.opacityVertexBuffer.itemSize=1),(oi||ai)&&this.programConfigurations.upload(ze))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Eo("SymbolBuffers",od);class nd{constructor(ze,ii,oi){this.layoutVertexArray=new ze,this.layoutAttributes=ii,this.indexArray=new oi,this.segments=new xn,this.collisionVertexArray=new yn}upload(ze){this.layoutVertexBuffer=ze.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=ze.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=ze.createVertexBuffer(this.collisionVertexArray,o_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Eo("CollisionBuffers",nd);class Jc{constructor(ze){this.collisionBoxArray=ze.collisionBoxArray,this.zoom=ze.zoom,this.overscaling=ze.overscaling,this.layers=ze.layers,this.layerIds=this.layers.map(pi=>pi.id),this.index=ze.index,this.pixelRatio=ze.pixelRatio,this.sourceLayerIndex=ze.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Dp([]),this.placementViewportMatrix=Dp([]);const ii=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yf(this.zoom,ii["text-size"]),this.iconSizeData=yf(this.zoom,ii["icon-size"]);const oi=this.layers[0].layout,ai=oi.get("symbol-sort-key"),ui=oi.get("symbol-z-order");this.canOverlap=id(oi,"text-overlap","text-allow-overlap")!=="never"||id(oi,"icon-overlap","icon-allow-overlap")!=="never"||oi.get("text-ignore-placement")||oi.get("icon-ignore-placement"),this.sortFeaturesByKey=ui!=="viewport-y"&&!ai.isConstant(),this.sortFeaturesByY=(ui==="viewport-y"||ui==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,oi.get("symbol-placement")==="point"&&(this.writingModes=oi.get("text-writing-mode").map(pi=>li.ai[pi])),this.stateDependentLayerIds=this.layers.filter(pi=>pi.isStateDependent()).map(pi=>pi.id),this.sourceID=ze.sourceID}createArrays(){this.text=new od(new Gs(this.layers,this.zoom,ze=>/^text/.test(ze))),this.icon=new od(new Gs(this.layers,this.zoom,ze=>/^icon/.test(ze))),this.glyphOffsetArray=new Ji,this.lineVertexArray=new eo,this.symbolInstances=new $i,this.textAnchorOffsets=new no}calculateGlyphDependencies(ze,ii,oi,ai,ui){for(let pi=0;pi<ze.length;pi++)if(ii[ze.charCodeAt(pi)]=!0,(oi||ai)&&ui){const di=Qu[ze.charAt(pi)];di&&(ii[di.charCodeAt(0)]=!0)}}populate(ze,ii,oi){const ai=this.layers[0],ui=ai.layout,pi=ui.get("text-font"),di=ui.get("text-field"),yi=ui.get("icon-image"),xi=(di.value.kind!=="constant"||di.value.value instanceof ya&&!di.value.value.isEmpty()||di.value.value.toString().length>0)&&(pi.value.kind!=="constant"||pi.value.value.length>0),wi=yi.value.kind!=="constant"||!!yi.value.value||Object.keys(yi.parameters).length>0,Ii=ui.get("symbol-sort-key");if(this.features=[],!xi&&!wi)return;const Pi=ii.iconDependencies,Ri=ii.glyphDependencies,Li=ii.availableImages,Fi=new gn(this.zoom);for(const{feature:qi,id:Zi,index:Gr,sourceLayerIndex:Yi}of ze){const Yr=ai._featureFilter.needGeometry,Jr=hc(qi,Yr);if(!ai._featureFilter.filter(Fi,Jr,oi))continue;let ao,So;if(Yr||(Jr.geometry=uc(qi)),xi){const bo=ai.getValueAndResolveTokens("text-field",Jr,oi,Li),vo=ya.factory(bo);T_(vo)&&(this.hasRTLText=!0),(!this.hasRTLText||Lu()==="unavailable"||this.hasRTLText&&Ka.isParsed())&&(ao=a_(vo,ai,Jr))}if(wi){const bo=ai.getValueAndResolveTokens("icon-image",Jr,oi,Li);So=bo instanceof ha?bo:ha.fromString(bo)}if(!ao&&!So)continue;const Po=this.sortFeaturesByKey?Ii.evaluate(Jr,{},oi):void 0;if(this.features.push({id:Zi,text:ao,icon:So,index:Gr,sourceLayerIndex:Yi,geometry:Jr.geometry,properties:qi.properties,type:S_[qi.type],sortKey:Po}),So&&(Pi[So.name]=!0),ao){const bo=pi.evaluate(Jr,{},oi).join(","),vo=ui.get("text-rotation-alignment")!=="viewport"&&ui.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(li.ai.vertical)>=0;for(const mo of ao.sections)if(mo.image)Pi[mo.image.name]=!0;else{const To=Tu(ao.toString()),yo=mo.fontStack||bo,uo=Ri[yo]=Ri[yo]||{};this.calculateGlyphDependencies(mo.text,uo,vo,this.allowVerticalPlacement,To)}}}ui.get("symbol-placement")==="line"&&(this.features=function(qi){const Zi={},Gr={},Yi=[];let Yr=0;function Jr(bo){Yi.push(qi[bo]),Yr++}function ao(bo,vo,mo){const To=Gr[bo];return delete Gr[bo],Gr[vo]=To,Yi[To].geometry[0].pop(),Yi[To].geometry[0]=Yi[To].geometry[0].concat(mo[0]),To}function So(bo,vo,mo){const To=Zi[vo];return delete Zi[vo],Zi[bo]=To,Yi[To].geometry[0].shift(),Yi[To].geometry[0]=mo[0].concat(Yi[To].geometry[0]),To}function Po(bo,vo,mo){const To=mo?vo[0][vo[0].length-1]:vo[0][0];return`${bo}:${To.x}:${To.y}`}for(let bo=0;bo<qi.length;bo++){const vo=qi[bo],mo=vo.geometry,To=vo.text?vo.text.toString():null;if(!To){Jr(bo);continue}const yo=Po(To,mo),uo=Po(To,mo,!0);if(yo in Gr&&uo in Zi&&Gr[yo]!==Zi[uo]){const ko=So(yo,uo,mo),zo=ao(yo,uo,Yi[ko].geometry);delete Zi[yo],delete Gr[uo],Gr[Po(To,Yi[zo].geometry,!0)]=zo,Yi[ko].geometry=null}else yo in Gr?ao(yo,uo,mo):uo in Zi?So(yo,uo,mo):(Jr(bo),Zi[yo]=Yr-1,Gr[uo]=Yr-1)}return Yi.filter(bo=>bo.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((qi,Zi)=>qi.sortKey-Zi.sortKey)}update(ze,ii,oi){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(ze,ii,this.layers,oi),this.icon.programConfigurations.updatePaintArrays(ze,ii,this.layers,oi))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(ze){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(ze),this.iconCollisionBox.upload(ze)),this.text.upload(ze,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(ze,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(ze,ii){const oi=this.lineVertexArray.length;if(ze.segment!==void 0){let ai=ze.dist(ii[ze.segment+1]),ui=ze.dist(ii[ze.segment]);const pi={};for(let di=ze.segment+1;di<ii.length;di++)pi[di]={x:ii[di].x,y:ii[di].y,tileUnitDistanceFromAnchor:ai},di<ii.length-1&&(ai+=ii[di+1].dist(ii[di]));for(let di=ze.segment||0;di>=0;di--)pi[di]={x:ii[di].x,y:ii[di].y,tileUnitDistanceFromAnchor:ui},di>0&&(ui+=ii[di-1].dist(ii[di]));for(let di=0;di<ii.length;di++){const yi=pi[di];this.lineVertexArray.emplaceBack(yi.x,yi.y,yi.tileUnitDistanceFromAnchor)}}return{lineStartIndex:oi,lineLength:this.lineVertexArray.length-oi}}addSymbols(ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi){const Ri=ze.indexArray,Li=ze.layoutVertexArray,Fi=ze.segments.prepareSegment(4*ii.length,Li,Ri,this.canOverlap?pi.sortKey:void 0),qi=this.glyphOffsetArray.length,Zi=Fi.vertexLength,Gr=this.allowVerticalPlacement&&di===li.ai.vertical?Math.PI/2:0,Yi=pi.text&&pi.text.sections;for(let Yr=0;Yr<ii.length;Yr++){const{tl:Jr,tr:ao,bl:So,br:Po,tex:bo,pixelOffsetTL:vo,pixelOffsetBR:mo,minFontScaleX:To,minFontScaleY:yo,glyphOffset:uo,isSDF:ko,sectionIndex:zo}=ii[Yr],$o=Fi.vertexLength,vn=uo[1];np(Li,yi.x,yi.y,Jr.x,vn+Jr.y,bo.x,bo.y,oi,ko,vo.x,vo.y,To,yo),np(Li,yi.x,yi.y,ao.x,vn+ao.y,bo.x+bo.w,bo.y,oi,ko,mo.x,vo.y,To,yo),np(Li,yi.x,yi.y,So.x,vn+So.y,bo.x,bo.y+bo.h,oi,ko,vo.x,mo.y,To,yo),np(Li,yi.x,yi.y,Po.x,vn+Po.y,bo.x+bo.w,bo.y+bo.h,oi,ko,mo.x,mo.y,To,yo),rd(ze.dynamicLayoutVertexArray,yi,Gr),Ri.emplaceBack($o,$o+1,$o+2),Ri.emplaceBack($o+1,$o+2,$o+3),Fi.vertexLength+=4,Fi.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(uo[0]),Yr!==ii.length-1&&zo===ii[Yr+1].sectionIndex||ze.programConfigurations.populatePaintArrays(Li.length,pi,pi.index,{},Pi,Yi&&Yi[zo])}ze.placedSymbolArray.emplaceBack(yi.x,yi.y,qi,this.glyphOffsetArray.length-qi,Zi,xi,wi,yi.segment,oi?oi[0]:0,oi?oi[1]:0,ai[0],ai[1],di,0,!1,0,Ii)}_addCollisionDebugVertex(ze,ii,oi,ai,ui,pi){return ii.emplaceBack(0,0),ze.emplaceBack(oi.x,oi.y,ai,ui,Math.round(pi.x),Math.round(pi.y))}addCollisionDebugVertices(ze,ii,oi,ai,ui,pi,di){const yi=ui.segments.prepareSegment(4,ui.layoutVertexArray,ui.indexArray),xi=yi.vertexLength,wi=ui.layoutVertexArray,Ii=ui.collisionVertexArray,Pi=di.anchorX,Ri=di.anchorY;this._addCollisionDebugVertex(wi,Ii,pi,Pi,Ri,new fo(ze,ii)),this._addCollisionDebugVertex(wi,Ii,pi,Pi,Ri,new fo(oi,ii)),this._addCollisionDebugVertex(wi,Ii,pi,Pi,Ri,new fo(oi,ai)),this._addCollisionDebugVertex(wi,Ii,pi,Pi,Ri,new fo(ze,ai)),yi.vertexLength+=4;const Li=ui.indexArray;Li.emplaceBack(xi,xi+1),Li.emplaceBack(xi+1,xi+2),Li.emplaceBack(xi+2,xi+3),Li.emplaceBack(xi+3,xi),yi.primitiveLength+=4}addDebugCollisionBoxes(ze,ii,oi,ai){for(let ui=ze;ui<ii;ui++){const pi=this.collisionBoxArray.get(ui);this.addCollisionDebugVertices(pi.x1,pi.y1,pi.x2,pi.y2,ai?this.textCollisionBox:this.iconCollisionBox,pi.anchorPoint,oi)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nd(kn,ef.members,Wn),this.iconCollisionBox=new nd(kn,ef.members,Wn);for(let ze=0;ze<this.symbolInstances.length;ze++){const ii=this.symbolInstances.get(ze);this.addDebugCollisionBoxes(ii.textBoxStartIndex,ii.textBoxEndIndex,ii,!0),this.addDebugCollisionBoxes(ii.verticalTextBoxStartIndex,ii.verticalTextBoxEndIndex,ii,!0),this.addDebugCollisionBoxes(ii.iconBoxStartIndex,ii.iconBoxEndIndex,ii,!1),this.addDebugCollisionBoxes(ii.verticalIconBoxStartIndex,ii.verticalIconBoxEndIndex,ii,!1)}}_deserializeCollisionBoxesForSymbol(ze,ii,oi,ai,ui,pi,di,yi,xi){const wi={};for(let Ii=ii;Ii<oi;Ii++){const Pi=ze.get(Ii);wi.textBox={x1:Pi.x1,y1:Pi.y1,x2:Pi.x2,y2:Pi.y2,anchorPointX:Pi.anchorPointX,anchorPointY:Pi.anchorPointY},wi.textFeatureIndex=Pi.featureIndex;break}for(let Ii=ai;Ii<ui;Ii++){const Pi=ze.get(Ii);wi.verticalTextBox={x1:Pi.x1,y1:Pi.y1,x2:Pi.x2,y2:Pi.y2,anchorPointX:Pi.anchorPointX,anchorPointY:Pi.anchorPointY},wi.verticalTextFeatureIndex=Pi.featureIndex;break}for(let Ii=pi;Ii<di;Ii++){const Pi=ze.get(Ii);wi.iconBox={x1:Pi.x1,y1:Pi.y1,x2:Pi.x2,y2:Pi.y2,anchorPointX:Pi.anchorPointX,anchorPointY:Pi.anchorPointY},wi.iconFeatureIndex=Pi.featureIndex;break}for(let Ii=yi;Ii<xi;Ii++){const Pi=ze.get(Ii);wi.verticalIconBox={x1:Pi.x1,y1:Pi.y1,x2:Pi.x2,y2:Pi.y2,anchorPointX:Pi.anchorPointX,anchorPointY:Pi.anchorPointY},wi.verticalIconFeatureIndex=Pi.featureIndex;break}return wi}deserializeCollisionBoxes(ze){this.collisionArrays=[];for(let ii=0;ii<this.symbolInstances.length;ii++){const oi=this.symbolInstances.get(ii);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(ze,oi.textBoxStartIndex,oi.textBoxEndIndex,oi.verticalTextBoxStartIndex,oi.verticalTextBoxEndIndex,oi.iconBoxStartIndex,oi.iconBoxEndIndex,oi.verticalIconBoxStartIndex,oi.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(ze,ii){const oi=ze.placedSymbolArray.get(ii),ai=oi.vertexStartIndex+4*oi.numGlyphs;for(let ui=oi.vertexStartIndex;ui<ai;ui+=4)ze.indexArray.emplaceBack(ui,ui+1,ui+2),ze.indexArray.emplaceBack(ui+1,ui+2,ui+3)}getSortedSymbolIndexes(ze){if(this.sortedAngle===ze&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const ii=Math.sin(ze),oi=Math.cos(ze),ai=[],ui=[],pi=[];for(let di=0;di<this.symbolInstances.length;++di){pi.push(di);const yi=this.symbolInstances.get(di);ai.push(0|Math.round(ii*yi.anchorX+oi*yi.anchorY)),ui.push(yi.featureIndex)}return pi.sort((di,yi)=>ai[di]-ai[yi]||ui[yi]-ui[di]),pi}addToSortKeyRanges(ze,ii){const oi=this.sortKeyRanges[this.sortKeyRanges.length-1];oi&&oi.sortKey===ii?oi.symbolInstanceEnd=ze+1:this.sortKeyRanges.push({sortKey:ii,symbolInstanceStart:ze,symbolInstanceEnd:ze+1})}sortFeatures(ze){if(this.sortFeaturesByY&&this.sortedAngle!==ze&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(ze),this.sortedAngle=ze,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const ii of this.symbolInstanceIndexes){const oi=this.symbolInstances.get(ii);this.featureSortOrder.push(oi.featureIndex),[oi.rightJustifiedTextSymbolIndex,oi.centerJustifiedTextSymbolIndex,oi.leftJustifiedTextSymbolIndex].forEach((ai,ui,pi)=>{ai>=0&&pi.indexOf(ai)===ui&&this.addIndicesForPlacedSymbol(this.text,ai)}),oi.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,oi.verticalPlacedTextSymbolIndex),oi.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,oi.placedIconSymbolIndex),oi.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,oi.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gf,xf;Eo("SymbolBucket",Jc,{omit:["layers","collisionBoxArray","features","compareText"]}),Jc.MAX_GLYPHS=65535,Jc.addDynamicAttributes=rd;var ad={get paint(){return xf=xf||new Vn({"icon-opacity":new Fo(io.paint_symbol["icon-opacity"]),"icon-color":new Fo(io.paint_symbol["icon-color"]),"icon-halo-color":new Fo(io.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fo(io.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fo(io.paint_symbol["icon-halo-blur"]),"icon-translate":new Mo(io.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mo(io.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fo(io.paint_symbol["text-opacity"]),"text-color":new Fo(io.paint_symbol["text-color"],{runtimeType:Ea,getOverride:ti=>ti.textColor,hasOverride:ti=>!!ti.textColor}),"text-halo-color":new Fo(io.paint_symbol["text-halo-color"]),"text-halo-width":new Fo(io.paint_symbol["text-halo-width"]),"text-halo-blur":new Fo(io.paint_symbol["text-halo-blur"]),"text-translate":new Mo(io.paint_symbol["text-translate"]),"text-translate-anchor":new Mo(io.paint_symbol["text-translate-anchor"])})},get layout(){return gf=gf||new Vn({"symbol-placement":new Mo(io.layout_symbol["symbol-placement"]),"symbol-spacing":new Mo(io.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mo(io.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fo(io.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mo(io.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Mo(io.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Mo(io.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Mo(io.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mo(io.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mo(io.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fo(io.layout_symbol["icon-size"]),"icon-text-fit":new Mo(io.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mo(io.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fo(io.layout_symbol["icon-image"]),"icon-rotate":new Fo(io.layout_symbol["icon-rotate"]),"icon-padding":new Fo(io.layout_symbol["icon-padding"]),"icon-keep-upright":new Mo(io.layout_symbol["icon-keep-upright"]),"icon-offset":new Fo(io.layout_symbol["icon-offset"]),"icon-anchor":new Fo(io.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mo(io.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mo(io.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mo(io.layout_symbol["text-rotation-alignment"]),"text-field":new Fo(io.layout_symbol["text-field"]),"text-font":new Fo(io.layout_symbol["text-font"]),"text-size":new Fo(io.layout_symbol["text-size"]),"text-max-width":new Fo(io.layout_symbol["text-max-width"]),"text-line-height":new Mo(io.layout_symbol["text-line-height"]),"text-letter-spacing":new Fo(io.layout_symbol["text-letter-spacing"]),"text-justify":new Fo(io.layout_symbol["text-justify"]),"text-radial-offset":new Fo(io.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mo(io.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Fo(io.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Fo(io.layout_symbol["text-anchor"]),"text-max-angle":new Mo(io.layout_symbol["text-max-angle"]),"text-writing-mode":new Mo(io.layout_symbol["text-writing-mode"]),"text-rotate":new Fo(io.layout_symbol["text-rotate"]),"text-padding":new Mo(io.layout_symbol["text-padding"]),"text-keep-upright":new Mo(io.layout_symbol["text-keep-upright"]),"text-transform":new Fo(io.layout_symbol["text-transform"]),"text-offset":new Fo(io.layout_symbol["text-offset"]),"text-allow-overlap":new Mo(io.layout_symbol["text-allow-overlap"]),"text-overlap":new Mo(io.layout_symbol["text-overlap"]),"text-ignore-placement":new Mo(io.layout_symbol["text-ignore-placement"]),"text-optional":new Mo(io.layout_symbol["text-optional"])})}};class vf{constructor(ze){if(ze.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=ze.property.overrides?ze.property.overrides.runtimeType:Fs,this.defaultValue=ze}evaluate(ze){if(ze.formattedSection){const ii=this.defaultValue.property.overrides;if(ii&&ii.hasOverride(ze.formattedSection))return ii.getOverride(ze.formattedSection)}return ze.feature&&ze.featureState?this.defaultValue.evaluate(ze.feature,ze.featureState):this.defaultValue.property.specification.default}eachChild(ze){this.defaultValue.isConstant()||ze(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Eo("FormatSectionOverride",vf,{omit:["defaultValue"]});class ap extends hs{constructor(ze){super(ze,ad)}recalculate(ze,ii){if(super.recalculate(ze,ii),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const oi=this.layout.get("text-writing-mode");if(oi){const ai=[];for(const ui of oi)ai.indexOf(ui)<0&&ai.push(ui);this.layout._values["text-writing-mode"]=ai}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(ze,ii,oi,ai){const ui=this.layout.get(ze).evaluate(ii,{},oi,ai),pi=this._unevaluatedLayout._values[ze];return pi.isDataDriven()||Mc(pi.value)||!ui?ui:function(di,yi){return yi.replace(/{([^{}]+)}/g,(xi,wi)=>di&&wi in di?String(di[wi]):"")}(ii.properties,ui)}createBucket(ze){return new Jc(ze)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const ze of ad.paint.overridableProperties){if(!ap.hasPaintOverride(this.layout,ze))continue;const ii=this.paint.get(ze),oi=new vf(ii),ai=new xu(oi,ii.property.specification);let ui=null;ui=ii.value.kind==="constant"||ii.value.kind==="source"?new vu("source",ai):new Oc("composite",ai,ii.value.zoomStops),this.paint._values[ze]=new Ta(ii.property,ui,ii.parameters)}}_handleOverridablePaintPropertyUpdate(ze,ii,oi){return!(!this.layout||ii.isDataDriven()||oi.isDataDriven())&&ap.hasPaintOverride(this.layout,ze)}static hasPaintOverride(ze,ii){const oi=ze.get("text-field"),ai=ad.paint.properties[ii];let ui=!1;const pi=di=>{for(const yi of di)if(ai.overrides&&ai.overrides.hasOverride(yi))return void(ui=!0)};if(oi.value.kind==="constant"&&oi.value.value instanceof ya)pi(oi.value.value.sections);else if(oi.value.kind==="source"){const di=xi=>{ui||(xi instanceof ul&&En(xi.value)===Ui?pi(xi.value.sections):xi instanceof Rc?pi(xi.sections):xi.eachChild(di))},yi=oi.value;yi._styleExpression&&di(yi._styleExpression.expression)}return ui}}let bf;var I_={get paint(){return bf=bf||new Vn({"background-color":new Mo(io.paint_background["background-color"]),"background-pattern":new ku(io.paint_background["background-pattern"]),"background-opacity":new Mo(io.paint_background["background-opacity"])})}};class A_ extends hs{constructor(ze){super(ze,I_)}}let wf;var P_={get paint(){return wf=wf||new Vn({"raster-opacity":new Mo(io.paint_raster["raster-opacity"]),"raster-hue-rotate":new Mo(io.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mo(io.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mo(io.paint_raster["raster-brightness-max"]),"raster-saturation":new Mo(io.paint_raster["raster-saturation"]),"raster-contrast":new Mo(io.paint_raster["raster-contrast"]),"raster-resampling":new Mo(io.paint_raster["raster-resampling"]),"raster-fade-duration":new Mo(io.paint_raster["raster-fade-duration"])})}};class C_ extends hs{constructor(ze){super(ze,P_)}}class z_ extends hs{constructor(ze){super(ze,{}),this.onAdd=ii=>{this.implementation.onAdd&&this.implementation.onAdd(ii,ii.painter.context.gl)},this.onRemove=ii=>{this.implementation.onRemove&&this.implementation.onRemove(ii,ii.painter.context.gl)},this.implementation=ze}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class R_{constructor(ze){this._callback=ze,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const sd=63710088e-1;class $l{constructor(ze,ii){if(isNaN(ze)||isNaN(ii))throw new Error(`Invalid LngLat object: (${ze}, ${ii})`);if(this.lng=+ze,this.lat=+ii,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $l(oa(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(ze){const ii=Math.PI/180,oi=this.lat*ii,ai=ze.lat*ii,ui=Math.sin(oi)*Math.sin(ai)+Math.cos(oi)*Math.cos(ai)*Math.cos((ze.lng-this.lng)*ii);return sd*Math.acos(Math.min(ui,1))}static convert(ze){if(ze instanceof $l)return ze;if(Array.isArray(ze)&&(ze.length===2||ze.length===3))return new $l(Number(ze[0]),Number(ze[1]));if(!Array.isArray(ze)&&typeof ze=="object"&&ze!==null)return new $l(Number("lng"in ze?ze.lng:ze.lon),Number(ze.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Sf=2*Math.PI*sd;function Ef(ti){return Sf*Math.cos(ti*Math.PI/180)}function Tf(ti){return(180+ti)/360}function If(ti){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+ti*Math.PI/360)))/360}function Af(ti,ze){return ti/Ef(ze)}function Pf(ti){return 360*ti-180}function ld(ti){return 360/Math.PI*Math.atan(Math.exp((180-360*ti)*Math.PI/180))-90}class sp{constructor(ze,ii,oi=0){this.x=+ze,this.y=+ii,this.z=+oi}static fromLngLat(ze,ii=0){const oi=$l.convert(ze);return new sp(Tf(oi.lng),If(oi.lat),Af(ii,oi.lat))}toLngLat(){return new $l(Pf(this.x),ld(this.y))}toAltitude(){return this.z*Ef(ld(this.y))}meterInMercatorCoordinateUnits(){return 1/Sf*(ze=ld(this.y),1/Math.cos(ze*Math.PI/180));var ze}}function Cf(ti,ze,ii){var oi=2*Math.PI*6378137/256/Math.pow(2,ii);return[ti*oi-2*Math.PI*6378137/2,ze*oi-2*Math.PI*6378137/2]}class cd{constructor(ze,ii,oi){if(ze<0||ze>25||oi<0||oi>=Math.pow(2,ze)||ii<0||ii>=Math.pow(2,ze))throw new Error(`x=${ii}, y=${oi}, z=${ze} outside of bounds. 0<=x<${Math.pow(2,ze)}, 0<=y<${Math.pow(2,ze)} 0<=z<=25 `);this.z=ze,this.x=ii,this.y=oi,this.key=rh(0,ze,ze,ii,oi)}equals(ze){return this.z===ze.z&&this.x===ze.x&&this.y===ze.y}url(ze,ii,oi){const ai=(pi=this.y,di=this.z,yi=Cf(256*(ui=this.x),256*(pi=Math.pow(2,di)-pi-1),di),xi=Cf(256*(ui+1),256*(pi+1),di),yi[0]+","+yi[1]+","+xi[0]+","+xi[1]);var ui,pi,di,yi,xi;const wi=function(Ii,Pi,Ri){let Li,Fi="";for(let qi=Ii;qi>0;qi--)Li=1<<qi-1,Fi+=(Pi&Li?1:0)+(Ri&Li?2:0);return Fi}(this.z,this.x,this.y);return ze[(this.x+this.y)%ze.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(oi==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,ii>1?"@2x":"").replace(/{quadkey}/g,wi).replace(/{bbox-epsg-3857}/g,ai)}isChildOf(ze){const ii=this.z-ze.z;return ii>0&&ze.x===this.x>>ii&&ze.y===this.y>>ii}getTilePoint(ze){const ii=Math.pow(2,this.z);return new fo((ze.x*ii-this.x)*Hn,(ze.y*ii-this.y)*Hn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zf{constructor(ze,ii){this.wrap=ze,this.canonical=ii,this.key=rh(ze,ii.z,ii.z,ii.x,ii.y)}}class ys{constructor(ze,ii,oi,ai,ui){if(ze<oi)throw new Error(`overscaledZ should be >= z; overscaledZ = ${ze}; z = ${oi}`);this.overscaledZ=ze,this.wrap=ii,this.canonical=new cd(oi,+ai,+ui),this.key=rh(ii,ze,oi,ai,ui)}clone(){return new ys(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(ze){return this.overscaledZ===ze.overscaledZ&&this.wrap===ze.wrap&&this.canonical.equals(ze.canonical)}scaledTo(ze){if(ze>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${ze}; overscaledZ = ${this.overscaledZ}`);const ii=this.canonical.z-ze;return ze>this.canonical.z?new ys(ze,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ys(ze,this.wrap,ze,this.canonical.x>>ii,this.canonical.y>>ii)}calculateScaledKey(ze,ii){if(ze>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${ze}; overscaledZ = ${this.overscaledZ}`);const oi=this.canonical.z-ze;return ze>this.canonical.z?rh(this.wrap*+ii,ze,this.canonical.z,this.canonical.x,this.canonical.y):rh(this.wrap*+ii,ze,ze,this.canonical.x>>oi,this.canonical.y>>oi)}isChildOf(ze){if(ze.wrap!==this.wrap)return!1;const ii=this.canonical.z-ze.canonical.z;return ze.overscaledZ===0||ze.overscaledZ<this.overscaledZ&&ze.canonical.x===this.canonical.x>>ii&&ze.canonical.y===this.canonical.y>>ii}children(ze){if(this.overscaledZ>=ze)return[new ys(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const ii=this.canonical.z+1,oi=2*this.canonical.x,ai=2*this.canonical.y;return[new ys(ii,this.wrap,ii,oi,ai),new ys(ii,this.wrap,ii,oi+1,ai),new ys(ii,this.wrap,ii,oi,ai+1),new ys(ii,this.wrap,ii,oi+1,ai+1)]}isLessThan(ze){return this.wrap<ze.wrap||!(this.wrap>ze.wrap)&&(this.overscaledZ<ze.overscaledZ||!(this.overscaledZ>ze.overscaledZ)&&(this.canonical.x<ze.canonical.x||!(this.canonical.x>ze.canonical.x)&&this.canonical.y<ze.canonical.y))}wrapped(){return new ys(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(ze){return new ys(this.overscaledZ,ze,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(ze){return this.canonical.getTilePoint(new sp(ze.x-this.wrap,ze.y))}}function rh(ti,ze,ii,oi,ai){(ti*=2)<0&&(ti=-1*ti-1);const ui=1<<ii;return(ui*ui*ti+ui*ai+oi).toString(36)+ii.toString(36)+ze.toString(36)}Eo("CanonicalTileID",cd),Eo("OverscaledTileID",ys,{omit:["posMatrix"]});class Rf{constructor(ze,ii,oi,ai=1,ui=1,pi=1,di=0){if(this.uid=ze,ii.height!==ii.width)throw new RangeError("DEM tiles must be square");if(oi&&!["mapbox","terrarium","custom"].includes(oi))return void On(`"${oi}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=ii.height;const yi=this.dim=ii.height-2;switch(this.data=new Uint32Array(ii.data.buffer),oi){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=ai,this.greenFactor=ui,this.blueFactor=pi,this.baseShift=di;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let xi=0;xi<yi;xi++)this.data[this._idx(-1,xi)]=this.data[this._idx(0,xi)],this.data[this._idx(yi,xi)]=this.data[this._idx(yi-1,xi)],this.data[this._idx(xi,-1)]=this.data[this._idx(xi,0)],this.data[this._idx(xi,yi)]=this.data[this._idx(xi,yi-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(yi,-1)]=this.data[this._idx(yi-1,0)],this.data[this._idx(-1,yi)]=this.data[this._idx(0,yi-1)],this.data[this._idx(yi,yi)]=this.data[this._idx(yi-1,yi-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let xi=0;xi<yi;xi++)for(let wi=0;wi<yi;wi++){const Ii=this.get(xi,wi);Ii>this.max&&(this.max=Ii),Ii<this.min&&(this.min=Ii)}}get(ze,ii){const oi=new Uint8Array(this.data.buffer),ai=4*this._idx(ze,ii);return this.unpack(oi[ai],oi[ai+1],oi[ai+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(ze,ii){if(ze<-1||ze>=this.dim+1||ii<-1||ii>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(ii+1)*this.stride+(ze+1)}unpack(ze,ii,oi){return ze*this.redFactor+ii*this.greenFactor+oi*this.blueFactor-this.baseShift}getPixels(){return new _s({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(ze,ii,oi){if(this.dim!==ze.dim)throw new Error("dem dimension mismatch");let ai=ii*this.dim,ui=ii*this.dim+this.dim,pi=oi*this.dim,di=oi*this.dim+this.dim;switch(ii){case-1:ai=ui-1;break;case 1:ui=ai+1}switch(oi){case-1:pi=di-1;break;case 1:di=pi+1}const yi=-ii*this.dim,xi=-oi*this.dim;for(let wi=pi;wi<di;wi++)for(let Ii=ai;Ii<ui;Ii++)this.data[this._idx(Ii,wi)]=ze.data[this._idx(Ii+yi,wi+xi)]}}Eo("DEMData",Rf);class Mf{constructor(ze){this._stringToNumber={},this._numberToString=[];for(let ii=0;ii<ze.length;ii++){const oi=ze[ii];this._stringToNumber[oi]=ii,this._numberToString[ii]=oi}}encode(ze){return this._stringToNumber[ze]}decode(ze){if(ze>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${ze} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[ze]}}class Lf{constructor(ze,ii,oi,ai,ui){this.type="Feature",this._vectorTileFeature=ze,ze._z=ii,ze._x=oi,ze._y=ai,this.properties=ze.properties,this.id=ui}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(ze){this._geometry=ze}toJSON(){const ze={geometry:this.geometry};for(const ii in this)ii!=="_geometry"&&ii!=="_vectorTileFeature"&&(ze[ii]=this[ii]);return ze}}class Of{constructor(ze,ii){this.tileID=ze,this.x=ze.canonical.x,this.y=ze.canonical.y,this.z=ze.canonical.z,this.grid=new Fl(Hn,16,0),this.grid3D=new Fl(Hn,16,0),this.featureIndexArray=new lo,this.promoteId=ii}insert(ze,ii,oi,ai,ui,pi){const di=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(oi,ai,ui);const yi=pi?this.grid3D:this.grid;for(let xi=0;xi<ii.length;xi++){const wi=ii[xi],Ii=[1/0,1/0,-1/0,-1/0];for(let Pi=0;Pi<wi.length;Pi++){const Ri=wi[Pi];Ii[0]=Math.min(Ii[0],Ri.x),Ii[1]=Math.min(Ii[1],Ri.y),Ii[2]=Math.max(Ii[2],Ri.x),Ii[3]=Math.max(Ii[3],Ri.y)}Ii[0]<Hn&&Ii[1]<Hn&&Ii[2]>=0&&Ii[3]>=0&&yi.insert(di,Ii[0],Ii[1],Ii[2],Ii[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new jl.VectorTile(new Kp(this.rawTileData)).layers,this.sourceLayerCoder=new Mf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(ze,ii,oi,ai){this.loadVTLayers();const ui=ze.params||{},pi=Hn/ze.tileSize/ze.scale,di=wu(ui.filter),yi=ze.queryGeometry,xi=ze.queryPadding*pi,wi=Df(yi),Ii=this.grid.query(wi.minX-xi,wi.minY-xi,wi.maxX+xi,wi.maxY+xi),Pi=Df(ze.cameraQueryGeometry),Ri=this.grid3D.query(Pi.minX-xi,Pi.minY-xi,Pi.maxX+xi,Pi.maxY+xi,(qi,Zi,Gr,Yi)=>function(Yr,Jr,ao,So,Po){for(const vo of Yr)if(Jr<=vo.x&&ao<=vo.y&&So>=vo.x&&Po>=vo.y)return!0;const bo=[new fo(Jr,ao),new fo(Jr,Po),new fo(So,Po),new fo(So,ao)];if(Yr.length>2){for(const vo of bo)if($c(Yr,vo))return!0}for(let vo=0;vo<Yr.length-1;vo++)if(cm(Yr[vo],Yr[vo+1],bo))return!0;return!1}(ze.cameraQueryGeometry,qi-xi,Zi-xi,Gr+xi,Yi+xi));for(const qi of Ri)Ii.push(qi);Ii.sort(M_);const Li={};let Fi;for(let qi=0;qi<Ii.length;qi++){const Zi=Ii[qi];if(Zi===Fi)continue;Fi=Zi;const Gr=this.featureIndexArray.get(Zi);let Yi=null;this.loadMatchingFeature(Li,Gr.bucketIndex,Gr.sourceLayerIndex,Gr.featureIndex,di,ui.layers,ui.availableImages,ii,oi,ai,(Yr,Jr,ao)=>(Yi||(Yi=uc(Yr)),Jr.queryIntersectsFeature(yi,Yr,ao,Yi,this.z,ze.transform,pi,ze.pixelPosMatrix)))}return Li}loadMatchingFeature(ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii){const Pi=this.bucketLayerIDs[ii];if(pi&&!function(qi,Zi){for(let Gr=0;Gr<qi.length;Gr++)if(Zi.indexOf(qi[Gr])>=0)return!0;return!1}(pi,Pi))return;const Ri=this.sourceLayerCoder.decode(oi),Li=this.vtLayers[Ri].feature(ai);if(ui.needGeometry){const qi=hc(Li,!0);if(!ui.filter(new gn(this.tileID.overscaledZ),qi,this.tileID.canonical))return}else if(!ui.filter(new gn(this.tileID.overscaledZ),Li))return;const Fi=this.getId(Li,Ri);for(let qi=0;qi<Pi.length;qi++){const Zi=Pi[qi];if(pi&&pi.indexOf(Zi)<0)continue;const Gr=yi[Zi];if(!Gr)continue;let Yi={};Fi&&wi&&(Yi=wi.getState(Gr.sourceLayer||"_geojsonTileLayer",Fi));const Yr=ln({},xi[Zi]);Yr.paint=kf(Yr.paint,Gr.paint,Li,Yi,di),Yr.layout=kf(Yr.layout,Gr.layout,Li,Yi,di);const Jr=!Ii||Ii(Li,Gr,Yi);if(!Jr)continue;const ao=new Lf(Li,this.z,this.x,this.y,Fi);ao.layer=Yr;let So=ze[Zi];So===void 0&&(So=ze[Zi]=[]),So.push({featureIndex:ai,feature:ao,intersectionZ:Jr})}}lookupSymbolFeatures(ze,ii,oi,ai,ui,pi,di,yi){const xi={};this.loadVTLayers();const wi=wu(ui);for(const Ii of ze)this.loadMatchingFeature(xi,oi,ai,Ii,wi,pi,di,yi,ii);return xi}hasLayer(ze){for(const ii of this.bucketLayerIDs)for(const oi of ii)if(ze===oi)return!0;return!1}getId(ze,ii){let oi=ze.id;return this.promoteId&&(oi=ze.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[ii]],typeof oi=="boolean"&&(oi=Number(oi))),oi}}function kf(ti,ze,ii,oi,ai){return Wo(ti,(ui,pi)=>{const di=ze instanceof qc?ze.get(pi):null;return di&&di.evaluate?di.evaluate(ii,oi,ai):di})}function Df(ti){let ze=1/0,ii=1/0,oi=-1/0,ai=-1/0;for(const ui of ti)ze=Math.min(ze,ui.x),ii=Math.min(ii,ui.y),oi=Math.max(oi,ui.x),ai=Math.max(ai,ui.y);return{minX:ze,minY:ii,maxX:oi,maxY:ai}}function M_(ti,ze){return ze-ti}function Ff(ti,ze,ii,oi,ai){const ui=[];for(let pi=0;pi<ti.length;pi++){const di=ti[pi];let yi;for(let xi=0;xi<di.length-1;xi++){let wi=di[xi],Ii=di[xi+1];wi.x<ze&&Ii.x<ze||(wi.x<ze?wi=new fo(ze,wi.y+(ze-wi.x)/(Ii.x-wi.x)*(Ii.y-wi.y))._round():Ii.x<ze&&(Ii=new fo(ze,wi.y+(ze-wi.x)/(Ii.x-wi.x)*(Ii.y-wi.y))._round()),wi.y<ii&&Ii.y<ii||(wi.y<ii?wi=new fo(wi.x+(ii-wi.y)/(Ii.y-wi.y)*(Ii.x-wi.x),ii)._round():Ii.y<ii&&(Ii=new fo(wi.x+(ii-wi.y)/(Ii.y-wi.y)*(Ii.x-wi.x),ii)._round()),wi.x>=oi&&Ii.x>=oi||(wi.x>=oi?wi=new fo(oi,wi.y+(oi-wi.x)/(Ii.x-wi.x)*(Ii.y-wi.y))._round():Ii.x>=oi&&(Ii=new fo(oi,wi.y+(oi-wi.x)/(Ii.x-wi.x)*(Ii.y-wi.y))._round()),wi.y>=ai&&Ii.y>=ai||(wi.y>=ai?wi=new fo(wi.x+(ai-wi.y)/(Ii.y-wi.y)*(Ii.x-wi.x),ai)._round():Ii.y>=ai&&(Ii=new fo(wi.x+(ai-wi.y)/(Ii.y-wi.y)*(Ii.x-wi.x),ai)._round()),yi&&wi.equals(yi[yi.length-1])||(yi=[wi],ui.push(yi)),yi.push(Ii)))))}}return ui}Eo("FeatureIndex",Of,{omit:["rawTileData","sourceLayerCoder"]});class Zl extends fo{constructor(ze,ii,oi,ai){super(ze,ii),this.angle=oi,ai!==void 0&&(this.segment=ai)}clone(){return new Zl(this.x,this.y,this.angle,this.segment)}}function Bf(ti,ze,ii,oi,ai){if(ze.segment===void 0||ii===0)return!0;let ui=ze,pi=ze.segment+1,di=0;for(;di>-ii/2;){if(pi--,pi<0)return!1;di-=ti[pi].dist(ui),ui=ti[pi]}di+=ti[pi].dist(ti[pi+1]),pi++;const yi=[];let xi=0;for(;di<ii/2;){const wi=ti[pi],Ii=ti[pi+1];if(!Ii)return!1;let Pi=ti[pi-1].angleTo(wi)-wi.angleTo(Ii);for(Pi=Math.abs((Pi+3*Math.PI)%(2*Math.PI)-Math.PI),yi.push({distance:di,angleDelta:Pi}),xi+=Pi;di-yi[0].distance>oi;)xi-=yi.shift().angleDelta;if(xi>ai)return!1;pi++,di+=wi.dist(Ii)}return!0}function Nf(ti){let ze=0;for(let ii=0;ii<ti.length-1;ii++)ze+=ti[ii].dist(ti[ii+1]);return ze}function Uf(ti,ze,ii){return ti?.6*ze*ii:0}function Vf(ti,ze){return Math.max(ti?ti.right-ti.left:0,ze?ze.right-ze.left:0)}function L_(ti,ze,ii,oi,ai,ui){const pi=Uf(ii,ai,ui),di=Vf(ii,oi)*ui;let yi=0;const xi=Nf(ti)/2;for(let wi=0;wi<ti.length-1;wi++){const Ii=ti[wi],Pi=ti[wi+1],Ri=Ii.dist(Pi);if(yi+Ri>xi){const Li=(xi-yi)/Ri,Fi=Ya.number(Ii.x,Pi.x,Li),qi=Ya.number(Ii.y,Pi.y,Li),Zi=new Zl(Fi,qi,Pi.angleTo(Ii),wi);return Zi._round(),!pi||Bf(ti,Zi,di,pi,ze)?Zi:void 0}yi+=Ri}}function O_(ti,ze,ii,oi,ai,ui,pi,di,yi){const xi=Uf(oi,ui,pi),wi=Vf(oi,ai),Ii=wi*pi,Pi=ti[0].x===0||ti[0].x===yi||ti[0].y===0||ti[0].y===yi;return ze-Ii<ze/4&&(ze=Ii+ze/4),jf(ti,Pi?ze/2*di%ze:(wi/2+2*ui)*pi*di%ze,ze,xi,ii,Ii,Pi,!1,yi)}function jf(ti,ze,ii,oi,ai,ui,pi,di,yi){const xi=ui/2,wi=Nf(ti);let Ii=0,Pi=ze-ii,Ri=[];for(let Li=0;Li<ti.length-1;Li++){const Fi=ti[Li],qi=ti[Li+1],Zi=Fi.dist(qi),Gr=qi.angleTo(Fi);for(;Pi+ii<Ii+Zi;){Pi+=ii;const Yi=(Pi-Ii)/Zi,Yr=Ya.number(Fi.x,qi.x,Yi),Jr=Ya.number(Fi.y,qi.y,Yi);if(Yr>=0&&Yr<yi&&Jr>=0&&Jr<yi&&Pi-xi>=0&&Pi+xi<=wi){const ao=new Zl(Yr,Jr,Gr,Li);ao._round(),oi&&!Bf(ti,ao,ui,oi,ai)||Ri.push(ao)}}Ii+=Zi}return di||Ri.length||pi||(Ri=jf(ti,Ii/2,ii,oi,ai,ui,pi,!0,yi)),Ri}Eo("Anchor",Zl);const Qc=Qa;function qf(ti,ze,ii,oi){const ai=[],ui=ti.image,pi=ui.pixelRatio,di=ui.paddedRect.w-2*Qc,yi=ui.paddedRect.h-2*Qc,xi=ti.right-ti.left,wi=ti.bottom-ti.top,Ii=ui.stretchX||[[0,di]],Pi=ui.stretchY||[[0,yi]],Ri=(mo,To)=>mo+To[1]-To[0],Li=Ii.reduce(Ri,0),Fi=Pi.reduce(Ri,0),qi=di-Li,Zi=yi-Fi;let Gr=0,Yi=Li,Yr=0,Jr=Fi,ao=0,So=qi,Po=0,bo=Zi;if(ui.content&&oi){const mo=ui.content;Gr=lp(Ii,0,mo[0]),Yr=lp(Pi,0,mo[1]),Yi=lp(Ii,mo[0],mo[2]),Jr=lp(Pi,mo[1],mo[3]),ao=mo[0]-Gr,Po=mo[1]-Yr,So=mo[2]-mo[0]-Yi,bo=mo[3]-mo[1]-Jr}const vo=(mo,To,yo,uo)=>{const ko=cp(mo.stretch-Gr,Yi,xi,ti.left),zo=up(mo.fixed-ao,So,mo.stretch,Li),$o=cp(To.stretch-Yr,Jr,wi,ti.top),vn=up(To.fixed-Po,bo,To.stretch,Fi),Sn=cp(yo.stretch-Gr,Yi,xi,ti.left),Qn=up(yo.fixed-ao,So,yo.stretch,Li),ds=cp(uo.stretch-Yr,Jr,wi,ti.top),Va=up(uo.fixed-Po,bo,uo.stretch,Fi),Yn=new fo(ko,$o),fa=new fo(Sn,$o),va=new fo(Sn,ds),ja=new fo(ko,ds),qa=new fo(zo/pi,vn/pi),ea=new fo(Qn/pi,Va/pi),ta=ze*Math.PI/180;if(ta){const Pa=Math.sin(ta),es=Math.cos(ta),ts=[es,-Pa,Pa,es];Yn._matMult(ts),fa._matMult(ts),ja._matMult(ts),va._matMult(ts)}const Aa=mo.stretch+mo.fixed,Ga=To.stretch+To.fixed;return{tl:Yn,tr:fa,bl:ja,br:va,tex:{x:ui.paddedRect.x+Qc+Aa,y:ui.paddedRect.y+Qc+Ga,w:yo.stretch+yo.fixed-Aa,h:uo.stretch+uo.fixed-Ga},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qa,pixelOffsetBR:ea,minFontScaleX:So/pi/xi,minFontScaleY:bo/pi/wi,isSDF:ii}};if(oi&&(ui.stretchX||ui.stretchY)){const mo=Gf(Ii,qi,Li),To=Gf(Pi,Zi,Fi);for(let yo=0;yo<mo.length-1;yo++){const uo=mo[yo],ko=mo[yo+1];for(let zo=0;zo<To.length-1;zo++)ai.push(vo(uo,To[zo],ko,To[zo+1]))}}else ai.push(vo({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:di+1},{fixed:0,stretch:yi+1}));return ai}function lp(ti,ze,ii){let oi=0;for(const ai of ti)oi+=Math.max(ze,Math.min(ii,ai[1]))-Math.max(ze,Math.min(ii,ai[0]));return oi}function Gf(ti,ze,ii){const oi=[{fixed:-Qc,stretch:0}];for(const[ai,ui]of ti){const pi=oi[oi.length-1];oi.push({fixed:ai-pi.stretch,stretch:pi.stretch}),oi.push({fixed:ai-pi.stretch,stretch:pi.stretch+(ui-ai)})}return oi.push({fixed:ze+Qc,stretch:ii}),oi}function cp(ti,ze,ii,oi){return ti/ze*ii+oi}function up(ti,ze,ii,oi){return ti-ze*ii/oi}class hp{constructor(ze,ii,oi,ai,ui,pi,di,yi,xi,wi){if(this.boxStartIndex=ze.length,xi){let Ii=pi.top,Pi=pi.bottom;const Ri=pi.collisionPadding;Ri&&(Ii-=Ri[1],Pi+=Ri[3]);let Li=Pi-Ii;Li>0&&(Li=Math.max(10,Li),this.circleDiameter=Li)}else{let Ii=pi.top*di-yi[0],Pi=pi.bottom*di+yi[2],Ri=pi.left*di-yi[3],Li=pi.right*di+yi[1];const Fi=pi.collisionPadding;if(Fi&&(Ri-=Fi[0]*di,Ii-=Fi[1]*di,Li+=Fi[2]*di,Pi+=Fi[3]*di),wi){const qi=new fo(Ri,Ii),Zi=new fo(Li,Ii),Gr=new fo(Ri,Pi),Yi=new fo(Li,Pi),Yr=wi*Math.PI/180;qi._rotate(Yr),Zi._rotate(Yr),Gr._rotate(Yr),Yi._rotate(Yr),Ri=Math.min(qi.x,Zi.x,Gr.x,Yi.x),Li=Math.max(qi.x,Zi.x,Gr.x,Yi.x),Ii=Math.min(qi.y,Zi.y,Gr.y,Yi.y),Pi=Math.max(qi.y,Zi.y,Gr.y,Yi.y)}ze.emplaceBack(ii.x,ii.y,Ri,Ii,Li,Pi,oi,ai,ui)}this.boxEndIndex=ze.length}}class k_{constructor(ze=[],ii=D_){if(this.data=ze,this.length=this.data.length,this.compare=ii,this.length>0)for(let oi=(this.length>>1)-1;oi>=0;oi--)this._down(oi)}push(ze){this.data.push(ze),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const ze=this.data[0],ii=this.data.pop();return this.length--,this.length>0&&(this.data[0]=ii,this._down(0)),ze}peek(){return this.data[0]}_up(ze){const{data:ii,compare:oi}=this,ai=ii[ze];for(;ze>0;){const ui=ze-1>>1,pi=ii[ui];if(oi(ai,pi)>=0)break;ii[ze]=pi,ze=ui}ii[ze]=ai}_down(ze){const{data:ii,compare:oi}=this,ai=this.length>>1,ui=ii[ze];for(;ze<ai;){let pi=1+(ze<<1),di=ii[pi];const yi=pi+1;if(yi<this.length&&oi(ii[yi],di)<0&&(pi=yi,di=ii[yi]),oi(di,ui)>=0)break;ii[ze]=di,ze=pi}ii[ze]=ui}}function D_(ti,ze){return ti<ze?-1:ti>ze?1:0}function F_(ti,ze=1,ii=!1){let oi=1/0,ai=1/0,ui=-1/0,pi=-1/0;const di=ti[0];for(let Ri=0;Ri<di.length;Ri++){const Li=di[Ri];(!Ri||Li.x<oi)&&(oi=Li.x),(!Ri||Li.y<ai)&&(ai=Li.y),(!Ri||Li.x>ui)&&(ui=Li.x),(!Ri||Li.y>pi)&&(pi=Li.y)}const yi=Math.min(ui-oi,pi-ai);let xi=yi/2;const wi=new k_([],B_);if(yi===0)return new fo(oi,ai);for(let Ri=oi;Ri<ui;Ri+=yi)for(let Li=ai;Li<pi;Li+=yi)wi.push(new eu(Ri+xi,Li+xi,xi,ti));let Ii=function(Ri){let Li=0,Fi=0,qi=0;const Zi=Ri[0];for(let Gr=0,Yi=Zi.length,Yr=Yi-1;Gr<Yi;Yr=Gr++){const Jr=Zi[Gr],ao=Zi[Yr],So=Jr.x*ao.y-ao.x*Jr.y;Fi+=(Jr.x+ao.x)*So,qi+=(Jr.y+ao.y)*So,Li+=3*So}return new eu(Fi/Li,qi/Li,0,Ri)}(ti),Pi=wi.length;for(;wi.length;){const Ri=wi.pop();(Ri.d>Ii.d||!Ii.d)&&(Ii=Ri,ii&&console.log("found best %d after %d probes",Math.round(1e4*Ri.d)/1e4,Pi)),Ri.max-Ii.d<=ze||(xi=Ri.h/2,wi.push(new eu(Ri.p.x-xi,Ri.p.y-xi,xi,ti)),wi.push(new eu(Ri.p.x+xi,Ri.p.y-xi,xi,ti)),wi.push(new eu(Ri.p.x-xi,Ri.p.y+xi,xi,ti)),wi.push(new eu(Ri.p.x+xi,Ri.p.y+xi,xi,ti)),Pi+=4)}return ii&&(console.log(`num probes: ${Pi}`),console.log(`best distance: ${Ii.d}`)),Ii.p}function B_(ti,ze){return ze.max-ti.max}function eu(ti,ze,ii,oi){this.p=new fo(ti,ze),this.h=ii,this.d=function(ai,ui){let pi=!1,di=1/0;for(let yi=0;yi<ui.length;yi++){const xi=ui[yi];for(let wi=0,Ii=xi.length,Pi=Ii-1;wi<Ii;Pi=wi++){const Ri=xi[wi],Li=xi[Pi];Ri.y>ai.y!=Li.y>ai.y&&ai.x<(Li.x-Ri.x)*(ai.y-Ri.y)/(Li.y-Ri.y)+Ri.x&&(pi=!pi),di=Math.min(di,Td(ai,Ri,Li))}}return(pi?1:-1)*Math.sqrt(di)}(this.p,oi),this.max=this.d+this.h*Math.SQRT2}var xa;li.aq=void 0,(xa=li.aq||(li.aq={}))[xa.center=1]="center",xa[xa.left=2]="left",xa[xa.right=3]="right",xa[xa.top=4]="top",xa[xa.bottom=5]="bottom",xa[xa["top-left"]=6]="top-left",xa[xa["top-right"]=7]="top-right",xa[xa["bottom-left"]=8]="bottom-left",xa[xa["bottom-right"]=9]="bottom-right";const Hl=7,ud=Number.POSITIVE_INFINITY;function $f(ti,ze){return ze[1]!==ud?function(ii,oi,ai){let ui=0,pi=0;switch(oi=Math.abs(oi),ai=Math.abs(ai),ii){case"top-right":case"top-left":case"top":pi=ai-Hl;break;case"bottom-right":case"bottom-left":case"bottom":pi=-ai+Hl}switch(ii){case"top-right":case"bottom-right":case"right":ui=-oi;break;case"top-left":case"bottom-left":case"left":ui=oi}return[ui,pi]}(ti,ze[0],ze[1]):function(ii,oi){let ai=0,ui=0;oi<0&&(oi=0);const pi=oi/Math.SQRT2;switch(ii){case"top-right":case"top-left":ui=pi-Hl;break;case"bottom-right":case"bottom-left":ui=-pi+Hl;break;case"bottom":ui=-oi+Hl;break;case"top":ui=oi-Hl}switch(ii){case"top-right":case"bottom-right":ai=-pi;break;case"top-left":case"bottom-left":ai=pi;break;case"left":ai=oi;break;case"right":ai=-oi}return[ai,ui]}(ti,ze[0])}function Zf(ti,ze,ii){var oi;const ai=ti.layout,ui=(oi=ai.get("text-variable-anchor-offset"))===null||oi===void 0?void 0:oi.evaluate(ze,{},ii);if(ui){const di=ui.values,yi=[];for(let xi=0;xi<di.length;xi+=2){const wi=yi[xi]=di[xi],Ii=di[xi+1].map(Pi=>Pi*Jn);wi.startsWith("top")?Ii[1]-=Hl:wi.startsWith("bottom")&&(Ii[1]+=Hl),yi[xi+1]=Ii}return new ss(yi)}const pi=ai.get("text-variable-anchor");if(pi){let di;di=ti._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[ai.get("text-radial-offset").evaluate(ze,{},ii)*Jn,ud]:ai.get("text-offset").evaluate(ze,{},ii).map(xi=>xi*Jn);const yi=[];for(const xi of pi)yi.push(xi,$f(xi,di));return new ss(yi)}return null}function hd(ti){switch(ti){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function N_(ti,ze,ii,oi,ai,ui,pi,di,yi,xi,wi){let Ii=ui.textMaxSize.evaluate(ze,{});Ii===void 0&&(Ii=pi);const Pi=ti.layers[0].layout,Ri=Pi.get("icon-offset").evaluate(ze,{},wi),Li=Yf(ii.horizontal),Fi=pi/24,qi=ti.tilePixelRatio*Fi,Zi=ti.tilePixelRatio*Ii/24,Gr=ti.tilePixelRatio*di,Yi=ti.tilePixelRatio*Pi.get("symbol-spacing"),Yr=Pi.get("text-padding")*ti.tilePixelRatio,Jr=function(uo,ko,zo,$o=1){const vn=uo.get("icon-padding").evaluate(ko,{},zo),Sn=vn&&vn.values;return[Sn[0]*$o,Sn[1]*$o,Sn[2]*$o,Sn[3]*$o]}(Pi,ze,wi,ti.tilePixelRatio),ao=Pi.get("text-max-angle")/180*Math.PI,So=Pi.get("text-rotation-alignment")!=="viewport"&&Pi.get("symbol-placement")!=="point",Po=Pi.get("icon-rotation-alignment")==="map"&&Pi.get("symbol-placement")!=="point",bo=Pi.get("symbol-placement"),vo=Yi/2,mo=Pi.get("icon-text-fit");let To;oi&&mo!=="none"&&(ti.allowVerticalPlacement&&ii.vertical&&(To=_f(oi,ii.vertical,mo,Pi.get("icon-text-fit-padding"),Ri,Fi)),Li&&(oi=_f(oi,Li,mo,Pi.get("icon-text-fit-padding"),Ri,Fi)));const yo=(uo,ko)=>{ko.x<0||ko.x>=Hn||ko.y<0||ko.y>=Hn||function(zo,$o,vn,Sn,Qn,ds,Va,Yn,fa,va,ja,qa,ea,ta,Aa,Ga,Pa,es,ts,ia,Xo,Ca,ba,ra,Rs){const $s=zo.addToLineVertexArray($o,vn);let Zs,Sl,Ms,gs,is=0,El=0,ah=0,Jf=0,xd=-1,vd=-1;const Tl={};let Qf=xl("");if(zo.allowVerticalPlacement&&Sn.vertical){const za=Yn.layout.get("text-rotate").evaluate(Xo,{},ra)+90;Ms=new hp(fa,$o,va,ja,qa,Sn.vertical,ea,ta,Aa,za),Va&&(gs=new hp(fa,$o,va,ja,qa,Va,Pa,es,Aa,za))}if(Qn){const za=Yn.layout.get("icon-rotate").evaluate(Xo,{}),xs=Yn.layout.get("icon-text-fit")!=="none",dc=qf(Qn,za,ba,xs),Ys=Va?qf(Va,za,ba,xs):void 0;Sl=new hp(fa,$o,va,ja,qa,Qn,Pa,es,!1,za),is=4*dc.length;const fc=zo.iconSizeData;let nl=null;fc.kind==="source"?(nl=[ol*Yn.layout.get("icon-size").evaluate(Xo,{})],nl[0]>Gl&&On(`${zo.layerIds[0]}: Value for "icon-size" is >= ${ih}. Reduce your "icon-size".`)):fc.kind==="composite"&&(nl=[ol*Ca.compositeIconSizes[0].evaluate(Xo,{},ra),ol*Ca.compositeIconSizes[1].evaluate(Xo,{},ra)],(nl[0]>Gl||nl[1]>Gl)&&On(`${zo.layerIds[0]}: Value for "icon-size" is >= ${ih}. Reduce your "icon-size".`)),zo.addSymbols(zo.icon,dc,nl,ia,ts,Xo,li.ai.none,$o,$s.lineStartIndex,$s.lineLength,-1,ra),xd=zo.icon.placedSymbolArray.length-1,Ys&&(El=4*Ys.length,zo.addSymbols(zo.icon,Ys,nl,ia,ts,Xo,li.ai.vertical,$o,$s.lineStartIndex,$s.lineLength,-1,ra),vd=zo.icon.placedSymbolArray.length-1)}const em=Object.keys(Sn.horizontal);for(const za of em){const xs=Sn.horizontal[za];if(!Zs){Qf=xl(xs.text);const Ys=Yn.layout.get("text-rotate").evaluate(Xo,{},ra);Zs=new hp(fa,$o,va,ja,qa,xs,ea,ta,Aa,Ys)}const dc=xs.positionedLines.length===1;if(ah+=Hf(zo,$o,xs,ds,Yn,Aa,Xo,Ga,$s,Sn.vertical?li.ai.horizontal:li.ai.horizontalOnly,dc?em:[za],Tl,xd,Ca,ra),dc)break}Sn.vertical&&(Jf+=Hf(zo,$o,Sn.vertical,ds,Yn,Aa,Xo,Ga,$s,li.ai.vertical,["vertical"],Tl,vd,Ca,ra));const j_=Zs?Zs.boxStartIndex:zo.collisionBoxArray.length,q_=Zs?Zs.boxEndIndex:zo.collisionBoxArray.length,G_=Ms?Ms.boxStartIndex:zo.collisionBoxArray.length,$_=Ms?Ms.boxEndIndex:zo.collisionBoxArray.length,Z_=Sl?Sl.boxStartIndex:zo.collisionBoxArray.length,H_=Sl?Sl.boxEndIndex:zo.collisionBoxArray.length,Y_=gs?gs.boxStartIndex:zo.collisionBoxArray.length,X_=gs?gs.boxEndIndex:zo.collisionBoxArray.length;let Hs=-1;const dp=(za,xs)=>za&&za.circleDiameter?Math.max(za.circleDiameter,xs):xs;Hs=dp(Zs,Hs),Hs=dp(Ms,Hs),Hs=dp(Sl,Hs),Hs=dp(gs,Hs);const tm=Hs>-1?1:0;tm&&(Hs*=Rs/Jn),zo.glyphOffsetArray.length>=Jc.MAX_GLYPHS&&On("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xo.sortKey!==void 0&&zo.addToSortKeyRanges(zo.symbolInstances.length,Xo.sortKey);const W_=Zf(Yn,Xo,ra),[K_,J_]=function(za,xs){const dc=za.length,Ys=xs==null?void 0:xs.values;if((Ys==null?void 0:Ys.length)>0)for(let fc=0;fc<Ys.length;fc+=2){const nl=Ys[fc+1];za.emplaceBack(li.aq[Ys[fc]],nl[0],nl[1])}return[dc,za.length]}(zo.textAnchorOffsets,W_);zo.symbolInstances.emplaceBack($o.x,$o.y,Tl.right>=0?Tl.right:-1,Tl.center>=0?Tl.center:-1,Tl.left>=0?Tl.left:-1,Tl.vertical||-1,xd,vd,Qf,j_,q_,G_,$_,Z_,H_,Y_,X_,va,ah,Jf,is,El,tm,0,ea,Hs,K_,J_)}(ti,ko,uo,ii,oi,ai,To,ti.layers[0],ti.collisionBoxArray,ze.index,ze.sourceLayerIndex,ti.index,qi,[Yr,Yr,Yr,Yr],So,yi,Gr,Jr,Po,Ri,ze,ui,xi,wi,pi)};if(bo==="line")for(const uo of Ff(ze.geometry,0,0,Hn,Hn)){const ko=O_(uo,Yi,ao,ii.vertical||Li,oi,24,Zi,ti.overscaling,Hn);for(const zo of ko)Li&&U_(ti,Li.text,vo,zo)||yo(uo,zo)}else if(bo==="line-center"){for(const uo of ze.geometry)if(uo.length>1){const ko=L_(uo,ao,ii.vertical||Li,oi,24,Zi);ko&&yo(uo,ko)}}else if(ze.type==="Polygon")for(const uo of qp(ze.geometry,0)){const ko=F_(uo,16);yo(uo[0],new Zl(ko.x,ko.y,0))}else if(ze.type==="LineString")for(const uo of ze.geometry)yo(uo,new Zl(uo[0].x,uo[0].y,0));else if(ze.type==="Point")for(const uo of ze.geometry)for(const ko of uo)yo([ko],new Zl(ko.x,ko.y,0))}function Hf(ti,ze,ii,oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri,Li){const Fi=function(Gr,Yi,Yr,Jr,ao,So,Po,bo){const vo=Jr.layout.get("text-rotate").evaluate(So,{})*Math.PI/180,mo=[];for(const To of Yi.positionedLines)for(const yo of To.positionedGlyphs){if(!yo.rect)continue;const uo=yo.rect||{};let ko=cf+1,zo=!0,$o=1,vn=0;const Sn=(ao||bo)&&yo.vertical,Qn=yo.metrics.advance*yo.scale/2;if(bo&&Yi.verticalizable&&(vn=To.lineOffset/2-(yo.imageName?-(Jn-yo.metrics.width*yo.scale)/2:(yo.scale-1)*Jn)),yo.imageName){const ia=Po[yo.imageName];zo=ia.sdf,$o=ia.pixelRatio,ko=Qa/$o}const ds=ao?[yo.x+Qn,yo.y]:[0,0];let Va=ao?[0,0]:[yo.x+Qn+Yr[0],yo.y+Yr[1]-vn],Yn=[0,0];Sn&&(Yn=Va,Va=[0,0]);const fa=yo.metrics.isDoubleResolution?2:1,va=(yo.metrics.left-ko)*yo.scale-Qn+Va[0],ja=(-yo.metrics.top-ko)*yo.scale+Va[1],qa=va+uo.w/fa*yo.scale/$o,ea=ja+uo.h/fa*yo.scale/$o,ta=new fo(va,ja),Aa=new fo(qa,ja),Ga=new fo(va,ea),Pa=new fo(qa,ea);if(Sn){const ia=new fo(-Qn,Qn-eh),Xo=-Math.PI/2,Ca=Jn/2-Qn,ba=new fo(5-eh-Ca,-(yo.imageName?Ca:0)),ra=new fo(...Yn);ta._rotateAround(Xo,ia)._add(ba)._add(ra),Aa._rotateAround(Xo,ia)._add(ba)._add(ra),Ga._rotateAround(Xo,ia)._add(ba)._add(ra),Pa._rotateAround(Xo,ia)._add(ba)._add(ra)}if(vo){const ia=Math.sin(vo),Xo=Math.cos(vo),Ca=[Xo,-ia,ia,Xo];ta._matMult(Ca),Aa._matMult(Ca),Ga._matMult(Ca),Pa._matMult(Ca)}const es=new fo(0,0),ts=new fo(0,0);mo.push({tl:ta,tr:Aa,bl:Ga,br:Pa,tex:uo,writingMode:Yi.writingMode,glyphOffset:ds,sectionIndex:yo.sectionIndex,isSDF:zo,pixelOffsetTL:es,pixelOffsetBR:ts,minFontScaleX:0,minFontScaleY:0})}return mo}(0,ii,di,ai,ui,pi,oi,ti.allowVerticalPlacement),qi=ti.textSizeData;let Zi=null;qi.kind==="source"?(Zi=[ol*ai.layout.get("text-size").evaluate(pi,{})],Zi[0]>Gl&&On(`${ti.layerIds[0]}: Value for "text-size" is >= ${ih}. Reduce your "text-size".`)):qi.kind==="composite"&&(Zi=[ol*Ri.compositeTextSizes[0].evaluate(pi,{},Li),ol*Ri.compositeTextSizes[1].evaluate(pi,{},Li)],(Zi[0]>Gl||Zi[1]>Gl)&&On(`${ti.layerIds[0]}: Value for "text-size" is >= ${ih}. Reduce your "text-size".`)),ti.addSymbols(ti.text,Fi,Zi,di,ui,pi,xi,ze,yi.lineStartIndex,yi.lineLength,Pi,Li);for(const Gr of wi)Ii[Gr]=ti.text.placedSymbolArray.length-1;return 4*Fi.length}function Yf(ti){for(const ze in ti)return ti[ze];return null}function U_(ti,ze,ii,oi){const ai=ti.compareText;if(ze in ai){const ui=ai[ze];for(let pi=ui.length-1;pi>=0;pi--)if(oi.dist(ui[pi])<ii)return!0}else ai[ze]=[];return ai[ze].push(oi),!1}const Xf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pd{static from(ze){if(!(ze instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[ii,oi]=new Uint8Array(ze,0,2);if(ii!==219)throw new Error("Data does not appear to be in a KDBush format.");const ai=oi>>4;if(ai!==1)throw new Error(`Got v${ai} data when expected v1.`);const ui=Xf[15&oi];if(!ui)throw new Error("Unrecognized array type.");const[pi]=new Uint16Array(ze,2,1),[di]=new Uint32Array(ze,4,1);return new pd(di,pi,ui,ze)}constructor(ze,ii=64,oi=Float64Array,ai){if(isNaN(ze)||ze<0)throw new Error(`Unpexpected numItems value: ${ze}.`);this.numItems=+ze,this.nodeSize=Math.min(Math.max(+ii,2),65535),this.ArrayType=oi,this.IndexArrayType=ze<65536?Uint16Array:Uint32Array;const ui=Xf.indexOf(this.ArrayType),pi=2*ze*this.ArrayType.BYTES_PER_ELEMENT,di=ze*this.IndexArrayType.BYTES_PER_ELEMENT,yi=(8-di%8)%8;if(ui<0)throw new Error(`Unexpected typed array class: ${oi}.`);ai&&ai instanceof ArrayBuffer?(this.data=ai,this.ids=new this.IndexArrayType(this.data,8,ze),this.coords=new this.ArrayType(this.data,8+di+yi,2*ze),this._pos=2*ze,this._finished=!0):(this.data=new ArrayBuffer(8+pi+di+yi),this.ids=new this.IndexArrayType(this.data,8,ze),this.coords=new this.ArrayType(this.data,8+di+yi,2*ze),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+ui]),new Uint16Array(this.data,2,1)[0]=ii,new Uint32Array(this.data,4,1)[0]=ze)}add(ze,ii){const oi=this._pos>>1;return this.ids[oi]=oi,this.coords[this._pos++]=ze,this.coords[this._pos++]=ii,oi}finish(){const ze=this._pos>>1;if(ze!==this.numItems)throw new Error(`Added ${ze} items when expected ${this.numItems}.`);return dd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(ze,ii,oi,ai){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:ui,coords:pi,nodeSize:di}=this,yi=[0,ui.length-1,0],xi=[];for(;yi.length;){const wi=yi.pop()||0,Ii=yi.pop()||0,Pi=yi.pop()||0;if(Ii-Pi<=di){for(let qi=Pi;qi<=Ii;qi++){const Zi=pi[2*qi],Gr=pi[2*qi+1];Zi>=ze&&Zi<=oi&&Gr>=ii&&Gr<=ai&&xi.push(ui[qi])}continue}const Ri=Pi+Ii>>1,Li=pi[2*Ri],Fi=pi[2*Ri+1];Li>=ze&&Li<=oi&&Fi>=ii&&Fi<=ai&&xi.push(ui[Ri]),(wi===0?ze<=Li:ii<=Fi)&&(yi.push(Pi),yi.push(Ri-1),yi.push(1-wi)),(wi===0?oi>=Li:ai>=Fi)&&(yi.push(Ri+1),yi.push(Ii),yi.push(1-wi))}return xi}within(ze,ii,oi){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:ai,coords:ui,nodeSize:pi}=this,di=[0,ai.length-1,0],yi=[],xi=oi*oi;for(;di.length;){const wi=di.pop()||0,Ii=di.pop()||0,Pi=di.pop()||0;if(Ii-Pi<=pi){for(let qi=Pi;qi<=Ii;qi++)Kf(ui[2*qi],ui[2*qi+1],ze,ii)<=xi&&yi.push(ai[qi]);continue}const Ri=Pi+Ii>>1,Li=ui[2*Ri],Fi=ui[2*Ri+1];Kf(Li,Fi,ze,ii)<=xi&&yi.push(ai[Ri]),(wi===0?ze-oi<=Li:ii-oi<=Fi)&&(di.push(Pi),di.push(Ri-1),di.push(1-wi)),(wi===0?ze+oi>=Li:ii+oi>=Fi)&&(di.push(Ri+1),di.push(Ii),di.push(1-wi))}return yi}}function dd(ti,ze,ii,oi,ai,ui){if(ai-oi<=ii)return;const pi=oi+ai>>1;Wf(ti,ze,pi,oi,ai,ui),dd(ti,ze,ii,oi,pi-1,1-ui),dd(ti,ze,ii,pi+1,ai,1-ui)}function Wf(ti,ze,ii,oi,ai,ui){for(;ai>oi;){if(ai-oi>600){const xi=ai-oi+1,wi=ii-oi+1,Ii=Math.log(xi),Pi=.5*Math.exp(2*Ii/3),Ri=.5*Math.sqrt(Ii*Pi*(xi-Pi)/xi)*(wi-xi/2<0?-1:1);Wf(ti,ze,ii,Math.max(oi,Math.floor(ii-wi*Pi/xi+Ri)),Math.min(ai,Math.floor(ii+(xi-wi)*Pi/xi+Ri)),ui)}const pi=ze[2*ii+ui];let di=oi,yi=ai;for(oh(ti,ze,oi,ii),ze[2*ai+ui]>pi&&oh(ti,ze,oi,ai);di<yi;){for(oh(ti,ze,di,yi),di++,yi--;ze[2*di+ui]<pi;)di++;for(;ze[2*yi+ui]>pi;)yi--}ze[2*oi+ui]===pi?oh(ti,ze,oi,yi):(yi++,oh(ti,ze,yi,ai)),yi<=ii&&(oi=yi+1),ii<=yi&&(ai=yi-1)}}function oh(ti,ze,ii,oi){fd(ti,ii,oi),fd(ze,2*ii,2*oi),fd(ze,2*ii+1,2*oi+1)}function fd(ti,ze,ii){const oi=ti[ze];ti[ze]=ti[ii],ti[ii]=oi}function Kf(ti,ze,ii,oi){const ai=ti-ii,ui=ze-oi;return ai*ai+ui*ui}var md;li.bh=void 0,(md=li.bh||(li.bh={})).create="create",md.load="load",md.fullLoad="fullLoad";let pp=null,nh=[];const _d=1e3/60,yd="loadTime",gd="fullLoadTime",V_={mark(ti){performance.mark(ti)},frame(ti){const ze=ti;pp!=null&&nh.push(ze-pp),pp=ze},clearMetrics(){pp=null,nh=[],performance.clearMeasures(yd),performance.clearMeasures(gd);for(const ti in li.bh)performance.clearMarks(li.bh[ti])},getPerformanceMetrics(){performance.measure(yd,li.bh.create,li.bh.load),performance.measure(gd,li.bh.create,li.bh.fullLoad);const ti=performance.getEntriesByName(yd)[0].duration,ze=performance.getEntriesByName(gd)[0].duration,ii=nh.length,oi=1/(nh.reduce((ui,pi)=>ui+pi,0)/ii/1e3),ai=nh.filter(ui=>ui>_d).reduce((ui,pi)=>ui+(pi-_d)/_d,0);return{loadTime:ti,fullLoadTime:ze,fps:oi,percentDroppedFrames:ai/(ii+ai)*100,totalFrames:ii}}};li.$=function(ti,ze,ii){var oi,ai,ui,pi,di,yi,xi,wi,Ii,Pi,Ri,Li,Fi=ii[0],qi=ii[1],Zi=ii[2];return ze===ti?(ti[12]=ze[0]*Fi+ze[4]*qi+ze[8]*Zi+ze[12],ti[13]=ze[1]*Fi+ze[5]*qi+ze[9]*Zi+ze[13],ti[14]=ze[2]*Fi+ze[6]*qi+ze[10]*Zi+ze[14],ti[15]=ze[3]*Fi+ze[7]*qi+ze[11]*Zi+ze[15]):(ai=ze[1],ui=ze[2],pi=ze[3],di=ze[4],yi=ze[5],xi=ze[6],wi=ze[7],Ii=ze[8],Pi=ze[9],Ri=ze[10],Li=ze[11],ti[0]=oi=ze[0],ti[1]=ai,ti[2]=ui,ti[3]=pi,ti[4]=di,ti[5]=yi,ti[6]=xi,ti[7]=wi,ti[8]=Ii,ti[9]=Pi,ti[10]=Ri,ti[11]=Li,ti[12]=oi*Fi+di*qi+Ii*Zi+ze[12],ti[13]=ai*Fi+yi*qi+Pi*Zi+ze[13],ti[14]=ui*Fi+xi*qi+Ri*Zi+ze[14],ti[15]=pi*Fi+wi*qi+Li*Zi+ze[15]),ti},li.A=Zc,li.B=Ya,li.C=class{constructor(ti,ze,ii){this.receive=oi=>{const ai=oi.data,ui=ai.id;if(ui&&(!ai.targetMapId||this.mapId===ai.targetMapId))if(ai.type==="<cancel>"){delete this.tasks[ui];const pi=this.cancelCallbacks[ui];delete this.cancelCallbacks[ui],pi&&pi()}else Gn()||ai.mustQueue?(this.tasks[ui]=ai,this.taskQueue.push(ui),this.invoker.trigger()):this.processTask(ui,ai)},this.process=()=>{if(!this.taskQueue.length)return;const oi=this.taskQueue.shift(),ai=this.tasks[oi];delete this.tasks[oi],this.taskQueue.length&&this.invoker.trigger(),ai&&this.processTask(oi,ai)},this.target=ti,this.parent=ze,this.mapId=ii,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new R_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Gn()?ti:window}send(ti,ze,ii,oi,ai=!1){const ui=Math.round(1e18*Math.random()).toString(36).substring(0,10);ii&&(this.callbacks[ui]=ii);const pi=[],di={id:ui,type:ti,hasCallback:!!ii,targetMapId:oi,mustQueue:ai,sourceMapId:this.mapId,data:tl(ze,pi)};return this.target.postMessage(di,{transfer:pi}),{cancel:()=>{ii&&delete this.callbacks[ui],this.target.postMessage({id:ui,type:"<cancel>",targetMapId:oi,sourceMapId:this.mapId})}}}processTask(ti,ze){if(ze.type==="<response>"){const ii=this.callbacks[ti];delete this.callbacks[ti],ii&&(ze.error?ii(Bl(ze.error)):ii(null,Bl(ze.data)))}else{let ii=!1;const oi=[],ai=ze.hasCallback?(di,yi)=>{ii=!0,delete this.cancelCallbacks[ti];const xi={id:ti,type:"<response>",sourceMapId:this.mapId,error:di?tl(di):null,data:tl(yi,oi)};this.target.postMessage(xi,{transfer:oi})}:di=>{ii=!0};let ui=null;const pi=Bl(ze.data);if(this.parent[ze.type])ui=this.parent[ze.type](ze.sourceMapId,pi,ai);else if("getWorkerSource"in this.parent){const di=ze.type.split(".");ui=this.parent.getWorkerSource(ze.sourceMapId,di[0],pi.source)[di[1]](pi,ai)}else ai(new Error(`Could not find function ${ze.type}`));!ii&&ui&&ui.cancel&&(this.cancelCallbacks[ti]=ui.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},li.D=Mo,li.E=ka,li.F=function(ti,ze){const ii={};for(let oi=0;oi<ze.length;oi++){const ai=ze[oi];ai in ti&&(ii[ai]=ti[ai])}return ii},li.G=Tf,li.H=If,li.I=Qp,li.J=fs,li.K=sa,li.L=$l,li.M=rs,li.N=Hn,li.O=ys,li.P=fo,li.Q=An,li.R=_s,li.S=xn,li.T=Vh,li.U=sp,li.V=class extends yl{},li.W=cd,li.X=function(ti,ze){const ii=window.document.createElement("video");ii.muted=!0,ii.onloadstart=function(){ze(null,ii)};for(let oi=0;oi<ti.length;oi++){const ai=window.document.createElement("source");Oa(ti[oi])||(ii.crossOrigin="Anonymous"),ai.src=ti[oi],ii.appendChild(ai)}return{cancel:()=>{}}},li.Y=_o,li.Z=function(){var ti=new Zc(16);return Zc!=Float32Array&&(ti[1]=0,ti[2]=0,ti[3]=0,ti[4]=0,ti[6]=0,ti[7]=0,ti[8]=0,ti[9]=0,ti[11]=0,ti[12]=0,ti[13]=0,ti[14]=0),ti[0]=1,ti[5]=1,ti[10]=1,ti[15]=1,ti},li._=po,li.a=al,li.a$=class extends zi{},li.a0=function(ti,ze,ii){var oi=ii[0],ai=ii[1],ui=ii[2];return ti[0]=ze[0]*oi,ti[1]=ze[1]*oi,ti[2]=ze[2]*oi,ti[3]=ze[3]*oi,ti[4]=ze[4]*ai,ti[5]=ze[5]*ai,ti[6]=ze[6]*ai,ti[7]=ze[7]*ai,ti[8]=ze[8]*ui,ti[9]=ze[9]*ui,ti[10]=ze[10]*ui,ti[11]=ze[11]*ui,ti[12]=ze[12],ti[13]=ze[13],ti[14]=ze[14],ti[15]=ze[15],ti},li.a1=Cd,li.a2=function(){return vs++},li.a3=Vi,li.a4=Jc,li.a5=function(){Ka.isLoading()||Ka.isLoaded()||Lu()!=="deferred"||Uh()},li.a6=wu,li.a7=hc,li.a8=gn,li.a9=Lf,li.aA=nc,li.aB=function(ti){ti=ti.slice();const ze=Object.create(null);for(let ii=0;ii<ti.length;ii++)ze[ti[ii].id]=ti[ii];for(let ii=0;ii<ti.length;ii++)"ref"in ti[ii]&&(ti[ii]=ns(ti[ii],ze[ti[ii].ref]));return ti},li.aC=function(ti){if(ti.type==="custom")return new z_(ti);switch(ti.type){case"background":return new A_(ti);case"circle":return new pm(ti);case"fill":return new Mm(ti);case"fill-extrusion":return new Hm(ti);case"heatmap":return new fm(ti);case"hillshade":return new _m(ti);case"line":return new t_(ti);case"raster":return new C_(ti);case"symbol":return new ap(ti)}},li.aD=Pn,li.aE=function(ti,ze){if(!ti)return[{command:tn.setStyle,args:[ze]}];let ii=[];try{if(!mn(ti.version,ze.version))return[{command:tn.setStyle,args:[ze]}];mn(ti.center,ze.center)||ii.push({command:tn.setCenter,args:[ze.center]}),mn(ti.zoom,ze.zoom)||ii.push({command:tn.setZoom,args:[ze.zoom]}),mn(ti.bearing,ze.bearing)||ii.push({command:tn.setBearing,args:[ze.bearing]}),mn(ti.pitch,ze.pitch)||ii.push({command:tn.setPitch,args:[ze.pitch]}),mn(ti.sprite,ze.sprite)||ii.push({command:tn.setSprite,args:[ze.sprite]}),mn(ti.glyphs,ze.glyphs)||ii.push({command:tn.setGlyphs,args:[ze.glyphs]}),mn(ti.transition,ze.transition)||ii.push({command:tn.setTransition,args:[ze.transition]}),mn(ti.light,ze.light)||ii.push({command:tn.setLight,args:[ze.light]});const oi={},ai=[];(function(pi,di,yi,xi){let wi;for(wi in di=di||{},pi=pi||{})Object.prototype.hasOwnProperty.call(pi,wi)&&(Object.prototype.hasOwnProperty.call(di,wi)||Il(wi,yi,xi));for(wi in di)Object.prototype.hasOwnProperty.call(di,wi)&&(Object.prototype.hasOwnProperty.call(pi,wi)?mn(pi[wi],di[wi])||(pi[wi].type==="geojson"&&di[wi].type==="geojson"&&mc(pi,di,wi)?yi.push({command:tn.setGeoJSONSourceData,args:[wi,di[wi].data]}):Ds(wi,di,yi,xi)):ws(wi,di,yi))})(ti.sources,ze.sources,ai,oi);const ui=[];ti.layers&&ti.layers.forEach(pi=>{oi[pi.source]?ii.push({command:tn.removeLayer,args:[pi.id]}):ui.push(pi)}),ii=ii.concat(ai),function(pi,di,yi){di=di||[];const xi=(pi=pi||[]).map(Ws),wi=di.map(Ws),Ii=pi.reduce(ll,{}),Pi=di.reduce(ll,{}),Ri=xi.slice(),Li=Object.create(null);let Fi,qi,Zi,Gr,Yi,Yr,Jr;for(Fi=0,qi=0;Fi<xi.length;Fi++)Zi=xi[Fi],Object.prototype.hasOwnProperty.call(Pi,Zi)?qi++:(yi.push({command:tn.removeLayer,args:[Zi]}),Ri.splice(Ri.indexOf(Zi,qi),1));for(Fi=0,qi=0;Fi<wi.length;Fi++)Zi=wi[wi.length-1-Fi],Ri[Ri.length-1-Fi]!==Zi&&(Object.prototype.hasOwnProperty.call(Ii,Zi)?(yi.push({command:tn.removeLayer,args:[Zi]}),Ri.splice(Ri.lastIndexOf(Zi,Ri.length-qi),1)):qi++,Yr=Ri[Ri.length-Fi],yi.push({command:tn.addLayer,args:[Pi[Zi],Yr]}),Ri.splice(Ri.length-Fi,0,Zi),Li[Zi]=!0);for(Fi=0;Fi<wi.length;Fi++)if(Zi=wi[Fi],Gr=Ii[Zi],Yi=Pi[Zi],!Li[Zi]&&!mn(Gr,Yi))if(mn(Gr.source,Yi.source)&&mn(Gr["source-layer"],Yi["source-layer"])&&mn(Gr.type,Yi.type)){for(Jr in Al(Gr.layout,Yi.layout,yi,Zi,null,tn.setLayoutProperty),Al(Gr.paint,Yi.paint,yi,Zi,null,tn.setPaintProperty),mn(Gr.filter,Yi.filter)||yi.push({command:tn.setFilter,args:[Zi,Yi.filter]}),mn(Gr.minzoom,Yi.minzoom)&&mn(Gr.maxzoom,Yi.maxzoom)||yi.push({command:tn.setLayerZoomRange,args:[Zi,Yi.minzoom,Yi.maxzoom]}),Gr)Object.prototype.hasOwnProperty.call(Gr,Jr)&&Jr!=="layout"&&Jr!=="paint"&&Jr!=="filter"&&Jr!=="metadata"&&Jr!=="minzoom"&&Jr!=="maxzoom"&&(Jr.indexOf("paint.")===0?Al(Gr[Jr],Yi[Jr],yi,Zi,Jr.slice(6),tn.setPaintProperty):mn(Gr[Jr],Yi[Jr])||yi.push({command:tn.setLayerProperty,args:[Zi,Jr,Yi[Jr]]}));for(Jr in Yi)Object.prototype.hasOwnProperty.call(Yi,Jr)&&!Object.prototype.hasOwnProperty.call(Gr,Jr)&&Jr!=="layout"&&Jr!=="paint"&&Jr!=="filter"&&Jr!=="metadata"&&Jr!=="minzoom"&&Jr!=="maxzoom"&&(Jr.indexOf("paint.")===0?Al(Gr[Jr],Yi[Jr],yi,Zi,Jr.slice(6),tn.setPaintProperty):mn(Gr[Jr],Yi[Jr])||yi.push({command:tn.setLayerProperty,args:[Zi,Jr,Yi[Jr]]}))}else yi.push({command:tn.removeLayer,args:[Zi]}),Yr=Ri[Ri.lastIndexOf(Zi)+1],yi.push({command:tn.addLayer,args:[Yi,Yr]})}(ui,ze.layers,ii)}catch(oi){console.warn("Unable to compute style diff:",oi),ii=[{command:tn.setStyle,args:[ze]}]}return ii},li.aF=function(ti){const ze=[],ii=ti.id;return ii===void 0&&ze.push({message:`layers.${ii}: missing required property "id"`}),ti.render===void 0&&ze.push({message:`layers.${ii}: missing required method "render"`}),ti.renderingMode&&ti.renderingMode!=="2d"&&ti.renderingMode!=="3d"&&ze.push({message:`layers.${ii}: property "renderingMode" must be either "2d" or "3d"`}),ze},li.aG=function ti(ze,ii){if(Array.isArray(ze)){if(!Array.isArray(ii)||ze.length!==ii.length)return!1;for(let oi=0;oi<ze.length;oi++)if(!ti(ze[oi],ii[oi]))return!1;return!0}if(typeof ze=="object"&&ze!==null&&ii!==null){if(typeof ii!="object"||Object.keys(ze).length!==Object.keys(ii).length)return!1;for(const oi in ze)if(!ti(ze[oi],ii[oi]))return!1;return!0}return ze===ii},li.aH=Wo,li.aI=fn,li.aJ=ac,li.aK=function(ti){return ti({pluginStatus:Ba,pluginURL:il}),ac.on("pluginStateChange",ti),ti},li.aL=class extends vl{constructor(ti,ze){super(ti,ze),this.current=0}set(ti){this.current!==ti&&(this.current=ti,this.gl.uniform1i(this.location,ti))}},li.aM=Gc,li.aN=class extends vl{constructor(ti,ze){super(ti,ze),this.current=Rp}set(ti){if(ti[12]!==this.current[12]||ti[0]!==this.current[0])return this.current=ti,void this.gl.uniformMatrix4fv(this.location,!1,ti);for(let ze=1;ze<16;ze++)if(ti[ze]!==this.current[ze]){this.current=ti,this.gl.uniformMatrix4fv(this.location,!1,ti);break}}},li.aO=$h,li.aP=class extends vl{constructor(ti,ze){super(ti,ze),this.current=[0,0,0]}set(ti){ti[0]===this.current[0]&&ti[1]===this.current[1]&&ti[2]===this.current[2]||(this.current=ti,this.gl.uniform3f(this.location,ti[0],ti[1],ti[2]))}},li.aQ=class extends vl{constructor(ti,ze){super(ti,ze),this.current=[0,0]}set(ti){ti[0]===this.current[0]&&ti[1]===this.current[1]||(this.current=ti,this.gl.uniform2f(this.location,ti[0],ti[1]))}},li.aR=Zh,li.aS=function(ti,ze,ii,oi,ai,ui,pi){var di=1/(ze-ii),yi=1/(oi-ai),xi=1/(ui-pi);return ti[0]=-2*di,ti[1]=0,ti[2]=0,ti[3]=0,ti[4]=0,ti[5]=-2*yi,ti[6]=0,ti[7]=0,ti[8]=0,ti[9]=0,ti[10]=2*xi,ti[11]=0,ti[12]=(ze+ii)*di,ti[13]=(ai+oi)*yi,ti[14]=(pi+ui)*xi,ti[15]=1,ti},li.aT=cn,li.aU=hm,li.aV=class extends ni{},li.aW=n_,li.aX=class extends hi{},li.aY=function(ti){return ti<=1?1:Math.pow(2,Math.ceil(Math.log(ti)/Math.LN2))},li.aZ=Od,li.a_=ho,li.aa=function(ti){const ze={};if(ti.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(ii,oi,ai,ui)=>{const pi=ai||ui;return ze[oi]=!pi||pi.toLowerCase(),""}),ze["max-age"]){const ii=parseInt(ze["max-age"],10);isNaN(ii)?delete ze["max-age"]:ze["max-age"]=ii}return ze},li.ab=function(ti,ze){const ii=[];for(const oi in ti)oi in ze||ii.push(oi);return ii},li.ac=function(ti){if(ca==null){const ze=ti.navigator?ti.navigator.userAgent:null;ca=!!ti.safari||!(!ze||!(/\b(iPad|iPhone|iPod)\b/.test(ze)||ze.match("Safari")&&!ze.match("Chrome")))}return ca},li.ad=Za,li.ae=function(ti,ze,ii){var oi=Math.sin(ii),ai=Math.cos(ii),ui=ze[0],pi=ze[1],di=ze[2],yi=ze[3],xi=ze[4],wi=ze[5],Ii=ze[6],Pi=ze[7];return ze!==ti&&(ti[8]=ze[8],ti[9]=ze[9],ti[10]=ze[10],ti[11]=ze[11],ti[12]=ze[12],ti[13]=ze[13],ti[14]=ze[14],ti[15]=ze[15]),ti[0]=ui*ai+xi*oi,ti[1]=pi*ai+wi*oi,ti[2]=di*ai+Ii*oi,ti[3]=yi*ai+Pi*oi,ti[4]=xi*ai-ui*oi,ti[5]=wi*ai-pi*oi,ti[6]=Ii*ai-di*oi,ti[7]=Pi*ai-yi*oi,ti},li.af=function(ti){var ze=new Zc(16);return ze[0]=ti[0],ze[1]=ti[1],ze[2]=ti[2],ze[3]=ti[3],ze[4]=ti[4],ze[5]=ti[5],ze[6]=ti[6],ze[7]=ti[7],ze[8]=ti[8],ze[9]=ti[9],ze[10]=ti[10],ze[11]=ti[11],ze[12]=ti[12],ze[13]=ti[13],ze[14]=ti[14],ze[15]=ti[15],ze},li.ag=Wh,li.ah=function(ti,ze){let ii=0,oi=0;if(ti.kind==="constant")oi=ti.layoutSize;else if(ti.kind!=="source"){const{interpolationType:ai,minZoom:ui,maxZoom:pi}=ti,di=ai?Za(Xa.interpolationFactor(ai,ze,ui,pi),0,1):0;ti.kind==="camera"?oi=Ya.number(ti.minSize,ti.maxSize,di):ii=di}return{uSizeT:ii,uSize:oi}},li.aj=function(ti,{uSize:ze,uSizeT:ii},{lowerSize:oi,upperSize:ai}){return ti.kind==="source"?oi/ol:ti.kind==="composite"?Ya.number(oi/ol,ai/ol,ii):ze},li.ak=rd,li.al=function(ti,ze,ii,oi){const ai=ze.y-ti.y,ui=ze.x-ti.x,pi=oi.y-ii.y,di=oi.x-ii.x,yi=pi*ui-di*ai;if(yi===0)return null;const xi=(di*(ti.y-ii.y)-pi*(ti.x-ii.x))/yi;return new fo(ti.x+xi*ui,ti.y+xi*ai)},li.am=Ff,li.an=Sd,li.ao=Dp,li.ap=Jn,li.ar=id,li.as=function(ti,ze){var ii=ze[0],oi=ze[1],ai=ze[2],ui=ze[3],pi=ze[4],di=ze[5],yi=ze[6],xi=ze[7],wi=ze[8],Ii=ze[9],Pi=ze[10],Ri=ze[11],Li=ze[12],Fi=ze[13],qi=ze[14],Zi=ze[15],Gr=ii*di-oi*pi,Yi=ii*yi-ai*pi,Yr=ii*xi-ui*pi,Jr=oi*yi-ai*di,ao=oi*xi-ui*di,So=ai*xi-ui*yi,Po=wi*Fi-Ii*Li,bo=wi*qi-Pi*Li,vo=wi*Zi-Ri*Li,mo=Ii*qi-Pi*Fi,To=Ii*Zi-Ri*Fi,yo=Pi*Zi-Ri*qi,uo=Gr*yo-Yi*To+Yr*mo+Jr*vo-ao*bo+So*Po;return uo?(ti[0]=(di*yo-yi*To+xi*mo)*(uo=1/uo),ti[1]=(ai*To-oi*yo-ui*mo)*uo,ti[2]=(Fi*So-qi*ao+Zi*Jr)*uo,ti[3]=(Pi*ao-Ii*So-Ri*Jr)*uo,ti[4]=(yi*vo-pi*yo-xi*bo)*uo,ti[5]=(ii*yo-ai*vo+ui*bo)*uo,ti[6]=(qi*Yr-Li*So-Zi*Yi)*uo,ti[7]=(wi*So-Pi*Yr+Ri*Yi)*uo,ti[8]=(pi*To-di*vo+xi*Po)*uo,ti[9]=(oi*vo-ii*To-ui*Po)*uo,ti[10]=(Li*ao-Fi*Yr+Zi*Gr)*uo,ti[11]=(Ii*Yr-wi*ao-Ri*Gr)*uo,ti[12]=(di*bo-pi*mo-yi*Po)*uo,ti[13]=(ii*mo-oi*bo+ai*Po)*uo,ti[14]=(Fi*Yi-Li*Jr-qi*Gr)*uo,ti[15]=(wi*Jr-Ii*Yi+Pi*Gr)*uo,ti):null},li.at=hd,li.au=td,li.av=pd,li.aw=function(){const ti={},ze=io.$version;for(const ii in io.$root){const oi=io.$root[ii];if(oi.required){let ai=null;ai=ii==="version"?ze:oi.type==="array"?[]:{},ai!=null&&(ti[ii]=ai)}}return ti},li.ax=tn,li.ay=Dh,li.az=Nn,li.b=function(ti,ze){const ii=new Blob([new Uint8Array(ti)],{type:"image/png"});createImageBitmap(ii).then(oi=>{ze(null,oi)}).catch(oi=>{ze(new Error(`Could not load image because of ${oi.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},li.b0=pa,li.b1=function(ti,ze){var ii=ti[0],oi=ti[1],ai=ti[2],ui=ti[3],pi=ti[4],di=ti[5],yi=ti[6],xi=ti[7],wi=ti[8],Ii=ti[9],Pi=ti[10],Ri=ti[11],Li=ti[12],Fi=ti[13],qi=ti[14],Zi=ti[15],Gr=ze[0],Yi=ze[1],Yr=ze[2],Jr=ze[3],ao=ze[4],So=ze[5],Po=ze[6],bo=ze[7],vo=ze[8],mo=ze[9],To=ze[10],yo=ze[11],uo=ze[12],ko=ze[13],zo=ze[14],$o=ze[15];return Math.abs(ii-Gr)<=Ua*Math.max(1,Math.abs(ii),Math.abs(Gr))&&Math.abs(oi-Yi)<=Ua*Math.max(1,Math.abs(oi),Math.abs(Yi))&&Math.abs(ai-Yr)<=Ua*Math.max(1,Math.abs(ai),Math.abs(Yr))&&Math.abs(ui-Jr)<=Ua*Math.max(1,Math.abs(ui),Math.abs(Jr))&&Math.abs(pi-ao)<=Ua*Math.max(1,Math.abs(pi),Math.abs(ao))&&Math.abs(di-So)<=Ua*Math.max(1,Math.abs(di),Math.abs(So))&&Math.abs(yi-Po)<=Ua*Math.max(1,Math.abs(yi),Math.abs(Po))&&Math.abs(xi-bo)<=Ua*Math.max(1,Math.abs(xi),Math.abs(bo))&&Math.abs(wi-vo)<=Ua*Math.max(1,Math.abs(wi),Math.abs(vo))&&Math.abs(Ii-mo)<=Ua*Math.max(1,Math.abs(Ii),Math.abs(mo))&&Math.abs(Pi-To)<=Ua*Math.max(1,Math.abs(Pi),Math.abs(To))&&Math.abs(Ri-yo)<=Ua*Math.max(1,Math.abs(Ri),Math.abs(yo))&&Math.abs(Li-uo)<=Ua*Math.max(1,Math.abs(Li),Math.abs(uo))&&Math.abs(Fi-ko)<=Ua*Math.max(1,Math.abs(Fi),Math.abs(ko))&&Math.abs(qi-zo)<=Ua*Math.max(1,Math.abs(qi),Math.abs(zo))&&Math.abs(Zi-$o)<=Ua*Math.max(1,Math.abs(Zi),Math.abs($o))},li.b2=function(ti,ze){return ti[0]=ze[0],ti[1]=ze[1],ti[2]=ze[2],ti[3]=ze[3],ti[4]=ze[4],ti[5]=ze[5],ti[6]=ze[6],ti[7]=ze[7],ti[8]=ze[8],ti[9]=ze[9],ti[10]=ze[10],ti[11]=ze[11],ti[12]=ze[12],ti[13]=ze[13],ti[14]=ze[14],ti[15]=ze[15],ti},li.b3=function(ti,ze,ii){return ti[0]=ze[0]*ii[0],ti[1]=ze[1]*ii[1],ti[2]=ze[2]*ii[2],ti[3]=ze[3]*ii[3],ti},li.b4=function(ti,ze){return ti[0]*ze[0]+ti[1]*ze[1]+ti[2]*ze[2]+ti[3]*ze[3]},li.b5=oa,li.b6=zf,li.b7=Af,li.b8=function(ti,ze,ii,oi,ai){var ui,pi=1/Math.tan(ze/2);return ti[0]=pi/ii,ti[1]=0,ti[2]=0,ti[3]=0,ti[4]=0,ti[5]=pi,ti[6]=0,ti[7]=0,ti[8]=0,ti[9]=0,ti[11]=-1,ti[12]=0,ti[13]=0,ti[15]=0,ai!=null&&ai!==1/0?(ti[10]=(ai+oi)*(ui=1/(oi-ai)),ti[14]=2*ai*oi*ui):(ti[10]=-1,ti[14]=-2*oi),ti},li.b9=function(ti,ze,ii){var oi=Math.sin(ii),ai=Math.cos(ii),ui=ze[4],pi=ze[5],di=ze[6],yi=ze[7],xi=ze[8],wi=ze[9],Ii=ze[10],Pi=ze[11];return ze!==ti&&(ti[0]=ze[0],ti[1]=ze[1],ti[2]=ze[2],ti[3]=ze[3],ti[12]=ze[12],ti[13]=ze[13],ti[14]=ze[14],ti[15]=ze[15]),ti[4]=ui*ai+xi*oi,ti[5]=pi*ai+wi*oi,ti[6]=di*ai+Ii*oi,ti[7]=yi*ai+Pi*oi,ti[8]=xi*ai-ui*oi,ti[9]=wi*ai-pi*oi,ti[10]=Ii*ai-di*oi,ti[11]=Pi*ai-yi*oi,ti},li.bA=Lo,li.bB=tf,li.bC=Lc,li.bD=Ka,li.ba=ma,li.bb=la,li.bc=function(ti,ze){return ti[0]=ze[0],ti[1]=0,ti[2]=0,ti[3]=0,ti[4]=0,ti[5]=ze[1],ti[6]=0,ti[7]=0,ti[8]=0,ti[9]=0,ti[10]=ze[2],ti[11]=0,ti[12]=0,ti[13]=0,ti[14]=0,ti[15]=1,ti},li.bd=class extends cc{},li.be=sd,li.bf=Pf,li.bg=V_,li.bi=os,li.bj=function(ti,ze,ii=!1){if(Ba===Pu||Ba===Cu||Ba===zu)throw new Error("setRTLTextPlugin cannot be called multiple times.");il=Ls.resolveURL(ti),Ba=Pu,Ru=ze,Mu(),ii||Uh()},li.bk=Lu,li.bl=function(ti,ze){const ii={};for(let ai=0;ai<ti.length;ai++){const ui=ze&&ze[ti[ai].id]||Fc(ti[ai]);ze&&(ze[ti[ai].id]=ui);let pi=ii[ui];pi||(pi=ii[ui]=[]),pi.push(ti[ai])}const oi=[];for(const ai in ii)oi.push(ii[ai]);return oi},li.bm=Eo,li.bn=Mf,li.bo=Of,li.bp=hf,li.bq=function(ti){ti.bucket.createArrays(),ti.bucket.tilePixelRatio=Hn/(512*ti.bucket.overscaling),ti.bucket.compareText={},ti.bucket.iconsNeedLinear=!1;const ze=ti.bucket.layers[0],ii=ze.layout,oi=ze._unevaluatedLayout._values,ai={layoutIconSize:oi["icon-size"].possiblyEvaluate(new gn(ti.bucket.zoom+1),ti.canonical),layoutTextSize:oi["text-size"].possiblyEvaluate(new gn(ti.bucket.zoom+1),ti.canonical),textMaxSize:oi["text-size"].possiblyEvaluate(new gn(18))};if(ti.bucket.textSizeData.kind==="composite"){const{minZoom:xi,maxZoom:wi}=ti.bucket.textSizeData;ai.compositeTextSizes=[oi["text-size"].possiblyEvaluate(new gn(xi),ti.canonical),oi["text-size"].possiblyEvaluate(new gn(wi),ti.canonical)]}if(ti.bucket.iconSizeData.kind==="composite"){const{minZoom:xi,maxZoom:wi}=ti.bucket.iconSizeData;ai.compositeIconSizes=[oi["icon-size"].possiblyEvaluate(new gn(xi),ti.canonical),oi["icon-size"].possiblyEvaluate(new gn(wi),ti.canonical)]}const ui=ii.get("text-line-height")*Jn,pi=ii.get("text-rotation-alignment")!=="viewport"&&ii.get("symbol-placement")!=="point",di=ii.get("text-keep-upright"),yi=ii.get("text-size");for(const xi of ti.bucket.features){const wi=ii.get("text-font").evaluate(xi,{},ti.canonical).join(","),Ii=yi.evaluate(xi,{},ti.canonical),Pi=ai.layoutTextSize.evaluate(xi,{},ti.canonical),Ri=ai.layoutIconSize.evaluate(xi,{},ti.canonical),Li={horizontal:{},vertical:void 0},Fi=xi.text;let qi,Zi=[0,0];if(Fi){const Yr=Fi.toString(),Jr=ii.get("text-letter-spacing").evaluate(xi,{},ti.canonical)*Jn,ao=Iu(Yr)?Jr:0,So=ii.get("text-anchor").evaluate(xi,{},ti.canonical),Po=Zf(ze,xi,ti.canonical);if(!Po){const yo=ii.get("text-radial-offset").evaluate(xi,{},ti.canonical);Zi=yo?$f(So,[yo*Jn,ud]):ii.get("text-offset").evaluate(xi,{},ti.canonical).map(uo=>uo*Jn)}let bo=pi?"center":ii.get("text-justify").evaluate(xi,{},ti.canonical);const vo=ii.get("symbol-placement"),mo=vo==="point"?ii.get("text-max-width").evaluate(xi,{},ti.canonical)*Jn:0,To=()=>{ti.bucket.allowVerticalPlacement&&Tu(Yr)&&(Li.vertical=rp(Fi,ti.glyphMap,ti.glyphPositions,ti.imagePositions,wi,mo,ui,So,"left",ao,Zi,li.ai.vertical,!0,vo,Pi,Ii))};if(!pi&&Po){const yo=new Set;if(bo==="auto")for(let ko=0;ko<Po.values.length;ko+=2)yo.add(hd(Po.values[ko]));else yo.add(bo);let uo=!1;for(const ko of yo)if(!Li.horizontal[ko])if(uo)Li.horizontal[ko]=Li.horizontal[0];else{const zo=rp(Fi,ti.glyphMap,ti.glyphPositions,ti.imagePositions,wi,mo,ui,"center",ko,ao,Zi,li.ai.horizontal,!1,vo,Pi,Ii);zo&&(Li.horizontal[ko]=zo,uo=zo.positionedLines.length===1)}To()}else{bo==="auto"&&(bo=hd(So));const yo=rp(Fi,ti.glyphMap,ti.glyphPositions,ti.imagePositions,wi,mo,ui,So,bo,ao,Zi,li.ai.horizontal,!1,vo,Pi,Ii);yo&&(Li.horizontal[bo]=yo),To(),Tu(Yr)&&pi&&di&&(Li.vertical=rp(Fi,ti.glyphMap,ti.glyphPositions,ti.imagePositions,wi,mo,ui,So,bo,ao,Zi,li.ai.vertical,!1,vo,Pi,Ii))}}let Gr=!1;if(xi.icon&&xi.icon.name){const Yr=ti.imageMap[xi.icon.name];Yr&&(qi=w_(ti.imagePositions[xi.icon.name],ii.get("icon-offset").evaluate(xi,{},ti.canonical),ii.get("icon-anchor").evaluate(xi,{},ti.canonical)),Gr=!!Yr.sdf,ti.bucket.sdfIcons===void 0?ti.bucket.sdfIcons=Gr:ti.bucket.sdfIcons!==Gr&&On("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Yr.pixelRatio!==ti.bucket.pixelRatio||ii.get("icon-rotate").constantOr(1)!==0)&&(ti.bucket.iconsNeedLinear=!0))}const Yi=Yf(Li.horizontal)||Li.vertical;ti.bucket.iconsInText=!!Yi&&Yi.iconsInText,(Yi||qi)&&N_(ti.bucket,xi,Li,qi,ti.imageMap,ai,Pi,Ri,Zi,Gr,ti.canonical)}ti.showCollisionBoxes&&ti.bucket.generateCollisionDebugBuffers()},li.br=Xp,li.bs=Zp,li.bt=Yp,li.bu=class{constructor(ti){this._marks={start:[ti.url,"start"].join("#"),end:[ti.url,"end"].join("#"),measure:ti.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let ti=performance.getEntriesByName(this._marks.measure);return ti.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),ti=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),ti}},li.bv=Kp,li.bw=jl,li.bx=function(ti,ze,ii,oi,ai){return po(this,void 0,void 0,function*(){if(sa())try{return yield rs(ti,ze,ii,oi,ai)}catch{}return function(ui,pi,di,yi,xi){const wi=ui.width,Ii=ui.height;Ma&&hn||(Ma=new OffscreenCanvas(wi,Ii),hn=Ma.getContext("2d",{willReadFrequently:!0})),Ma.width=wi,Ma.height=Ii,hn.drawImage(ui,0,0,wi,Ii);const Pi=hn.getImageData(pi,di,yi,xi);return hn.clearRect(0,0,wi,Ii),Pi.data}(ti,ze,ii,oi,ai)})},li.by=Rf,li.bz=Ki,li.c=Xs,li.d=function(ti,ze){const ii=new Image;ii.onload=()=>{ze(null,ii),URL.revokeObjectURL(ii.src),ii.onload=null,window.requestAnimationFrame(()=>{ii.src=sl})},ii.onerror=()=>ze(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const oi=new Blob([new Uint8Array(ti)],{type:"image/png"});ii.src=ti.byteLength?URL.createObjectURL(oi):sl},li.e=ln,li.f=function(ti,ze){return bs(ln(ti,{type:"json"}),ze)},li.g=La,li.h=Ls,li.i=Gn,li.j=na,li.k=$n,li.l=Un,li.m=bs,li.n=function(ti){return new Kp(ti).readFields(__,[])},li.o=function(ti,ze,ii){if(!ti.length)return ii(null,[]);let oi=ti.length;const ai=new Array(ti.length);let ui=null;ti.forEach((pi,di)=>{ze(pi,(yi,xi)=>{yi&&(ui=yi),ai[di]=xi,--oi==0&&ii(ui,ai)})})},li.p=uf,li.q=Zu,li.r=Vn,li.s=Oa,li.t=Ap,li.u=wo,li.v=io,li.w=On,li.x=Uc,li.y=js,li.z=function([ti,ze,ii]){return ze+=90,ze*=Math.PI/180,ii*=Math.PI/180,{x:ti*Math.cos(ze)*Math.sin(ii),y:ti*Math.sin(ze)*Math.sin(ii),z:ti*Math.cos(ii)}}}),Wr(["./shared"],function(li){class po{constructor(Ai){this.keyCache={},Ai&&this.replace(Ai)}replace(Ai){this._layerConfigs={},this._layers={},this.update(Ai,[])}update(Ai,Ci){for(const ji of Ai){this._layerConfigs[ji.id]=ji;const Gi=this._layers[ji.id]=li.aC(ji);Gi._featureFilter=li.a6(Gi.filter),this.keyCache[ji.id]&&delete this.keyCache[ji.id]}for(const ji of Ci)delete this.keyCache[ji],delete this._layerConfigs[ji],delete this._layers[ji];this.familiesBySource={};const ki=li.bl(Object.values(this._layerConfigs),this.keyCache);for(const ji of ki){const Gi=ji.map(oo=>this._layers[oo.id]),Zr=Gi[0];if(Zr.visibility==="none")continue;const Xi=Zr.source||"";let Hi=this.familiesBySource[Xi];Hi||(Hi=this.familiesBySource[Xi]={});const Qi=Zr.sourceLayer||"_geojsonTileLayer";let ro=Hi[Qi];ro||(ro=Hi[Qi]=[]),ro.push(Gi)}}}class Ki{constructor(Ai){const Ci={},ki=[];for(const Xi in Ai){const Hi=Ai[Xi],Qi=Ci[Xi]={};for(const ro in Hi){const oo=Hi[+ro];if(!oo||oo.bitmap.width===0||oo.bitmap.height===0)continue;const so={x:0,y:0,w:oo.bitmap.width+2,h:oo.bitmap.height+2};ki.push(so),Qi[ro]={rect:so,metrics:oo.metrics}}}const{w:ji,h:Gi}=li.p(ki),Zr=new li.q({width:ji||1,height:Gi||1});for(const Xi in Ai){const Hi=Ai[Xi];for(const Qi in Hi){const ro=Hi[+Qi];if(!ro||ro.bitmap.width===0||ro.bitmap.height===0)continue;const oo=Ci[Xi][Qi].rect;li.q.copy(ro.bitmap,Zr,{x:0,y:0},{x:oo.x+1,y:oo.y+1},ro.bitmap)}}this.image=Zr,this.positions=Ci}}li.bm("GlyphAtlas",Ki);class Lo{constructor(Ai){this.tileID=new li.O(Ai.tileID.overscaledZ,Ai.tileID.wrap,Ai.tileID.canonical.z,Ai.tileID.canonical.x,Ai.tileID.canonical.y),this.uid=Ai.uid,this.zoom=Ai.zoom,this.pixelRatio=Ai.pixelRatio,this.tileSize=Ai.tileSize,this.source=Ai.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ai.showCollisionBoxes,this.collectResourceTiming=!!Ai.collectResourceTiming,this.returnDependencies=!!Ai.returnDependencies,this.promoteId=Ai.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(Ai,Ci,ki,ji,Gi){this.status="parsing",this.data=Ai,this.collisionBoxArray=new li.a3;const Zr=new li.bn(Object.keys(Ai.layers).sort()),Xi=new li.bo(this.tileID,this.promoteId);Xi.bucketLayerIDs=[];const Hi={},Qi={featureIndex:Xi,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ki},ro=Ci.familiesBySource[this.source];for(const en in ro){const Qo=Ai.layers[en];if(!Qo)continue;Qo.version===1&&li.w(`Vector tile source "${this.source}" layer "${en}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _a=Zr.encode(en),_n=[];for(let Zn=0;Zn<Qo.length;Zn++){const ua=Qo.feature(Zn),as=Xi.getId(ua,en);_n.push({feature:ua,id:as,index:Zn,sourceLayerIndex:_a})}for(const Zn of ro[en]){const ua=Zn[0];ua.source!==this.source&&li.w(`layer.source = ${ua.source} does not equal this.source = ${this.source}`),ua.minzoom&&this.zoom<Math.floor(ua.minzoom)||ua.maxzoom&&this.zoom>=ua.maxzoom||ua.visibility!=="none"&&(Ro(Zn,this.zoom,ki),(Hi[ua.id]=ua.createBucket({index:Xi.bucketLayerIDs.length,layers:Zn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_a,sourceID:this.source})).populate(_n,Qi,this.tileID.canonical),Xi.bucketLayerIDs.push(Zn.map(as=>as.id)))}}let oo,so,Oo,No;const Io=li.aH(Qi.glyphDependencies,en=>Object.keys(en).map(Number));this.inFlightDependencies.forEach(en=>en==null?void 0:en.cancel()),this.inFlightDependencies=[];const Do=++this.dependencySentinel;Object.keys(Io).length?this.inFlightDependencies.push(ji.send("getGlyphs",{uid:this.uid,stacks:Io,source:this.source,tileID:this.tileID,type:"glyphs"},(en,Qo)=>{Do===this.dependencySentinel&&(oo||(oo=en,so=Qo,pn.call(this)))})):so={};const Vo=Object.keys(Qi.iconDependencies);Vo.length?this.inFlightDependencies.push(ji.send("getImages",{icons:Vo,source:this.source,tileID:this.tileID,type:"icons"},(en,Qo)=>{Do===this.dependencySentinel&&(oo||(oo=en,Oo=Qo,pn.call(this)))})):Oo={};const sn=Object.keys(Qi.patternDependencies);function pn(){if(oo)return Gi(oo);if(so&&Oo&&No){const en=new Ki(so),Qo=new li.bp(Oo,No);for(const _a in Hi){const _n=Hi[_a];_n instanceof li.a4?(Ro(_n.layers,this.zoom,ki),li.bq({bucket:_n,glyphMap:so,glyphPositions:en.positions,imageMap:Oo,imagePositions:Qo.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):_n.hasPattern&&(_n instanceof li.br||_n instanceof li.bs||_n instanceof li.bt)&&(Ro(_n.layers,this.zoom,ki),_n.addFeatures(Qi,this.tileID.canonical,Qo.patternPositions))}this.status="done",Gi(null,{buckets:Object.values(Hi).filter(_a=>!_a.isEmpty()),featureIndex:Xi,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:en.image,imageAtlas:Qo,glyphMap:this.returnDependencies?so:null,iconMap:this.returnDependencies?Oo:null,glyphPositions:this.returnDependencies?en.positions:null})}}sn.length?this.inFlightDependencies.push(ji.send("getImages",{icons:sn,source:this.source,tileID:this.tileID,type:"patterns"},(en,Qo)=>{Do===this.dependencySentinel&&(oo||(oo=en,No=Qo,pn.call(this)))})):No={},pn.call(this)}}function Ro(Ui,Ai,Ci){const ki=new li.a8(Ai);for(const ji of Ui)ji.recalculate(ki,Ci)}function fo(Ui,Ai){const Ci=li.l(Ui.request,(ki,ji,Gi,Zr)=>{if(ki)Ai(ki);else if(ji)try{const Xi=new li.bw.VectorTile(new li.bv(ji));Ai(null,{vectorTile:Xi,rawData:ji,cacheControl:Gi,expires:Zr})}catch(Xi){const Hi=new Uint8Array(ji);let Qi=`Unable to parse the tile at ${Ui.request.url}, `;Qi+=Hi[0]===31&&Hi[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Xi.messge}`,Ai(new Error(Qi))}});return()=>{Ci.cancel(),Ai()}}class aa{constructor(Ai,Ci,ki,ji){this.actor=Ai,this.layerIndex=Ci,this.availableImages=ki,this.loadVectorData=ji||fo,this.fetching={},this.loading={},this.loaded={}}loadTile(Ai,Ci){const ki=Ai.uid;this.loading||(this.loading={});const ji=!!(Ai&&Ai.request&&Ai.request.collectResourceTiming)&&new li.bu(Ai.request),Gi=this.loading[ki]=new Lo(Ai);Gi.abort=this.loadVectorData(Ai,(Zr,Xi)=>{if(delete this.loading[ki],Zr||!Xi)return Gi.status="done",this.loaded[ki]=Gi,Ci(Zr);const Hi=Xi.rawData,Qi={};Xi.expires&&(Qi.expires=Xi.expires),Xi.cacheControl&&(Qi.cacheControl=Xi.cacheControl);const ro={};if(ji){const oo=ji.finish();oo&&(ro.resourceTiming=JSON.parse(JSON.stringify(oo)))}Gi.vectorTile=Xi.vectorTile,Gi.parse(Xi.vectorTile,this.layerIndex,this.availableImages,this.actor,(oo,so)=>{if(delete this.fetching[ki],oo||!so)return Ci(oo);Ci(null,li.e({rawTileData:Hi.slice(0)},so,Qi,ro))}),this.loaded=this.loaded||{},this.loaded[ki]=Gi,this.fetching[ki]={rawTileData:Hi,cacheControl:Qi,resourceTiming:ro}})}reloadTile(Ai,Ci){const ki=this.loaded,ji=Ai.uid;if(ki&&ki[ji]){const Gi=ki[ji];Gi.showCollisionBoxes=Ai.showCollisionBoxes,Gi.status==="parsing"?Gi.parse(Gi.vectorTile,this.layerIndex,this.availableImages,this.actor,(Zr,Xi)=>{if(Zr||!Xi)return Ci(Zr,Xi);let Hi;if(this.fetching[ji]){const{rawTileData:Qi,cacheControl:ro,resourceTiming:oo}=this.fetching[ji];delete this.fetching[ji],Hi=li.e({rawTileData:Qi.slice(0)},Xi,ro,oo)}else Hi=Xi;Ci(null,Hi)}):Gi.status==="done"&&(Gi.vectorTile?Gi.parse(Gi.vectorTile,this.layerIndex,this.availableImages,this.actor,Ci):Ci())}}abortTile(Ai,Ci){const ki=this.loading,ji=Ai.uid;ki&&ki[ji]&&ki[ji].abort&&(ki[ji].abort(),delete ki[ji]),Ci()}removeTile(Ai,Ci){const ki=this.loaded,ji=Ai.uid;ki&&ki[ji]&&delete ki[ji],Ci()}}class wa{constructor(){this.loaded={}}loadTile(Ai,Ci){return li._(this,void 0,void 0,function*(){const{uid:ki,encoding:ji,rawImageData:Gi,redFactor:Zr,greenFactor:Xi,blueFactor:Hi,baseShift:Qi}=Ai,ro=Gi.width+2,oo=Gi.height+2,so=li.a(Gi)?new li.R({width:ro,height:oo},yield li.bx(Gi,-1,-1,ro,oo)):Gi,Oo=new li.by(ki,so,ji,Zr,Xi,Hi,Qi);this.loaded=this.loaded||{},this.loaded[ki]=Oo,Ci(null,Oo)})}removeTile(Ai){const Ci=this.loaded,ki=Ai.uid;Ci&&Ci[ki]&&delete Ci[ki]}}function $a(Ui,Ai){if(Ui.length!==0){Ln(Ui[0],Ai);for(var Ci=1;Ci<Ui.length;Ci++)Ln(Ui[Ci],!Ai)}}function Ln(Ui,Ai){for(var Ci=0,ki=0,ji=0,Gi=Ui.length,Zr=Gi-1;ji<Gi;Zr=ji++){var Xi=(Ui[ji][0]-Ui[Zr][0])*(Ui[Zr][1]+Ui[ji][1]),Hi=Ci+Xi;ki+=Math.abs(Ci)>=Math.abs(Xi)?Ci-Hi+Xi:Xi-Hi+Ci,Ci=Hi}Ci+ki>=0!=!!Ai&&Ui.reverse()}var bn=li.bz(function Ui(Ai,Ci){var ki,ji=Ai&&Ai.type;if(ji==="FeatureCollection")for(ki=0;ki<Ai.features.length;ki++)Ui(Ai.features[ki],Ci);else if(ji==="GeometryCollection")for(ki=0;ki<Ai.geometries.length;ki++)Ui(Ai.geometries[ki],Ci);else if(ji==="Feature")Ui(Ai.geometry,Ci);else if(ji==="Polygon")$a(Ai.coordinates,Ci);else if(ji==="MultiPolygon")for(ki=0;ki<Ai.coordinates.length;ki++)$a(Ai.coordinates[ki],Ci);return Ai});const fs=li.bw.VectorTileFeature.prototype.toGeoJSON;var sa={exports:{}},ma=li.bA,la=li.bw.VectorTileFeature,Za=oa;function oa(Ui,Ai){this.options=Ai||{},this.features=Ui,this.length=Ui.length}function ln(Ui,Ai){this.id=typeof Ui.id=="number"?Ui.id:void 0,this.type=Ui.type,this.rawGeometry=Ui.type===1?[Ui.geometry]:Ui.geometry,this.properties=Ui.tags,this.extent=Ai||4096}oa.prototype.feature=function(Ui){return new ln(this.features[Ui],this.options.extent)},ln.prototype.loadGeometry=function(){var Ui=this.rawGeometry;this.geometry=[];for(var Ai=0;Ai<Ui.length;Ai++){for(var Ci=Ui[Ai],ki=[],ji=0;ji<Ci.length;ji++)ki.push(new ma(Ci[ji][0],Ci[ji][1]));this.geometry.push(ki)}return this.geometry},ln.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ui=this.geometry,Ai=1/0,Ci=-1/0,ki=1/0,ji=-1/0,Gi=0;Gi<Ui.length;Gi++)for(var Zr=Ui[Gi],Xi=0;Xi<Zr.length;Xi++){var Hi=Zr[Xi];Ai=Math.min(Ai,Hi.x),Ci=Math.max(Ci,Hi.x),ki=Math.min(ki,Hi.y),ji=Math.max(ji,Hi.y)}return[Ai,ki,Ci,ji]},ln.prototype.toGeoJSON=la.prototype.toGeoJSON;var vs=li.bB,Wo=Za;function fn(Ui){var Ai=new vs;return function(Ci,ki){for(var ji in Ci.layers)ki.writeMessage(3,Pn,Ci.layers[ji])}(Ui,Ai),Ai.finish()}function Pn(Ui,Ai){var Ci;Ai.writeVarintField(15,Ui.version||1),Ai.writeStringField(1,Ui.name||""),Ai.writeVarintField(5,Ui.extent||4096);var ki={keys:[],values:[],keycache:{},valuecache:{}};for(Ci=0;Ci<Ui.length;Ci++)ki.feature=Ui.feature(Ci),Ai.writeMessage(2,Ra,ki);var ji=ki.keys;for(Ci=0;Ci<ji.length;Ci++)Ai.writeStringField(3,ji[Ci]);var Gi=ki.values;for(Ci=0;Ci<Gi.length;Ci++)Ai.writeMessage(4,ca,Gi[Ci])}function Ra(Ui,Ai){var Ci=Ui.feature;Ci.id!==void 0&&Ai.writeVarintField(1,Ci.id),Ai.writeMessage(2,On,Ui),Ai.writeVarintField(3,Ci.type),Ai.writeMessage(4,Gn,Ci)}function On(Ui,Ai){var Ci=Ui.feature,ki=Ui.keys,ji=Ui.values,Gi=Ui.keycache,Zr=Ui.valuecache;for(var Xi in Ci.properties){var Hi=Ci.properties[Xi],Qi=Gi[Xi];if(Hi!==null){Qi===void 0&&(ki.push(Xi),Gi[Xi]=Qi=ki.length-1),Ai.writeVarint(Qi);var ro=typeof Hi;ro!=="string"&&ro!=="boolean"&&ro!=="number"&&(Hi=JSON.stringify(Hi));var oo=ro+":"+Hi,so=Zr[oo];so===void 0&&(ji.push(Hi),Zr[oo]=so=ji.length-1),Ai.writeVarint(so)}}}function rn(Ui,Ai){return(Ai<<3)+(7&Ui)}function Sa(Ui){return Ui<<1^Ui>>31}function Gn(Ui,Ai){for(var Ci=Ui.loadGeometry(),ki=Ui.type,ji=0,Gi=0,Zr=Ci.length,Xi=0;Xi<Zr;Xi++){var Hi=Ci[Xi],Qi=1;ki===1&&(Qi=Hi.length),Ai.writeVarint(rn(1,Qi));for(var ro=ki===3?Hi.length-1:Hi.length,oo=0;oo<ro;oo++){oo===1&&ki!==1&&Ai.writeVarint(rn(2,ro-1));var so=Hi[oo].x-ji,Oo=Hi[oo].y-Gi;Ai.writeVarint(Sa(so)),Ai.writeVarint(Sa(Oo)),ji+=so,Gi+=Oo}ki===3&&Ai.writeVarint(rn(7,1))}}function ca(Ui,Ai){var Ci=typeof Ui;Ci==="string"?Ai.writeStringField(1,Ui):Ci==="boolean"?Ai.writeBooleanField(7,Ui):Ci==="number"&&(Ui%1!=0?Ai.writeDoubleField(3,Ui):Ui<0?Ai.writeSVarintField(6,Ui):Ai.writeVarintField(5,Ui))}sa.exports=fn,sa.exports.fromVectorTileJs=fn,sa.exports.fromGeojsonVt=function(Ui,Ai){Ai=Ai||{};var Ci={};for(var ki in Ui)Ci[ki]=new Wo(Ui[ki].features,Ai),Ci[ki].name=ki,Ci[ki].version=Ai.version,Ci[ki].extent=Ai.extent;return fn({layers:Ci})},sa.exports.GeoJSONWrapper=Wo;var al=li.bz(sa.exports);const sl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ui=>Ui},rs=Math.fround||(Ma=new Float32Array(1),Ui=>(Ma[0]=+Ui,Ma[0]));var Ma;const hn=3,Xn=5,Bn=6;class Ls{constructor(Ai){this.options=Object.assign(Object.create(sl),Ai),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ai){const{log:Ci,minZoom:ki,maxZoom:ji}=this.options;Ci&&console.time("total time");const Gi=`prepare ${Ai.length} points`;Ci&&console.time(Gi),this.points=Ai;const Zr=[];for(let Hi=0;Hi<Ai.length;Hi++){const Qi=Ai[Hi];if(!Qi.geometry)continue;const[ro,oo]=Qi.geometry.coordinates,so=rs(Nn(ro)),Oo=rs(La(oo));Zr.push(so,Oo,1/0,Hi,-1,1),this.options.reduce&&Zr.push(0)}let Xi=this.trees[ji+1]=this._createTree(Zr);Ci&&console.timeEnd(Gi);for(let Hi=ji;Hi>=ki;Hi--){const Qi=+Date.now();Xi=this.trees[Hi]=this._createTree(this._cluster(Xi,Hi)),Ci&&console.log("z%d: %d clusters in %dms",Hi,Xi.numItems,+Date.now()-Qi)}return Ci&&console.timeEnd("total time"),this}getClusters(Ai,Ci){let ki=((Ai[0]+180)%360+360)%360-180;const ji=Math.max(-90,Math.min(90,Ai[1]));let Gi=Ai[2]===180?180:((Ai[2]+180)%360+360)%360-180;const Zr=Math.max(-90,Math.min(90,Ai[3]));if(Ai[2]-Ai[0]>=360)ki=-180,Gi=180;else if(ki>Gi){const oo=this.getClusters([ki,ji,180,Zr],Ci),so=this.getClusters([-180,ji,Gi,Zr],Ci);return oo.concat(so)}const Xi=this.trees[this._limitZoom(Ci)],Hi=Xi.range(Nn(ki),La(Zr),Nn(Gi),La(ji)),Qi=Xi.data,ro=[];for(const oo of Hi){const so=this.stride*oo;ro.push(Qi[so+Xn]>1?Xs(Qi,so,this.clusterProps):this.points[Qi[so+hn]])}return ro}getChildren(Ai){const Ci=this._getOriginId(Ai),ki=this._getOriginZoom(Ai),ji="No cluster with the specified id.",Gi=this.trees[ki];if(!Gi)throw new Error(ji);const Zr=Gi.data;if(Ci*this.stride>=Zr.length)throw new Error(ji);const Xi=this.options.radius/(this.options.extent*Math.pow(2,ki-1)),Hi=Gi.within(Zr[Ci*this.stride],Zr[Ci*this.stride+1],Xi),Qi=[];for(const ro of Hi){const oo=ro*this.stride;Zr[oo+4]===Ai&&Qi.push(Zr[oo+Xn]>1?Xs(Zr,oo,this.clusterProps):this.points[Zr[oo+hn]])}if(Qi.length===0)throw new Error(ji);return Qi}getLeaves(Ai,Ci,ki){const ji=[];return this._appendLeaves(ji,Ai,Ci=Ci||10,ki=ki||0,0),ji}getTile(Ai,Ci,ki){const ji=this.trees[this._limitZoom(Ai)],Gi=Math.pow(2,Ai),{extent:Zr,radius:Xi}=this.options,Hi=Xi/Zr,Qi=(ki-Hi)/Gi,ro=(ki+1+Hi)/Gi,oo={features:[]};return this._addTileFeatures(ji.range((Ci-Hi)/Gi,Qi,(Ci+1+Hi)/Gi,ro),ji.data,Ci,ki,Gi,oo),Ci===0&&this._addTileFeatures(ji.range(1-Hi/Gi,Qi,1,ro),ji.data,Gi,ki,Gi,oo),Ci===Gi-1&&this._addTileFeatures(ji.range(0,Qi,Hi/Gi,ro),ji.data,-1,ki,Gi,oo),oo.features.length?oo:null}getClusterExpansionZoom(Ai){let Ci=this._getOriginZoom(Ai)-1;for(;Ci<=this.options.maxZoom;){const ki=this.getChildren(Ai);if(Ci++,ki.length!==1)break;Ai=ki[0].properties.cluster_id}return Ci}_appendLeaves(Ai,Ci,ki,ji,Gi){const Zr=this.getChildren(Ci);for(const Xi of Zr){const Hi=Xi.properties;if(Hi&&Hi.cluster?Gi+Hi.point_count<=ji?Gi+=Hi.point_count:Gi=this._appendLeaves(Ai,Hi.cluster_id,ki,ji,Gi):Gi<ji?Gi++:Ai.push(Xi),Ai.length===ki)break}return Gi}_createTree(Ai){const Ci=new li.av(Ai.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ki=0;ki<Ai.length;ki+=this.stride)Ci.add(Ai[ki],Ai[ki+1]);return Ci.finish(),Ci.data=Ai,Ci}_addTileFeatures(Ai,Ci,ki,ji,Gi,Zr){for(const Xi of Ai){const Hi=Xi*this.stride,Qi=Ci[Hi+Xn]>1;let ro,oo,so;if(Qi)ro=os(Ci,Hi,this.clusterProps),oo=Ci[Hi],so=Ci[Hi+1];else{const Io=this.points[Ci[Hi+hn]];ro=Io.properties;const[Do,Vo]=Io.geometry.coordinates;oo=Nn(Do),so=La(Vo)}const Oo={type:1,geometry:[[Math.round(this.options.extent*(oo*Gi-ki)),Math.round(this.options.extent*(so*Gi-ji))]],tags:ro};let No;No=Qi||this.options.generateId?Ci[Hi+hn]:this.points[Ci[Hi+hn]].id,No!==void 0&&(Oo.id=No),Zr.features.push(Oo)}}_limitZoom(Ai){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ai),this.options.maxZoom+1))}_cluster(Ai,Ci){const{radius:ki,extent:ji,reduce:Gi,minPoints:Zr}=this.options,Xi=ki/(ji*Math.pow(2,Ci)),Hi=Ai.data,Qi=[],ro=this.stride;for(let oo=0;oo<Hi.length;oo+=ro){if(Hi[oo+2]<=Ci)continue;Hi[oo+2]=Ci;const so=Hi[oo],Oo=Hi[oo+1],No=Ai.within(Hi[oo],Hi[oo+1],Xi),Io=Hi[oo+Xn];let Do=Io;for(const Vo of No){const sn=Vo*ro;Hi[sn+2]>Ci&&(Do+=Hi[sn+Xn])}if(Do>Io&&Do>=Zr){let Vo,sn=so*Io,pn=Oo*Io,en=-1;const Qo=((oo/ro|0)<<5)+(Ci+1)+this.points.length;for(const _a of No){const _n=_a*ro;if(Hi[_n+2]<=Ci)continue;Hi[_n+2]=Ci;const Zn=Hi[_n+Xn];sn+=Hi[_n]*Zn,pn+=Hi[_n+1]*Zn,Hi[_n+4]=Qo,Gi&&(Vo||(Vo=this._map(Hi,oo,!0),en=this.clusterProps.length,this.clusterProps.push(Vo)),Gi(Vo,this._map(Hi,_n)))}Hi[oo+4]=Qo,Qi.push(sn/Do,pn/Do,1/0,Qo,-1,Do),Gi&&Qi.push(en)}else{for(let Vo=0;Vo<ro;Vo++)Qi.push(Hi[oo+Vo]);if(Do>1)for(const Vo of No){const sn=Vo*ro;if(!(Hi[sn+2]<=Ci)){Hi[sn+2]=Ci;for(let pn=0;pn<ro;pn++)Qi.push(Hi[sn+pn])}}}}return Qi}_getOriginId(Ai){return Ai-this.points.length>>5}_getOriginZoom(Ai){return(Ai-this.points.length)%32}_map(Ai,Ci,ki){if(Ai[Ci+Xn]>1){const Zr=this.clusterProps[Ai[Ci+Bn]];return ki?Object.assign({},Zr):Zr}const ji=this.points[Ai[Ci+hn]].properties,Gi=this.options.map(ji);return ki&&Gi===ji?Object.assign({},Gi):Gi}}function Xs(Ui,Ai,Ci){return{type:"Feature",id:Ui[Ai+hn],properties:os(Ui,Ai,Ci),geometry:{type:"Point",coordinates:[(ki=Ui[Ai],360*(ki-.5)),Os(Ui[Ai+1])]}};var ki}function os(Ui,Ai,Ci){const ki=Ui[Ai+Xn],ji=ki>=1e4?`${Math.round(ki/1e3)}k`:ki>=1e3?Math.round(ki/100)/10+"k":ki,Gi=Ui[Ai+Bn],Zr=Gi===-1?{}:Object.assign({},Ci[Gi]);return Object.assign(Zr,{cluster:!0,cluster_id:Ui[Ai+hn],point_count:ki,point_count_abbreviated:ji})}function Nn(Ui){return Ui/360+.5}function La(Ui){const Ai=Math.sin(Ui*Math.PI/180),Ci=.5-.25*Math.log((1+Ai)/(1-Ai))/Math.PI;return Ci<0?0:Ci>1?1:Ci}function Os(Ui){const Ai=(180-360*Ui)*Math.PI/180;return 360*Math.atan(Math.exp(Ai))/Math.PI-90}function bs(Ui,Ai,Ci,ki){for(var ji,Gi=ki,Zr=Ci-Ai>>1,Xi=Ci-Ai,Hi=Ui[Ai],Qi=Ui[Ai+1],ro=Ui[Ci],oo=Ui[Ci+1],so=Ai+3;so<Ci;so+=3){var Oo=Un(Ui[so],Ui[so+1],Hi,Qi,ro,oo);if(Oo>Gi)ji=so,Gi=Oo;else if(Oo===Gi){var No=Math.abs(so-Zr);No<Xi&&(ji=so,Xi=No)}}Gi>ki&&(ji-Ai>3&&bs(Ui,Ai,ji,ki),Ui[ji+2]=Gi,Ci-ji>3&&bs(Ui,ji,Ci,ki))}function Un(Ui,Ai,Ci,ki,ji,Gi){var Zr=ji-Ci,Xi=Gi-ki;if(Zr!==0||Xi!==0){var Hi=((Ui-Ci)*Zr+(Ai-ki)*Xi)/(Zr*Zr+Xi*Xi);Hi>1?(Ci=ji,ki=Gi):Hi>0&&(Ci+=Zr*Hi,ki+=Xi*Hi)}return(Zr=Ui-Ci)*Zr+(Xi=Ai-ki)*Xi}function Oa(Ui,Ai,Ci,ki){var ji={id:Ui===void 0?null:Ui,type:Ai,geometry:Ci,tags:ki,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Gi){var Zr=Gi.geometry,Xi=Gi.type;if(Xi==="Point"||Xi==="MultiPoint"||Xi==="LineString")ms(Gi,Zr);else if(Xi==="Polygon"||Xi==="MultiLineString")for(var Hi=0;Hi<Zr.length;Hi++)ms(Gi,Zr[Hi]);else if(Xi==="MultiPolygon")for(Hi=0;Hi<Zr.length;Hi++)for(var Qi=0;Qi<Zr[Hi].length;Qi++)ms(Gi,Zr[Hi][Qi])}(ji),ji}function ms(Ui,Ai){for(var Ci=0;Ci<Ai.length;Ci+=3)Ui.minX=Math.min(Ui.minX,Ai[Ci]),Ui.minY=Math.min(Ui.minY,Ai[Ci+1]),Ui.maxX=Math.max(Ui.maxX,Ai[Ci]),Ui.maxY=Math.max(Ui.maxY,Ai[Ci+1])}function ks(Ui,Ai,Ci,ki){if(Ai.geometry){var ji=Ai.geometry.coordinates,Gi=Ai.geometry.type,Zr=Math.pow(Ci.tolerance/((1<<Ci.maxZoom)*Ci.extent),2),Xi=[],Hi=Ai.id;if(Ci.promoteId?Hi=Ai.properties[Ci.promoteId]:Ci.generateId&&(Hi=ki||0),Gi==="Point")$n(ji,Xi);else if(Gi==="MultiPoint")for(var Qi=0;Qi<ji.length;Qi++)$n(ji[Qi],Xi);else if(Gi==="LineString")na(ji,Xi,Zr,!1);else if(Gi==="MultiLineString"){if(Ci.lineMetrics){for(Qi=0;Qi<ji.length;Qi++)na(ji[Qi],Xi=[],Zr,!1),Ui.push(Oa(Hi,"LineString",Xi,Ai.properties));return}ka(ji,Xi,Zr,!1)}else if(Gi==="Polygon")ka(ji,Xi,Zr,!0);else{if(Gi!=="MultiPolygon"){if(Gi==="GeometryCollection"){for(Qi=0;Qi<Ai.geometry.geometries.length;Qi++)ks(Ui,{id:Hi,geometry:Ai.geometry.geometries[Qi],properties:Ai.properties},Ci,ki);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Qi=0;Qi<ji.length;Qi++){var ro=[];ka(ji[Qi],ro,Zr,!0),Xi.push(ro)}}Ui.push(Oa(Hi,Gi,Xi,Ai.properties))}}function $n(Ui,Ai){Ai.push(io(Ui[0])),Ai.push(Da(Ui[1])),Ai.push(0)}function na(Ui,Ai,Ci,ki){for(var ji,Gi,Zr=0,Xi=0;Xi<Ui.length;Xi++){var Hi=io(Ui[Xi][0]),Qi=Da(Ui[Xi][1]);Ai.push(Hi),Ai.push(Qi),Ai.push(0),Xi>0&&(Zr+=ki?(ji*Qi-Hi*Gi)/2:Math.sqrt(Math.pow(Hi-ji,2)+Math.pow(Qi-Gi,2))),ji=Hi,Gi=Qi}var ro=Ai.length-3;Ai[2]=1,bs(Ai,0,ro,Ci),Ai[ro+2]=1,Ai.size=Math.abs(Zr),Ai.start=0,Ai.end=Ai.size}function ka(Ui,Ai,Ci,ki){for(var ji=0;ji<Ui.length;ji++){var Gi=[];na(Ui[ji],Gi,Ci,ki),Ai.push(Gi)}}function io(Ui){return Ui/360+.5}function Da(Ui){var Ai=Math.sin(Ui*Math.PI/180),Ci=.5-.25*Math.log((1+Ai)/(1-Ai))/Math.PI;return Ci<0?0:Ci>1?1:Ci}function ns(Ui,Ai,Ci,ki,ji,Gi,Zr,Xi){if(ki/=Ai,Gi>=(Ci/=Ai)&&Zr<ki)return Ui;if(Zr<Ci||Gi>=ki)return null;for(var Hi=[],Qi=0;Qi<Ui.length;Qi++){var ro=Ui[Qi],oo=ro.geometry,so=ro.type,Oo=ji===0?ro.minX:ro.minY,No=ji===0?ro.maxX:ro.maxY;if(Oo>=Ci&&No<ki)Hi.push(ro);else if(!(No<Ci||Oo>=ki)){var Io=[];if(so==="Point"||so==="MultiPoint")mn(oo,Io,Ci,ki,ji);else if(so==="LineString")tn(oo,Io,Ci,ki,ji,!1,Xi.lineMetrics);else if(so==="MultiLineString")Il(oo,Io,Ci,ki,ji,!1);else if(so==="Polygon")Il(oo,Io,Ci,ki,ji,!0);else if(so==="MultiPolygon")for(var Do=0;Do<oo.length;Do++){var Vo=[];Il(oo[Do],Vo,Ci,ki,ji,!0),Vo.length&&Io.push(Vo)}if(Io.length){if(Xi.lineMetrics&&so==="LineString"){for(Do=0;Do<Io.length;Do++)Hi.push(Oa(ro.id,so,Io[Do],ro.tags));continue}so!=="LineString"&&so!=="MultiLineString"||(Io.length===1?(so="LineString",Io=Io[0]):so="MultiLineString"),so!=="Point"&&so!=="MultiPoint"||(so=Io.length===3?"Point":"MultiPoint"),Hi.push(Oa(ro.id,so,Io,ro.tags))}}}return Hi.length?Hi:null}function mn(Ui,Ai,Ci,ki,ji){for(var Gi=0;Gi<Ui.length;Gi+=3){var Zr=Ui[Gi+ji];Zr>=Ci&&Zr<=ki&&(Ai.push(Ui[Gi]),Ai.push(Ui[Gi+1]),Ai.push(Ui[Gi+2]))}}function tn(Ui,Ai,Ci,ki,ji,Gi,Zr){for(var Xi,Hi,Qi=ws(Ui),ro=ji===0?mc:Al,oo=Ui.start,so=0;so<Ui.length-3;so+=3){var Oo=Ui[so],No=Ui[so+1],Io=Ui[so+2],Do=Ui[so+3],Vo=Ui[so+4],sn=ji===0?Oo:No,pn=ji===0?Do:Vo,en=!1;Zr&&(Xi=Math.sqrt(Math.pow(Oo-Do,2)+Math.pow(No-Vo,2))),sn<Ci?pn>Ci&&(Hi=ro(Qi,Oo,No,Do,Vo,Ci),Zr&&(Qi.start=oo+Xi*Hi)):sn>ki?pn<ki&&(Hi=ro(Qi,Oo,No,Do,Vo,ki),Zr&&(Qi.start=oo+Xi*Hi)):Ds(Qi,Oo,No,Io),pn<Ci&&sn>=Ci&&(Hi=ro(Qi,Oo,No,Do,Vo,Ci),en=!0),pn>ki&&sn<=ki&&(Hi=ro(Qi,Oo,No,Do,Vo,ki),en=!0),!Gi&&en&&(Zr&&(Qi.end=oo+Xi*Hi),Ai.push(Qi),Qi=ws(Ui)),Zr&&(oo+=Xi)}var Qo=Ui.length-3;Oo=Ui[Qo],No=Ui[Qo+1],Io=Ui[Qo+2],(sn=ji===0?Oo:No)>=Ci&&sn<=ki&&Ds(Qi,Oo,No,Io),Qo=Qi.length-3,Gi&&Qo>=3&&(Qi[Qo]!==Qi[0]||Qi[Qo+1]!==Qi[1])&&Ds(Qi,Qi[0],Qi[1],Qi[2]),Qi.length&&Ai.push(Qi)}function ws(Ui){var Ai=[];return Ai.size=Ui.size,Ai.start=Ui.start,Ai.end=Ui.end,Ai}function Il(Ui,Ai,Ci,ki,ji,Gi){for(var Zr=0;Zr<Ui.length;Zr++)tn(Ui[Zr],Ai,Ci,ki,ji,Gi,!1)}function Ds(Ui,Ai,Ci,ki){Ui.push(Ai),Ui.push(Ci),Ui.push(ki)}function mc(Ui,Ai,Ci,ki,ji,Gi){var Zr=(Gi-Ai)/(ki-Ai);return Ui.push(Gi),Ui.push(Ci+(ji-Ci)*Zr),Ui.push(1),Zr}function Al(Ui,Ai,Ci,ki,ji,Gi){var Zr=(Gi-Ci)/(ji-Ci);return Ui.push(Ai+(ki-Ai)*Zr),Ui.push(Gi),Ui.push(1),Zr}function Ws(Ui,Ai){for(var Ci=[],ki=0;ki<Ui.length;ki++){var ji,Gi=Ui[ki],Zr=Gi.type;if(Zr==="Point"||Zr==="MultiPoint"||Zr==="LineString")ji=ll(Gi.geometry,Ai);else if(Zr==="MultiLineString"||Zr==="Polygon"){ji=[];for(var Xi=0;Xi<Gi.geometry.length;Xi++)ji.push(ll(Gi.geometry[Xi],Ai))}else if(Zr==="MultiPolygon")for(ji=[],Xi=0;Xi<Gi.geometry.length;Xi++){for(var Hi=[],Qi=0;Qi<Gi.geometry[Xi].length;Qi++)Hi.push(ll(Gi.geometry[Xi][Qi],Ai));ji.push(Hi)}Ci.push(Oa(Gi.id,Zr,ji,Gi.tags))}return Ci}function ll(Ui,Ai){var Ci=[];Ci.size=Ui.size,Ui.start!==void 0&&(Ci.start=Ui.start,Ci.end=Ui.end);for(var ki=0;ki<Ui.length;ki+=3)Ci.push(Ui[ki]+Ai,Ui[ki+1],Ui[ki+2]);return Ci}function _o(Ui,Ai){if(Ui.transformed)return Ui;var Ci,ki,ji,Gi=1<<Ui.z,Zr=Ui.x,Xi=Ui.y;for(Ci=0;Ci<Ui.features.length;Ci++){var Hi=Ui.features[Ci],Qi=Hi.geometry,ro=Hi.type;if(Hi.geometry=[],ro===1)for(ki=0;ki<Qi.length;ki+=2)Hi.geometry.push(Ss(Qi[ki],Qi[ki+1],Ai,Gi,Zr,Xi));else for(ki=0;ki<Qi.length;ki++){var oo=[];for(ji=0;ji<Qi[ki].length;ji+=2)oo.push(Ss(Qi[ki][ji],Qi[ki][ji+1],Ai,Gi,Zr,Xi));Hi.geometry.push(oo)}}return Ui.transformed=!0,Ui}function Ss(Ui,Ai,Ci,ki,ji,Gi){return[Math.round(Ci*(Ui*ki-ji)),Math.round(Ci*(Ai*ki-Gi))]}function Cn(Ui,Ai,Ci,ki,ji){for(var Gi=Ai===ji.maxZoom?0:ji.tolerance/((1<<Ai)*ji.extent),Zr={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ci,y:ki,z:Ai,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Xi=0;Xi<Ui.length;Xi++){Zr.numFeatures++,cl(Zr,Ui[Xi],Gi,ji);var Hi=Ui[Xi].minX,Qi=Ui[Xi].minY,ro=Ui[Xi].maxX,oo=Ui[Xi].maxY;Hi<Zr.minX&&(Zr.minX=Hi),Qi<Zr.minY&&(Zr.minY=Qi),ro>Zr.maxX&&(Zr.maxX=ro),oo>Zr.maxY&&(Zr.maxY=oo)}return Zr}function cl(Ui,Ai,Ci,ki){var ji=Ai.geometry,Gi=Ai.type,Zr=[];if(Gi==="Point"||Gi==="MultiPoint")for(var Xi=0;Xi<ji.length;Xi+=3)Zr.push(ji[Xi]),Zr.push(ji[Xi+1]),Ui.numPoints++,Ui.numSimplified++;else if(Gi==="LineString")Fs(Zr,ji,Ui,Ci,!1,!1);else if(Gi==="MultiLineString"||Gi==="Polygon")for(Xi=0;Xi<ji.length;Xi++)Fs(Zr,ji[Xi],Ui,Ci,Gi==="Polygon",Xi===0);else if(Gi==="MultiPolygon")for(var Hi=0;Hi<ji.length;Hi++){var Qi=ji[Hi];for(Xi=0;Xi<Qi.length;Xi++)Fs(Zr,Qi[Xi],Ui,Ci,!0,Xi===0)}if(Zr.length){var ro=Ai.tags||null;if(Gi==="LineString"&&ki.lineMetrics){for(var oo in ro={},Ai.tags)ro[oo]=Ai.tags[oo];ro.mapbox_clip_start=ji.start/ji.size,ro.mapbox_clip_end=ji.end/ji.size}var so={geometry:Zr,type:Gi==="Polygon"||Gi==="MultiPolygon"?3:Gi==="LineString"||Gi==="MultiLineString"?2:1,tags:ro};Ai.id!==null&&(so.id=Ai.id),Ui.features.push(so)}}function Fs(Ui,Ai,Ci,ki,ji,Gi){var Zr=ki*ki;if(ki>0&&Ai.size<(ji?Zr:ki))Ci.numPoints+=Ai.length/3;else{for(var Xi=[],Hi=0;Hi<Ai.length;Hi+=3)(ki===0||Ai[Hi+2]>Zr)&&(Ci.numSimplified++,Xi.push(Ai[Hi]),Xi.push(Ai[Hi+1])),Ci.numPoints++;ji&&function(Qi,ro){for(var oo=0,so=0,Oo=Qi.length,No=Oo-2;so<Oo;No=so,so+=2)oo+=(Qi[so]-Qi[No])*(Qi[so+1]+Qi[No+1]);if(oo>0===ro)for(so=0,Oo=Qi.length;so<Oo/2;so+=2){var Io=Qi[so],Do=Qi[so+1];Qi[so]=Qi[Oo-2-so],Qi[so+1]=Qi[Oo-1-so],Qi[Oo-2-so]=Io,Qi[Oo-1-so]=Do}}(Xi,Gi),Ui.push(Xi)}}function go(Ui,Ai){var Ci=(Ai=this.options=function(ji,Gi){for(var Zr in Gi)ji[Zr]=Gi[Zr];return ji}(Object.create(this.options),Ai)).debug;if(Ci&&console.time("preprocess data"),Ai.maxZoom<0||Ai.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ai.promoteId&&Ai.generateId)throw new Error("promoteId and generateId cannot be used together.");var ki=function(ji,Gi){var Zr=[];if(ji.type==="FeatureCollection")for(var Xi=0;Xi<ji.features.length;Xi++)ks(Zr,ji.features[Xi],Gi,Xi);else ks(Zr,ji.type==="Feature"?ji:{geometry:ji},Gi);return Zr}(Ui,Ai);this.tiles={},this.tileCoords=[],Ci&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ai.indexMaxZoom,Ai.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ki=function(ji,Gi){var Zr=Gi.buffer/Gi.extent,Xi=ji,Hi=ns(ji,1,-1-Zr,Zr,0,-1,2,Gi),Qi=ns(ji,1,1-Zr,2+Zr,0,-1,2,Gi);return(Hi||Qi)&&(Xi=ns(ji,1,-Zr,1+Zr,0,-1,2,Gi)||[],Hi&&(Xi=Ws(Hi,1).concat(Xi)),Qi&&(Xi=Xi.concat(Ws(Qi,-1)))),Xi}(ki,Ai),ki.length&&this.splitTile(ki,0,0,0),Ci&&(ki.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Go(Ui,Ai,Ci){return 32*((1<<Ui)*Ci+Ai)+Ui}function Uo(Ui,Ai){return Ai?Ui.properties[Ai]:Ui.id}function Ea(Ui,Ai){if(Ui==null)return!0;if(Ui.type==="Feature")return Uo(Ui,Ai)!=null;if(Ui.type==="FeatureCollection"){const Ci=new Set;for(const ki of Ui.features){const ji=Uo(ki,Ai);if(ji==null||Ci.has(ji))return!1;Ci.add(ji)}return!0}return!1}function Es(Ui,Ai){const Ci=new Map;if(Ui!=null)if(Ui.type==="Feature")Ci.set(Uo(Ui,Ai),Ui);else for(const ki of Ui.features)Ci.set(Uo(ki,Ai),ki);return Ci}go.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},go.prototype.splitTile=function(Ui,Ai,Ci,ki,ji,Gi,Zr){for(var Xi=[Ui,Ai,Ci,ki],Hi=this.options,Qi=Hi.debug;Xi.length;){ki=Xi.pop(),Ci=Xi.pop(),Ai=Xi.pop(),Ui=Xi.pop();var ro=1<<Ai,oo=Go(Ai,Ci,ki),so=this.tiles[oo];if(!so&&(Qi>1&&console.time("creation"),so=this.tiles[oo]=Cn(Ui,Ai,Ci,ki,Hi),this.tileCoords.push({z:Ai,x:Ci,y:ki}),Qi)){Qi>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ai,Ci,ki,so.numFeatures,so.numPoints,so.numSimplified),console.timeEnd("creation"));var Oo="z"+Ai;this.stats[Oo]=(this.stats[Oo]||0)+1,this.total++}if(so.source=Ui,ji){if(Ai===Hi.maxZoom||Ai===ji)continue;var No=1<<ji-Ai;if(Ci!==Math.floor(Gi/No)||ki!==Math.floor(Zr/No))continue}else if(Ai===Hi.indexMaxZoom||so.numPoints<=Hi.indexMaxPoints)continue;if(so.source=null,Ui.length!==0){Qi>1&&console.time("clipping");var Io,Do,Vo,sn,pn,en,Qo=.5*Hi.buffer/Hi.extent,_a=.5-Qo,_n=.5+Qo,Zn=1+Qo;Io=Do=Vo=sn=null,pn=ns(Ui,ro,Ci-Qo,Ci+_n,0,so.minX,so.maxX,Hi),en=ns(Ui,ro,Ci+_a,Ci+Zn,0,so.minX,so.maxX,Hi),Ui=null,pn&&(Io=ns(pn,ro,ki-Qo,ki+_n,1,so.minY,so.maxY,Hi),Do=ns(pn,ro,ki+_a,ki+Zn,1,so.minY,so.maxY,Hi),pn=null),en&&(Vo=ns(en,ro,ki-Qo,ki+_n,1,so.minY,so.maxY,Hi),sn=ns(en,ro,ki+_a,ki+Zn,1,so.minY,so.maxY,Hi),en=null),Qi>1&&console.timeEnd("clipping"),Xi.push(Io||[],Ai+1,2*Ci,2*ki),Xi.push(Do||[],Ai+1,2*Ci,2*ki+1),Xi.push(Vo||[],Ai+1,2*Ci+1,2*ki),Xi.push(sn||[],Ai+1,2*Ci+1,2*ki+1)}}},go.prototype.getTile=function(Ui,Ai,Ci){var ki=this.options,ji=ki.extent,Gi=ki.debug;if(Ui<0||Ui>24)return null;var Zr=1<<Ui,Xi=Go(Ui,Ai=(Ai%Zr+Zr)%Zr,Ci);if(this.tiles[Xi])return _o(this.tiles[Xi],ji);Gi>1&&console.log("drilling down to z%d-%d-%d",Ui,Ai,Ci);for(var Hi,Qi=Ui,ro=Ai,oo=Ci;!Hi&&Qi>0;)Qi--,ro=Math.floor(ro/2),oo=Math.floor(oo/2),Hi=this.tiles[Go(Qi,ro,oo)];return Hi&&Hi.source?(Gi>1&&console.log("found parent tile z%d-%d-%d",Qi,ro,oo),Gi>1&&console.time("drilling down"),this.splitTile(Hi.source,Qi,ro,oo,Ui,Ai,Ci),Gi>1&&console.timeEnd("drilling down"),this.tiles[Xi]?_o(this.tiles[Xi],ji):null):null};class jo extends aa{constructor(Ai,Ci,ki,ji){super(Ai,Ci,ki),this._dataUpdateable=new Map,this.loadGeoJSON=(Gi,Zr)=>{const{promoteId:Xi}=Gi;if(Gi.request)return li.f(Gi.request,(Hi,Qi,ro,oo)=>{this._dataUpdateable=Ea(Qi,Xi)?Es(Qi,Xi):void 0,Zr(Hi,Qi,ro,oo)});if(typeof Gi.data=="string")try{const Hi=JSON.parse(Gi.data);this._dataUpdateable=Ea(Hi,Xi)?Es(Hi,Xi):void 0,Zr(null,Hi)}catch{Zr(new Error(`Input data given to '${Gi.source}' is not a valid GeoJSON object.`))}else Gi.dataDiff?this._dataUpdateable?(function(Hi,Qi,ro){var oo,so,Oo,No;if(Qi.removeAll&&Hi.clear(),Qi.remove)for(const Io of Qi.remove)Hi.delete(Io);if(Qi.add)for(const Io of Qi.add){const Do=Uo(Io,ro);Do!=null&&Hi.set(Do,Io)}if(Qi.update)for(const Io of Qi.update){let Do=Hi.get(Io.id);if(Do==null)continue;const Vo=!Io.removeAllProperties&&(((oo=Io.removeProperties)===null||oo===void 0?void 0:oo.length)>0||((so=Io.addOrUpdateProperties)===null||so===void 0?void 0:so.length)>0);if((Io.newGeometry||Io.removeAllProperties||Vo)&&(Do=Object.assign({},Do),Hi.set(Io.id,Do),Vo&&(Do.properties=Object.assign({},Do.properties))),Io.newGeometry&&(Do.geometry=Io.newGeometry),Io.removeAllProperties)Do.properties={};else if(((Oo=Io.removeProperties)===null||Oo===void 0?void 0:Oo.length)>0)for(const sn of Io.removeProperties)Object.prototype.hasOwnProperty.call(Do.properties,sn)&&delete Do.properties[sn];if(((No=Io.addOrUpdateProperties)===null||No===void 0?void 0:No.length)>0)for(const{key:sn,value:pn}of Io.addOrUpdateProperties)Do.properties[sn]=pn}}(this._dataUpdateable,Gi.dataDiff,Xi),Zr(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Zr(new Error(`Cannot update existing geojson data in ${Gi.source}`)):Zr(new Error(`Input data given to '${Gi.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,ji&&(this.loadGeoJSON=ji)}loadGeoJSONTile(Ai,Ci){const ki=Ai.tileID.canonical;if(!this._geoJSONIndex)return Ci(null,null);const ji=this._geoJSONIndex.getTile(ki.z,ki.x,ki.y);if(!ji)return Ci(null,null);const Gi=new class{constructor(Xi){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=li.N,this.length=Xi.length,this._features=Xi}feature(Xi){return new class{constructor(Hi){this._feature=Hi,this.extent=li.N,this.type=Hi.type,this.properties=Hi.tags,"id"in Hi&&!isNaN(Hi.id)&&(this.id=parseInt(Hi.id,10))}loadGeometry(){if(this._feature.type===1){const Hi=[];for(const Qi of this._feature.geometry)Hi.push([new li.P(Qi[0],Qi[1])]);return Hi}{const Hi=[];for(const Qi of this._feature.geometry){const ro=[];for(const oo of Qi)ro.push(new li.P(oo[0],oo[1]));Hi.push(ro)}return Hi}}toGeoJSON(Hi,Qi,ro){return fs.call(this,Hi,Qi,ro)}}(this._features[Xi])}}(ji.features);let Zr=al(Gi);Zr.byteOffset===0&&Zr.byteLength===Zr.buffer.byteLength||(Zr=new Uint8Array(Zr)),Ci(null,{vectorTile:Gi,rawData:Zr.buffer})}loadData(Ai,Ci){var ki;(ki=this._pendingRequest)===null||ki===void 0||ki.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const ji=!!(Ai&&Ai.request&&Ai.request.collectResourceTiming)&&new li.bu(Ai.request);this._pendingCallback=Ci,this._pendingRequest=this.loadGeoJSON(Ai,(Gi,Zr)=>{if(delete this._pendingCallback,delete this._pendingRequest,Gi||!Zr)return Ci(Gi);if(typeof Zr!="object")return Ci(new Error(`Input data given to '${Ai.source}' is not a valid GeoJSON object.`));{bn(Zr,!0);try{if(Ai.filter){const Hi=li.bC(Ai.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Hi.result==="error")throw new Error(Hi.value.map(ro=>`${ro.key}: ${ro.message}`).join(", "));Zr={type:"FeatureCollection",features:Zr.features.filter(ro=>Hi.value.evaluate({zoom:0},ro))}}this._geoJSONIndex=Ai.cluster?new Ls(function({superclusterOptions:Hi,clusterProperties:Qi}){if(!Qi||!Hi)return Hi;const ro={},oo={},so={accumulated:null,zoom:0},Oo={properties:null},No=Object.keys(Qi);for(const Io of No){const[Do,Vo]=Qi[Io],sn=li.bC(Vo),pn=li.bC(typeof Do=="string"?[Do,["accumulated"],["get",Io]]:Do);ro[Io]=sn.value,oo[Io]=pn.value}return Hi.map=Io=>{Oo.properties=Io;const Do={};for(const Vo of No)Do[Vo]=ro[Vo].evaluate(so,Oo);return Do},Hi.reduce=(Io,Do)=>{Oo.properties=Do;for(const Vo of No)so.accumulated=Io[Vo],Io[Vo]=oo[Vo].evaluate(so,Oo)},Hi}(Ai)).load(Zr.features):function(Hi,Qi){return new go(Hi,Qi)}(Zr,Ai.geojsonVtOptions)}catch(Hi){return Ci(Hi)}this.loaded={};const Xi={};if(ji){const Hi=ji.finish();Hi&&(Xi.resourceTiming={},Xi.resourceTiming[Ai.source]=JSON.parse(JSON.stringify(Hi)))}Ci(null,Xi)}})}reloadTile(Ai,Ci){const ki=this.loaded;return ki&&ki[Ai.uid]?super.reloadTile(Ai,Ci):this.loadTile(Ai,Ci)}removeSource(Ai,Ci){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Ci()}getClusterExpansionZoom(Ai,Ci){try{Ci(null,this._geoJSONIndex.getClusterExpansionZoom(Ai.clusterId))}catch(ki){Ci(ki)}}getClusterChildren(Ai,Ci){try{Ci(null,this._geoJSONIndex.getChildren(Ai.clusterId))}catch(ki){Ci(ki)}}getClusterLeaves(Ai,Ci){try{Ci(null,this._geoJSONIndex.getLeaves(Ai.clusterId,Ai.limit,Ai.offset))}catch(ki){Ci(ki)}}}class Bs{constructor(Ai){this.self=Ai,this.actor=new li.C(Ai,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:aa,geojson:jo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Ci,ki)=>{if(this.workerSourceTypes[Ci])throw new Error(`Worker source with name "${Ci}" already registered.`);this.workerSourceTypes[Ci]=ki},this.self.registerRTLTextPlugin=Ci=>{if(li.bD.isParsed())throw new Error("RTL text plugin already registered.");li.bD.applyArabicShaping=Ci.applyArabicShaping,li.bD.processBidirectionalText=Ci.processBidirectionalText,li.bD.processStyledBidirectionalText=Ci.processStyledBidirectionalText}}setReferrer(Ai,Ci){this.referrer=Ci}setImages(Ai,Ci,ki){this.availableImages[Ai]=Ci;for(const ji in this.workerSources[Ai]){const Gi=this.workerSources[Ai][ji];for(const Zr in Gi)Gi[Zr].availableImages=Ci}ki()}setLayers(Ai,Ci,ki){this.getLayerIndex(Ai).replace(Ci),ki()}updateLayers(Ai,Ci,ki){this.getLayerIndex(Ai).update(Ci.layers,Ci.removedIds),ki()}loadTile(Ai,Ci,ki){this.getWorkerSource(Ai,Ci.type,Ci.source).loadTile(Ci,ki)}loadDEMTile(Ai,Ci,ki){this.getDEMWorkerSource(Ai,Ci.source).loadTile(Ci,ki)}reloadTile(Ai,Ci,ki){this.getWorkerSource(Ai,Ci.type,Ci.source).reloadTile(Ci,ki)}abortTile(Ai,Ci,ki){this.getWorkerSource(Ai,Ci.type,Ci.source).abortTile(Ci,ki)}removeTile(Ai,Ci,ki){this.getWorkerSource(Ai,Ci.type,Ci.source).removeTile(Ci,ki)}removeDEMTile(Ai,Ci){this.getDEMWorkerSource(Ai,Ci.source).removeTile(Ci)}removeSource(Ai,Ci,ki){if(!this.workerSources[Ai]||!this.workerSources[Ai][Ci.type]||!this.workerSources[Ai][Ci.type][Ci.source])return;const ji=this.workerSources[Ai][Ci.type][Ci.source];delete this.workerSources[Ai][Ci.type][Ci.source],ji.removeSource!==void 0?ji.removeSource(Ci,ki):ki()}loadWorkerSource(Ai,Ci,ki){try{this.self.importScripts(Ci.url),ki()}catch(ji){ki(ji.toString())}}syncRTLPluginState(Ai,Ci,ki){try{li.bD.setState(Ci);const ji=li.bD.getPluginURL();if(li.bD.isLoaded()&&!li.bD.isParsed()&&ji!=null){this.self.importScripts(ji);const Gi=li.bD.isParsed();ki(Gi?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ji}`),Gi)}}catch(ji){ki(ji.toString())}}getAvailableImages(Ai){let Ci=this.availableImages[Ai];return Ci||(Ci=[]),Ci}getLayerIndex(Ai){let Ci=this.layerIndexes[Ai];return Ci||(Ci=this.layerIndexes[Ai]=new po),Ci}getWorkerSource(Ai,Ci,ki){return this.workerSources[Ai]||(this.workerSources[Ai]={}),this.workerSources[Ai][Ci]||(this.workerSources[Ai][Ci]={}),this.workerSources[Ai][Ci][ki]||(this.workerSources[Ai][Ci][ki]=new this.workerSourceTypes[Ci]({send:(ji,Gi,Zr)=>{this.actor.send(ji,Gi,Zr,Ai)}},this.getLayerIndex(Ai),this.getAvailableImages(Ai))),this.workerSources[Ai][Ci][ki]}getDEMWorkerSource(Ai,Ci){return this.demWorkerSources[Ai]||(this.demWorkerSources[Ai]={}),this.demWorkerSources[Ai][Ci]||(this.demWorkerSources[Ai][Ci]=new wa),this.demWorkerSources[Ai][Ci]}}return li.i()&&(self.worker=new Bs(self)),Bs}),Wr(["./shared"],function(li){var po="3.6.2";class Ki{static testProp(ei){if(!Ki.docStyle)return ei[0];for(let ri=0;ri<ei.length;ri++)if(ei[ri]in Ki.docStyle)return ei[ri];return ei[0]}static create(ei,ri,ni){const si=window.document.createElement(ei);return ri!==void 0&&(si.className=ri),ni&&ni.appendChild(si),si}static createNS(ei,ri){return window.document.createElementNS(ei,ri)}static disableDrag(){Ki.docStyle&&Ki.selectProp&&(Ki.userSelect=Ki.docStyle[Ki.selectProp],Ki.docStyle[Ki.selectProp]="none")}static enableDrag(){Ki.docStyle&&Ki.selectProp&&(Ki.docStyle[Ki.selectProp]=Ki.userSelect)}static setTransform(ei,ri){ei.style[Ki.transformProp]=ri}static addEventListener(ei,ri,ni,si={}){ei.addEventListener(ri,ni,"passive"in si?si:si.capture)}static removeEventListener(ei,ri,ni,si={}){ei.removeEventListener(ri,ni,"passive"in si?si:si.capture)}static suppressClickInternal(ei){ei.preventDefault(),ei.stopPropagation(),window.removeEventListener("click",Ki.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ki.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Ki.suppressClickInternal,!0)},0)}static mousePos(ei,ri){const ni=ei.getBoundingClientRect();return new li.P(ri.clientX-ni.left-ei.clientLeft,ri.clientY-ni.top-ei.clientTop)}static touchPos(ei,ri){const ni=ei.getBoundingClientRect(),si=[];for(let hi=0;hi<ri.length;hi++)si.push(new li.P(ri[hi].clientX-ni.left-ei.clientLeft,ri[hi].clientY-ni.top-ei.clientTop));return si}static mouseButton(ei){return ei.button}static remove(ei){ei.parentNode&&ei.parentNode.removeChild(ei)}}Ki.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ki.selectProp=Ki.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ki.transformProp=Ki.testProp(["transform","WebkitTransform"]);const Lo={supported:!1,testSupport:function(ci){!aa&&fo&&(wa?$a(ci):Ro=ci)}};let Ro,fo,aa=!1,wa=!1;function $a(ci){const ei=ci.createTexture();ci.bindTexture(ci.TEXTURE_2D,ei);try{if(ci.texImage2D(ci.TEXTURE_2D,0,ci.RGBA,ci.RGBA,ci.UNSIGNED_BYTE,fo),ci.isContextLost())return;Lo.supported=!0}catch{}ci.deleteTexture(ei),aa=!0}var Ln,bn;typeof document<"u"&&(fo=document.createElement("img"),fo.onload=function(){Ro&&$a(Ro),Ro=null,wa=!0},fo.onerror=function(){aa=!0,Ro=null},fo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(ci){let ei,ri,ni,si;ci.resetRequestQueue=()=>{ei=[],ri=0,ni=0,si={}},ci.addThrottleControl=bi=>{const Ei=ni++;return si[Ei]=bi,Ei},ci.removeThrottleControl=bi=>{delete si[bi],_i()},ci.getImage=(bi,Ei,Ti=!0)=>{Lo.supported&&(bi.headers||(bi.headers={}),bi.headers.accept="image/webp,*/*");const zi={requestParameters:bi,supportImageRefresh:Ti,callback:Ei,cancelled:!1,completed:!1,cancel:()=>{zi.completed||zi.cancelled||(zi.cancelled=!0,zi.innerRequest&&(zi.innerRequest.cancel(),ri--),_i())}};return ei.push(zi),_i(),zi};const hi=bi=>{const{requestParameters:Ei,supportImageRefresh:Ti,callback:zi}=bi;return li.e(Ei,{type:"image"}),(Ti!==!1||li.i()||li.g(Ei.url)||Ei.headers&&!Object.keys(Ei.headers).reduce((Ni,Bi)=>Ni&&Bi==="accept",!0)?li.m:gi)(Ei,(Ni,Bi,Vi,Di)=>{fi(bi,zi,Ni,Bi,Vi,Di)})},fi=(bi,Ei,Ti,zi,Ni,Bi)=>{Ti?Ei(Ti):zi instanceof HTMLImageElement||li.a(zi)?Ei(null,zi):zi&&((Vi,Di)=>{typeof createImageBitmap=="function"?li.b(Vi,Di):li.d(Vi,Di)})(zi,(Vi,Di)=>{Vi!=null?Ei(Vi):Di!=null&&Ei(null,Di,{cacheControl:Ni,expires:Bi})}),bi.cancelled||(bi.completed=!0,ri--,_i())},_i=()=>{const bi=(()=>{const Ei=Object.keys(si);let Ti=!1;if(Ei.length>0){for(const zi of Ei)if(Ti=si[zi](),Ti)break}return Ti})()?li.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:li.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let Ei=ri;Ei<bi&&ei.length>0;Ei++){const Ti=ei.shift();if(Ti.cancelled){Ei--;continue}const zi=hi(Ti);ri++,Ti.innerRequest=zi}},gi=(bi,Ei)=>{const Ti=new Image,zi=bi.url;let Ni=!1;const Bi=bi.credentials;return Bi&&Bi==="include"?Ti.crossOrigin="use-credentials":(Bi&&Bi==="same-origin"||!li.s(zi))&&(Ti.crossOrigin="anonymous"),Ti.fetchPriority="high",Ti.onload=()=>{Ei(null,Ti),Ti.onerror=Ti.onload=null},Ti.onerror=()=>{Ni||Ei(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),Ti.onerror=Ti.onload=null},Ti.src=zi,{cancel:()=>{Ni=!0,Ti.src=""}}}}(Ln||(Ln={})),Ln.resetRequestQueue(),function(ci){ci.Glyphs="Glyphs",ci.Image="Image",ci.Source="Source",ci.SpriteImage="SpriteImage",ci.SpriteJSON="SpriteJSON",ci.Style="Style",ci.Tile="Tile",ci.Unknown="Unknown"}(bn||(bn={}));class fs{constructor(ei){this._transformRequestFn=ei}transformRequest(ei,ri){return this._transformRequestFn&&this._transformRequestFn(ei,ri)||{url:ei}}normalizeSpriteURL(ei,ri,ni){const si=function(hi){const fi=hi.match(sa);if(!fi)throw new Error(`Unable to parse URL "${hi}"`);return{protocol:fi[1],authority:fi[2],path:fi[3]||"/",params:fi[4]?fi[4].split("&"):[]}}(ei);return si.path+=`${ri}${ni}`,function(hi){const fi=hi.params.length?`?${hi.params.join("&")}`:"";return`${hi.protocol}://${hi.authority}${hi.path}${fi}`}(si)}setTransformRequest(ei){this._transformRequestFn=ei}}const sa=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ma(ci){var ei=new li.A(3);return ei[0]=ci[0],ei[1]=ci[1],ei[2]=ci[2],ei}var la,Za=function(ci,ei,ri){return ci[0]=ei[0]-ri[0],ci[1]=ei[1]-ri[1],ci[2]=ei[2]-ri[2],ci};la=new li.A(3),li.A!=Float32Array&&(la[0]=0,la[1]=0,la[2]=0);var oa=function(ci){var ei=ci[0],ri=ci[1];return ei*ei+ri*ri};function ln(ci){const ei=[];if(typeof ci=="string")ei.push({id:"default",url:ci});else if(ci&&ci.length>0){const ri=[];for(const{id:ni,url:si}of ci){const hi=`${ni}${si}`;ri.indexOf(hi)===-1&&(ri.push(hi),ei.push({id:ni,url:si}))}}return ei}function vs(ci,ei,ri,ni,si){if(ni)return void ci(ni);if(si!==Object.values(ei).length||si!==Object.values(ri).length)return;const hi={};for(const fi in ei){hi[fi]={};const _i=li.h.getImageCanvasContext(ri[fi]),gi=ei[fi];for(const bi in gi){const{width:Ei,height:Ti,x:zi,y:Ni,sdf:Bi,pixelRatio:Vi,stretchX:Di,stretchY:Wi,content:Kr}=gi[bi];hi[fi][bi]={data:null,pixelRatio:Vi,sdf:Bi,stretchX:Di,stretchY:Wi,content:Kr,spriteData:{width:Ei,height:Ti,x:zi,y:Ni,context:_i}}}}ci(null,hi)}(function(){var ci=new li.A(2);li.A!=Float32Array&&(ci[0]=0,ci[1]=0)})();class Wo{constructor(ei,ri,ni,si){this.context=ei,this.format=ni,this.texture=ei.gl.createTexture(),this.update(ri,si)}update(ei,ri,ni){const{width:si,height:hi}=ei,fi=!(this.size&&this.size[0]===si&&this.size[1]===hi||ni),{context:_i}=this,{gl:gi}=_i;if(this.useMipmap=!!(ri&&ri.useMipmap),gi.bindTexture(gi.TEXTURE_2D,this.texture),_i.pixelStoreUnpackFlipY.set(!1),_i.pixelStoreUnpack.set(1),_i.pixelStoreUnpackPremultiplyAlpha.set(this.format===gi.RGBA&&(!ri||ri.premultiply!==!1)),fi)this.size=[si,hi],ei instanceof HTMLImageElement||ei instanceof HTMLCanvasElement||ei instanceof HTMLVideoElement||ei instanceof ImageData||li.a(ei)?gi.texImage2D(gi.TEXTURE_2D,0,this.format,this.format,gi.UNSIGNED_BYTE,ei):gi.texImage2D(gi.TEXTURE_2D,0,this.format,si,hi,0,this.format,gi.UNSIGNED_BYTE,ei.data);else{const{x:bi,y:Ei}=ni||{x:0,y:0};ei instanceof HTMLImageElement||ei instanceof HTMLCanvasElement||ei instanceof HTMLVideoElement||ei instanceof ImageData||li.a(ei)?gi.texSubImage2D(gi.TEXTURE_2D,0,bi,Ei,gi.RGBA,gi.UNSIGNED_BYTE,ei):gi.texSubImage2D(gi.TEXTURE_2D,0,bi,Ei,si,hi,gi.RGBA,gi.UNSIGNED_BYTE,ei.data)}this.useMipmap&&this.isSizePowerOfTwo()&&gi.generateMipmap(gi.TEXTURE_2D)}bind(ei,ri,ni){const{context:si}=this,{gl:hi}=si;hi.bindTexture(hi.TEXTURE_2D,this.texture),ni!==hi.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(ni=hi.LINEAR),ei!==this.filter&&(hi.texParameteri(hi.TEXTURE_2D,hi.TEXTURE_MAG_FILTER,ei),hi.texParameteri(hi.TEXTURE_2D,hi.TEXTURE_MIN_FILTER,ni||ei),this.filter=ei),ri!==this.wrap&&(hi.texParameteri(hi.TEXTURE_2D,hi.TEXTURE_WRAP_S,ri),hi.texParameteri(hi.TEXTURE_2D,hi.TEXTURE_WRAP_T,ri),this.wrap=ri)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:ei}=this.context;ei.deleteTexture(this.texture),this.texture=null}}function fn(ci){const{userImage:ei}=ci;return!!(ei&&ei.render&&ei.render())&&(ci.data.replace(new Uint8Array(ei.data.buffer)),!0)}class Pn extends li.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new li.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(ei){if(this.loaded!==ei&&(this.loaded=ei,ei)){for(const{ids:ri,callback:ni}of this.requestors)this._notify(ri,ni);this.requestors=[]}}getImage(ei){const ri=this.images[ei];if(ri&&!ri.data&&ri.spriteData){const ni=ri.spriteData;ri.data=new li.R({width:ni.width,height:ni.height},ni.context.getImageData(ni.x,ni.y,ni.width,ni.height).data),ri.spriteData=null}return ri}addImage(ei,ri){if(this.images[ei])throw new Error(`Image id ${ei} already exist, use updateImage instead`);this._validate(ei,ri)&&(this.images[ei]=ri)}_validate(ei,ri){let ni=!0;const si=ri.data||ri.spriteData;return this._validateStretch(ri.stretchX,si&&si.width)||(this.fire(new li.j(new Error(`Image "${ei}" has invalid "stretchX" value`))),ni=!1),this._validateStretch(ri.stretchY,si&&si.height)||(this.fire(new li.j(new Error(`Image "${ei}" has invalid "stretchY" value`))),ni=!1),this._validateContent(ri.content,ri)||(this.fire(new li.j(new Error(`Image "${ei}" has invalid "content" value`))),ni=!1),ni}_validateStretch(ei,ri){if(!ei)return!0;let ni=0;for(const si of ei){if(si[0]<ni||si[1]<si[0]||ri<si[1])return!1;ni=si[1]}return!0}_validateContent(ei,ri){if(!ei)return!0;if(ei.length!==4)return!1;const ni=ri.spriteData,si=ni&&ni.width||ri.data.width,hi=ni&&ni.height||ri.data.height;return!(ei[0]<0||si<ei[0]||ei[1]<0||hi<ei[1]||ei[2]<0||si<ei[2]||ei[3]<0||hi<ei[3]||ei[2]<ei[0]||ei[3]<ei[1])}updateImage(ei,ri,ni=!0){const si=this.getImage(ei);if(ni&&(si.data.width!==ri.data.width||si.data.height!==ri.data.height))throw new Error(`size mismatch between old image (${si.data.width}x${si.data.height}) and new image (${ri.data.width}x${ri.data.height}).`);ri.version=si.version+1,this.images[ei]=ri,this.updatedImages[ei]=!0}removeImage(ei){const ri=this.images[ei];delete this.images[ei],delete this.patterns[ei],ri.userImage&&ri.userImage.onRemove&&ri.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(ei,ri){let ni=!0;if(!this.isLoaded())for(const si of ei)this.images[si]||(ni=!1);this.isLoaded()||ni?this._notify(ei,ri):this.requestors.push({ids:ei,callback:ri})}_notify(ei,ri){const ni={};for(const si of ei){let hi=this.getImage(si);hi||(this.fire(new li.k("styleimagemissing",{id:si})),hi=this.getImage(si)),hi?ni[si]={data:hi.data.clone(),pixelRatio:hi.pixelRatio,sdf:hi.sdf,version:hi.version,stretchX:hi.stretchX,stretchY:hi.stretchY,content:hi.content,hasRenderCallback:!!(hi.userImage&&hi.userImage.render)}:li.w(`Image "${si}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}ri(null,ni)}getPixelSize(){const{width:ei,height:ri}=this.atlasImage;return{width:ei,height:ri}}getPattern(ei){const ri=this.patterns[ei],ni=this.getImage(ei);if(!ni)return null;if(ri&&ri.position.version===ni.version)return ri.position;if(ri)ri.position.version=ni.version;else{const si={w:ni.data.width+2,h:ni.data.height+2,x:0,y:0},hi=new li.I(si,ni);this.patterns[ei]={bin:si,position:hi}}return this._updatePatternAtlas(),this.patterns[ei].position}bind(ei){const ri=ei.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Wo(ei,this.atlasImage,ri.RGBA),this.atlasTexture.bind(ri.LINEAR,ri.CLAMP_TO_EDGE)}_updatePatternAtlas(){const ei=[];for(const hi in this.patterns)ei.push(this.patterns[hi].bin);const{w:ri,h:ni}=li.p(ei),si=this.atlasImage;si.resize({width:ri||1,height:ni||1});for(const hi in this.patterns){const{bin:fi}=this.patterns[hi],_i=fi.x+1,gi=fi.y+1,bi=this.getImage(hi).data,Ei=bi.width,Ti=bi.height;li.R.copy(bi,si,{x:0,y:0},{x:_i,y:gi},{width:Ei,height:Ti}),li.R.copy(bi,si,{x:0,y:Ti-1},{x:_i,y:gi-1},{width:Ei,height:1}),li.R.copy(bi,si,{x:0,y:0},{x:_i,y:gi+Ti},{width:Ei,height:1}),li.R.copy(bi,si,{x:Ei-1,y:0},{x:_i-1,y:gi},{width:1,height:Ti}),li.R.copy(bi,si,{x:0,y:0},{x:_i+Ei,y:gi},{width:1,height:Ti})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(ei){for(const ri of ei){if(this.callbackDispatchedThisFrame[ri])continue;this.callbackDispatchedThisFrame[ri]=!0;const ni=this.getImage(ri);ni||li.w(`Image with ID: "${ri}" was not found`),fn(ni)&&this.updateImage(ri,ni)}}}const Ra=1e20;function On(ci,ei,ri,ni,si,hi,fi,_i,gi){for(let bi=ei;bi<ei+ni;bi++)rn(ci,ri*hi+bi,hi,si,fi,_i,gi);for(let bi=ri;bi<ri+si;bi++)rn(ci,bi*hi+ei,1,ni,fi,_i,gi)}function rn(ci,ei,ri,ni,si,hi,fi){hi[0]=0,fi[0]=-Ra,fi[1]=Ra,si[0]=ci[ei];for(let _i=1,gi=0,bi=0;_i<ni;_i++){si[_i]=ci[ei+_i*ri];const Ei=_i*_i;do{const Ti=hi[gi];bi=(si[_i]-si[Ti]+Ei-Ti*Ti)/(_i-Ti)/2}while(bi<=fi[gi]&&--gi>-1);gi++,hi[gi]=_i,fi[gi]=bi,fi[gi+1]=Ra}for(let _i=0,gi=0;_i<ni;_i++){for(;fi[gi+1]<_i;)gi++;const bi=hi[gi],Ei=_i-bi;ci[ei+_i*ri]=si[bi]+Ei*Ei}}class Sa{constructor(ei,ri){this.requestManager=ei,this.localIdeographFontFamily=ri,this.entries={}}setURL(ei){this.url=ei}getGlyphs(ei,ri){const ni=[];for(const si in ei)for(const hi of ei[si])ni.push({stack:si,id:hi});li.o(ni,({stack:si,id:hi},fi)=>{let _i=this.entries[si];_i||(_i=this.entries[si]={glyphs:{},requests:{},ranges:{}});let gi=_i.glyphs[hi];if(gi!==void 0)return void fi(null,{stack:si,id:hi,glyph:gi});if(gi=this._tinySDF(_i,si,hi),gi)return _i.glyphs[hi]=gi,void fi(null,{stack:si,id:hi,glyph:gi});const bi=Math.floor(hi/256);if(256*bi>65535)return void fi(new Error("glyphs > 65535 not supported"));if(_i.ranges[bi])return void fi(null,{stack:si,id:hi,glyph:gi});if(!this.url)return void fi(new Error("glyphsUrl is not set"));let Ei=_i.requests[bi];Ei||(Ei=_i.requests[bi]=[],Sa.loadGlyphRange(si,bi,this.url,this.requestManager,(Ti,zi)=>{if(zi){for(const Ni in zi)this._doesCharSupportLocalGlyph(+Ni)||(_i.glyphs[+Ni]=zi[+Ni]);_i.ranges[bi]=!0}for(const Ni of Ei)Ni(Ti,zi);delete _i.requests[bi]})),Ei.push((Ti,zi)=>{Ti?fi(Ti):zi&&fi(null,{stack:si,id:hi,glyph:zi[hi]||null})})},(si,hi)=>{if(si)ri(si);else if(hi){const fi={};for(const{stack:_i,id:gi,glyph:bi}of hi)(fi[_i]||(fi[_i]={}))[gi]=bi&&{id:bi.id,bitmap:bi.bitmap.clone(),metrics:bi.metrics};ri(null,fi)}})}_doesCharSupportLocalGlyph(ei){return!!this.localIdeographFontFamily&&(li.u["CJK Unified Ideographs"](ei)||li.u["Hangul Syllables"](ei)||li.u.Hiragana(ei)||li.u.Katakana(ei))}_tinySDF(ei,ri,ni){const si=this.localIdeographFontFamily;if(!si||!this._doesCharSupportLocalGlyph(ni))return;let hi=ei.tinySDF;if(!hi){let _i="400";/bold/i.test(ri)?_i="900":/medium/i.test(ri)?_i="500":/light/i.test(ri)&&(_i="200"),hi=ei.tinySDF=new Sa.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:si,fontWeight:_i})}const fi=hi.draw(String.fromCharCode(ni));return{id:ni,bitmap:new li.q({width:fi.width||60,height:fi.height||60},fi.data),metrics:{width:fi.glyphWidth/2||24,height:fi.glyphHeight/2||24,left:fi.glyphLeft/2+.5||0,top:fi.glyphTop/2-27.5||-8,advance:fi.glyphAdvance/2||24,isDoubleResolution:!0}}}}Sa.loadGlyphRange=function(ci,ei,ri,ni,si){const hi=256*ei,fi=hi+255,_i=ni.transformRequest(ri.replace("{fontstack}",ci).replace("{range}",`${hi}-${fi}`),bn.Glyphs);li.l(_i,(gi,bi)=>{if(gi)si(gi);else if(bi){const Ei={};for(const Ti of li.n(bi))Ei[Ti.id]=Ti;si(null,Ei)}})},Sa.TinySDF=class{constructor({fontSize:ci=24,buffer:ei=3,radius:ri=8,cutoff:ni=.25,fontFamily:si="sans-serif",fontWeight:hi="normal",fontStyle:fi="normal"}={}){this.buffer=ei,this.cutoff=ni,this.radius=ri;const _i=this.size=ci+4*ei,gi=this._createCanvas(_i),bi=this.ctx=gi.getContext("2d",{willReadFrequently:!0});bi.font=`${fi} ${hi} ${ci}px ${si}`,bi.textBaseline="alphabetic",bi.textAlign="left",bi.fillStyle="black",this.gridOuter=new Float64Array(_i*_i),this.gridInner=new Float64Array(_i*_i),this.f=new Float64Array(_i),this.z=new Float64Array(_i+1),this.v=new Uint16Array(_i)}_createCanvas(ci){const ei=document.createElement("canvas");return ei.width=ei.height=ci,ei}draw(ci){const{width:ei,actualBoundingBoxAscent:ri,actualBoundingBoxDescent:ni,actualBoundingBoxLeft:si,actualBoundingBoxRight:hi}=this.ctx.measureText(ci),fi=Math.ceil(ri),_i=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(hi-si))),gi=Math.min(this.size-this.buffer,fi+Math.ceil(ni)),bi=_i+2*this.buffer,Ei=gi+2*this.buffer,Ti=Math.max(bi*Ei,0),zi=new Uint8ClampedArray(Ti),Ni={data:zi,width:bi,height:Ei,glyphWidth:_i,glyphHeight:gi,glyphTop:fi,glyphLeft:0,glyphAdvance:ei};if(_i===0||gi===0)return Ni;const{ctx:Bi,buffer:Vi,gridInner:Di,gridOuter:Wi}=this;Bi.clearRect(Vi,Vi,_i,gi),Bi.fillText(ci,Vi,Vi+fi);const Kr=Bi.getImageData(Vi,Vi,_i,gi);Wi.fill(Ra,0,Ti),Di.fill(0,0,Ti);for(let $i=0;$i<gi;$i++)for(let Ji=0;Ji<_i;Ji++){const eo=Kr.data[4*($i*_i+Ji)+3]/255;if(eo===0)continue;const to=($i+Vi)*bi+Ji+Vi;if(eo===1)Wi[to]=0,Di[to]=Ra;else{const no=.5-eo;Wi[to]=no>0?no*no:0,Di[to]=no<0?no*no:0}}On(Wi,0,0,bi,Ei,bi,this.f,this.v,this.z),On(Di,Vi,Vi,_i,gi,bi,this.f,this.v,this.z);for(let $i=0;$i<Ti;$i++){const Ji=Math.sqrt(Wi[$i])-Math.sqrt(Di[$i]);zi[$i]=Math.round(255-255*(Ji/this.radius+this.cutoff))}return Ni}};class Gn{constructor(){this.specification=li.v.light.position}possiblyEvaluate(ei,ri){return li.z(ei.expression.evaluate(ri))}interpolate(ei,ri,ni){return{x:li.B.number(ei.x,ri.x,ni),y:li.B.number(ei.y,ri.y,ni),z:li.B.number(ei.z,ri.z,ni)}}}let ca;class al extends li.E{constructor(ei){super(),ca=ca||new li.r({anchor:new li.D(li.v.light.anchor),position:new Gn,color:new li.D(li.v.light.color),intensity:new li.D(li.v.light.intensity)}),this._transitionable=new li.T(ca),this.setLight(ei),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(ei,ri={}){if(!this._validate(li.t,ei,ri))for(const ni in ei){const si=ei[ni];ni.endsWith("-transition")?this._transitionable.setTransition(ni.slice(0,-11),si):this._transitionable.setValue(ni,si)}}updateTransitions(ei){this._transitioning=this._transitionable.transitioned(ei,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(ei){this.properties=this._transitioning.possiblyEvaluate(ei)}_validate(ei,ri,ni){return(!ni||ni.validate!==!1)&&li.x(this,ei.call(li.y,li.e({value:ri,style:{glyphs:!0,sprite:!0},styleSpec:li.v})))}}class sl{constructor(ei,ri){this.width=ei,this.height=ri,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(ei,ri){const ni=ei.join(",")+String(ri);return this.dashEntry[ni]||(this.dashEntry[ni]=this.addDash(ei,ri)),this.dashEntry[ni]}getDashRanges(ei,ri,ni){const si=[];let hi=ei.length%2==1?-ei[ei.length-1]*ni:0,fi=ei[0]*ni,_i=!0;si.push({left:hi,right:fi,isDash:_i,zeroLength:ei[0]===0});let gi=ei[0];for(let bi=1;bi<ei.length;bi++){_i=!_i;const Ei=ei[bi];hi=gi*ni,gi+=Ei,fi=gi*ni,si.push({left:hi,right:fi,isDash:_i,zeroLength:Ei===0})}return si}addRoundDash(ei,ri,ni){const si=ri/2;for(let hi=-ni;hi<=ni;hi++){const fi=this.width*(this.nextRow+ni+hi);let _i=0,gi=ei[_i];for(let bi=0;bi<this.width;bi++){bi/gi.right>1&&(gi=ei[++_i]);const Ei=Math.abs(bi-gi.left),Ti=Math.abs(bi-gi.right),zi=Math.min(Ei,Ti);let Ni;const Bi=hi/ni*(si+1);if(gi.isDash){const Vi=si-Math.abs(Bi);Ni=Math.sqrt(zi*zi+Vi*Vi)}else Ni=si-Math.sqrt(zi*zi+Bi*Bi);this.data[fi+bi]=Math.max(0,Math.min(255,Ni+128))}}}addRegularDash(ei){for(let _i=ei.length-1;_i>=0;--_i){const gi=ei[_i],bi=ei[_i+1];gi.zeroLength?ei.splice(_i,1):bi&&bi.isDash===gi.isDash&&(bi.left=gi.left,ei.splice(_i,1))}const ri=ei[0],ni=ei[ei.length-1];ri.isDash===ni.isDash&&(ri.left=ni.left-this.width,ni.right=ri.right+this.width);const si=this.width*this.nextRow;let hi=0,fi=ei[hi];for(let _i=0;_i<this.width;_i++){_i/fi.right>1&&(fi=ei[++hi]);const gi=Math.abs(_i-fi.left),bi=Math.abs(_i-fi.right),Ei=Math.min(gi,bi);this.data[si+_i]=Math.max(0,Math.min(255,(fi.isDash?Ei:-Ei)+128))}}addDash(ei,ri){const ni=ri?7:0,si=2*ni+1;if(this.nextRow+si>this.height)return li.w("LineAtlas out of space"),null;let hi=0;for(let _i=0;_i<ei.length;_i++)hi+=ei[_i];if(hi!==0){const _i=this.width/hi,gi=this.getDashRanges(ei,this.width,_i);ri?this.addRoundDash(gi,_i,ni):this.addRegularDash(gi)}const fi={y:(this.nextRow+ni+.5)/this.height,height:2*ni/this.height,width:hi};return this.nextRow+=si,this.dirty=!0,fi}bind(ei){const ri=ei.gl;this.texture?(ri.bindTexture(ri.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,ri.texSubImage2D(ri.TEXTURE_2D,0,0,0,this.width,this.height,ri.ALPHA,ri.UNSIGNED_BYTE,this.data))):(this.texture=ri.createTexture(),ri.bindTexture(ri.TEXTURE_2D,this.texture),ri.texParameteri(ri.TEXTURE_2D,ri.TEXTURE_WRAP_S,ri.REPEAT),ri.texParameteri(ri.TEXTURE_2D,ri.TEXTURE_WRAP_T,ri.REPEAT),ri.texParameteri(ri.TEXTURE_2D,ri.TEXTURE_MIN_FILTER,ri.LINEAR),ri.texParameteri(ri.TEXTURE_2D,ri.TEXTURE_MAG_FILTER,ri.LINEAR),ri.texImage2D(ri.TEXTURE_2D,0,ri.ALPHA,this.width,this.height,0,ri.ALPHA,ri.UNSIGNED_BYTE,this.data))}}class rs{constructor(ei,ri,ni){this.workerPool=ei,this.actors=[],this.currentActor=0,this.id=ni;const si=this.workerPool.acquire(ni);for(let hi=0;hi<si.length;hi++){const fi=new li.C(si[hi],ri,ni);fi.name=`Worker ${hi}`,this.actors.push(fi)}if(!this.actors.length)throw new Error("No actors found")}broadcast(ei,ri,ni){li.o(this.actors,(si,hi)=>{si.send(ei,ri,hi)},ni=ni||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(ei=!0){this.actors.forEach(ri=>{ri.remove()}),this.actors=[],ei&&this.workerPool.release(this.id)}}function Ma(ci,ei,ri){const ni=function(si,hi){if(si)return ri(si);if(hi){const fi=li.F(li.e(hi,ci),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);hi.vector_layers&&(fi.vectorLayers=hi.vector_layers,fi.vectorLayerIds=fi.vectorLayers.map(_i=>_i.id)),ri(null,fi)}};return ci.url?li.f(ei.transformRequest(ci.url,bn.Source),ni):li.h.frame(()=>ni(null,ci))}class hn{constructor(ei,ri){ei&&(ri?this.setSouthWest(ei).setNorthEast(ri):Array.isArray(ei)&&(ei.length===4?this.setSouthWest([ei[0],ei[1]]).setNorthEast([ei[2],ei[3]]):this.setSouthWest(ei[0]).setNorthEast(ei[1])))}setNorthEast(ei){return this._ne=ei instanceof li.L?new li.L(ei.lng,ei.lat):li.L.convert(ei),this}setSouthWest(ei){return this._sw=ei instanceof li.L?new li.L(ei.lng,ei.lat):li.L.convert(ei),this}extend(ei){const ri=this._sw,ni=this._ne;let si,hi;if(ei instanceof li.L)si=ei,hi=ei;else{if(!(ei instanceof hn))return Array.isArray(ei)?ei.length===4||ei.every(Array.isArray)?this.extend(hn.convert(ei)):this.extend(li.L.convert(ei)):ei&&("lng"in ei||"lon"in ei)&&"lat"in ei?this.extend(li.L.convert(ei)):this;if(si=ei._sw,hi=ei._ne,!si||!hi)return this}return ri||ni?(ri.lng=Math.min(si.lng,ri.lng),ri.lat=Math.min(si.lat,ri.lat),ni.lng=Math.max(hi.lng,ni.lng),ni.lat=Math.max(hi.lat,ni.lat)):(this._sw=new li.L(si.lng,si.lat),this._ne=new li.L(hi.lng,hi.lat)),this}getCenter(){return new li.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new li.L(this.getWest(),this.getNorth())}getSouthEast(){return new li.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(ei){const{lng:ri,lat:ni}=li.L.convert(ei);let si=this._sw.lng<=ri&&ri<=this._ne.lng;return this._sw.lng>this._ne.lng&&(si=this._sw.lng>=ri&&ri>=this._ne.lng),this._sw.lat<=ni&&ni<=this._ne.lat&&si}static convert(ei){return ei instanceof hn?ei:ei&&new hn(ei)}static fromLngLat(ei,ri=0){const ni=360*ri/40075017,si=ni/Math.cos(Math.PI/180*ei.lat);return new hn(new li.L(ei.lng-si,ei.lat-ni),new li.L(ei.lng+si,ei.lat+ni))}}class Xn{constructor(ei,ri,ni){this.bounds=hn.convert(this.validateBounds(ei)),this.minzoom=ri||0,this.maxzoom=ni||24}validateBounds(ei){return Array.isArray(ei)&&ei.length===4?[Math.max(-180,ei[0]),Math.max(-90,ei[1]),Math.min(180,ei[2]),Math.min(90,ei[3])]:[-180,-90,180,90]}contains(ei){const ri=Math.pow(2,ei.z),ni=Math.floor(li.G(this.bounds.getWest())*ri),si=Math.floor(li.H(this.bounds.getNorth())*ri),hi=Math.ceil(li.G(this.bounds.getEast())*ri),fi=Math.ceil(li.H(this.bounds.getSouth())*ri);return ei.x>=ni&&ei.x<hi&&ei.y>=si&&ei.y<fi}}class Bn extends li.E{constructor(ei,ri,ni,si){if(super(),this.load=()=>{this._loaded=!1,this.fire(new li.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Ma(this._options,this.map._requestManager,(hi,fi)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),hi?this.fire(new li.j(hi)):fi&&(li.e(this,fi),fi.bounds&&(this.tileBounds=new Xn(fi.bounds,this.minzoom,this.maxzoom)),this.fire(new li.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new li.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>li.e({},this._options),this.id=ei,this.dispatcher=ni,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,li.e(this,li.F(ri,["url","scheme","tileSize","promoteId"])),this._options=li.e({type:"vector"},ri),this._collectResourceTiming=ri.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(si)}loaded(){return this._loaded}hasTile(ei){return!this.tileBounds||this.tileBounds.contains(ei.canonical)}onAdd(ei){this.map=ei,this.load()}setSourceProperty(ei){this._tileJSONRequest&&this._tileJSONRequest.cancel(),ei(),this.load()}setTiles(ei){return this.setSourceProperty(()=>{this._options.tiles=ei}),this}setUrl(ei){return this.setSourceProperty(()=>{this.url=ei,this._options.url=ei}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(ei,ri){const ni=ei.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),si={request:this.map._requestManager.transformRequest(ni,bn.Tile),uid:ei.uid,tileID:ei.tileID,zoom:ei.tileID.overscaledZ,tileSize:this.tileSize*ei.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function hi(fi,_i){return delete ei.request,ei.aborted?ri(null):fi&&fi.status!==404?ri(fi):(_i&&_i.resourceTiming&&(ei.resourceTiming=_i.resourceTiming),this.map._refreshExpiredTiles&&_i&&ei.setExpiryData(_i),ei.loadVectorData(_i,this.map.painter),ri(null),void(ei.reloadCallback&&(this.loadTile(ei,ei.reloadCallback),ei.reloadCallback=null)))}si.request.collectResourceTiming=this._collectResourceTiming,ei.actor&&ei.state!=="expired"?ei.state==="loading"?ei.reloadCallback=ri:ei.request=ei.actor.send("reloadTile",si,hi.bind(this)):(ei.actor=this.dispatcher.getActor(),ei.request=ei.actor.send("loadTile",si,hi.bind(this)))}abortTile(ei){ei.request&&(ei.request.cancel(),delete ei.request),ei.actor&&ei.actor.send("abortTile",{uid:ei.uid,type:this.type,source:this.id},void 0)}unloadTile(ei){ei.unloadVectorData(),ei.actor&&ei.actor.send("removeTile",{uid:ei.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ls extends li.E{constructor(ei,ri,ni,si){super(),this.id=ei,this.dispatcher=ni,this.setEventedParent(si),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=li.e({type:"raster"},ri),li.e(this,li.F(ri,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new li.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Ma(this._options,this.map._requestManager,(ei,ri)=>{this._tileJSONRequest=null,this._loaded=!0,ei?this.fire(new li.j(ei)):ri&&(li.e(this,ri),ri.bounds&&(this.tileBounds=new Xn(ri.bounds,this.minzoom,this.maxzoom)),this.fire(new li.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new li.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(ei){this.map=ei,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(ei){this._tileJSONRequest&&this._tileJSONRequest.cancel(),ei(),this.load()}setTiles(ei){return this.setSourceProperty(()=>{this._options.tiles=ei}),this}serialize(){return li.e({},this._options)}hasTile(ei){return!this.tileBounds||this.tileBounds.contains(ei.canonical)}loadTile(ei,ri){const ni=ei.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);ei.request=Ln.getImage(this.map._requestManager.transformRequest(ni,bn.Tile),(si,hi,fi)=>{if(delete ei.request,ei.aborted)ei.state="unloaded",ri(null);else if(si)ei.state="errored",ri(si);else if(hi){this.map._refreshExpiredTiles&&fi&&ei.setExpiryData(fi);const _i=this.map.painter.context,gi=_i.gl;ei.texture=this.map.painter.getTileTexture(hi.width),ei.texture?ei.texture.update(hi,{useMipmap:!0}):(ei.texture=new Wo(_i,hi,gi.RGBA,{useMipmap:!0}),ei.texture.bind(gi.LINEAR,gi.CLAMP_TO_EDGE,gi.LINEAR_MIPMAP_NEAREST),_i.extTextureFilterAnisotropic&&gi.texParameterf(gi.TEXTURE_2D,_i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_i.extTextureFilterAnisotropicMax)),ei.state="loaded",ri(null)}},this.map._refreshExpiredTiles)}abortTile(ei,ri){ei.request&&(ei.request.cancel(),delete ei.request),ri()}unloadTile(ei,ri){ei.texture&&this.map.painter.saveTileTexture(ei.texture),ri()}hasTransition(){return!1}}class Xs extends Ls{constructor(ei,ri,ni,si){super(ei,ri,ni,si),this.type="raster-dem",this.maxzoom=22,this._options=li.e({type:"raster-dem"},ri),this.encoding=ri.encoding||"mapbox",this.redFactor=ri.redFactor,this.greenFactor=ri.greenFactor,this.blueFactor=ri.blueFactor,this.baseShift=ri.baseShift}loadTile(ei,ri){const ni=ei.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),si=this.map._requestManager.transformRequest(ni,bn.Tile);function hi(fi,_i){fi&&(ei.state="errored",ri(fi)),_i&&(ei.dem=_i,ei.needsHillshadePrepare=!0,ei.needsTerrainPrepare=!0,ei.state="loaded",ri(null))}ei.neighboringTiles=this._getNeighboringTiles(ei.tileID),ei.request=Ln.getImage(si,(fi,_i,gi)=>li._(this,void 0,void 0,function*(){if(delete ei.request,ei.aborted)ei.state="unloaded",ri(null);else if(fi)ei.state="errored",ri(fi);else if(_i){this.map._refreshExpiredTiles&&ei.setExpiryData(gi);const bi=li.a(_i)&&li.J()?_i:yield function(Ti){return li._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&li.K()){const zi=Ti.width+2,Ni=Ti.height+2;try{return new li.R({width:zi,height:Ni},yield li.M(Ti,-1,-1,zi,Ni))}catch{}}return li.h.getImageData(Ti,1)})}(_i),Ei={uid:ei.uid,coord:ei.tileID,source:this.id,rawImageData:bi,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};ei.actor&&ei.state!=="expired"||(ei.actor=this.dispatcher.getActor(),ei.actor.send("loadDEMTile",Ei,hi))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(ei){const ri=ei.canonical,ni=Math.pow(2,ri.z),si=(ri.x-1+ni)%ni,hi=ri.x===0?ei.wrap-1:ei.wrap,fi=(ri.x+1+ni)%ni,_i=ri.x+1===ni?ei.wrap+1:ei.wrap,gi={};return gi[new li.O(ei.overscaledZ,hi,ri.z,si,ri.y).key]={backfilled:!1},gi[new li.O(ei.overscaledZ,_i,ri.z,fi,ri.y).key]={backfilled:!1},ri.y>0&&(gi[new li.O(ei.overscaledZ,hi,ri.z,si,ri.y-1).key]={backfilled:!1},gi[new li.O(ei.overscaledZ,ei.wrap,ri.z,ri.x,ri.y-1).key]={backfilled:!1},gi[new li.O(ei.overscaledZ,_i,ri.z,fi,ri.y-1).key]={backfilled:!1}),ri.y+1<ni&&(gi[new li.O(ei.overscaledZ,hi,ri.z,si,ri.y+1).key]={backfilled:!1},gi[new li.O(ei.overscaledZ,ei.wrap,ri.z,ri.x,ri.y+1).key]={backfilled:!1},gi[new li.O(ei.overscaledZ,_i,ri.z,fi,ri.y+1).key]={backfilled:!1}),gi}unloadTile(ei){ei.demTexture&&this.map.painter.saveTileTexture(ei.demTexture),ei.fbo&&(ei.fbo.destroy(),delete ei.fbo),ei.dem&&delete ei.dem,delete ei.neighboringTiles,ei.state="unloaded",ei.actor&&ei.actor.send("removeDEMTile",{uid:ei.uid,source:this.id})}}class os extends li.E{constructor(ei,ri,ni,si){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>li.e({},this._options,{type:this.type,data:this._data}),this.id=ei,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=ni.getActor(),this.setEventedParent(si),this._data=ri.data,this._options=li.e({},ri),this._collectResourceTiming=ri.collectResourceTiming,ri.maxzoom!==void 0&&(this.maxzoom=ri.maxzoom),ri.type&&(this.type=ri.type),ri.attribution&&(this.attribution=ri.attribution),this.promoteId=ri.promoteId;const hi=li.N/this.tileSize;this.workerOptions=li.e({source:this.id,cluster:ri.cluster||!1,geojsonVtOptions:{buffer:(ri.buffer!==void 0?ri.buffer:128)*hi,tolerance:(ri.tolerance!==void 0?ri.tolerance:.375)*hi,extent:li.N,maxZoom:this.maxzoom,lineMetrics:ri.lineMetrics||!1,generateId:ri.generateId||!1},superclusterOptions:{maxZoom:ri.clusterMaxZoom!==void 0?ri.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,ri.clusterMinPoints||2),extent:li.N,radius:(ri.clusterRadius||50)*hi,log:!1,generateId:ri.generateId||!1},clusterProperties:ri.clusterProperties,filter:ri.filter},ri.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(ei){this.map=ei,this.load()}setData(ei){return this._data=ei,this._updateWorkerData(),this}updateData(ei){return this._updateWorkerData(ei),this}setClusterOptions(ei){return this.workerOptions.cluster=ei.cluster,ei&&(ei.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=ei.clusterRadius),ei.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=ei.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(ei,ri){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:ei,source:this.id},ri),this}getClusterChildren(ei,ri){return this.actor.send("geojson.getClusterChildren",{clusterId:ei,source:this.id},ri),this}getClusterLeaves(ei,ri,ni,si){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:ei,limit:ri,offset:ni},si),this}_updateWorkerData(ei){const ri=li.e({},this.workerOptions);ei?ri.dataDiff=ei:typeof this._data=="string"?(ri.request=this.map._requestManager.transformRequest(li.h.resolveURL(this._data),bn.Source),ri.request.collectResourceTiming=this._collectResourceTiming):ri.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new li.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,ri,(ni,si)=>{if(this._pendingLoads--,this._removed||si&&si.abandoned)return void this.fire(new li.k("dataabort",{dataType:"source"}));let hi=null;if(si&&si.resourceTiming&&si.resourceTiming[this.id]&&(hi=si.resourceTiming[this.id].slice(0)),ni)return void this.fire(new li.j(ni));const fi={dataType:"source"};this._collectResourceTiming&&hi&&hi.length>0&&li.e(fi,{resourceTiming:hi}),this.fire(new li.k("data",Object.assign(Object.assign({},fi),{sourceDataType:"metadata"}))),this.fire(new li.k("data",Object.assign(Object.assign({},fi),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(ei,ri){const ni=ei.actor?"reloadTile":"loadTile";ei.actor=this.actor;const si={type:this.type,uid:ei.uid,tileID:ei.tileID,zoom:ei.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};ei.request=this.actor.send(ni,si,(hi,fi)=>(delete ei.request,ei.unloadVectorData(),ei.aborted?ri(null):hi?ri(hi):(ei.loadVectorData(fi,this.map.painter,ni==="reloadTile"),ri(null))))}abortTile(ei){ei.request&&(ei.request.cancel(),delete ei.request),ei.aborted=!0}unloadTile(ei){ei.unloadVectorData(),this.actor.send("removeTile",{uid:ei.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Nn=li.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class La extends li.E{constructor(ei,ri,ni,si){super(),this.load=(hi,fi)=>{this._loaded=!1,this.fire(new li.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Ln.getImage(this.map._requestManager.transformRequest(this.url,bn.Image),(_i,gi)=>{this._request=null,this._loaded=!0,_i?this.fire(new li.j(_i)):gi&&(this.image=gi,hi&&(this.coordinates=hi),fi&&fi(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const hi=this.map.painter.context,fi=hi.gl;this.boundsBuffer||(this.boundsBuffer=hi.createVertexBuffer(this._boundsArray,Nn.members)),this.boundsSegments||(this.boundsSegments=li.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Wo(hi,this.image,fi.RGBA),this.texture.bind(fi.LINEAR,fi.CLAMP_TO_EDGE));let _i=!1;for(const gi in this.tiles){const bi=this.tiles[gi];bi.state!=="loaded"&&(bi.state="loaded",bi.texture=this.texture,_i=!0)}_i&&this.fire(new li.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=ei,this.dispatcher=ni,this.coordinates=ri.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(si),this.options=ri}loaded(){return this._loaded}updateImage(ei){return ei.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=ei.url,this.load(ei.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new li.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(ei){this.map=ei,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(ei){this.coordinates=ei;const ri=ei.map(li.U.fromLngLat);this.tileID=function(si){let hi=1/0,fi=1/0,_i=-1/0,gi=-1/0;for(const zi of si)hi=Math.min(hi,zi.x),fi=Math.min(fi,zi.y),_i=Math.max(_i,zi.x),gi=Math.max(gi,zi.y);const bi=Math.max(_i-hi,gi-fi),Ei=Math.max(0,Math.floor(-Math.log(bi)/Math.LN2)),Ti=Math.pow(2,Ei);return new li.W(Ei,Math.floor((hi+_i)/2*Ti),Math.floor((fi+gi)/2*Ti))}(ri),this.minzoom=this.maxzoom=this.tileID.z;const ni=ri.map(si=>this.tileID.getTilePoint(si)._round());return this._boundsArray=new li.V,this._boundsArray.emplaceBack(ni[0].x,ni[0].y,0,0),this._boundsArray.emplaceBack(ni[1].x,ni[1].y,li.N,0),this._boundsArray.emplaceBack(ni[3].x,ni[3].y,0,li.N),this._boundsArray.emplaceBack(ni[2].x,ni[2].y,li.N,li.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new li.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(ei,ri){this.tileID&&this.tileID.equals(ei.tileID.canonical)?(this.tiles[String(ei.tileID.wrap)]=ei,ei.buckets={},ri(null)):(ei.state="errored",ri(null))}hasTransition(){return!1}}class Os extends La{constructor(ei,ri,ni,si){super(ei,ri,ni,si),this.load=()=>{this._loaded=!1;const hi=this.options;this.urls=[];for(const fi of hi.urls)this.urls.push(this.map._requestManager.transformRequest(fi,bn.Source).url);li.X(this.urls,(fi,_i)=>{this._loaded=!0,fi?this.fire(new li.j(fi)):_i&&(this.video=_i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const hi=this.map.painter.context,fi=hi.gl;this.boundsBuffer||(this.boundsBuffer=hi.createVertexBuffer(this._boundsArray,Nn.members)),this.boundsSegments||(this.boundsSegments=li.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(fi.LINEAR,fi.CLAMP_TO_EDGE),fi.texSubImage2D(fi.TEXTURE_2D,0,0,0,fi.RGBA,fi.UNSIGNED_BYTE,this.video)):(this.texture=new Wo(hi,this.video,fi.RGBA),this.texture.bind(fi.LINEAR,fi.CLAMP_TO_EDGE));let _i=!1;for(const gi in this.tiles){const bi=this.tiles[gi];bi.state!=="loaded"&&(bi.state="loaded",bi.texture=this.texture,_i=!0)}_i&&this.fire(new li.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=ri}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(ei){if(this.video){const ri=this.video.seekable;ei<ri.start(0)||ei>ri.end(0)?this.fire(new li.j(new li.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${ri.start(0)} and ${ri.end(0)}-second mark.`))):this.video.currentTime=ei}}getVideo(){return this.video}onAdd(ei){this.map||(this.map=ei,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class bs extends La{constructor(ei,ri,ni,si){super(ei,ri,ni,si),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new li.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let hi=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,hi=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,hi=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const fi=this.map.painter.context,_i=fi.gl;this.boundsBuffer||(this.boundsBuffer=fi.createVertexBuffer(this._boundsArray,Nn.members)),this.boundsSegments||(this.boundsSegments=li.S.simpleSegment(0,0,4,2)),this.texture?(hi||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Wo(fi,this.canvas,_i.RGBA,{premultiply:!0});let gi=!1;for(const bi in this.tiles){const Ei=this.tiles[bi];Ei.state!=="loaded"&&(Ei.state="loaded",Ei.texture=this.texture,gi=!0)}gi&&this.fire(new li.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),ri.coordinates?Array.isArray(ri.coordinates)&&ri.coordinates.length===4&&!ri.coordinates.some(hi=>!Array.isArray(hi)||hi.length!==2||hi.some(fi=>typeof fi!="number"))||this.fire(new li.j(new li.Y(`sources.${ei}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new li.j(new li.Y(`sources.${ei}`,null,'missing required property "coordinates"'))),ri.animate&&typeof ri.animate!="boolean"&&this.fire(new li.j(new li.Y(`sources.${ei}`,null,'optional "animate" property must be a boolean value'))),ri.canvas?typeof ri.canvas=="string"||ri.canvas instanceof HTMLCanvasElement||this.fire(new li.j(new li.Y(`sources.${ei}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new li.j(new li.Y(`sources.${ei}`,null,'missing required property "canvas"'))),this.options=ri,this.animate=ri.animate===void 0||ri.animate}getCanvas(){return this.canvas}onAdd(ei){this.map=ei,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const ei of[this.canvas.width,this.canvas.height])if(isNaN(ei)||ei<=0)return!0;return!1}}const Un={},Oa=ci=>{switch(ci){case"geojson":return os;case"image":return La;case"raster":return Ls;case"raster-dem":return Xs;case"vector":return Bn;case"video":return Os;case"canvas":return bs}return Un[ci]};function ms(ci,ei){const ri=li.Z();return li.$(ri,ri,[1,1,0]),li.a0(ri,ri,[.5*ci.width,.5*ci.height,1]),li.a1(ri,ri,ci.calculatePosMatrix(ei.toUnwrapped()))}function ks(ci,ei,ri,ni,si,hi){const fi=function(Ti,zi,Ni){if(Ti)for(const Bi of Ti){const Vi=zi[Bi];if(Vi&&Vi.source===Ni&&Vi.type==="fill-extrusion")return!0}else for(const Bi in zi){const Vi=zi[Bi];if(Vi.source===Ni&&Vi.type==="fill-extrusion")return!0}return!1}(si&&si.layers,ei,ci.id),_i=hi.maxPitchScaleFactor(),gi=ci.tilesIn(ni,_i,fi);gi.sort($n);const bi=[];for(const Ti of gi)bi.push({wrappedTileID:Ti.tileID.wrapped().key,queryResults:Ti.tile.queryRenderedFeatures(ei,ri,ci._state,Ti.queryGeometry,Ti.cameraQueryGeometry,Ti.scale,si,hi,_i,ms(ci.transform,Ti.tileID))});const Ei=function(Ti){const zi={},Ni={};for(const Bi of Ti){const Vi=Bi.queryResults,Di=Bi.wrappedTileID,Wi=Ni[Di]=Ni[Di]||{};for(const Kr in Vi){const $i=Vi[Kr],Ji=Wi[Kr]=Wi[Kr]||{},eo=zi[Kr]=zi[Kr]||[];for(const to of $i)Ji[to.featureIndex]||(Ji[to.featureIndex]=!0,eo.push(to))}}return zi}(bi);for(const Ti in Ei)Ei[Ti].forEach(zi=>{const Ni=zi.feature,Bi=ci.getFeatureState(Ni.layer["source-layer"],Ni.id);Ni.source=Ni.layer.source,Ni.layer["source-layer"]&&(Ni.sourceLayer=Ni.layer["source-layer"]),Ni.state=Bi});return Ei}function $n(ci,ei){const ri=ci.tileID,ni=ei.tileID;return ri.overscaledZ-ni.overscaledZ||ri.canonical.y-ni.canonical.y||ri.wrap-ni.wrap||ri.canonical.x-ni.canonical.x}class na{constructor(ei,ri){this.timeAdded=0,this.fadeEndTime=0,this.tileID=ei,this.uid=li.a2(),this.uses=0,this.tileSize=ri,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(ei){const ri=ei+this.timeAdded;ri<this.fadeEndTime||(this.fadeEndTime=ri)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(ei){this.demTexture&&ei.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(ei,ri,ni){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",ei){ei.featureIndex&&(this.latestFeatureIndex=ei.featureIndex,ei.rawTileData?(this.latestRawTileData=ei.rawTileData,this.latestFeatureIndex.rawTileData=ei.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=ei.collisionBoxArray,this.buckets=function(si,hi){const fi={};if(!hi)return fi;for(const _i of si){const gi=_i.layerIds.map(bi=>hi.getLayer(bi)).filter(Boolean);if(gi.length!==0){_i.layers=gi,_i.stateDependentLayerIds&&(_i.stateDependentLayers=_i.stateDependentLayerIds.map(bi=>gi.filter(Ei=>Ei.id===bi)[0]));for(const bi of gi)fi[bi.id]=_i}}return fi}(ei.buckets,ri.style),this.hasSymbolBuckets=!1;for(const si in this.buckets){const hi=this.buckets[si];if(hi instanceof li.a4){if(this.hasSymbolBuckets=!0,!ni)break;hi.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const si in this.buckets){const hi=this.buckets[si];if(hi instanceof li.a4&&hi.hasRTLText){this.hasRTLText=!0,li.a5();break}}this.queryPadding=0;for(const si in this.buckets){const hi=this.buckets[si];this.queryPadding=Math.max(this.queryPadding,ri.style.getLayer(si).queryRadius(hi))}ei.imageAtlas&&(this.imageAtlas=ei.imageAtlas),ei.glyphAtlasImage&&(this.glyphAtlasImage=ei.glyphAtlasImage)}else this.collisionBoxArray=new li.a3}unloadVectorData(){for(const ei in this.buckets)this.buckets[ei].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(ei){return this.buckets[ei.id]}upload(ei){for(const ni in this.buckets){const si=this.buckets[ni];si.uploadPending()&&si.upload(ei)}const ri=ei.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Wo(ei,this.imageAtlas.image,ri.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Wo(ei,this.glyphAtlasImage,ri.ALPHA),this.glyphAtlasImage=null)}prepare(ei){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(ei,this.imageAtlasTexture)}queryRenderedFeatures(ei,ri,ni,si,hi,fi,_i,gi,bi,Ei){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:si,cameraQueryGeometry:hi,scale:fi,tileSize:this.tileSize,pixelPosMatrix:Ei,transform:gi,params:_i,queryPadding:this.queryPadding*bi},ei,ri,ni):{}}querySourceFeatures(ei,ri){const ni=this.latestFeatureIndex;if(!ni||!ni.rawTileData)return;const si=ni.loadVTLayers(),hi=ri&&ri.sourceLayer?ri.sourceLayer:"",fi=si._geojsonTileLayer||si[hi];if(!fi)return;const _i=li.a6(ri&&ri.filter),{z:gi,x:bi,y:Ei}=this.tileID.canonical,Ti={z:gi,x:bi,y:Ei};for(let zi=0;zi<fi.length;zi++){const Ni=fi.feature(zi);if(_i.needGeometry){const Di=li.a7(Ni,!0);if(!_i.filter(new li.a8(this.tileID.overscaledZ),Di,this.tileID.canonical))continue}else if(!_i.filter(new li.a8(this.tileID.overscaledZ),Ni))continue;const Bi=ni.getId(Ni,hi),Vi=new li.a9(Ni,gi,bi,Ei,Bi);Vi.tile=Ti,ei.push(Vi)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(ei){const ri=this.expirationTime;if(ei.cacheControl){const ni=li.aa(ei.cacheControl);ni["max-age"]&&(this.expirationTime=Date.now()+1e3*ni["max-age"])}else ei.expires&&(this.expirationTime=new Date(ei.expires).getTime());if(this.expirationTime){const ni=Date.now();let si=!1;if(this.expirationTime>ni)si=!1;else if(ri)if(this.expirationTime<ri)si=!0;else{const hi=this.expirationTime-ri;hi?this.expirationTime=ni+Math.max(hi,3e4):si=!0}else si=!0;si?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(ei,ri){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(ei).length===0)return;const ni=this.latestFeatureIndex.loadVTLayers();for(const si in this.buckets){if(!ri.style.hasLayer(si))continue;const hi=this.buckets[si],fi=hi.layers[0].sourceLayer||"_geojsonTileLayer",_i=ni[fi],gi=ei[fi];if(!_i||!gi||Object.keys(gi).length===0)continue;hi.update(gi,_i,this.imageAtlas&&this.imageAtlas.patternPositions||{});const bi=ri&&ri.style&&ri.style.getLayer(si);bi&&(this.queryPadding=Math.max(this.queryPadding,bi.queryRadius(hi)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<li.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(ei){this.symbolFadeHoldUntil=li.h.now()+ei}setDependencies(ei,ri){const ni={};for(const si of ri)ni[si]=!0;this.dependencies[ei]=ni}hasDependency(ei,ri){for(const ni of ei){const si=this.dependencies[ni];if(si){for(const hi of ri)if(si[hi])return!0}}return!1}}class ka{constructor(ei,ri){this.max=ei,this.onRemove=ri,this.reset()}reset(){for(const ei in this.data)for(const ri of this.data[ei])ri.timeout&&clearTimeout(ri.timeout),this.onRemove(ri.value);return this.data={},this.order=[],this}add(ei,ri,ni){const si=ei.wrapped().key;this.data[si]===void 0&&(this.data[si]=[]);const hi={value:ri,timeout:void 0};if(ni!==void 0&&(hi.timeout=setTimeout(()=>{this.remove(ei,hi)},ni)),this.data[si].push(hi),this.order.push(si),this.order.length>this.max){const fi=this._getAndRemoveByKey(this.order[0]);fi&&this.onRemove(fi)}return this}has(ei){return ei.wrapped().key in this.data}getAndRemove(ei){return this.has(ei)?this._getAndRemoveByKey(ei.wrapped().key):null}_getAndRemoveByKey(ei){const ri=this.data[ei].shift();return ri.timeout&&clearTimeout(ri.timeout),this.data[ei].length===0&&delete this.data[ei],this.order.splice(this.order.indexOf(ei),1),ri.value}getByKey(ei){const ri=this.data[ei];return ri?ri[0].value:null}get(ei){return this.has(ei)?this.data[ei.wrapped().key][0].value:null}remove(ei,ri){if(!this.has(ei))return this;const ni=ei.wrapped().key,si=ri===void 0?0:this.data[ni].indexOf(ri),hi=this.data[ni][si];return this.data[ni].splice(si,1),hi.timeout&&clearTimeout(hi.timeout),this.data[ni].length===0&&delete this.data[ni],this.onRemove(hi.value),this.order.splice(this.order.indexOf(ni),1),this}setMaxSize(ei){for(this.max=ei;this.order.length>this.max;){const ri=this._getAndRemoveByKey(this.order[0]);ri&&this.onRemove(ri)}return this}filter(ei){const ri=[];for(const ni in this.data)for(const si of this.data[ni])ei(si.value)||ri.push(si);for(const ni of ri)this.remove(ni.value.tileID,ni)}}class io{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(ei,ri,ni){const si=String(ri);if(this.stateChanges[ei]=this.stateChanges[ei]||{},this.stateChanges[ei][si]=this.stateChanges[ei][si]||{},li.e(this.stateChanges[ei][si],ni),this.deletedStates[ei]===null){this.deletedStates[ei]={};for(const hi in this.state[ei])hi!==si&&(this.deletedStates[ei][hi]=null)}else if(this.deletedStates[ei]&&this.deletedStates[ei][si]===null){this.deletedStates[ei][si]={};for(const hi in this.state[ei][si])ni[hi]||(this.deletedStates[ei][si][hi]=null)}else for(const hi in ni)this.deletedStates[ei]&&this.deletedStates[ei][si]&&this.deletedStates[ei][si][hi]===null&&delete this.deletedStates[ei][si][hi]}removeFeatureState(ei,ri,ni){if(this.deletedStates[ei]===null)return;const si=String(ri);if(this.deletedStates[ei]=this.deletedStates[ei]||{},ni&&ri!==void 0)this.deletedStates[ei][si]!==null&&(this.deletedStates[ei][si]=this.deletedStates[ei][si]||{},this.deletedStates[ei][si][ni]=null);else if(ri!==void 0)if(this.stateChanges[ei]&&this.stateChanges[ei][si])for(ni in this.deletedStates[ei][si]={},this.stateChanges[ei][si])this.deletedStates[ei][si][ni]=null;else this.deletedStates[ei][si]=null;else this.deletedStates[ei]=null}getState(ei,ri){const ni=String(ri),si=li.e({},(this.state[ei]||{})[ni],(this.stateChanges[ei]||{})[ni]);if(this.deletedStates[ei]===null)return{};if(this.deletedStates[ei]){const hi=this.deletedStates[ei][ri];if(hi===null)return{};for(const fi in hi)delete si[fi]}return si}initializeTileState(ei,ri){ei.setFeatureState(this.state,ri)}coalesceChanges(ei,ri){const ni={};for(const si in this.stateChanges){this.state[si]=this.state[si]||{};const hi={};for(const fi in this.stateChanges[si])this.state[si][fi]||(this.state[si][fi]={}),li.e(this.state[si][fi],this.stateChanges[si][fi]),hi[fi]=this.state[si][fi];ni[si]=hi}for(const si in this.deletedStates){this.state[si]=this.state[si]||{};const hi={};if(this.deletedStates[si]===null)for(const fi in this.state[si])hi[fi]={},this.state[si][fi]={};else for(const fi in this.deletedStates[si]){if(this.deletedStates[si][fi]===null)this.state[si][fi]={};else for(const _i of Object.keys(this.deletedStates[si][fi]))delete this.state[si][fi][_i];hi[fi]=this.state[si][fi]}ni[si]=ni[si]||{},li.e(ni[si],hi)}if(this.stateChanges={},this.deletedStates={},Object.keys(ni).length!==0)for(const si in ei)ei[si].setFeatureState(ni,ri)}}class Da extends li.E{constructor(ei,ri,ni){super(),this.id=ei,this.dispatcher=ni,this.on("data",si=>{si.dataType==="source"&&si.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&si.dataType==="source"&&si.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((si,hi,fi,_i)=>{const gi=new(Oa(hi.type))(si,hi,fi,_i);if(gi.id!==si)throw new Error(`Expected Source id to be ${si} instead of ${gi.id}`);return gi})(ei,ri,ni,this),this._tiles={},this._cache=new ka(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new io,this._didEmitContent=!1,this._updated=!1}onAdd(ei){this.map=ei,this._maxTileCacheSize=ei?ei._maxTileCacheSize:null,this._maxTileCacheZoomLevels=ei?ei._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(ei)}onRemove(ei){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(ei)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const ei in this._tiles){const ri=this._tiles[ei];if(ri.state!=="loaded"&&ri.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const ei=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,ei&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(ei,ri){return this._source.loadTile(ei,ri)}_unloadTile(ei){if(this._source.unloadTile)return this._source.unloadTile(ei,()=>{})}_abortTile(ei){this._source.abortTile&&this._source.abortTile(ei,()=>{}),this._source.fire(new li.k("dataabort",{tile:ei,coord:ei.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(ei){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const ri in this._tiles){const ni=this._tiles[ri];ni.upload(ei),ni.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(ei=>ei.tileID).sort(ns).map(ei=>ei.key)}getRenderableIds(ei){const ri=[];for(const ni in this._tiles)this._isIdRenderable(ni,ei)&&ri.push(this._tiles[ni]);return ei?ri.sort((ni,si)=>{const hi=ni.tileID,fi=si.tileID,_i=new li.P(hi.canonical.x,hi.canonical.y)._rotate(this.transform.angle),gi=new li.P(fi.canonical.x,fi.canonical.y)._rotate(this.transform.angle);return hi.overscaledZ-fi.overscaledZ||gi.y-_i.y||gi.x-_i.x}).map(ni=>ni.tileID.key):ri.map(ni=>ni.tileID).sort(ns).map(ni=>ni.key)}hasRenderableParent(ei){const ri=this.findLoadedParent(ei,0);return!!ri&&this._isIdRenderable(ri.tileID.key)}_isIdRenderable(ei,ri){return this._tiles[ei]&&this._tiles[ei].hasData()&&!this._coveredTiles[ei]&&(ri||!this._tiles[ei].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const ei in this._tiles)this._tiles[ei].state!=="errored"&&this._reloadTile(ei,"reloading")}}_reloadTile(ei,ri){const ni=this._tiles[ei];ni&&(ni.state!=="loading"&&(ni.state=ri),this._loadTile(ni,this._tileLoaded.bind(this,ni,ei,ri)))}_tileLoaded(ei,ri,ni,si){if(si)return ei.state="errored",void(si.status!==404?this._source.fire(new li.j(si,{tile:ei})):this.update(this.transform,this.terrain));ei.timeAdded=li.h.now(),ni==="expired"&&(ei.refreshedUponExpiration=!0),this._setTileReloadTimer(ri,ei),this.getSource().type==="raster-dem"&&ei.dem&&this._backfillDEM(ei),this._state.initializeTileState(ei,this.map?this.map.painter:null),ei.aborted||this._source.fire(new li.k("data",{dataType:"source",tile:ei,coord:ei.tileID}))}_backfillDEM(ei){const ri=this.getRenderableIds();for(let si=0;si<ri.length;si++){const hi=ri[si];if(ei.neighboringTiles&&ei.neighboringTiles[hi]){const fi=this.getTileByID(hi);ni(ei,fi),ni(fi,ei)}}function ni(si,hi){si.needsHillshadePrepare=!0,si.needsTerrainPrepare=!0;let fi=hi.tileID.canonical.x-si.tileID.canonical.x;const _i=hi.tileID.canonical.y-si.tileID.canonical.y,gi=Math.pow(2,si.tileID.canonical.z),bi=hi.tileID.key;fi===0&&_i===0||Math.abs(_i)>1||(Math.abs(fi)>1&&(Math.abs(fi+gi)===1?fi+=gi:Math.abs(fi-gi)===1&&(fi-=gi)),hi.dem&&si.dem&&(si.dem.backfillBorder(hi.dem,fi,_i),si.neighboringTiles&&si.neighboringTiles[bi]&&(si.neighboringTiles[bi].backfilled=!0)))}}getTile(ei){return this.getTileByID(ei.key)}getTileByID(ei){return this._tiles[ei]}_retainLoadedChildren(ei,ri,ni,si){for(const hi in this._tiles){let fi=this._tiles[hi];if(si[hi]||!fi.hasData()||fi.tileID.overscaledZ<=ri||fi.tileID.overscaledZ>ni)continue;let _i=fi.tileID;for(;fi&&fi.tileID.overscaledZ>ri+1;){const bi=fi.tileID.scaledTo(fi.tileID.overscaledZ-1);fi=this._tiles[bi.key],fi&&fi.hasData()&&(_i=bi)}let gi=_i;for(;gi.overscaledZ>ri;)if(gi=gi.scaledTo(gi.overscaledZ-1),ei[gi.key]){si[_i.key]=_i;break}}}findLoadedParent(ei,ri){if(ei.key in this._loadedParentTiles){const ni=this._loadedParentTiles[ei.key];return ni&&ni.tileID.overscaledZ>=ri?ni:null}for(let ni=ei.overscaledZ-1;ni>=ri;ni--){const si=ei.scaledTo(ni),hi=this._getLoadedTile(si);if(hi)return hi}}_getLoadedTile(ei){const ri=this._tiles[ei.key];return ri&&ri.hasData()?ri:this._cache.getByKey(ei.wrapped().key)}updateCacheSize(ei){const ri=Math.ceil(ei.width/this._source.tileSize)+1,ni=Math.ceil(ei.height/this._source.tileSize)+1,si=Math.floor(ri*ni*(this._maxTileCacheZoomLevels===null?li.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),hi=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,si):si;this._cache.setMaxSize(hi)}handleWrapJump(ei){const ri=Math.round((ei-(this._prevLng===void 0?ei:this._prevLng))/360);if(this._prevLng=ei,ri){const ni={};for(const si in this._tiles){const hi=this._tiles[si];hi.tileID=hi.tileID.unwrapTo(hi.tileID.wrap+ri),ni[hi.tileID.key]=hi}this._tiles=ni;for(const si in this._timers)clearTimeout(this._timers[si]),delete this._timers[si];for(const si in this._tiles)this._setTileReloadTimer(si,this._tiles[si])}}update(ei,ri){if(this.transform=ei,this.terrain=ri,!this._sourceLoaded||this._paused)return;let ni;this.updateCacheSize(ei),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?ni=ei.getVisibleUnwrappedCoordinates(this._source.tileID).map(Ei=>new li.O(Ei.canonical.z,Ei.wrap,Ei.canonical.z,Ei.canonical.x,Ei.canonical.y)):(ni=ei.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:ri}),this._source.hasTile&&(ni=ni.filter(Ei=>this._source.hasTile(Ei)))):ni=[];const si=ei.coveringZoomLevel(this._source),hi=Math.max(si-Da.maxOverzooming,this._source.minzoom),fi=Math.max(si+Da.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Ei={};for(const Ti of ni)if(Ti.canonical.z>this._source.minzoom){const zi=Ti.scaledTo(Ti.canonical.z-1);Ei[zi.key]=zi;const Ni=Ti.scaledTo(Math.max(this._source.minzoom,Math.min(Ti.canonical.z,5)));Ei[Ni.key]=Ni}ni=ni.concat(Object.values(Ei))}const _i=ni.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_i&&this.fire(new li.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const gi=this._updateRetainedTiles(ni,si);if(mn(this._source.type)){const Ei={},Ti={},zi=Object.keys(gi),Ni=li.h.now();for(const Bi of zi){const Vi=gi[Bi],Di=this._tiles[Bi];if(!Di||Di.fadeEndTime!==0&&Di.fadeEndTime<=Ni)continue;const Wi=this.findLoadedParent(Vi,hi);Wi&&(this._addTile(Wi.tileID),Ei[Wi.tileID.key]=Wi.tileID),Ti[Bi]=Vi}this._retainLoadedChildren(Ti,si,fi,gi);for(const Bi in Ei)gi[Bi]||(this._coveredTiles[Bi]=!0,gi[Bi]=Ei[Bi]);if(ri){const Bi={},Vi={};for(const Di of ni)this._tiles[Di.key].hasData()?Bi[Di.key]=Di:Vi[Di.key]=Di;for(const Di in Vi){const Wi=Vi[Di].children(this._source.maxzoom);this._tiles[Wi[0].key]&&this._tiles[Wi[1].key]&&this._tiles[Wi[2].key]&&this._tiles[Wi[3].key]&&(Bi[Wi[0].key]=gi[Wi[0].key]=Wi[0],Bi[Wi[1].key]=gi[Wi[1].key]=Wi[1],Bi[Wi[2].key]=gi[Wi[2].key]=Wi[2],Bi[Wi[3].key]=gi[Wi[3].key]=Wi[3],delete Vi[Di])}for(const Di in Vi){const Wi=this.findLoadedParent(Vi[Di],this._source.minzoom);if(Wi){Bi[Wi.tileID.key]=gi[Wi.tileID.key]=Wi.tileID;for(const Kr in Bi)Bi[Kr].isChildOf(Wi.tileID)&&delete Bi[Kr]}}for(const Di in this._tiles)Bi[Di]||(this._coveredTiles[Di]=!0)}}for(const Ei in gi)this._tiles[Ei].clearFadeHold();const bi=li.ab(this._tiles,gi);for(const Ei of bi){const Ti=this._tiles[Ei];Ti.hasSymbolBuckets&&!Ti.holdingForFade()?Ti.setHoldDuration(this.map._fadeDuration):Ti.hasSymbolBuckets&&!Ti.symbolFadeFinished()||this._removeTile(Ei)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const ei in this._tiles)this._tiles[ei].holdingForFade()&&this._removeTile(ei)}_updateRetainedTiles(ei,ri){const ni={},si={},hi=Math.max(ri-Da.maxOverzooming,this._source.minzoom),fi=Math.max(ri+Da.maxUnderzooming,this._source.minzoom),_i={};for(const gi of ei){const bi=this._addTile(gi);ni[gi.key]=gi,bi.hasData()||ri<this._source.maxzoom&&(_i[gi.key]=gi)}this._retainLoadedChildren(_i,ri,fi,ni);for(const gi of ei){let bi=this._tiles[gi.key];if(bi.hasData())continue;if(ri+1>this._source.maxzoom){const Ti=gi.children(this._source.maxzoom)[0],zi=this.getTile(Ti);if(zi&&zi.hasData()){ni[Ti.key]=Ti;continue}}else{const Ti=gi.children(this._source.maxzoom);if(ni[Ti[0].key]&&ni[Ti[1].key]&&ni[Ti[2].key]&&ni[Ti[3].key])continue}let Ei=bi.wasRequested();for(let Ti=gi.overscaledZ-1;Ti>=hi;--Ti){const zi=gi.scaledTo(Ti);if(si[zi.key])break;if(si[zi.key]=!0,bi=this.getTile(zi),!bi&&Ei&&(bi=this._addTile(zi)),bi){const Ni=bi.hasData();if((Ei||Ni)&&(ni[zi.key]=zi),Ei=bi.wasRequested(),Ni)break}}}return ni}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const ei in this._tiles){const ri=[];let ni,si=this._tiles[ei].tileID;for(;si.overscaledZ>0;){if(si.key in this._loadedParentTiles){ni=this._loadedParentTiles[si.key];break}ri.push(si.key);const hi=si.scaledTo(si.overscaledZ-1);if(ni=this._getLoadedTile(hi),ni)break;si=hi}for(const hi of ri)this._loadedParentTiles[hi]=ni}}_addTile(ei){let ri=this._tiles[ei.key];if(ri)return ri;ri=this._cache.getAndRemove(ei),ri&&(this._setTileReloadTimer(ei.key,ri),ri.tileID=ei,this._state.initializeTileState(ri,this.map?this.map.painter:null),this._cacheTimers[ei.key]&&(clearTimeout(this._cacheTimers[ei.key]),delete this._cacheTimers[ei.key],this._setTileReloadTimer(ei.key,ri)));const ni=ri;return ri||(ri=new na(ei,this._source.tileSize*ei.overscaleFactor()),this._loadTile(ri,this._tileLoaded.bind(this,ri,ei.key,ri.state))),ri.uses++,this._tiles[ei.key]=ri,ni||this._source.fire(new li.k("dataloading",{tile:ri,coord:ri.tileID,dataType:"source"})),ri}_setTileReloadTimer(ei,ri){ei in this._timers&&(clearTimeout(this._timers[ei]),delete this._timers[ei]);const ni=ri.getExpiryTimeout();ni&&(this._timers[ei]=setTimeout(()=>{this._reloadTile(ei,"expired"),delete this._timers[ei]},ni))}_removeTile(ei){const ri=this._tiles[ei];ri&&(ri.uses--,delete this._tiles[ei],this._timers[ei]&&(clearTimeout(this._timers[ei]),delete this._timers[ei]),ri.uses>0||(ri.hasData()&&ri.state!=="reloading"?this._cache.add(ri.tileID,ri,ri.getExpiryTimeout()):(ri.aborted=!0,this._abortTile(ri),this._unloadTile(ri))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const ei in this._tiles)this._removeTile(ei);this._cache.reset()}tilesIn(ei,ri,ni){const si=[],hi=this.transform;if(!hi)return si;const fi=ni?hi.getCameraQueryGeometry(ei):ei,_i=ei.map(Bi=>hi.pointCoordinate(Bi,this.terrain)),gi=fi.map(Bi=>hi.pointCoordinate(Bi,this.terrain)),bi=this.getIds();let Ei=1/0,Ti=1/0,zi=-1/0,Ni=-1/0;for(const Bi of gi)Ei=Math.min(Ei,Bi.x),Ti=Math.min(Ti,Bi.y),zi=Math.max(zi,Bi.x),Ni=Math.max(Ni,Bi.y);for(let Bi=0;Bi<bi.length;Bi++){const Vi=this._tiles[bi[Bi]];if(Vi.holdingForFade())continue;const Di=Vi.tileID,Wi=Math.pow(2,hi.zoom-Vi.tileID.overscaledZ),Kr=ri*Vi.queryPadding*li.N/Vi.tileSize/Wi,$i=[Di.getTilePoint(new li.U(Ei,Ti)),Di.getTilePoint(new li.U(zi,Ni))];if($i[0].x-Kr<li.N&&$i[0].y-Kr<li.N&&$i[1].x+Kr>=0&&$i[1].y+Kr>=0){const Ji=_i.map(to=>Di.getTilePoint(to)),eo=gi.map(to=>Di.getTilePoint(to));si.push({tile:Vi,tileID:Di,queryGeometry:Ji,cameraQueryGeometry:eo,scale:Wi})}}return si}getVisibleCoordinates(ei){const ri=this.getRenderableIds(ei).map(ni=>this._tiles[ni].tileID);for(const ni of ri)ni.posMatrix=this.transform.calculatePosMatrix(ni.toUnwrapped());return ri}hasTransition(){if(this._source.hasTransition())return!0;if(mn(this._source.type)){const ei=li.h.now();for(const ri in this._tiles)if(this._tiles[ri].fadeEndTime>=ei)return!0}return!1}setFeatureState(ei,ri,ni){this._state.updateState(ei=ei||"_geojsonTileLayer",ri,ni)}removeFeatureState(ei,ri,ni){this._state.removeFeatureState(ei=ei||"_geojsonTileLayer",ri,ni)}getFeatureState(ei,ri){return this._state.getState(ei=ei||"_geojsonTileLayer",ri)}setDependencies(ei,ri,ni){const si=this._tiles[ei];si&&si.setDependencies(ri,ni)}reloadTilesForDependencies(ei,ri){for(const ni in this._tiles)this._tiles[ni].hasDependency(ei,ri)&&this._reloadTile(ni,"reloading");this._cache.filter(ni=>!ni.hasDependency(ei,ri))}}function ns(ci,ei){const ri=Math.abs(2*ci.wrap)-+(ci.wrap<0),ni=Math.abs(2*ei.wrap)-+(ei.wrap<0);return ci.overscaledZ-ei.overscaledZ||ni-ri||ei.canonical.y-ci.canonical.y||ei.canonical.x-ci.canonical.x}function mn(ci){return ci==="raster"||ci==="image"||ci==="video"}Da.maxOverzooming=10,Da.maxUnderzooming=3;const tn="mapboxgl_preloaded_worker_pool";class ws{constructor(){this.active={}}acquire(ei){if(!this.workers)for(this.workers=[];this.workers.length<ws.workerCount;)this.workers.push(new Worker(li.c.WORKER_URL));return this.active[ei]=!0,this.workers.slice()}release(ei){delete this.active[ei],this.numActive()===0&&(this.workers.forEach(ri=>{ri.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[tn]}numActive(){return Object.keys(this.active).length}}const Il=Math.floor(li.h.hardwareConcurrency/2);let Ds;function mc(){return Ds||(Ds=new ws),Ds}ws.workerCount=li.ac(globalThis)?Math.max(Math.min(Il,3),1):1;class Al{constructor(ei,ri){this.reset(ei,ri)}reset(ei,ri){this.points=ei||[],this._distances=[0];for(let ni=1;ni<this.points.length;ni++)this._distances[ni]=this._distances[ni-1]+this.points[ni].dist(this.points[ni-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(ri||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(ei){if(this.points.length===1)return this.points[0];ei=li.ad(ei,0,1);let ri=1,ni=this._distances[ri];const si=ei*this.paddedLength+this.padding;for(;ni<si&&ri<this._distances.length;)ni=this._distances[++ri];const hi=ri-1,fi=this._distances[hi],_i=ni-fi,gi=_i>0?(si-fi)/_i:0;return this.points[hi].mult(1-gi).add(this.points[ri].mult(gi))}}function Ws(ci,ei){let ri=!0;return ci==="always"||ci!=="never"&&ei!=="never"||(ri=!1),ri}class ll{constructor(ei,ri,ni){const si=this.boxCells=[],hi=this.circleCells=[];this.xCellCount=Math.ceil(ei/ni),this.yCellCount=Math.ceil(ri/ni);for(let fi=0;fi<this.xCellCount*this.yCellCount;fi++)si.push([]),hi.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=ei,this.height=ri,this.xScale=this.xCellCount/ei,this.yScale=this.yCellCount/ri,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(ei,ri,ni,si,hi){this._forEachCell(ri,ni,si,hi,this._insertBoxCell,this.boxUid++),this.boxKeys.push(ei),this.bboxes.push(ri),this.bboxes.push(ni),this.bboxes.push(si),this.bboxes.push(hi)}insertCircle(ei,ri,ni,si){this._forEachCell(ri-si,ni-si,ri+si,ni+si,this._insertCircleCell,this.circleUid++),this.circleKeys.push(ei),this.circles.push(ri),this.circles.push(ni),this.circles.push(si)}_insertBoxCell(ei,ri,ni,si,hi,fi){this.boxCells[hi].push(fi)}_insertCircleCell(ei,ri,ni,si,hi,fi){this.circleCells[hi].push(fi)}_query(ei,ri,ni,si,hi,fi,_i){if(ni<0||ei>this.width||si<0||ri>this.height)return[];const gi=[];if(ei<=0&&ri<=0&&this.width<=ni&&this.height<=si){if(hi)return[{key:null,x1:ei,y1:ri,x2:ni,y2:si}];for(let bi=0;bi<this.boxKeys.length;bi++)gi.push({key:this.boxKeys[bi],x1:this.bboxes[4*bi],y1:this.bboxes[4*bi+1],x2:this.bboxes[4*bi+2],y2:this.bboxes[4*bi+3]});for(let bi=0;bi<this.circleKeys.length;bi++){const Ei=this.circles[3*bi],Ti=this.circles[3*bi+1],zi=this.circles[3*bi+2];gi.push({key:this.circleKeys[bi],x1:Ei-zi,y1:Ti-zi,x2:Ei+zi,y2:Ti+zi})}}else this._forEachCell(ei,ri,ni,si,this._queryCell,gi,{hitTest:hi,overlapMode:fi,seenUids:{box:{},circle:{}}},_i);return gi}query(ei,ri,ni,si){return this._query(ei,ri,ni,si,!1,null)}hitTest(ei,ri,ni,si,hi,fi){return this._query(ei,ri,ni,si,!0,hi,fi).length>0}hitTestCircle(ei,ri,ni,si,hi){const fi=ei-ni,_i=ei+ni,gi=ri-ni,bi=ri+ni;if(_i<0||fi>this.width||bi<0||gi>this.height)return!1;const Ei=[];return this._forEachCell(fi,gi,_i,bi,this._queryCellCircle,Ei,{hitTest:!0,overlapMode:si,circle:{x:ei,y:ri,radius:ni},seenUids:{box:{},circle:{}}},hi),Ei.length>0}_queryCell(ei,ri,ni,si,hi,fi,_i,gi){const{seenUids:bi,hitTest:Ei,overlapMode:Ti}=_i,zi=this.boxCells[hi];if(zi!==null){const Bi=this.bboxes;for(const Vi of zi)if(!bi.box[Vi]){bi.box[Vi]=!0;const Di=4*Vi,Wi=this.boxKeys[Vi];if(ei<=Bi[Di+2]&&ri<=Bi[Di+3]&&ni>=Bi[Di+0]&&si>=Bi[Di+1]&&(!gi||gi(Wi))&&(!Ei||!Ws(Ti,Wi.overlapMode))&&(fi.push({key:Wi,x1:Bi[Di],y1:Bi[Di+1],x2:Bi[Di+2],y2:Bi[Di+3]}),Ei))return!0}}const Ni=this.circleCells[hi];if(Ni!==null){const Bi=this.circles;for(const Vi of Ni)if(!bi.circle[Vi]){bi.circle[Vi]=!0;const Di=3*Vi,Wi=this.circleKeys[Vi];if(this._circleAndRectCollide(Bi[Di],Bi[Di+1],Bi[Di+2],ei,ri,ni,si)&&(!gi||gi(Wi))&&(!Ei||!Ws(Ti,Wi.overlapMode))){const Kr=Bi[Di],$i=Bi[Di+1],Ji=Bi[Di+2];if(fi.push({key:Wi,x1:Kr-Ji,y1:$i-Ji,x2:Kr+Ji,y2:$i+Ji}),Ei)return!0}}}return!1}_queryCellCircle(ei,ri,ni,si,hi,fi,_i,gi){const{circle:bi,seenUids:Ei,overlapMode:Ti}=_i,zi=this.boxCells[hi];if(zi!==null){const Bi=this.bboxes;for(const Vi of zi)if(!Ei.box[Vi]){Ei.box[Vi]=!0;const Di=4*Vi,Wi=this.boxKeys[Vi];if(this._circleAndRectCollide(bi.x,bi.y,bi.radius,Bi[Di+0],Bi[Di+1],Bi[Di+2],Bi[Di+3])&&(!gi||gi(Wi))&&!Ws(Ti,Wi.overlapMode))return fi.push(!0),!0}}const Ni=this.circleCells[hi];if(Ni!==null){const Bi=this.circles;for(const Vi of Ni)if(!Ei.circle[Vi]){Ei.circle[Vi]=!0;const Di=3*Vi,Wi=this.circleKeys[Vi];if(this._circlesCollide(Bi[Di],Bi[Di+1],Bi[Di+2],bi.x,bi.y,bi.radius)&&(!gi||gi(Wi))&&!Ws(Ti,Wi.overlapMode))return fi.push(!0),!0}}}_forEachCell(ei,ri,ni,si,hi,fi,_i,gi){const bi=this._convertToXCellCoord(ei),Ei=this._convertToYCellCoord(ri),Ti=this._convertToXCellCoord(ni),zi=this._convertToYCellCoord(si);for(let Ni=bi;Ni<=Ti;Ni++)for(let Bi=Ei;Bi<=zi;Bi++)if(hi.call(this,ei,ri,ni,si,this.xCellCount*Bi+Ni,fi,_i,gi))return}_convertToXCellCoord(ei){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(ei*this.xScale)))}_convertToYCellCoord(ei){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(ei*this.yScale)))}_circlesCollide(ei,ri,ni,si,hi,fi){const _i=si-ei,gi=hi-ri,bi=ni+fi;return bi*bi>_i*_i+gi*gi}_circleAndRectCollide(ei,ri,ni,si,hi,fi,_i){const gi=(fi-si)/2,bi=Math.abs(ei-(si+gi));if(bi>gi+ni)return!1;const Ei=(_i-hi)/2,Ti=Math.abs(ri-(hi+Ei));if(Ti>Ei+ni)return!1;if(bi<=gi||Ti<=Ei)return!0;const zi=bi-gi,Ni=Ti-Ei;return zi*zi+Ni*Ni<=ni*ni}}function _o(ci,ei,ri,ni,si){const hi=li.Z();return ei?(li.a0(hi,hi,[1/si,1/si,1]),ri||li.ae(hi,hi,ni.angle)):li.a1(hi,ni.labelPlaneMatrix,ci),hi}function Ss(ci,ei,ri,ni,si){if(ei){const hi=li.af(ci);return li.a0(hi,hi,[si,si,1]),ri||li.ae(hi,hi,-ni.angle),hi}return ni.glCoordMatrix}function Cn(ci,ei,ri){let ni;ri?(ni=[ci.x,ci.y,ri(ci.x,ci.y),1],li.ag(ni,ni,ei)):(ni=[ci.x,ci.y,0,1],ji(ni,ni,ei));const si=ni[3];return{point:new li.P(ni[0]/si,ni[1]/si),signedDistanceFromCamera:si}}function cl(ci,ei){return .5+ci/ei*.5}function Fs(ci,ei){const ri=ci[0]/ci[3],ni=ci[1]/ci[3];return ri>=-ei[0]&&ri<=ei[0]&&ni>=-ei[1]&&ni<=ei[1]}function go(ci,ei,ri,ni,si,hi,fi,_i,gi,bi){const Ei=ni?ci.textSizeData:ci.iconSizeData,Ti=li.ah(Ei,ri.transform.zoom),zi=[256/ri.width*2+1,256/ri.height*2+1],Ni=ni?ci.text.dynamicLayoutVertexArray:ci.icon.dynamicLayoutVertexArray;Ni.clear();const Bi=ci.lineVertexArray,Vi=ni?ci.text.placedSymbolArray:ci.icon.placedSymbolArray,Di=ri.transform.width/ri.transform.height;let Wi=!1;for(let Kr=0;Kr<Vi.length;Kr++){const $i=Vi.get(Kr);if($i.hidden||$i.writingMode===li.ai.vertical&&!Wi){ki($i.numGlyphs,Ni);continue}let Ji;if(Wi=!1,bi?(Ji=[$i.anchorX,$i.anchorY,bi($i.anchorX,$i.anchorY),1],li.ag(Ji,Ji,ei)):(Ji=[$i.anchorX,$i.anchorY,0,1],ji(Ji,Ji,ei)),!Fs(Ji,zi)){ki($i.numGlyphs,Ni);continue}const eo=cl(ri.transform.cameraToCenterDistance,Ji[3]),to=li.aj(Ei,Ti,$i),no=fi?to/eo:to*eo,co=new li.P($i.anchorX,$i.anchorY),lo=Cn(co,si,bi).point,ho={projections:{},offsets:{}},Ao=Ea($i,no,!1,_i,ei,si,hi,ci.glyphOffsetArray,Bi,Ni,lo,co,ho,Di,gi,bi);Wi=Ao.useVertical,(Ao.notEnoughRoom||Wi||Ao.needsFlipping&&Ea($i,no,!0,_i,ei,si,hi,ci.glyphOffsetArray,Bi,Ni,lo,co,ho,Di,gi,bi).notEnoughRoom)&&ki($i.numGlyphs,Ni)}ni?ci.text.dynamicLayoutVertexBuffer.updateData(Ni):ci.icon.dynamicLayoutVertexBuffer.updateData(Ni)}function Go(ci,ei,ri,ni,si,hi,fi,_i,gi,bi,Ei,Ti,zi){const Ni=_i.glyphStartIndex+_i.numGlyphs,Bi=_i.lineStartIndex,Vi=_i.lineStartIndex+_i.lineLength,Di=ei.getoffsetX(_i.glyphStartIndex),Wi=ei.getoffsetX(Ni-1),Kr=Ai(ci*Di,ri,ni,si,hi,fi,_i.segment,Bi,Vi,gi,bi,Ei,Ti,zi);if(!Kr)return null;const $i=Ai(ci*Wi,ri,ni,si,hi,fi,_i.segment,Bi,Vi,gi,bi,Ei,Ti,zi);return $i?{first:Kr,last:$i}:null}function Uo(ci,ei,ri,ni){return ci===li.ai.horizontal&&Math.abs(ri.y-ei.y)>Math.abs(ri.x-ei.x)*ni?{useVertical:!0}:(ci===li.ai.vertical?ei.y<ri.y:ei.x>ri.x)?{needsFlipping:!0}:null}function Ea(ci,ei,ri,ni,si,hi,fi,_i,gi,bi,Ei,Ti,zi,Ni,Bi,Vi){const Di=ei/24,Wi=ci.lineOffsetX*Di,Kr=ci.lineOffsetY*Di;let $i;if(ci.numGlyphs>1){const Ji=ci.glyphStartIndex+ci.numGlyphs,eo=ci.lineStartIndex,to=ci.lineStartIndex+ci.lineLength,no=Go(Di,_i,Wi,Kr,ri,Ei,Ti,ci,gi,hi,zi,Bi,Vi);if(!no)return{notEnoughRoom:!0};const co=Cn(no.first.point,fi,Vi).point,lo=Cn(no.last.point,fi,Vi).point;if(ni&&!ri){const ho=Uo(ci.writingMode,co,lo,Ni);if(ho)return ho}$i=[no.first];for(let ho=ci.glyphStartIndex+1;ho<Ji-1;ho++)$i.push(Ai(Di*_i.getoffsetX(ho),Wi,Kr,ri,Ei,Ti,ci.segment,eo,to,gi,hi,zi,Bi,Vi));$i.push(no.last)}else{if(ni&&!ri){const eo=Cn(Ti,si,Vi).point,to=ci.lineStartIndex+ci.segment+1,no=new li.P(gi.getx(to),gi.gety(to)),co=Cn(no,si,Vi),lo=co.signedDistanceFromCamera>0?co.point:Es(Ti,no,eo,1,si,Vi),ho=Uo(ci.writingMode,eo,lo,Ni);if(ho)return ho}const Ji=Ai(Di*_i.getoffsetX(ci.glyphStartIndex),Wi,Kr,ri,Ei,Ti,ci.segment,ci.lineStartIndex,ci.lineStartIndex+ci.lineLength,gi,hi,zi,Bi,Vi);if(!Ji)return{notEnoughRoom:!0};$i=[Ji]}for(const Ji of $i)li.ak(bi,Ji.point,Ji.angle);return{}}function Es(ci,ei,ri,ni,si,hi){const fi=Cn(ci.add(ci.sub(ei)._unit()),si,hi).point,_i=ri.sub(fi);return ri.add(_i._mult(ni/_i.mag()))}function jo(ci,ei){const{projectionCache:ri,lineVertexArray:ni,labelPlaneMatrix:si,tileAnchorPoint:hi,distanceFromAnchor:fi,getElevation:_i,previousVertex:gi,direction:bi,absOffsetX:Ei}=ei;if(ri.projections[ci])return ri.projections[ci];const Ti=new li.P(ni.getx(ci),ni.gety(ci)),zi=Cn(Ti,si,_i);if(zi.signedDistanceFromCamera>0)return ri.projections[ci]=zi.point,zi.point;const Ni=ci-bi;return Es(fi===0?hi:new li.P(ni.getx(Ni),ni.gety(Ni)),Ti,gi,Ei-fi+1,si,_i)}function Bs(ci,ei,ri){return ci._unit()._perp()._mult(ei*ri)}function Ui(ci,ei,ri,ni,si,hi,fi,_i){const{projectionCache:gi,direction:bi}=_i;if(gi.offsets[ci])return gi.offsets[ci];const Ei=ri.add(ei);if(ci+bi<ni||ci+bi>=si)return gi.offsets[ci]=Ei,Ei;const Ti=jo(ci+bi,_i),zi=Bs(Ti.sub(ri),fi,bi),Ni=ri.add(zi),Bi=Ti.add(zi);return gi.offsets[ci]=li.al(hi,Ei,Ni,Bi)||Ei,gi.offsets[ci]}function Ai(ci,ei,ri,ni,si,hi,fi,_i,gi,bi,Ei,Ti,zi,Ni){const Bi=ni?ci-ei:ci+ei;let Vi=Bi>0?1:-1,Di=0;ni&&(Vi*=-1,Di=Math.PI),Vi<0&&(Di+=Math.PI);let Wi,Kr,$i=Vi>0?_i+fi:_i+fi+1,Ji=si,eo=si,to=0,no=0;const co=Math.abs(Bi),lo=[];let ho;for(;to+no<=co;){if($i+=Vi,$i<_i||$i>=gi)return null;to+=no,eo=Ji,Kr=Wi;const xo={projectionCache:Ti,lineVertexArray:bi,labelPlaneMatrix:Ei,tileAnchorPoint:hi,distanceFromAnchor:to,getElevation:Ni,previousVertex:eo,direction:Vi,absOffsetX:co};if(Ji=jo($i,xo),ri===0)lo.push(eo),ho=Ji.sub(eo);else{let Bo;const Co=Ji.sub(eo);Bo=Co.mag()===0?Bs(jo($i+Vi,xo).sub(Ji),ri,Vi):Bs(Co,ri,Vi),Kr||(Kr=eo.add(Bo)),Wi=Ui($i,Bo,Ji,_i,gi,Kr,ri,xo),lo.push(Kr),ho=Wi.sub(Kr)}no=ho.mag()}const Ao=ho._mult((co-to)/no)._add(Kr||eo),Ho=Di+Math.atan2(Ji.y-eo.y,Ji.x-eo.x);return lo.push(Ao),{point:Ao,angle:zi?Ho:0,path:lo}}const Ci=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ki(ci,ei){for(let ri=0;ri<ci;ri++){const ni=ei.length;ei.resize(ni+4),ei.float32.set(Ci,3*ni)}}function ji(ci,ei,ri){const ni=ei[0],si=ei[1];return ci[0]=ri[0]*ni+ri[4]*si+ri[12],ci[1]=ri[1]*ni+ri[5]*si+ri[13],ci[3]=ri[3]*ni+ri[7]*si+ri[15],ci}const Gi=100;class Zr{constructor(ei,ri=new ll(ei.width+200,ei.height+200,25),ni=new ll(ei.width+200,ei.height+200,25)){this.transform=ei,this.grid=ri,this.ignoredGrid=ni,this.pitchfactor=Math.cos(ei._pitch)*ei.cameraToCenterDistance,this.screenRightBoundary=ei.width+Gi,this.screenBottomBoundary=ei.height+Gi,this.gridRightBoundary=ei.width+200,this.gridBottomBoundary=ei.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(ei,ri,ni,si,hi,fi){const _i=this.projectAndGetPerspectiveRatio(si,ei.anchorPointX,ei.anchorPointY,fi),gi=ni*_i.perspectiveRatio,bi=ei.x1*gi+_i.point.x,Ei=ei.y1*gi+_i.point.y,Ti=ei.x2*gi+_i.point.x,zi=ei.y2*gi+_i.point.y;return!this.isInsideGrid(bi,Ei,Ti,zi)||ri!=="always"&&this.grid.hitTest(bi,Ei,Ti,zi,ri,hi)||_i.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[bi,Ei,Ti,zi],offscreen:this.isOffscreen(bi,Ei,Ti,zi)}}placeCollisionCircles(ei,ri,ni,si,hi,fi,_i,gi,bi,Ei,Ti,zi,Ni,Bi){const Vi=[],Di=new li.P(ri.anchorX,ri.anchorY),Wi=Cn(Di,fi,Bi),Kr=cl(this.transform.cameraToCenterDistance,Wi.signedDistanceFromCamera),$i=(Ei?hi/Kr:hi*Kr)/li.ap,Ji=Cn(Di,_i,Bi).point,eo=Go($i,si,ri.lineOffsetX*$i,ri.lineOffsetY*$i,!1,Ji,Di,ri,ni,_i,{projections:{},offsets:{}},!1,Bi);let to=!1,no=!1,co=!0;if(eo){const lo=.5*zi*Kr+Ni,ho=new li.P(-100,-100),Ao=new li.P(this.screenRightBoundary,this.screenBottomBoundary),Ho=new Al,xo=eo.first,Bo=eo.last;let Co=[];for(let qo=xo.path.length-1;qo>=1;qo--)Co.push(xo.path[qo]);for(let qo=1;qo<Bo.path.length;qo++)Co.push(Bo.path[qo]);const un=2.5*lo;if(gi){const qo=Co.map(Yo=>Cn(Yo,gi,Bi));Co=qo.some(Yo=>Yo.signedDistanceFromCamera<=0)?[]:qo.map(Yo=>Yo.point)}let Zo=[];if(Co.length>0){const qo=Co[0].clone(),Yo=Co[0].clone();for(let kn=1;kn<Co.length;kn++)qo.x=Math.min(qo.x,Co[kn].x),qo.y=Math.min(qo.y,Co[kn].y),Yo.x=Math.max(Yo.x,Co[kn].x),Yo.y=Math.max(Yo.y,Co[kn].y);Zo=qo.x>=ho.x&&Yo.x<=Ao.x&&qo.y>=ho.y&&Yo.y<=Ao.y?[Co]:Yo.x<ho.x||qo.x>Ao.x||Yo.y<ho.y||qo.y>Ao.y?[]:li.am([Co],ho.x,ho.y,Ao.x,Ao.y)}for(const qo of Zo){Ho.reset(qo,.25*lo);let Yo=0;Yo=Ho.length<=.5*lo?1:Math.ceil(Ho.paddedLength/un)+1;for(let kn=0;kn<Yo;kn++){const yn=kn/Math.max(Yo-1,1),pa=Ho.lerp(yn),Wn=pa.x+Gi,jn=pa.y+Gi;Vi.push(Wn,jn,lo,0);const Ja=Wn-lo,xn=jn-lo,Is=Wn+lo,As=jn+lo;if(co=co&&this.isOffscreen(Ja,xn,Is,As),no=no||this.isInsideGrid(Ja,xn,Is,As),ei!=="always"&&this.grid.hitTestCircle(Wn,jn,lo,ei,Ti)&&(to=!0,!bi))return{circles:[],offscreen:!1,collisionDetected:to}}}}return{circles:!bi&&to||!no||Kr<this.perspectiveRatioCutoff?[]:Vi,offscreen:co,collisionDetected:to}}queryRenderedSymbols(ei){if(ei.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const ri=[];let ni=1/0,si=1/0,hi=-1/0,fi=-1/0;for(const Ei of ei){const Ti=new li.P(Ei.x+Gi,Ei.y+Gi);ni=Math.min(ni,Ti.x),si=Math.min(si,Ti.y),hi=Math.max(hi,Ti.x),fi=Math.max(fi,Ti.y),ri.push(Ti)}const _i=this.grid.query(ni,si,hi,fi).concat(this.ignoredGrid.query(ni,si,hi,fi)),gi={},bi={};for(const Ei of _i){const Ti=Ei.key;if(gi[Ti.bucketInstanceId]===void 0&&(gi[Ti.bucketInstanceId]={}),gi[Ti.bucketInstanceId][Ti.featureIndex])continue;const zi=[new li.P(Ei.x1,Ei.y1),new li.P(Ei.x2,Ei.y1),new li.P(Ei.x2,Ei.y2),new li.P(Ei.x1,Ei.y2)];li.an(ri,zi)&&(gi[Ti.bucketInstanceId][Ti.featureIndex]=!0,bi[Ti.bucketInstanceId]===void 0&&(bi[Ti.bucketInstanceId]=[]),bi[Ti.bucketInstanceId].push(Ti.featureIndex))}return bi}insertCollisionBox(ei,ri,ni,si,hi,fi){(ni?this.ignoredGrid:this.grid).insert({bucketInstanceId:si,featureIndex:hi,collisionGroupID:fi,overlapMode:ri},ei[0],ei[1],ei[2],ei[3])}insertCollisionCircles(ei,ri,ni,si,hi,fi){const _i=ni?this.ignoredGrid:this.grid,gi={bucketInstanceId:si,featureIndex:hi,collisionGroupID:fi,overlapMode:ri};for(let bi=0;bi<ei.length;bi+=4)_i.insertCircle(gi,ei[bi],ei[bi+1],ei[bi+2])}projectAndGetPerspectiveRatio(ei,ri,ni,si){let hi;return si?(hi=[ri,ni,si(ri,ni),1],li.ag(hi,hi,ei)):(hi=[ri,ni,0,1],ji(hi,hi,ei)),{point:new li.P((hi[0]/hi[3]+1)/2*this.transform.width+Gi,(-hi[1]/hi[3]+1)/2*this.transform.height+Gi),perspectiveRatio:.5+this.transform.cameraToCenterDistance/hi[3]*.5}}isOffscreen(ei,ri,ni,si){return ni<Gi||ei>=this.screenRightBoundary||si<Gi||ri>this.screenBottomBoundary}isInsideGrid(ei,ri,ni,si){return ni>=0&&ei<this.gridRightBoundary&&si>=0&&ri<this.gridBottomBoundary}getViewportMatrix(){const ei=li.ao([]);return li.$(ei,ei,[-100,-100,0]),ei}}function Xi(ci,ei,ri){return ei*(li.N/(ci.tileSize*Math.pow(2,ri-ci.tileID.overscaledZ)))}class Hi{constructor(ei,ri,ni,si){this.opacity=ei?Math.max(0,Math.min(1,ei.opacity+(ei.placed?ri:-ri))):si&&ni?1:0,this.placed=ni}isHidden(){return this.opacity===0&&!this.placed}}class Qi{constructor(ei,ri,ni,si,hi){this.text=new Hi(ei?ei.text:null,ri,ni,hi),this.icon=new Hi(ei?ei.icon:null,ri,si,hi)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ro{constructor(ei,ri,ni){this.text=ei,this.icon=ri,this.skipFade=ni}}class oo{constructor(){this.invProjMatrix=li.Z(),this.viewportMatrix=li.Z(),this.circles=[]}}class so{constructor(ei,ri,ni,si,hi){this.bucketInstanceId=ei,this.featureIndex=ri,this.sourceLayerIndex=ni,this.bucketIndex=si,this.tileID=hi}}class Oo{constructor(ei){this.crossSourceCollisions=ei,this.maxGroupID=0,this.collisionGroups={}}get(ei){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[ei]){const ri=++this.maxGroupID;this.collisionGroups[ei]={ID:ri,predicate:ni=>ni.collisionGroupID===ri}}return this.collisionGroups[ei]}}function No(ci,ei,ri,ni,si){const{horizontalAlign:hi,verticalAlign:fi}=li.au(ci);return new li.P(-(hi-.5)*ei+ni[0]*si,-(fi-.5)*ri+ni[1]*si)}function Io(ci,ei,ri,ni,si,hi){const{x1:fi,x2:_i,y1:gi,y2:bi,anchorPointX:Ei,anchorPointY:Ti}=ci,zi=new li.P(ei,ri);return ni&&zi._rotate(si?hi:-hi),{x1:fi+zi.x,y1:gi+zi.y,x2:_i+zi.x,y2:bi+zi.y,anchorPointX:Ei,anchorPointY:Ti}}class Do{constructor(ei,ri,ni,si,hi){this.transform=ei.clone(),this.terrain=ri,this.collisionIndex=new Zr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=ni,this.retainedQueryData={},this.collisionGroups=new Oo(si),this.collisionCircleArrays={},this.prevPlacement=hi,hi&&(hi.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(ei,ri,ni,si){const hi=ni.getBucket(ri),fi=ni.latestFeatureIndex;if(!hi||!fi||ri.id!==hi.layerIds[0])return;const _i=ni.collisionBoxArray,gi=hi.layers[0].layout,bi=Math.pow(2,this.transform.zoom-ni.tileID.overscaledZ),Ei=ni.tileSize/li.N,Ti=this.transform.calculatePosMatrix(ni.tileID.toUnwrapped()),zi=gi.get("text-pitch-alignment")==="map",Ni=gi.get("text-rotation-alignment")==="map",Bi=Xi(ni,1,this.transform.zoom),Vi=_o(Ti,zi,Ni,this.transform,Bi);let Di=null;if(zi){const Kr=Ss(Ti,zi,Ni,this.transform,Bi);Di=li.a1([],this.transform.labelPlaneMatrix,Kr)}this.retainedQueryData[hi.bucketInstanceId]=new so(hi.bucketInstanceId,fi,hi.sourceLayerIndex,hi.index,ni.tileID);const Wi={bucket:hi,layout:gi,posMatrix:Ti,textLabelPlaneMatrix:Vi,labelToScreenMatrix:Di,scale:bi,textPixelRatio:Ei,holdingForFade:ni.holdingForFade(),collisionBoxArray:_i,partiallyEvaluatedTextSize:li.ah(hi.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(hi.sourceID)};if(si)for(const Kr of hi.sortKeyRanges){const{sortKey:$i,symbolInstanceStart:Ji,symbolInstanceEnd:eo}=Kr;ei.push({sortKey:$i,symbolInstanceStart:Ji,symbolInstanceEnd:eo,parameters:Wi})}else ei.push({symbolInstanceStart:0,symbolInstanceEnd:hi.symbolInstances.length,parameters:Wi})}attemptAnchorPlacement(ei,ri,ni,si,hi,fi,_i,gi,bi,Ei,Ti,zi,Ni,Bi,Vi,Di){const Wi=li.aq[ei.textAnchor],Kr=[ei.textOffset0,ei.textOffset1],$i=No(Wi,ni,si,Kr,hi),Ji=this.collisionIndex.placeCollisionBox(Io(ri,$i.x,$i.y,fi,_i,this.transform.angle),Ti,gi,bi,Ei.predicate,Di);if((!Vi||this.collisionIndex.placeCollisionBox(Io(Vi,$i.x,$i.y,fi,_i,this.transform.angle),Ti,gi,bi,Ei.predicate,Di).box.length!==0)&&Ji.box.length>0){let eo;if(this.prevPlacement&&this.prevPlacement.variableOffsets[zi.crossTileID]&&this.prevPlacement.placements[zi.crossTileID]&&this.prevPlacement.placements[zi.crossTileID].text&&(eo=this.prevPlacement.variableOffsets[zi.crossTileID].anchor),zi.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[zi.crossTileID]={textOffset:Kr,width:ni,height:si,anchor:Wi,textBoxScale:hi,prevAnchor:eo},this.markUsedJustification(Ni,Wi,zi,Bi),Ni.allowVerticalPlacement&&(this.markUsedOrientation(Ni,Bi,zi),this.placedOrientations[zi.crossTileID]=Bi),{shift:$i,placedGlyphBoxes:Ji}}}placeLayerBucketPart(ei,ri,ni){const{bucket:si,layout:hi,posMatrix:fi,textLabelPlaneMatrix:_i,labelToScreenMatrix:gi,textPixelRatio:bi,holdingForFade:Ei,collisionBoxArray:Ti,partiallyEvaluatedTextSize:zi,collisionGroup:Ni}=ei.parameters,Bi=hi.get("text-optional"),Vi=hi.get("icon-optional"),Di=li.ar(hi,"text-overlap","text-allow-overlap"),Wi=Di==="always",Kr=li.ar(hi,"icon-overlap","icon-allow-overlap"),$i=Kr==="always",Ji=hi.get("text-rotation-alignment")==="map",eo=hi.get("text-pitch-alignment")==="map",to=hi.get("icon-text-fit")!=="none",no=hi.get("symbol-z-order")==="viewport-y",co=Wi&&($i||!si.hasIconData()||Vi),lo=$i&&(Wi||!si.hasTextData()||Bi);!si.collisionArrays&&Ti&&si.deserializeCollisionBoxes(Ti);const ho=this.retainedQueryData[si.bucketInstanceId].tileID,Ao=this.terrain?(xo,Bo)=>this.terrain.getElevation(ho,xo,Bo):null,Ho=(xo,Bo)=>{var Co,un;if(ri[xo.crossTileID])return;if(Ei)return void(this.placements[xo.crossTileID]=new ro(!1,!1,!1));let Zo=!1,qo=!1,Yo=!0,kn=null,yn={box:null,offscreen:null},pa={box:null,offscreen:null},Wn=null,jn=null,Ja=null,xn=0,Is=0,As=0;Bo.textFeatureIndex?xn=Bo.textFeatureIndex:xo.useRuntimeCollisionCircles&&(xn=xo.featureIndex),Bo.verticalTextFeatureIndex&&(Is=Bo.verticalTextFeatureIndex);const rl=Bo.textBox;if(rl){const ga=Dn=>{let Kn=li.ai.horizontal;if(si.allowVerticalPlacement&&!Dn&&this.prevPlacement){const Na=this.prevPlacement.placedOrientations[xo.crossTileID];Na&&(this.placedOrientations[xo.crossTileID]=Na,Kn=Na,this.markUsedOrientation(si,Kn,xo))}return Kn},da=(Dn,Kn)=>{if(si.allowVerticalPlacement&&xo.numVerticalGlyphVertices>0&&Bo.verticalTextBox){for(const Na of si.writingModes)if(Na===li.ai.vertical?(yn=Kn(),pa=yn):yn=Dn(),yn&&yn.box&&yn.box.length)break}else yn=Dn()},Ia=xo.textAnchorOffsetStartIndex,xl=xo.textAnchorOffsetEndIndex;if(xl===Ia){const Dn=(Kn,Na)=>{const Fn=this.collisionIndex.placeCollisionBox(Kn,Di,bi,fi,Ni.predicate,Ao);return Fn&&Fn.box&&Fn.box.length&&(this.markUsedOrientation(si,Na,xo),this.placedOrientations[xo.crossTileID]=Na),Fn};da(()=>Dn(rl,li.ai.horizontal),()=>{const Kn=Bo.verticalTextBox;return si.allowVerticalPlacement&&xo.numVerticalGlyphVertices>0&&Kn?Dn(Kn,li.ai.vertical):{box:null,offscreen:null}}),ga(yn&&yn.box&&yn.box.length)}else{let Dn=li.aq[(un=(Co=this.prevPlacement)===null||Co===void 0?void 0:Co.variableOffsets[xo.crossTileID])===null||un===void 0?void 0:un.anchor];const Kn=(Fn,vl,Gc)=>{const $h=Fn.x2-Fn.x1,Zh=Fn.y2-Fn.y1,Rp=xo.textBoxScale,ju=to&&Kr==="never"?vl:null;let Ps={box:[],offscreen:!1},bl=Di==="never"?1:2,Cs="never";Dn&&bl++;for(let ps=0;ps<bl;ps++){for(let zs=Ia;zs<xl;zs++){const qu=si.textAnchorOffsets.get(zs);if(Dn&&qu.textAnchor!==Dn)continue;const Gs=this.attemptAnchorPlacement(qu,Fn,$h,Zh,Rp,Ji,eo,bi,fi,Ni,Cs,xo,si,Gc,ju,Ao);if(Gs&&(Ps=Gs.placedGlyphBoxes,Ps&&Ps.box&&Ps.box.length))return Zo=!0,kn=Gs.shift,Ps}Dn?Dn=null:Cs=Di}return Ps};da(()=>Kn(rl,Bo.iconBox,li.ai.horizontal),()=>{const Fn=Bo.verticalTextBox;return si.allowVerticalPlacement&&!(yn&&yn.box&&yn.box.length)&&xo.numVerticalGlyphVertices>0&&Fn?Kn(Fn,Bo.verticalIconBox,li.ai.vertical):{box:null,offscreen:null}}),yn&&(Zo=yn.box,Yo=yn.offscreen);const Na=ga(yn&&yn.box);if(!Zo&&this.prevPlacement){const Fn=this.prevPlacement.variableOffsets[xo.crossTileID];Fn&&(this.variableOffsets[xo.crossTileID]=Fn,this.markUsedJustification(si,Fn.anchor,xo,Na))}}}if(Wn=yn,Zo=Wn&&Wn.box&&Wn.box.length>0,Yo=Wn&&Wn.offscreen,xo.useRuntimeCollisionCircles){const ga=si.text.placedSymbolArray.get(xo.centerJustifiedTextSymbolIndex),da=li.aj(si.textSizeData,zi,ga),Ia=hi.get("text-padding");jn=this.collisionIndex.placeCollisionCircles(Di,ga,si.lineVertexArray,si.glyphOffsetArray,da,fi,_i,gi,ni,eo,Ni.predicate,xo.collisionCircleDiameter,Ia,Ao),jn.circles.length&&jn.collisionDetected&&!ni&&li.w("Collisions detected, but collision boxes are not shown"),Zo=Wi||jn.circles.length>0&&!jn.collisionDetected,Yo=Yo&&jn.offscreen}if(Bo.iconFeatureIndex&&(As=Bo.iconFeatureIndex),Bo.iconBox){const ga=da=>{const Ia=to&&kn?Io(da,kn.x,kn.y,Ji,eo,this.transform.angle):da;return this.collisionIndex.placeCollisionBox(Ia,Kr,bi,fi,Ni.predicate,Ao)};pa&&pa.box&&pa.box.length&&Bo.verticalIconBox?(Ja=ga(Bo.verticalIconBox),qo=Ja.box.length>0):(Ja=ga(Bo.iconBox),qo=Ja.box.length>0),Yo=Yo&&Ja.offscreen}const gl=Bi||xo.numHorizontalGlyphVertices===0&&xo.numVerticalGlyphVertices===0,Vl=Vi||xo.numIconVertices===0;if(gl||Vl?Vl?gl||(qo=qo&&Zo):Zo=qo&&Zo:qo=Zo=qo&&Zo,Zo&&Wn&&Wn.box&&this.collisionIndex.insertCollisionBox(Wn.box,Di,hi.get("text-ignore-placement"),si.bucketInstanceId,pa&&pa.box&&Is?Is:xn,Ni.ID),qo&&Ja&&this.collisionIndex.insertCollisionBox(Ja.box,Kr,hi.get("icon-ignore-placement"),si.bucketInstanceId,As,Ni.ID),jn&&(Zo&&this.collisionIndex.insertCollisionCircles(jn.circles,Di,hi.get("text-ignore-placement"),si.bucketInstanceId,xn,Ni.ID),ni)){const ga=si.bucketInstanceId;let da=this.collisionCircleArrays[ga];da===void 0&&(da=this.collisionCircleArrays[ga]=new oo);for(let Ia=0;Ia<jn.circles.length;Ia+=4)da.circles.push(jn.circles[Ia+0]),da.circles.push(jn.circles[Ia+1]),da.circles.push(jn.circles[Ia+2]),da.circles.push(jn.collisionDetected?1:0)}if(xo.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(si.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[xo.crossTileID]=new ro(Zo||co,qo||lo,Yo||si.justReloaded),ri[xo.crossTileID]=!0};if(no){if(ei.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const xo=si.getSortedSymbolIndexes(this.transform.angle);for(let Bo=xo.length-1;Bo>=0;--Bo){const Co=xo[Bo];Ho(si.symbolInstances.get(Co),si.collisionArrays[Co])}}else for(let xo=ei.symbolInstanceStart;xo<ei.symbolInstanceEnd;xo++)Ho(si.symbolInstances.get(xo),si.collisionArrays[xo]);if(ni&&si.bucketInstanceId in this.collisionCircleArrays){const xo=this.collisionCircleArrays[si.bucketInstanceId];li.as(xo.invProjMatrix,fi),xo.viewportMatrix=this.collisionIndex.getViewportMatrix()}si.justReloaded=!1}markUsedJustification(ei,ri,ni,si){let hi;hi=si===li.ai.vertical?ni.verticalPlacedTextSymbolIndex:{left:ni.leftJustifiedTextSymbolIndex,center:ni.centerJustifiedTextSymbolIndex,right:ni.rightJustifiedTextSymbolIndex}[li.at(ri)];const fi=[ni.leftJustifiedTextSymbolIndex,ni.centerJustifiedTextSymbolIndex,ni.rightJustifiedTextSymbolIndex,ni.verticalPlacedTextSymbolIndex];for(const _i of fi)_i>=0&&(ei.text.placedSymbolArray.get(_i).crossTileID=hi>=0&&_i!==hi?0:ni.crossTileID)}markUsedOrientation(ei,ri,ni){const si=ri===li.ai.horizontal||ri===li.ai.horizontalOnly?ri:0,hi=ri===li.ai.vertical?ri:0,fi=[ni.leftJustifiedTextSymbolIndex,ni.centerJustifiedTextSymbolIndex,ni.rightJustifiedTextSymbolIndex];for(const _i of fi)ei.text.placedSymbolArray.get(_i).placedOrientation=si;ni.verticalPlacedTextSymbolIndex&&(ei.text.placedSymbolArray.get(ni.verticalPlacedTextSymbolIndex).placedOrientation=hi)}commit(ei){this.commitTime=ei,this.zoomAtLastRecencyCheck=this.transform.zoom;const ri=this.prevPlacement;let ni=!1;this.prevZoomAdjustment=ri?ri.zoomAdjustment(this.transform.zoom):0;const si=ri?ri.symbolFadeChange(ei):1,hi=ri?ri.opacities:{},fi=ri?ri.variableOffsets:{},_i=ri?ri.placedOrientations:{};for(const gi in this.placements){const bi=this.placements[gi],Ei=hi[gi];Ei?(this.opacities[gi]=new Qi(Ei,si,bi.text,bi.icon),ni=ni||bi.text!==Ei.text.placed||bi.icon!==Ei.icon.placed):(this.opacities[gi]=new Qi(null,si,bi.text,bi.icon,bi.skipFade),ni=ni||bi.text||bi.icon)}for(const gi in hi){const bi=hi[gi];if(!this.opacities[gi]){const Ei=new Qi(bi,si,!1,!1);Ei.isHidden()||(this.opacities[gi]=Ei,ni=ni||bi.text.placed||bi.icon.placed)}}for(const gi in fi)this.variableOffsets[gi]||!this.opacities[gi]||this.opacities[gi].isHidden()||(this.variableOffsets[gi]=fi[gi]);for(const gi in _i)this.placedOrientations[gi]||!this.opacities[gi]||this.opacities[gi].isHidden()||(this.placedOrientations[gi]=_i[gi]);if(ri&&ri.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");ni?this.lastPlacementChangeTime=ei:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=ri?ri.lastPlacementChangeTime:ei)}updateLayerOpacities(ei,ri){const ni={};for(const si of ri){const hi=si.getBucket(ei);hi&&si.latestFeatureIndex&&ei.id===hi.layerIds[0]&&this.updateBucketOpacities(hi,ni,si.collisionBoxArray)}}updateBucketOpacities(ei,ri,ni){ei.hasTextData()&&(ei.text.opacityVertexArray.clear(),ei.text.hasVisibleVertices=!1),ei.hasIconData()&&(ei.icon.opacityVertexArray.clear(),ei.icon.hasVisibleVertices=!1),ei.hasIconCollisionBoxData()&&ei.iconCollisionBox.collisionVertexArray.clear(),ei.hasTextCollisionBoxData()&&ei.textCollisionBox.collisionVertexArray.clear();const si=ei.layers[0],hi=si.layout,fi=new Qi(null,0,!1,!1,!0),_i=hi.get("text-allow-overlap"),gi=hi.get("icon-allow-overlap"),bi=si._unevaluatedLayout.hasValue("text-variable-anchor")||si._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ei=hi.get("text-rotation-alignment")==="map",Ti=hi.get("text-pitch-alignment")==="map",zi=hi.get("icon-text-fit")!=="none",Ni=new Qi(null,0,_i&&(gi||!ei.hasIconData()||hi.get("icon-optional")),gi&&(_i||!ei.hasTextData()||hi.get("text-optional")),!0);!ei.collisionArrays&&ni&&(ei.hasIconCollisionBoxData()||ei.hasTextCollisionBoxData())&&ei.deserializeCollisionBoxes(ni);const Bi=(Vi,Di,Wi)=>{for(let Kr=0;Kr<Di/4;Kr++)Vi.opacityVertexArray.emplaceBack(Wi);Vi.hasVisibleVertices=Vi.hasVisibleVertices||Wi!==as};for(let Vi=0;Vi<ei.symbolInstances.length;Vi++){const Di=ei.symbolInstances.get(Vi),{numHorizontalGlyphVertices:Wi,numVerticalGlyphVertices:Kr,crossTileID:$i}=Di;let Ji=this.opacities[$i];ri[$i]?Ji=fi:Ji||(Ji=Ni,this.opacities[$i]=Ji),ri[$i]=!0;const eo=Di.numIconVertices>0,to=this.placedOrientations[Di.crossTileID],no=to===li.ai.vertical,co=to===li.ai.horizontal||to===li.ai.horizontalOnly;if(Wi>0||Kr>0){const lo=ua(Ji.text);Bi(ei.text,Wi,no?as:lo),Bi(ei.text,Kr,co?as:lo);const ho=Ji.text.isHidden();[Di.rightJustifiedTextSymbolIndex,Di.centerJustifiedTextSymbolIndex,Di.leftJustifiedTextSymbolIndex].forEach(xo=>{xo>=0&&(ei.text.placedSymbolArray.get(xo).hidden=ho||no?1:0)}),Di.verticalPlacedTextSymbolIndex>=0&&(ei.text.placedSymbolArray.get(Di.verticalPlacedTextSymbolIndex).hidden=ho||co?1:0);const Ao=this.variableOffsets[Di.crossTileID];Ao&&this.markUsedJustification(ei,Ao.anchor,Di,to);const Ho=this.placedOrientations[Di.crossTileID];Ho&&(this.markUsedJustification(ei,"left",Di,Ho),this.markUsedOrientation(ei,Ho,Di))}if(eo){const lo=ua(Ji.icon),ho=!(zi&&Di.verticalPlacedIconSymbolIndex&&no);Di.placedIconSymbolIndex>=0&&(Bi(ei.icon,Di.numIconVertices,ho?lo:as),ei.icon.placedSymbolArray.get(Di.placedIconSymbolIndex).hidden=Ji.icon.isHidden()),Di.verticalPlacedIconSymbolIndex>=0&&(Bi(ei.icon,Di.numVerticalIconVertices,ho?as:lo),ei.icon.placedSymbolArray.get(Di.verticalPlacedIconSymbolIndex).hidden=Ji.icon.isHidden())}if(ei.hasIconCollisionBoxData()||ei.hasTextCollisionBoxData()){const lo=ei.collisionArrays[Vi];if(lo){let ho=new li.P(0,0);if(lo.textBox||lo.verticalTextBox){let Ho=!0;if(bi){const xo=this.variableOffsets[$i];xo?(ho=No(xo.anchor,xo.width,xo.height,xo.textOffset,xo.textBoxScale),Ei&&ho._rotate(Ti?this.transform.angle:-this.transform.angle)):Ho=!1}lo.textBox&&Vo(ei.textCollisionBox.collisionVertexArray,Ji.text.placed,!Ho||no,ho.x,ho.y),lo.verticalTextBox&&Vo(ei.textCollisionBox.collisionVertexArray,Ji.text.placed,!Ho||co,ho.x,ho.y)}const Ao=!!(!co&&lo.verticalIconBox);lo.iconBox&&Vo(ei.iconCollisionBox.collisionVertexArray,Ji.icon.placed,Ao,zi?ho.x:0,zi?ho.y:0),lo.verticalIconBox&&Vo(ei.iconCollisionBox.collisionVertexArray,Ji.icon.placed,!Ao,zi?ho.x:0,zi?ho.y:0)}}}if(ei.sortFeatures(this.transform.angle),this.retainedQueryData[ei.bucketInstanceId]&&(this.retainedQueryData[ei.bucketInstanceId].featureSortOrder=ei.featureSortOrder),ei.hasTextData()&&ei.text.opacityVertexBuffer&&ei.text.opacityVertexBuffer.updateData(ei.text.opacityVertexArray),ei.hasIconData()&&ei.icon.opacityVertexBuffer&&ei.icon.opacityVertexBuffer.updateData(ei.icon.opacityVertexArray),ei.hasIconCollisionBoxData()&&ei.iconCollisionBox.collisionVertexBuffer&&ei.iconCollisionBox.collisionVertexBuffer.updateData(ei.iconCollisionBox.collisionVertexArray),ei.hasTextCollisionBoxData()&&ei.textCollisionBox.collisionVertexBuffer&&ei.textCollisionBox.collisionVertexBuffer.updateData(ei.textCollisionBox.collisionVertexArray),ei.text.opacityVertexArray.length!==ei.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${ei.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${ei.text.layoutVertexArray.length}) / 4`);if(ei.icon.opacityVertexArray.length!==ei.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${ei.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${ei.icon.layoutVertexArray.length}) / 4`);if(ei.bucketInstanceId in this.collisionCircleArrays){const Vi=this.collisionCircleArrays[ei.bucketInstanceId];ei.placementInvProjMatrix=Vi.invProjMatrix,ei.placementViewportMatrix=Vi.viewportMatrix,ei.collisionCircleArray=Vi.circles,delete this.collisionCircleArrays[ei.bucketInstanceId]}}symbolFadeChange(ei){return this.fadeDuration===0?1:(ei-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(ei){return Math.max(0,(this.transform.zoom-ei)/1.5)}hasTransitions(ei){return this.stale||ei-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(ei,ri){const ni=this.zoomAtLastRecencyCheck===ri?1-this.zoomAdjustment(ri):1;return this.zoomAtLastRecencyCheck=ri,this.commitTime+this.fadeDuration*ni>ei}setStale(){this.stale=!0}}function Vo(ci,ei,ri,ni,si){ci.emplaceBack(ei?1:0,ri?1:0,ni||0,si||0),ci.emplaceBack(ei?1:0,ri?1:0,ni||0,si||0),ci.emplaceBack(ei?1:0,ri?1:0,ni||0,si||0),ci.emplaceBack(ei?1:0,ri?1:0,ni||0,si||0)}const sn=Math.pow(2,25),pn=Math.pow(2,24),en=Math.pow(2,17),Qo=Math.pow(2,16),_a=Math.pow(2,9),_n=Math.pow(2,8),Zn=Math.pow(2,1);function ua(ci){if(ci.opacity===0&&!ci.placed)return 0;if(ci.opacity===1&&ci.placed)return 4294967295;const ei=ci.placed?1:0,ri=Math.floor(127*ci.opacity);return ri*sn+ei*pn+ri*en+ei*Qo+ri*_a+ei*_n+ri*Zn+ei}const as=0;class sh{constructor(ei){this._sortAcrossTiles=ei.layout.get("symbol-z-order")!=="viewport-y"&&!ei.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(ei,ri,ni,si,hi){const fi=this._bucketParts;for(;this._currentTileIndex<ei.length;)if(ri.getBucketParts(fi,si,ei[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,hi())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,fi.sort((_i,gi)=>_i.sortKey-gi.sortKey));this._currentPartIndex<fi.length;)if(ri.placeLayerBucketPart(fi[this._currentPartIndex],this._seenCrossTileIDs,ni),this._currentPartIndex++,hi())return!0;return!1}}class Pl{constructor(ei,ri,ni,si,hi,fi,_i,gi){this.placement=new Do(ei,ri,fi,_i,gi),this._currentPlacementIndex=ni.length-1,this._forceFullPlacement=si,this._showCollisionBoxes=hi,this._done=!1}isDone(){return this._done}continuePlacement(ei,ri,ni){const si=li.h.now(),hi=()=>!this._forceFullPlacement&&li.h.now()-si>2;for(;this._currentPlacementIndex>=0;){const fi=ri[ei[this._currentPlacementIndex]],_i=this.placement.collisionIndex.transform.zoom;if(fi.type==="symbol"&&(!fi.minzoom||fi.minzoom<=_i)&&(!fi.maxzoom||fi.maxzoom>_i)){if(this._inProgressLayer||(this._inProgressLayer=new sh(fi)),this._inProgressLayer.continuePlacement(ni[fi.source],this.placement,this._showCollisionBoxes,fi,hi))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(ei){return this.placement.commit(ei),this.placement}}const Cl=512/li.N/2;class fp{constructor(ei,ri,ni){this.tileID=ei,this.bucketInstanceId=ni,this._symbolsByKey={};const si=new Map;for(let hi=0;hi<ri.length;hi++){const fi=ri.get(hi),_i=fi.key,gi=si.get(_i);gi?gi.push(fi):si.set(_i,[fi])}for(const[hi,fi]of si){const _i={positions:fi.map(gi=>({x:Math.floor(gi.anchorX*Cl),y:Math.floor(gi.anchorY*Cl)})),crossTileIDs:fi.map(gi=>gi.crossTileID)};if(_i.positions.length>128){const gi=new li.av(_i.positions.length,16,Uint16Array);for(const{x:bi,y:Ei}of _i.positions)gi.add(bi,Ei);gi.finish(),delete _i.positions,_i.index=gi}this._symbolsByKey[hi]=_i}}getScaledCoordinates(ei,ri){const{x:ni,y:si,z:hi}=this.tileID.canonical,{x:fi,y:_i,z:gi}=ri.canonical,bi=Cl/Math.pow(2,gi-hi),Ei=(_i*li.N+ei.anchorY)*bi,Ti=si*li.N*Cl;return{x:Math.floor((fi*li.N+ei.anchorX)*bi-ni*li.N*Cl),y:Math.floor(Ei-Ti)}}findMatches(ei,ri,ni){const si=this.tileID.canonical.z<ri.canonical.z?1:Math.pow(2,this.tileID.canonical.z-ri.canonical.z);for(let hi=0;hi<ei.length;hi++){const fi=ei.get(hi);if(fi.crossTileID)continue;const _i=this._symbolsByKey[fi.key];if(!_i)continue;const gi=this.getScaledCoordinates(fi,ri);if(_i.index){const bi=_i.index.range(gi.x-si,gi.y-si,gi.x+si,gi.y+si).sort();for(const Ei of bi){const Ti=_i.crossTileIDs[Ei];if(!ni[Ti]){ni[Ti]=!0,fi.crossTileID=Ti;break}}}else if(_i.positions)for(let bi=0;bi<_i.positions.length;bi++){const Ei=_i.positions[bi],Ti=_i.crossTileIDs[bi];if(Math.abs(Ei.x-gi.x)<=si&&Math.abs(Ei.y-gi.y)<=si&&!ni[Ti]){ni[Ti]=!0,fi.crossTileID=Ti;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:ei})=>ei)}}class cn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class tu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(ei){const ri=Math.round((ei-this.lng)/360);if(ri!==0)for(const ni in this.indexes){const si=this.indexes[ni],hi={};for(const fi in si){const _i=si[fi];_i.tileID=_i.tileID.unwrapTo(_i.tileID.wrap+ri),hi[_i.tileID.key]=_i}this.indexes[ni]=hi}this.lng=ei}addBucket(ei,ri,ni){if(this.indexes[ei.overscaledZ]&&this.indexes[ei.overscaledZ][ei.key]){if(this.indexes[ei.overscaledZ][ei.key].bucketInstanceId===ri.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(ei.overscaledZ,this.indexes[ei.overscaledZ][ei.key])}for(let hi=0;hi<ri.symbolInstances.length;hi++)ri.symbolInstances.get(hi).crossTileID=0;this.usedCrossTileIDs[ei.overscaledZ]||(this.usedCrossTileIDs[ei.overscaledZ]={});const si=this.usedCrossTileIDs[ei.overscaledZ];for(const hi in this.indexes){const fi=this.indexes[hi];if(Number(hi)>ei.overscaledZ)for(const _i in fi){const gi=fi[_i];gi.tileID.isChildOf(ei)&&gi.findMatches(ri.symbolInstances,ei,si)}else{const _i=fi[ei.scaledTo(Number(hi)).key];_i&&_i.findMatches(ri.symbolInstances,ei,si)}}for(let hi=0;hi<ri.symbolInstances.length;hi++){const fi=ri.symbolInstances.get(hi);fi.crossTileID||(fi.crossTileID=ni.generate(),si[fi.crossTileID]=!0)}return this.indexes[ei.overscaledZ]===void 0&&(this.indexes[ei.overscaledZ]={}),this.indexes[ei.overscaledZ][ei.key]=new fp(ei,ri.symbolInstances,ri.bucketInstanceId),!0}removeBucketCrossTileIDs(ei,ri){for(const ni of ri.getCrossTileIDsLists())for(const si of ni)delete this.usedCrossTileIDs[ei][si]}removeStaleBuckets(ei){let ri=!1;for(const ni in this.indexes){const si=this.indexes[ni];for(const hi in si)ei[si[hi].bucketInstanceId]||(this.removeBucketCrossTileIDs(ni,si[hi]),delete si[hi],ri=!0)}return ri}}class _c{constructor(){this.layerIndexes={},this.crossTileIDs=new cn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(ei,ri,ni){let si=this.layerIndexes[ei.id];si===void 0&&(si=this.layerIndexes[ei.id]=new tu);let hi=!1;const fi={};si.handleWrapJump(ni);for(const _i of ri){const gi=_i.getBucket(ei);gi&&ei.id===gi.layerIds[0]&&(gi.bucketInstanceId||(gi.bucketInstanceId=++this.maxBucketInstanceId),si.addBucket(_i.tileID,gi,this.crossTileIDs)&&(hi=!0),fi[gi.bucketInstanceId]=!0)}return si.removeStaleBuckets(fi)&&(hi=!0),hi}pruneUnusedLayers(ei){const ri={};ei.forEach(ni=>{ri[ni]=!0});for(const ni in this.layerIndexes)ri[ni]||delete this.layerIndexes[ni]}}const ya=(ci,ei)=>li.x(ci,ei&&ei.filter(ri=>ri.identifier!=="source.canvas")),Ha=li.F(li.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),mp=li.F(li.ax,["setCenter","setZoom","setBearing","setPitch"]),ss=li.aw();class ha extends li.E{constructor(ei,ri={}){super(),this.map=ei,this.dispatcher=new rs(mc(),this,ei._getMapId()),this.imageManager=new Pn,this.imageManager.setEventedParent(this),this.glyphManager=new Sa(ei._requestManager,ri.localIdeographFontFamily),this.lineAtlas=new sl(256,512),this.crossTileSymbolIndex=new _c,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new li.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",li.az());const ni=this;this._rtlTextPluginCallback=ha.registerForPluginStateChange(si=>{ni.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:si.pluginStatus,pluginURL:si.pluginURL},(hi,fi)=>{if(li.aA(hi),fi&&fi.every(_i=>_i))for(const _i in ni.sourceCaches){const gi=ni.sourceCaches[_i].getSource().type;gi!=="vector"&&gi!=="geojson"||ni.sourceCaches[_i].reload()}})}),this.on("data",si=>{if(si.dataType!=="source"||si.sourceDataType!=="metadata")return;const hi=this.sourceCaches[si.sourceId];if(!hi)return;const fi=hi.getSource();if(fi&&fi.vectorLayerIds)for(const _i in this._layers){const gi=this._layers[_i];gi.source===fi.id&&this._validateLayer(gi)}})}loadURL(ei,ri={},ni){this.fire(new li.k("dataloading",{dataType:"style"})),ri.validate=typeof ri.validate!="boolean"||ri.validate;const si=this.map._requestManager.transformRequest(ei,bn.Style);this._request=li.f(si,(hi,fi)=>{this._request=null,hi?this.fire(new li.j(hi)):fi&&this._load(fi,ri,ni)})}loadJSON(ei,ri={},ni){this.fire(new li.k("dataloading",{dataType:"style"})),this._request=li.h.frame(()=>{this._request=null,ri.validate=ri.validate!==!1,this._load(ei,ri,ni)})}loadEmpty(){this.fire(new li.k("dataloading",{dataType:"style"})),this._load(ss,{validate:!1})}_load(ei,ri,ni){var si;const hi=ri.transformStyle?ri.transformStyle(ni,ei):ei;if(!ri.validate||!ya(this,li.y(hi))){this._loaded=!0,this.stylesheet=hi;for(const fi in hi.sources)this.addSource(fi,hi.sources[fi],{validate:!1});hi.sprite?this._loadSprite(hi.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(hi.glyphs),this._createLayers(),this.light=new al(this.stylesheet.light),this.map.setTerrain((si=this.stylesheet.terrain)!==null&&si!==void 0?si:null),this.fire(new li.k("data",{dataType:"style"})),this.fire(new li.k("style.load"))}}_createLayers(){const ei=li.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",ei),this._order=ei.map(ri=>ri.id),this._layers={},this._serializedLayers=null;for(const ri of ei){const ni=li.aC(ri);ni.setEventedParent(this,{layer:{id:ri.id}}),this._layers[ri.id]=ni}}_loadSprite(ei,ri=!1,ni=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(si,hi,fi,_i){const gi=ln(si),bi=gi.length,Ei=fi>1?"@2x":"",Ti={},zi={},Ni={};for(const{id:Bi,url:Vi}of gi){const Di=hi.transformRequest(hi.normalizeSpriteURL(Vi,Ei,".json"),bn.SpriteJSON),Wi=`${Bi}_${Di.url}`;Ti[Wi]=li.f(Di,(Ji,eo)=>{delete Ti[Wi],zi[Bi]=eo,vs(_i,zi,Ni,Ji,bi)});const Kr=hi.transformRequest(hi.normalizeSpriteURL(Vi,Ei,".png"),bn.SpriteImage),$i=`${Bi}_${Kr.url}`;Ti[$i]=Ln.getImage(Kr,(Ji,eo)=>{delete Ti[$i],Ni[Bi]=eo,vs(_i,zi,Ni,Ji,bi)})}return{cancel(){for(const Bi of Object.values(Ti))Bi.cancel()}}}(ei,this.map._requestManager,this.map.getPixelRatio(),(si,hi)=>{if(this._spriteRequest=null,si)this.fire(new li.j(si));else if(hi)for(const fi in hi){this._spritesImagesIds[fi]=[];const _i=this._spritesImagesIds[fi]?this._spritesImagesIds[fi].filter(gi=>!(gi in hi)):[];for(const gi of _i)this.imageManager.removeImage(gi),this._changedImages[gi]=!0;for(const gi in hi[fi]){const bi=fi==="default"?gi:`${fi}:${gi}`;this._spritesImagesIds[fi].push(bi),bi in this.imageManager.images?this.imageManager.updateImage(bi,hi[fi][gi],!1):this.imageManager.addImage(bi,hi[fi][gi]),ri&&(this._changedImages[bi]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),ri&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new li.k("data",{dataType:"style"})),ni&&ni(si)})}_unloadSprite(){for(const ei of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(ei),this._changedImages[ei]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new li.k("data",{dataType:"style"}))}_validateLayer(ei){const ri=this.sourceCaches[ei.source];if(!ri)return;const ni=ei.sourceLayer;if(!ni)return;const si=ri.getSource();(si.type==="geojson"||si.vectorLayerIds&&si.vectorLayerIds.indexOf(ni)===-1)&&this.fire(new li.j(new Error(`Source layer "${ni}" does not exist on source "${si.id}" as specified by style layer "${ei.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const ei in this.sourceCaches)if(!this.sourceCaches[ei].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(ei){const ri=this._serializedAllLayers();if(!ei||ei.length===0)return Object.values(ri);const ni=[];for(const si of ei)ri[si]&&ni.push(ri[si]);return ni}_serializedAllLayers(){let ei=this._serializedLayers;if(ei)return ei;ei=this._serializedLayers={};const ri=Object.keys(this._layers);for(const ni of ri){const si=this._layers[ni];si.type!=="custom"&&(ei[ni]=si.serialize())}return ei}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const ei in this.sourceCaches)if(this.sourceCaches[ei].hasTransition())return!0;for(const ei in this._layers)if(this._layers[ei].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(ei){if(!this._loaded)return;const ri=this._changed;if(this._changed){const si=Object.keys(this._updatedLayers),hi=Object.keys(this._removedLayers);(si.length||hi.length)&&this._updateWorkerLayers(si,hi);for(const fi in this._updatedSources){const _i=this._updatedSources[fi];if(_i==="reload")this._reloadSource(fi);else{if(_i!=="clear")throw new Error(`Invalid action ${_i}`);this._clearSource(fi)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const fi in this._updatedPaintProps)this._layers[fi].updateTransitions(ei);this.light.updateTransitions(ei),this._resetUpdates()}const ni={};for(const si in this.sourceCaches){const hi=this.sourceCaches[si];ni[si]=hi.used,hi.used=!1}for(const si of this._order){const hi=this._layers[si];hi.recalculate(ei,this._availableImages),!hi.isHidden(ei.zoom)&&hi.source&&(this.sourceCaches[hi.source].used=!0)}for(const si in ni){const hi=this.sourceCaches[si];ni[si]!==hi.used&&hi.fire(new li.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:si}))}this.light.recalculate(ei),this.z=ei.zoom,ri&&this.fire(new li.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const ei=Object.keys(this._changedImages);if(ei.length){for(const ri in this.sourceCaches)this.sourceCaches[ri].reloadTilesForDependencies(["icons","patterns"],ei);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const ei in this.sourceCaches)this.sourceCaches[ei].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(ei,ri){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(ei),removedIds:ri})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(ei,ri={}){this._checkLoaded();const ni=this.serialize();if(ei=ri.transformStyle?ri.transformStyle(ni,ei):ei,ya(this,li.y(ei)))return!1;(ei=li.aD(ei)).layers=li.aB(ei.layers);const si=li.aE(ni,ei).filter(fi=>!(fi.command in mp));if(si.length===0)return!1;const hi=si.filter(fi=>!(fi.command in Ha));if(hi.length>0)throw new Error(`Unimplemented: ${hi.map(fi=>fi.command).join(", ")}.`);for(const fi of si)fi.command!=="setTransition"&&this[fi.command].apply(this,fi.args);return this.stylesheet=ei,this._serializedLayers=null,!0}addImage(ei,ri){if(this.getImage(ei))return this.fire(new li.j(new Error(`An image named "${ei}" already exists.`)));this.imageManager.addImage(ei,ri),this._afterImageUpdated(ei)}updateImage(ei,ri){this.imageManager.updateImage(ei,ri)}getImage(ei){return this.imageManager.getImage(ei)}removeImage(ei){if(!this.getImage(ei))return this.fire(new li.j(new Error(`An image named "${ei}" does not exist.`)));this.imageManager.removeImage(ei),this._afterImageUpdated(ei)}_afterImageUpdated(ei){this._availableImages=this.imageManager.listImages(),this._changedImages[ei]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new li.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(ei,ri,ni={}){if(this._checkLoaded(),this.sourceCaches[ei]!==void 0)throw new Error(`Source "${ei}" already exists.`);if(!ri.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(ri).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(ri.type)>=0&&this._validate(li.y.source,`sources.${ei}`,ri,null,ni))return;this.map&&this.map._collectResourceTiming&&(ri.collectResourceTiming=!0);const si=this.sourceCaches[ei]=new Da(ei,ri,this.dispatcher);si.style=this,si.setEventedParent(this,()=>({isSourceLoaded:si.loaded(),source:si.serialize(),sourceId:ei})),si.onAdd(this.map),this._changed=!0}removeSource(ei){if(this._checkLoaded(),this.sourceCaches[ei]===void 0)throw new Error("There is no source with this ID");for(const ni in this._layers)if(this._layers[ni].source===ei)return this.fire(new li.j(new Error(`Source "${ei}" cannot be removed while layer "${ni}" is using it.`)));const ri=this.sourceCaches[ei];delete this.sourceCaches[ei],delete this._updatedSources[ei],ri.fire(new li.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:ei})),ri.setEventedParent(null),ri.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(ei,ri){if(this._checkLoaded(),this.sourceCaches[ei]===void 0)throw new Error(`There is no source with this ID=${ei}`);const ni=this.sourceCaches[ei].getSource();if(ni.type!=="geojson")throw new Error(`geojsonSource.type is ${ni.type}, which is !== 'geojson`);ni.setData(ri),this._changed=!0}getSource(ei){return this.sourceCaches[ei]&&this.sourceCaches[ei].getSource()}addLayer(ei,ri,ni={}){this._checkLoaded();const si=ei.id;if(this.getLayer(si))return void this.fire(new li.j(new Error(`Layer "${si}" already exists on this map.`)));let hi;if(ei.type==="custom"){if(ya(this,li.aF(ei)))return;hi=li.aC(ei)}else{if("source"in ei&&typeof ei.source=="object"&&(this.addSource(si,ei.source),ei=li.aD(ei),ei=li.e(ei,{source:si})),this._validate(li.y.layer,`layers.${si}`,ei,{arrayIndex:-1},ni))return;hi=li.aC(ei),this._validateLayer(hi),hi.setEventedParent(this,{layer:{id:si}})}const fi=ri?this._order.indexOf(ri):this._order.length;if(ri&&fi===-1)this.fire(new li.j(new Error(`Cannot add layer "${si}" before non-existing layer "${ri}".`)));else{if(this._order.splice(fi,0,si),this._layerOrderChanged=!0,this._layers[si]=hi,this._removedLayers[si]&&hi.source&&hi.type!=="custom"){const _i=this._removedLayers[si];delete this._removedLayers[si],_i.type!==hi.type?this._updatedSources[hi.source]="clear":(this._updatedSources[hi.source]="reload",this.sourceCaches[hi.source].pause())}this._updateLayer(hi),hi.onAdd&&hi.onAdd(this.map)}}moveLayer(ei,ri){if(this._checkLoaded(),this._changed=!0,!this._layers[ei])return void this.fire(new li.j(new Error(`The layer '${ei}' does not exist in the map's style and cannot be moved.`)));if(ei===ri)return;const ni=this._order.indexOf(ei);this._order.splice(ni,1);const si=ri?this._order.indexOf(ri):this._order.length;ri&&si===-1?this.fire(new li.j(new Error(`Cannot move layer "${ei}" before non-existing layer "${ri}".`))):(this._order.splice(si,0,ei),this._layerOrderChanged=!0)}removeLayer(ei){this._checkLoaded();const ri=this._layers[ei];if(!ri)return void this.fire(new li.j(new Error(`Cannot remove non-existing layer "${ei}".`)));ri.setEventedParent(null);const ni=this._order.indexOf(ei);this._order.splice(ni,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[ei]=ri,delete this._layers[ei],this._serializedLayers&&delete this._serializedLayers[ei],delete this._updatedLayers[ei],delete this._updatedPaintProps[ei],ri.onRemove&&ri.onRemove(this.map)}getLayer(ei){return this._layers[ei]}getLayersOrder(){return[...this._order]}hasLayer(ei){return ei in this._layers}setLayerZoomRange(ei,ri,ni){this._checkLoaded();const si=this.getLayer(ei);si?si.minzoom===ri&&si.maxzoom===ni||(ri!=null&&(si.minzoom=ri),ni!=null&&(si.maxzoom=ni),this._updateLayer(si)):this.fire(new li.j(new Error(`Cannot set the zoom range of non-existing layer "${ei}".`)))}setFilter(ei,ri,ni={}){this._checkLoaded();const si=this.getLayer(ei);if(si){if(!li.aG(si.filter,ri))return ri==null?(si.filter=void 0,void this._updateLayer(si)):void(this._validate(li.y.filter,`layers.${si.id}.filter`,ri,null,ni)||(si.filter=li.aD(ri),this._updateLayer(si)))}else this.fire(new li.j(new Error(`Cannot filter non-existing layer "${ei}".`)))}getFilter(ei){return li.aD(this.getLayer(ei).filter)}setLayoutProperty(ei,ri,ni,si={}){this._checkLoaded();const hi=this.getLayer(ei);hi?li.aG(hi.getLayoutProperty(ri),ni)||(hi.setLayoutProperty(ri,ni,si),this._updateLayer(hi)):this.fire(new li.j(new Error(`Cannot style non-existing layer "${ei}".`)))}getLayoutProperty(ei,ri){const ni=this.getLayer(ei);if(ni)return ni.getLayoutProperty(ri);this.fire(new li.j(new Error(`Cannot get style of non-existing layer "${ei}".`)))}setPaintProperty(ei,ri,ni,si={}){this._checkLoaded();const hi=this.getLayer(ei);hi?li.aG(hi.getPaintProperty(ri),ni)||(hi.setPaintProperty(ri,ni,si)&&this._updateLayer(hi),this._changed=!0,this._updatedPaintProps[ei]=!0):this.fire(new li.j(new Error(`Cannot style non-existing layer "${ei}".`)))}getPaintProperty(ei,ri){return this.getLayer(ei).getPaintProperty(ri)}setFeatureState(ei,ri){this._checkLoaded();const ni=ei.source,si=ei.sourceLayer,hi=this.sourceCaches[ni];if(hi===void 0)return void this.fire(new li.j(new Error(`The source '${ni}' does not exist in the map's style.`)));const fi=hi.getSource().type;fi==="geojson"&&si?this.fire(new li.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):fi!=="vector"||si?(ei.id===void 0&&this.fire(new li.j(new Error("The feature id parameter must be provided."))),hi.setFeatureState(si,ei.id,ri)):this.fire(new li.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(ei,ri){this._checkLoaded();const ni=ei.source,si=this.sourceCaches[ni];if(si===void 0)return void this.fire(new li.j(new Error(`The source '${ni}' does not exist in the map's style.`)));const hi=si.getSource().type,fi=hi==="vector"?ei.sourceLayer:void 0;hi!=="vector"||fi?ri&&typeof ei.id!="string"&&typeof ei.id!="number"?this.fire(new li.j(new Error("A feature id is required to remove its specific state property."))):si.removeFeatureState(fi,ei.id,ri):this.fire(new li.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(ei){this._checkLoaded();const ri=ei.source,ni=ei.sourceLayer,si=this.sourceCaches[ri];if(si!==void 0)return si.getSource().type!=="vector"||ni?(ei.id===void 0&&this.fire(new li.j(new Error("The feature id parameter must be provided."))),si.getFeatureState(ni,ei.id)):void this.fire(new li.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new li.j(new Error(`The source '${ri}' does not exist in the map's style.`)))}getTransition(){return li.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const ei=li.aH(this.sourceCaches,hi=>hi.serialize()),ri=this._serializeByIds(this._order),ni=this.map.getTerrain()||void 0,si=this.stylesheet;return li.aI({version:si.version,name:si.name,metadata:si.metadata,light:si.light,center:si.center,zoom:si.zoom,bearing:si.bearing,pitch:si.pitch,sprite:si.sprite,glyphs:si.glyphs,transition:si.transition,sources:ei,layers:ri,terrain:ni},hi=>hi!==void 0)}_updateLayer(ei){this._updatedLayers[ei.id]=!0,ei.source&&!this._updatedSources[ei.source]&&this.sourceCaches[ei.source].getSource().type!=="raster"&&(this._updatedSources[ei.source]="reload",this.sourceCaches[ei.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(ei){const ri=fi=>this._layers[fi].type==="fill-extrusion",ni={},si=[];for(let fi=this._order.length-1;fi>=0;fi--){const _i=this._order[fi];if(ri(_i)){ni[_i]=fi;for(const gi of ei){const bi=gi[_i];if(bi)for(const Ei of bi)si.push(Ei)}}}si.sort((fi,_i)=>_i.intersectionZ-fi.intersectionZ);const hi=[];for(let fi=this._order.length-1;fi>=0;fi--){const _i=this._order[fi];if(ri(_i))for(let gi=si.length-1;gi>=0;gi--){const bi=si[gi].feature;if(ni[bi.layer.id]<fi)break;hi.push(bi),si.pop()}else for(const gi of ei){const bi=gi[_i];if(bi)for(const Ei of bi)hi.push(Ei.feature)}}return hi}queryRenderedFeatures(ei,ri,ni){ri&&ri.filter&&this._validate(li.y.filter,"queryRenderedFeatures.filter",ri.filter,null,ri);const si={};if(ri&&ri.layers){if(!Array.isArray(ri.layers))return this.fire(new li.j(new Error("parameters.layers must be an Array."))),[];for(const _i of ri.layers){const gi=this._layers[_i];if(!gi)return this.fire(new li.j(new Error(`The layer '${_i}' does not exist in the map's style and cannot be queried for features.`))),[];si[gi.source]=!0}}const hi=[];ri.availableImages=this._availableImages;const fi=this._serializedAllLayers();for(const _i in this.sourceCaches)ri.layers&&!si[_i]||hi.push(ks(this.sourceCaches[_i],this._layers,fi,ei,ri,ni));return this.placement&&hi.push(function(_i,gi,bi,Ei,Ti,zi,Ni){const Bi={},Vi=zi.queryRenderedSymbols(Ei),Di=[];for(const Wi of Object.keys(Vi).map(Number))Di.push(Ni[Wi]);Di.sort($n);for(const Wi of Di){const Kr=Wi.featureIndex.lookupSymbolFeatures(Vi[Wi.bucketInstanceId],gi,Wi.bucketIndex,Wi.sourceLayerIndex,Ti.filter,Ti.layers,Ti.availableImages,_i);for(const $i in Kr){const Ji=Bi[$i]=Bi[$i]||[],eo=Kr[$i];eo.sort((to,no)=>{const co=Wi.featureSortOrder;if(co){const lo=co.indexOf(to.featureIndex);return co.indexOf(no.featureIndex)-lo}return no.featureIndex-to.featureIndex});for(const to of eo)Ji.push(to)}}for(const Wi in Bi)Bi[Wi].forEach(Kr=>{const $i=Kr.feature,Ji=bi[_i[Wi].source].getFeatureState($i.layer["source-layer"],$i.id);$i.source=$i.layer.source,$i.layer["source-layer"]&&($i.sourceLayer=$i.layer["source-layer"]),$i.state=Ji});return Bi}(this._layers,fi,this.sourceCaches,ei,ri,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(hi)}querySourceFeatures(ei,ri){ri&&ri.filter&&this._validate(li.y.filter,"querySourceFeatures.filter",ri.filter,null,ri);const ni=this.sourceCaches[ei];return ni?function(si,hi){const fi=si.getRenderableIds().map(bi=>si.getTileByID(bi)),_i=[],gi={};for(let bi=0;bi<fi.length;bi++){const Ei=fi[bi],Ti=Ei.tileID.canonical.key;gi[Ti]||(gi[Ti]=!0,Ei.querySourceFeatures(_i,hi))}return _i}(ni,ri):[]}addSourceType(ei,ri,ni){return Oa(ei)?ni(new Error(`A source type called "${ei}" already exists.`)):(((si,hi)=>{Un[si]=hi})(ei,ri),ri.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:ei,url:ri.workerSourceURL},ni):ni(null,null))}getLight(){return this.light.getLight()}setLight(ei,ri={}){this._checkLoaded();const ni=this.light.getLight();let si=!1;for(const fi in ei)if(!li.aG(ei[fi],ni[fi])){si=!0;break}if(!si)return;const hi={now:li.h.now(),transition:li.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(ei,ri),this.light.updateTransitions(hi)}_validate(ei,ri,ni,si,hi={}){return(!hi||hi.validate!==!1)&&ya(this,ei.call(li.y,li.e({key:ri,style:this.serialize(),value:ni,styleSpec:li.v},si)))}_remove(ei=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),li.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const ri in this._layers)this._layers[ri].setEventedParent(null);for(const ri in this.sourceCaches){const ni=this.sourceCaches[ri];ni.setEventedParent(null),ni.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(ei)}_clearSource(ei){this.sourceCaches[ei].clearTiles()}_reloadSource(ei){this.sourceCaches[ei].resume(),this.sourceCaches[ei].reload()}_updateSources(ei){for(const ri in this.sourceCaches)this.sourceCaches[ri].update(ei,this.map.terrain)}_generateCollisionBoxes(){for(const ei in this.sourceCaches)this._reloadSource(ei)}_updatePlacement(ei,ri,ni,si,hi=!1){let fi=!1,_i=!1;const gi={};for(const bi of this._order){const Ei=this._layers[bi];if(Ei.type!=="symbol")continue;if(!gi[Ei.source]){const zi=this.sourceCaches[Ei.source];gi[Ei.source]=zi.getRenderableIds(!0).map(Ni=>zi.getTileByID(Ni)).sort((Ni,Bi)=>Bi.tileID.overscaledZ-Ni.tileID.overscaledZ||(Ni.tileID.isLessThan(Bi.tileID)?-1:1))}const Ti=this.crossTileSymbolIndex.addLayer(Ei,gi[Ei.source],ei.center.lng);fi=fi||Ti}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((hi=hi||this._layerOrderChanged||ni===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(li.h.now(),ei.zoom))&&(this.pauseablePlacement=new Pl(ei,this.map.terrain,this._order,hi,ri,ni,si,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,gi),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(li.h.now()),_i=!0),fi&&this.pauseablePlacement.placement.setStale()),_i||fi)for(const bi of this._order){const Ei=this._layers[bi];Ei.type==="symbol"&&this.placement.updateLayerOpacities(Ei,gi[Ei.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(li.h.now())}_releaseSymbolFadeTiles(){for(const ei in this.sourceCaches)this.sourceCaches[ei].releaseSymbolFadeTiles()}getImages(ei,ri,ni){this.imageManager.getImages(ri.icons,ni),this._updateTilesForChangedImages();const si=this.sourceCaches[ri.source];si&&si.setDependencies(ri.tileID.key,ri.type,ri.icons)}getGlyphs(ei,ri,ni){this.glyphManager.getGlyphs(ri.stacks,ni);const si=this.sourceCaches[ri.source];si&&si.setDependencies(ri.tileID.key,ri.type,[""])}getResource(ei,ri,ni){return li.m(ri,ni)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(ei,ri={}){this._checkLoaded(),ei&&this._validate(li.y.glyphs,"glyphs",ei,null,ri)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=ei,this.glyphManager.entries={},this.glyphManager.setURL(ei))}addSprite(ei,ri,ni={},si){this._checkLoaded();const hi=[{id:ei,url:ri}],fi=[...ln(this.stylesheet.sprite),...hi];this._validate(li.y.sprite,"sprite",fi,null,ni)||(this.stylesheet.sprite=fi,this._loadSprite(hi,!0,si))}removeSprite(ei){this._checkLoaded();const ri=ln(this.stylesheet.sprite);if(ri.find(ni=>ni.id===ei)){if(this._spritesImagesIds[ei])for(const ni of this._spritesImagesIds[ei])this.imageManager.removeImage(ni),this._changedImages[ni]=!0;ri.splice(ri.findIndex(ni=>ni.id===ei),1),this.stylesheet.sprite=ri.length>0?ri:void 0,delete this._spritesImagesIds[ei],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new li.k("data",{dataType:"style"}))}else this.fire(new li.j(new Error(`Sprite "${ei}" doesn't exists on this map.`)))}getSprite(){return ln(this.stylesheet.sprite)}setSprite(ei,ri={},ni){this._checkLoaded(),ei&&this._validate(li.y.sprite,"sprite",ei,null,ri)||(this.stylesheet.sprite=ei,ei?this._loadSprite(ei,!0,ni):(this._unloadSprite(),ni&&ni(null)))}}ha.registerForPluginStateChange=li.aK;var yc=li.Q([{name:"a_pos",type:"Int16",components:2}]),zl="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const En={prelude:on(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:on(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:on(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:on(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:on("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:on(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:on(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:on("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:on("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:on("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:on(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:on(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:on(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:on(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:on(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:on(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:on(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:on(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:on(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:on(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:on(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:on(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:on(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:on(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:on(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:on(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:on("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",zl),terrainDepth:on("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",zl),terrainCoords:on("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",zl)};function on(ci,ei){const ri=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,ni=ei.match(/attribute ([\w]+) ([\w]+)/g),si=ci.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),hi=ei.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),fi=hi?hi.concat(si):si,_i={};return{fragmentSource:ci=ci.replace(ri,(gi,bi,Ei,Ti,zi)=>(_i[zi]=!0,bi==="define"?`
#ifndef HAS_UNIFORM_u_${zi}
varying ${Ei} ${Ti} ${zi};
#else
uniform ${Ei} ${Ti} u_${zi};
#endif
`:`
#ifdef HAS_UNIFORM_u_${zi}
    ${Ei} ${Ti} ${zi} = u_${zi};
#endif
`)),vertexSource:ei=ei.replace(ri,(gi,bi,Ei,Ti,zi)=>{const Ni=Ti==="float"?"vec2":"vec4",Bi=zi.match(/color/)?"color":Ni;return _i[zi]?bi==="define"?`
#ifndef HAS_UNIFORM_u_${zi}
uniform lowp float u_${zi}_t;
attribute ${Ei} ${Ni} a_${zi};
varying ${Ei} ${Ti} ${zi};
#else
uniform ${Ei} ${Ti} u_${zi};
#endif
`:Bi==="vec4"?`
#ifndef HAS_UNIFORM_u_${zi}
    ${zi} = a_${zi};
#else
    ${Ei} ${Ti} ${zi} = u_${zi};
#endif
`:`
#ifndef HAS_UNIFORM_u_${zi}
    ${zi} = unpack_mix_${Bi}(a_${zi}, u_${zi}_t);
#else
    ${Ei} ${Ti} ${zi} = u_${zi};
#endif
`:bi==="define"?`
#ifndef HAS_UNIFORM_u_${zi}
uniform lowp float u_${zi}_t;
attribute ${Ei} ${Ni} a_${zi};
#else
uniform ${Ei} ${Ti} u_${zi};
#endif
`:Bi==="vec4"?`
#ifndef HAS_UNIFORM_u_${zi}
    ${Ei} ${Ti} ${zi} = a_${zi};
#else
    ${Ei} ${Ti} ${zi} = u_${zi};
#endif
`:`
#ifndef HAS_UNIFORM_u_${zi}
    ${Ei} ${Ti} ${zi} = unpack_mix_${Bi}(a_${zi}, u_${zi}_t);
#else
    ${Ei} ${Ti} ${zi} = u_${zi};
#endif
`}),staticAttributes:ni,staticUniforms:fi}}class ul{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(ei,ri,ni,si,hi,fi,_i,gi,bi){this.context=ei;let Ei=this.boundPaintVertexBuffers.length!==si.length;for(let Ti=0;!Ei&&Ti<si.length;Ti++)this.boundPaintVertexBuffers[Ti]!==si[Ti]&&(Ei=!0);!this.vao||this.boundProgram!==ri||this.boundLayoutVertexBuffer!==ni||Ei||this.boundIndexBuffer!==hi||this.boundVertexOffset!==fi||this.boundDynamicVertexBuffer!==_i||this.boundDynamicVertexBuffer2!==gi||this.boundDynamicVertexBuffer3!==bi?this.freshBind(ri,ni,si,hi,fi,_i,gi,bi):(ei.bindVertexArray.set(this.vao),_i&&_i.bind(),hi&&hi.dynamicDraw&&hi.bind(),gi&&gi.bind(),bi&&bi.bind())}freshBind(ei,ri,ni,si,hi,fi,_i,gi){const bi=ei.numAttributes,Ei=this.context,Ti=Ei.gl;this.vao&&this.destroy(),this.vao=Ei.createVertexArray(),Ei.bindVertexArray.set(this.vao),this.boundProgram=ei,this.boundLayoutVertexBuffer=ri,this.boundPaintVertexBuffers=ni,this.boundIndexBuffer=si,this.boundVertexOffset=hi,this.boundDynamicVertexBuffer=fi,this.boundDynamicVertexBuffer2=_i,this.boundDynamicVertexBuffer3=gi,ri.enableAttributes(Ti,ei);for(const zi of ni)zi.enableAttributes(Ti,ei);fi&&fi.enableAttributes(Ti,ei),_i&&_i.enableAttributes(Ti,ei),gi&&gi.enableAttributes(Ti,ei),ri.bind(),ri.setVertexAttribPointers(Ti,ei,hi);for(const zi of ni)zi.bind(),zi.setVertexAttribPointers(Ti,ei,hi);fi&&(fi.bind(),fi.setVertexAttribPointers(Ti,ei,hi)),si&&si.bind(),_i&&(_i.bind(),_i.setVertexAttribPointers(Ti,ei,hi)),gi&&(gi.bind(),gi.setVertexAttribPointers(Ti,ei,hi)),Ei.currentNumAttributes=bi}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function zn(ci){const ei=[];for(let ri=0;ri<ci.length;ri++){if(ci[ri]===null)continue;const ni=ci[ri].split(" ");ei.push(ni.pop())}return ei}class gc{constructor(ei,ri,ni,si,hi,fi){const _i=ei.gl;this.program=_i.createProgram();const gi=zn(ri.staticAttributes),bi=ni?ni.getBinderAttributes():[],Ei=gi.concat(bi),Ti=En.prelude.staticUniforms?zn(En.prelude.staticUniforms):[],zi=ri.staticUniforms?zn(ri.staticUniforms):[],Ni=ni?ni.getBinderUniforms():[],Bi=Ti.concat(zi).concat(Ni),Vi=[];for(const to of Bi)Vi.indexOf(to)<0&&Vi.push(to);const Di=ni?ni.defines():[];hi&&Di.push("#define OVERDRAW_INSPECTOR;"),fi&&Di.push("#define TERRAIN3D;");const Wi=Di.concat(En.prelude.fragmentSource,ri.fragmentSource).join(`
`),Kr=Di.concat(En.prelude.vertexSource,ri.vertexSource).join(`
`),$i=_i.createShader(_i.FRAGMENT_SHADER);if(_i.isContextLost())return void(this.failedToCreate=!0);if(_i.shaderSource($i,Wi),_i.compileShader($i),!_i.getShaderParameter($i,_i.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_i.getShaderInfoLog($i)}`);_i.attachShader(this.program,$i);const Ji=_i.createShader(_i.VERTEX_SHADER);if(_i.isContextLost())return void(this.failedToCreate=!0);if(_i.shaderSource(Ji,Kr),_i.compileShader(Ji),!_i.getShaderParameter(Ji,_i.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_i.getShaderInfoLog(Ji)}`);_i.attachShader(this.program,Ji),this.attributes={};const eo={};this.numAttributes=Ei.length;for(let to=0;to<this.numAttributes;to++)Ei[to]&&(_i.bindAttribLocation(this.program,to,Ei[to]),this.attributes[Ei[to]]=to);if(_i.linkProgram(this.program),!_i.getProgramParameter(this.program,_i.LINK_STATUS))throw new Error(`Program failed to link: ${_i.getProgramInfoLog(this.program)}`);_i.deleteShader(Ji),_i.deleteShader($i);for(let to=0;to<Vi.length;to++){const no=Vi[to];if(no&&!eo[no]){const co=_i.getUniformLocation(this.program,no);co&&(eo[no]=co)}}this.fixedUniforms=si(ei,eo),this.terrainUniforms=((to,no)=>({u_depth:new li.aL(to,no.u_depth),u_terrain:new li.aL(to,no.u_terrain),u_terrain_dim:new li.aM(to,no.u_terrain_dim),u_terrain_matrix:new li.aN(to,no.u_terrain_matrix),u_terrain_unpack:new li.aO(to,no.u_terrain_unpack),u_terrain_exaggeration:new li.aM(to,no.u_terrain_exaggeration)}))(ei,eo),this.binderUniforms=ni?ni.getUniforms(ei,eo):[]}draw(ei,ri,ni,si,hi,fi,_i,gi,bi,Ei,Ti,zi,Ni,Bi,Vi,Di,Wi,Kr){const $i=ei.gl;if(this.failedToCreate)return;if(ei.program.set(this.program),ei.setDepthMode(ni),ei.setStencilMode(si),ei.setColorMode(hi),ei.setCullFace(fi),gi){ei.activeTexture.set($i.TEXTURE2),$i.bindTexture($i.TEXTURE_2D,gi.depthTexture),ei.activeTexture.set($i.TEXTURE3),$i.bindTexture($i.TEXTURE_2D,gi.texture);for(const eo in this.terrainUniforms)this.terrainUniforms[eo].set(gi[eo])}for(const eo in this.fixedUniforms)this.fixedUniforms[eo].set(_i[eo]);Vi&&Vi.setUniforms(ei,this.binderUniforms,Ni,{zoom:Bi});let Ji=0;switch(ri){case $i.LINES:Ji=2;break;case $i.TRIANGLES:Ji=3;break;case $i.LINE_STRIP:Ji=1}for(const eo of zi.get()){const to=eo.vaos||(eo.vaos={});(to[bi]||(to[bi]=new ul)).bind(ei,this,Ei,Vi?Vi.getPaintVertexBuffers():[],Ti,eo.vertexOffset,Di,Wi,Kr),$i.drawElements(ri,eo.primitiveLength*Ji,$i.UNSIGNED_SHORT,eo.primitiveOffset*Ji*2)}}}function ls(ci,ei,ri){const ni=1/Xi(ri,1,ei.transform.tileZoom),si=Math.pow(2,ri.tileID.overscaledZ),hi=ri.tileSize*Math.pow(2,ei.transform.tileZoom)/si,fi=hi*(ri.tileID.canonical.x+ri.tileID.wrap*si),_i=hi*ri.tileID.canonical.y;return{u_image:0,u_texsize:ri.imageAtlasTexture.size,u_scale:[ni,ci.fromScale,ci.toScale],u_fade:ci.t,u_pixel_coord_upper:[fi>>16,_i>>16],u_pixel_coord_lower:[65535&fi,65535&_i]}}const iu=(ci,ei,ri,ni)=>{const si=ei.style.light,hi=si.properties.get("position"),fi=[hi.x,hi.y,hi.z],_i=function(){var bi=new li.A(9);return li.A!=Float32Array&&(bi[1]=0,bi[2]=0,bi[3]=0,bi[5]=0,bi[6]=0,bi[7]=0),bi[0]=1,bi[4]=1,bi[8]=1,bi}();si.properties.get("anchor")==="viewport"&&function(bi,Ei){var Ti=Math.sin(Ei),zi=Math.cos(Ei);bi[0]=zi,bi[1]=Ti,bi[2]=0,bi[3]=-Ti,bi[4]=zi,bi[5]=0,bi[6]=0,bi[7]=0,bi[8]=1}(_i,-ei.transform.angle),function(bi,Ei,Ti){var zi=Ei[0],Ni=Ei[1],Bi=Ei[2];bi[0]=zi*Ti[0]+Ni*Ti[3]+Bi*Ti[6],bi[1]=zi*Ti[1]+Ni*Ti[4]+Bi*Ti[7],bi[2]=zi*Ti[2]+Ni*Ti[5]+Bi*Ti[8]}(fi,fi,_i);const gi=si.properties.get("color");return{u_matrix:ci,u_lightpos:fi,u_lightintensity:si.properties.get("intensity"),u_lightcolor:[gi.r,gi.g,gi.b],u_vertical_gradient:+ri,u_opacity:ni}},Ks=(ci,ei,ri,ni,si,hi,fi)=>li.e(iu(ci,ei,ri,ni),ls(hi,ei,fi),{u_height_factor:-Math.pow(2,si.overscaledZ)/fi.tileSize/8}),lh=ci=>({u_matrix:ci}),ru=(ci,ei,ri,ni)=>li.e(lh(ci),ls(ri,ei,ni)),xc=(ci,ei)=>({u_matrix:ci,u_world:ei}),vc=(ci,ei,ri,ni,si)=>li.e(ru(ci,ei,ri,ni),{u_world:si}),Js=(ci,ei,ri,ni)=>{const si=ci.transform;let hi,fi;if(ni.paint.get("circle-pitch-alignment")==="map"){const _i=Xi(ri,1,si.zoom);hi=!0,fi=[_i,_i]}else hi=!1,fi=si.pixelsToGLUnits;return{u_camera_to_center_distance:si.cameraToCenterDistance,u_scale_with_map:+(ni.paint.get("circle-pitch-scale")==="map"),u_matrix:ci.translatePosMatrix(ei.posMatrix,ri,ni.paint.get("circle-translate"),ni.paint.get("circle-translate-anchor")),u_pitch_with_map:+hi,u_device_pixel_ratio:ci.pixelRatio,u_extrude_scale:fi}},ou=(ci,ei,ri)=>{const ni=Xi(ri,1,ei.zoom),si=Math.pow(2,ei.zoom-ri.tileID.overscaledZ),hi=ri.tileID.overscaleFactor();return{u_matrix:ci,u_camera_to_center_distance:ei.cameraToCenterDistance,u_pixels_to_tile_units:ni,u_extrude_scale:[ei.pixelsToGLUnits[0]/(ni*si),ei.pixelsToGLUnits[1]/(ni*si)],u_overscale_factor:hi}},Yl=(ci,ei,ri=1)=>({u_matrix:ci,u_color:ei,u_overlay:0,u_overlay_scale:ri}),ch=ci=>({u_matrix:ci}),_p=(ci,ei,ri,ni)=>({u_matrix:ci,u_extrude_scale:Xi(ei,1,ri),u_intensity:ni});function nu(ci,ei){const ri=Math.pow(2,ei.canonical.z),ni=ei.canonical.y;return[new li.U(0,ni/ri).toLngLat().lat,new li.U(0,(ni+1)/ri).toLngLat().lat]}const au=(ci,ei,ri,ni)=>{const si=ci.transform;return{u_matrix:bc(ci,ei,ri,ni),u_ratio:1/Xi(ei,1,si.zoom),u_device_pixel_ratio:ci.pixelRatio,u_units_to_pixels:[1/si.pixelsToGLUnits[0],1/si.pixelsToGLUnits[1]]}},uh=(ci,ei,ri,ni,si)=>li.e(au(ci,ei,ri,si),{u_image:0,u_image_height:ni}),yp=(ci,ei,ri,ni,si)=>{const hi=ci.transform,fi=ph(ei,hi);return{u_matrix:bc(ci,ei,ri,si),u_texsize:ei.imageAtlasTexture.size,u_ratio:1/Xi(ei,1,hi.zoom),u_device_pixel_ratio:ci.pixelRatio,u_image:0,u_scale:[fi,ni.fromScale,ni.toScale],u_fade:ni.t,u_units_to_pixels:[1/hi.pixelsToGLUnits[0],1/hi.pixelsToGLUnits[1]]}},hh=(ci,ei,ri,ni,si,hi)=>{const fi=ci.lineAtlas,_i=ph(ei,ci.transform),gi=ri.layout.get("line-cap")==="round",bi=fi.getDash(ni.from,gi),Ei=fi.getDash(ni.to,gi),Ti=bi.width*si.fromScale,zi=Ei.width*si.toScale;return li.e(au(ci,ei,ri,hi),{u_patternscale_a:[_i/Ti,-bi.height/2],u_patternscale_b:[_i/zi,-Ei.height/2],u_sdfgamma:fi.width/(256*Math.min(Ti,zi)*ci.pixelRatio)/2,u_image:0,u_tex_y_a:bi.y,u_tex_y_b:Ei.y,u_mix:si.t})};function ph(ci,ei){return 1/Xi(ci,1,ei.tileZoom)}function bc(ci,ei,ri,ni){return ci.translatePosMatrix(ni?ni.posMatrix:ei.tileID.posMatrix,ei,ri.paint.get("line-translate"),ri.paint.get("line-translate-anchor"))}const dh=(ci,ei,ri,ni,si)=>{return{u_matrix:ci,u_tl_parent:ei,u_scale_parent:ri,u_buffer_scale:1,u_fade_t:ni.mix,u_opacity:ni.opacity*si.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:si.paint.get("raster-brightness-min"),u_brightness_high:si.paint.get("raster-brightness-max"),u_saturation_factor:(fi=si.paint.get("raster-saturation"),fi>0?1-1/(1.001-fi):-fi),u_contrast_factor:(hi=si.paint.get("raster-contrast"),hi>0?1/(1-hi):1+hi),u_spin_weights:fh(si.paint.get("raster-hue-rotate"))};var hi,fi};function fh(ci){ci*=Math.PI/180;const ei=Math.sin(ci),ri=Math.cos(ci);return[(2*ri+1)/3,(-Math.sqrt(3)*ei-ri+1)/3,(Math.sqrt(3)*ei-ri+1)/3]}const su=(ci,ei,ri,ni,si,hi,fi,_i,gi,bi)=>{const Ei=si.transform;return{u_is_size_zoom_constant:+(ci==="constant"||ci==="source"),u_is_size_feature_constant:+(ci==="constant"||ci==="camera"),u_size_t:ei?ei.uSizeT:0,u_size:ei?ei.uSize:0,u_camera_to_center_distance:Ei.cameraToCenterDistance,u_pitch:Ei.pitch/360*2*Math.PI,u_rotate_symbol:+ri,u_aspect_ratio:Ei.width/Ei.height,u_fade_change:si.options.fadeDuration?si.symbolFadeChange:1,u_matrix:hi,u_label_plane_matrix:fi,u_coord_matrix:_i,u_is_text:+gi,u_pitch_with_map:+ni,u_texsize:bi,u_texture:0}},lu=(ci,ei,ri,ni,si,hi,fi,_i,gi,bi,Ei)=>{const Ti=si.transform;return li.e(su(ci,ei,ri,ni,si,hi,fi,_i,gi,bi),{u_gamma_scale:ni?Math.cos(Ti._pitch)*Ti.cameraToCenterDistance:1,u_device_pixel_ratio:si.pixelRatio,u_is_halo:+Ei})},hl=(ci,ei,ri,ni,si,hi,fi,_i,gi,bi)=>li.e(lu(ci,ei,ri,ni,si,hi,fi,_i,!0,gi,!0),{u_texsize_icon:bi,u_texture_icon:1}),wc=(ci,ei,ri)=>({u_matrix:ci,u_opacity:ei,u_color:ri}),cs=(ci,ei,ri,ni,si,hi)=>li.e(function(fi,_i,gi,bi){const Ei=gi.imageManager.getPattern(fi.from.toString()),Ti=gi.imageManager.getPattern(fi.to.toString()),{width:zi,height:Ni}=gi.imageManager.getPixelSize(),Bi=Math.pow(2,bi.tileID.overscaledZ),Vi=bi.tileSize*Math.pow(2,gi.transform.tileZoom)/Bi,Di=Vi*(bi.tileID.canonical.x+bi.tileID.wrap*Bi),Wi=Vi*bi.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Ei.tl,u_pattern_br_a:Ei.br,u_pattern_tl_b:Ti.tl,u_pattern_br_b:Ti.br,u_texsize:[zi,Ni],u_mix:_i.t,u_pattern_size_a:Ei.displaySize,u_pattern_size_b:Ti.displaySize,u_scale_a:_i.fromScale,u_scale_b:_i.toScale,u_tile_units_to_pixels:1/Xi(bi,1,gi.transform.tileZoom),u_pixel_coord_upper:[Di>>16,Wi>>16],u_pixel_coord_lower:[65535&Di,65535&Wi]}}(ni,hi,ri,si),{u_matrix:ci,u_opacity:ei}),Sc={fillExtrusion:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_lightpos:new li.aP(ci,ei.u_lightpos),u_lightintensity:new li.aM(ci,ei.u_lightintensity),u_lightcolor:new li.aP(ci,ei.u_lightcolor),u_vertical_gradient:new li.aM(ci,ei.u_vertical_gradient),u_opacity:new li.aM(ci,ei.u_opacity)}),fillExtrusionPattern:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_lightpos:new li.aP(ci,ei.u_lightpos),u_lightintensity:new li.aM(ci,ei.u_lightintensity),u_lightcolor:new li.aP(ci,ei.u_lightcolor),u_vertical_gradient:new li.aM(ci,ei.u_vertical_gradient),u_height_factor:new li.aM(ci,ei.u_height_factor),u_image:new li.aL(ci,ei.u_image),u_texsize:new li.aQ(ci,ei.u_texsize),u_pixel_coord_upper:new li.aQ(ci,ei.u_pixel_coord_upper),u_pixel_coord_lower:new li.aQ(ci,ei.u_pixel_coord_lower),u_scale:new li.aP(ci,ei.u_scale),u_fade:new li.aM(ci,ei.u_fade),u_opacity:new li.aM(ci,ei.u_opacity)}),fill:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix)}),fillPattern:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_image:new li.aL(ci,ei.u_image),u_texsize:new li.aQ(ci,ei.u_texsize),u_pixel_coord_upper:new li.aQ(ci,ei.u_pixel_coord_upper),u_pixel_coord_lower:new li.aQ(ci,ei.u_pixel_coord_lower),u_scale:new li.aP(ci,ei.u_scale),u_fade:new li.aM(ci,ei.u_fade)}),fillOutline:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_world:new li.aQ(ci,ei.u_world)}),fillOutlinePattern:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_world:new li.aQ(ci,ei.u_world),u_image:new li.aL(ci,ei.u_image),u_texsize:new li.aQ(ci,ei.u_texsize),u_pixel_coord_upper:new li.aQ(ci,ei.u_pixel_coord_upper),u_pixel_coord_lower:new li.aQ(ci,ei.u_pixel_coord_lower),u_scale:new li.aP(ci,ei.u_scale),u_fade:new li.aM(ci,ei.u_fade)}),circle:(ci,ei)=>({u_camera_to_center_distance:new li.aM(ci,ei.u_camera_to_center_distance),u_scale_with_map:new li.aL(ci,ei.u_scale_with_map),u_pitch_with_map:new li.aL(ci,ei.u_pitch_with_map),u_extrude_scale:new li.aQ(ci,ei.u_extrude_scale),u_device_pixel_ratio:new li.aM(ci,ei.u_device_pixel_ratio),u_matrix:new li.aN(ci,ei.u_matrix)}),collisionBox:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_camera_to_center_distance:new li.aM(ci,ei.u_camera_to_center_distance),u_pixels_to_tile_units:new li.aM(ci,ei.u_pixels_to_tile_units),u_extrude_scale:new li.aQ(ci,ei.u_extrude_scale),u_overscale_factor:new li.aM(ci,ei.u_overscale_factor)}),collisionCircle:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_inv_matrix:new li.aN(ci,ei.u_inv_matrix),u_camera_to_center_distance:new li.aM(ci,ei.u_camera_to_center_distance),u_viewport_size:new li.aQ(ci,ei.u_viewport_size)}),debug:(ci,ei)=>({u_color:new li.aR(ci,ei.u_color),u_matrix:new li.aN(ci,ei.u_matrix),u_overlay:new li.aL(ci,ei.u_overlay),u_overlay_scale:new li.aM(ci,ei.u_overlay_scale)}),clippingMask:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix)}),heatmap:(ci,ei)=>({u_extrude_scale:new li.aM(ci,ei.u_extrude_scale),u_intensity:new li.aM(ci,ei.u_intensity),u_matrix:new li.aN(ci,ei.u_matrix)}),heatmapTexture:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_world:new li.aQ(ci,ei.u_world),u_image:new li.aL(ci,ei.u_image),u_color_ramp:new li.aL(ci,ei.u_color_ramp),u_opacity:new li.aM(ci,ei.u_opacity)}),hillshade:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_image:new li.aL(ci,ei.u_image),u_latrange:new li.aQ(ci,ei.u_latrange),u_light:new li.aQ(ci,ei.u_light),u_shadow:new li.aR(ci,ei.u_shadow),u_highlight:new li.aR(ci,ei.u_highlight),u_accent:new li.aR(ci,ei.u_accent)}),hillshadePrepare:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_image:new li.aL(ci,ei.u_image),u_dimension:new li.aQ(ci,ei.u_dimension),u_zoom:new li.aM(ci,ei.u_zoom),u_unpack:new li.aO(ci,ei.u_unpack)}),line:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_ratio:new li.aM(ci,ei.u_ratio),u_device_pixel_ratio:new li.aM(ci,ei.u_device_pixel_ratio),u_units_to_pixels:new li.aQ(ci,ei.u_units_to_pixels)}),lineGradient:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_ratio:new li.aM(ci,ei.u_ratio),u_device_pixel_ratio:new li.aM(ci,ei.u_device_pixel_ratio),u_units_to_pixels:new li.aQ(ci,ei.u_units_to_pixels),u_image:new li.aL(ci,ei.u_image),u_image_height:new li.aM(ci,ei.u_image_height)}),linePattern:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_texsize:new li.aQ(ci,ei.u_texsize),u_ratio:new li.aM(ci,ei.u_ratio),u_device_pixel_ratio:new li.aM(ci,ei.u_device_pixel_ratio),u_image:new li.aL(ci,ei.u_image),u_units_to_pixels:new li.aQ(ci,ei.u_units_to_pixels),u_scale:new li.aP(ci,ei.u_scale),u_fade:new li.aM(ci,ei.u_fade)}),lineSDF:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_ratio:new li.aM(ci,ei.u_ratio),u_device_pixel_ratio:new li.aM(ci,ei.u_device_pixel_ratio),u_units_to_pixels:new li.aQ(ci,ei.u_units_to_pixels),u_patternscale_a:new li.aQ(ci,ei.u_patternscale_a),u_patternscale_b:new li.aQ(ci,ei.u_patternscale_b),u_sdfgamma:new li.aM(ci,ei.u_sdfgamma),u_image:new li.aL(ci,ei.u_image),u_tex_y_a:new li.aM(ci,ei.u_tex_y_a),u_tex_y_b:new li.aM(ci,ei.u_tex_y_b),u_mix:new li.aM(ci,ei.u_mix)}),raster:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_tl_parent:new li.aQ(ci,ei.u_tl_parent),u_scale_parent:new li.aM(ci,ei.u_scale_parent),u_buffer_scale:new li.aM(ci,ei.u_buffer_scale),u_fade_t:new li.aM(ci,ei.u_fade_t),u_opacity:new li.aM(ci,ei.u_opacity),u_image0:new li.aL(ci,ei.u_image0),u_image1:new li.aL(ci,ei.u_image1),u_brightness_low:new li.aM(ci,ei.u_brightness_low),u_brightness_high:new li.aM(ci,ei.u_brightness_high),u_saturation_factor:new li.aM(ci,ei.u_saturation_factor),u_contrast_factor:new li.aM(ci,ei.u_contrast_factor),u_spin_weights:new li.aP(ci,ei.u_spin_weights)}),symbolIcon:(ci,ei)=>({u_is_size_zoom_constant:new li.aL(ci,ei.u_is_size_zoom_constant),u_is_size_feature_constant:new li.aL(ci,ei.u_is_size_feature_constant),u_size_t:new li.aM(ci,ei.u_size_t),u_size:new li.aM(ci,ei.u_size),u_camera_to_center_distance:new li.aM(ci,ei.u_camera_to_center_distance),u_pitch:new li.aM(ci,ei.u_pitch),u_rotate_symbol:new li.aL(ci,ei.u_rotate_symbol),u_aspect_ratio:new li.aM(ci,ei.u_aspect_ratio),u_fade_change:new li.aM(ci,ei.u_fade_change),u_matrix:new li.aN(ci,ei.u_matrix),u_label_plane_matrix:new li.aN(ci,ei.u_label_plane_matrix),u_coord_matrix:new li.aN(ci,ei.u_coord_matrix),u_is_text:new li.aL(ci,ei.u_is_text),u_pitch_with_map:new li.aL(ci,ei.u_pitch_with_map),u_texsize:new li.aQ(ci,ei.u_texsize),u_texture:new li.aL(ci,ei.u_texture)}),symbolSDF:(ci,ei)=>({u_is_size_zoom_constant:new li.aL(ci,ei.u_is_size_zoom_constant),u_is_size_feature_constant:new li.aL(ci,ei.u_is_size_feature_constant),u_size_t:new li.aM(ci,ei.u_size_t),u_size:new li.aM(ci,ei.u_size),u_camera_to_center_distance:new li.aM(ci,ei.u_camera_to_center_distance),u_pitch:new li.aM(ci,ei.u_pitch),u_rotate_symbol:new li.aL(ci,ei.u_rotate_symbol),u_aspect_ratio:new li.aM(ci,ei.u_aspect_ratio),u_fade_change:new li.aM(ci,ei.u_fade_change),u_matrix:new li.aN(ci,ei.u_matrix),u_label_plane_matrix:new li.aN(ci,ei.u_label_plane_matrix),u_coord_matrix:new li.aN(ci,ei.u_coord_matrix),u_is_text:new li.aL(ci,ei.u_is_text),u_pitch_with_map:new li.aL(ci,ei.u_pitch_with_map),u_texsize:new li.aQ(ci,ei.u_texsize),u_texture:new li.aL(ci,ei.u_texture),u_gamma_scale:new li.aM(ci,ei.u_gamma_scale),u_device_pixel_ratio:new li.aM(ci,ei.u_device_pixel_ratio),u_is_halo:new li.aL(ci,ei.u_is_halo)}),symbolTextAndIcon:(ci,ei)=>({u_is_size_zoom_constant:new li.aL(ci,ei.u_is_size_zoom_constant),u_is_size_feature_constant:new li.aL(ci,ei.u_is_size_feature_constant),u_size_t:new li.aM(ci,ei.u_size_t),u_size:new li.aM(ci,ei.u_size),u_camera_to_center_distance:new li.aM(ci,ei.u_camera_to_center_distance),u_pitch:new li.aM(ci,ei.u_pitch),u_rotate_symbol:new li.aL(ci,ei.u_rotate_symbol),u_aspect_ratio:new li.aM(ci,ei.u_aspect_ratio),u_fade_change:new li.aM(ci,ei.u_fade_change),u_matrix:new li.aN(ci,ei.u_matrix),u_label_plane_matrix:new li.aN(ci,ei.u_label_plane_matrix),u_coord_matrix:new li.aN(ci,ei.u_coord_matrix),u_is_text:new li.aL(ci,ei.u_is_text),u_pitch_with_map:new li.aL(ci,ei.u_pitch_with_map),u_texsize:new li.aQ(ci,ei.u_texsize),u_texsize_icon:new li.aQ(ci,ei.u_texsize_icon),u_texture:new li.aL(ci,ei.u_texture),u_texture_icon:new li.aL(ci,ei.u_texture_icon),u_gamma_scale:new li.aM(ci,ei.u_gamma_scale),u_device_pixel_ratio:new li.aM(ci,ei.u_device_pixel_ratio),u_is_halo:new li.aL(ci,ei.u_is_halo)}),background:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_opacity:new li.aM(ci,ei.u_opacity),u_color:new li.aR(ci,ei.u_color)}),backgroundPattern:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_opacity:new li.aM(ci,ei.u_opacity),u_image:new li.aL(ci,ei.u_image),u_pattern_tl_a:new li.aQ(ci,ei.u_pattern_tl_a),u_pattern_br_a:new li.aQ(ci,ei.u_pattern_br_a),u_pattern_tl_b:new li.aQ(ci,ei.u_pattern_tl_b),u_pattern_br_b:new li.aQ(ci,ei.u_pattern_br_b),u_texsize:new li.aQ(ci,ei.u_texsize),u_mix:new li.aM(ci,ei.u_mix),u_pattern_size_a:new li.aQ(ci,ei.u_pattern_size_a),u_pattern_size_b:new li.aQ(ci,ei.u_pattern_size_b),u_scale_a:new li.aM(ci,ei.u_scale_a),u_scale_b:new li.aM(ci,ei.u_scale_b),u_pixel_coord_upper:new li.aQ(ci,ei.u_pixel_coord_upper),u_pixel_coord_lower:new li.aQ(ci,ei.u_pixel_coord_lower),u_tile_units_to_pixels:new li.aM(ci,ei.u_tile_units_to_pixels)}),terrain:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_texture:new li.aL(ci,ei.u_texture),u_ele_delta:new li.aM(ci,ei.u_ele_delta)}),terrainDepth:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_ele_delta:new li.aM(ci,ei.u_ele_delta)}),terrainCoords:(ci,ei)=>({u_matrix:new li.aN(ci,ei.u_matrix),u_texture:new li.aL(ci,ei.u_texture),u_terrain_coords_id:new li.aM(ci,ei.u_terrain_coords_id),u_ele_delta:new li.aM(ci,ei.u_ele_delta)})};class Ec{constructor(ei,ri,ni){this.context=ei;const si=ei.gl;this.buffer=si.createBuffer(),this.dynamicDraw=!!ni,this.context.unbindVAO(),ei.bindElementBuffer.set(this.buffer),si.bufferData(si.ELEMENT_ARRAY_BUFFER,ri.arrayBuffer,this.dynamicDraw?si.DYNAMIC_DRAW:si.STATIC_DRAW),this.dynamicDraw||delete ri.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(ei){const ri=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),ri.bufferSubData(ri.ELEMENT_ARRAY_BUFFER,0,ei.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Tc{constructor(ei,ri,ni,si){this.length=ri.length,this.attributes=ni,this.itemSize=ri.bytesPerElement,this.dynamicDraw=si,this.context=ei;const hi=ei.gl;this.buffer=hi.createBuffer(),ei.bindVertexBuffer.set(this.buffer),hi.bufferData(hi.ARRAY_BUFFER,ri.arrayBuffer,this.dynamicDraw?hi.DYNAMIC_DRAW:hi.STATIC_DRAW),this.dynamicDraw||delete ri.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(ei){if(ei.length!==this.length)throw new Error(`Length of new data is ${ei.length}, which doesn't match current length of ${this.length}`);const ri=this.context.gl;this.bind(),ri.bufferSubData(ri.ARRAY_BUFFER,0,ei.arrayBuffer)}enableAttributes(ei,ri){for(let ni=0;ni<this.attributes.length;ni++){const si=ri.attributes[this.attributes[ni].name];si!==void 0&&ei.enableVertexAttribArray(si)}}setVertexAttribPointers(ei,ri,ni){for(let si=0;si<this.attributes.length;si++){const hi=this.attributes[si],fi=ri.attributes[hi.name];fi!==void 0&&ei.vertexAttribPointer(fi,hi.components,ei[Xl[hi.type]],!1,this.itemSize,hi.offset+this.itemSize*(ni||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Rl=new WeakMap;function Qs(ci){var ei;if(Rl.has(ci))return Rl.get(ci);{const ri=(ei=ci.getParameter(ci.VERSION))===null||ei===void 0?void 0:ei.startsWith("WebGL 2.0");return Rl.set(ci,ri),ri}}class Ko{constructor(ei){this.gl=ei.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(ei){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ic extends Ko{getDefault(){return li.aT.transparent}set(ei){const ri=this.current;(ei.r!==ri.r||ei.g!==ri.g||ei.b!==ri.b||ei.a!==ri.a||this.dirty)&&(this.gl.clearColor(ei.r,ei.g,ei.b,ei.a),this.current=ei,this.dirty=!1)}}class Ya extends Ko{getDefault(){return 1}set(ei){(ei!==this.current||this.dirty)&&(this.gl.clearDepth(ei),this.current=ei,this.dirty=!1)}}class Xa extends Ko{getDefault(){return 0}set(ei){(ei!==this.current||this.dirty)&&(this.gl.clearStencil(ei),this.current=ei,this.dirty=!1)}}class cu extends Ko{getDefault(){return[!0,!0,!0,!0]}set(ei){const ri=this.current;(ei[0]!==ri[0]||ei[1]!==ri[1]||ei[2]!==ri[2]||ei[3]!==ri[3]||this.dirty)&&(this.gl.colorMask(ei[0],ei[1],ei[2],ei[3]),this.current=ei,this.dirty=!1)}}class Ac extends Ko{getDefault(){return!0}set(ei){(ei!==this.current||this.dirty)&&(this.gl.depthMask(ei),this.current=ei,this.dirty=!1)}}class Pc extends Ko{getDefault(){return 255}set(ei){(ei!==this.current||this.dirty)&&(this.gl.stencilMask(ei),this.current=ei,this.dirty=!1)}}class uu extends Ko{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(ei){const ri=this.current;(ei.func!==ri.func||ei.ref!==ri.ref||ei.mask!==ri.mask||this.dirty)&&(this.gl.stencilFunc(ei.func,ei.ref,ei.mask),this.current=ei,this.dirty=!1)}}class hu extends Ko{getDefault(){const ei=this.gl;return[ei.KEEP,ei.KEEP,ei.KEEP]}set(ei){const ri=this.current;(ei[0]!==ri[0]||ei[1]!==ri[1]||ei[2]!==ri[2]||this.dirty)&&(this.gl.stencilOp(ei[0],ei[1],ei[2]),this.current=ei,this.dirty=!1)}}class Cc extends Ko{getDefault(){return!1}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ei?ri.enable(ri.STENCIL_TEST):ri.disable(ri.STENCIL_TEST),this.current=ei,this.dirty=!1}}class pu extends Ko{getDefault(){return[0,1]}set(ei){const ri=this.current;(ei[0]!==ri[0]||ei[1]!==ri[1]||this.dirty)&&(this.gl.depthRange(ei[0],ei[1]),this.current=ei,this.dirty=!1)}}class du extends Ko{getDefault(){return!1}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ei?ri.enable(ri.DEPTH_TEST):ri.disable(ri.DEPTH_TEST),this.current=ei,this.dirty=!1}}class zc extends Ko{getDefault(){return this.gl.LESS}set(ei){(ei!==this.current||this.dirty)&&(this.gl.depthFunc(ei),this.current=ei,this.dirty=!1)}}class mh extends Ko{getDefault(){return!1}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ei?ri.enable(ri.BLEND):ri.disable(ri.BLEND),this.current=ei,this.dirty=!1}}class _h extends Ko{getDefault(){const ei=this.gl;return[ei.ONE,ei.ZERO]}set(ei){const ri=this.current;(ei[0]!==ri[0]||ei[1]!==ri[1]||this.dirty)&&(this.gl.blendFunc(ei[0],ei[1]),this.current=ei,this.dirty=!1)}}class Ml extends Ko{getDefault(){return li.aT.transparent}set(ei){const ri=this.current;(ei.r!==ri.r||ei.g!==ri.g||ei.b!==ri.b||ei.a!==ri.a||this.dirty)&&(this.gl.blendColor(ei.r,ei.g,ei.b,ei.a),this.current=ei,this.dirty=!1)}}class gp extends Ko{getDefault(){return this.gl.FUNC_ADD}set(ei){(ei!==this.current||this.dirty)&&(this.gl.blendEquation(ei),this.current=ei,this.dirty=!1)}}class xp extends Ko{getDefault(){return!1}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ei?ri.enable(ri.CULL_FACE):ri.disable(ri.CULL_FACE),this.current=ei,this.dirty=!1}}class vp extends Ko{getDefault(){return this.gl.BACK}set(ei){(ei!==this.current||this.dirty)&&(this.gl.cullFace(ei),this.current=ei,this.dirty=!1)}}class bp extends Ko{getDefault(){return this.gl.CCW}set(ei){(ei!==this.current||this.dirty)&&(this.gl.frontFace(ei),this.current=ei,this.dirty=!1)}}class wp extends Ko{getDefault(){return null}set(ei){(ei!==this.current||this.dirty)&&(this.gl.useProgram(ei),this.current=ei,this.dirty=!1)}}class Sp extends Ko{getDefault(){return this.gl.TEXTURE0}set(ei){(ei!==this.current||this.dirty)&&(this.gl.activeTexture(ei),this.current=ei,this.dirty=!1)}}class fu extends Ko{getDefault(){const ei=this.gl;return[0,0,ei.drawingBufferWidth,ei.drawingBufferHeight]}set(ei){const ri=this.current;(ei[0]!==ri[0]||ei[1]!==ri[1]||ei[2]!==ri[2]||ei[3]!==ri[3]||this.dirty)&&(this.gl.viewport(ei[0],ei[1],ei[2],ei[3]),this.current=ei,this.dirty=!1)}}class Rc extends Ko{getDefault(){return null}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ri.bindFramebuffer(ri.FRAMEBUFFER,ei),this.current=ei,this.dirty=!1}}class mu extends Ko{getDefault(){return null}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ri.bindRenderbuffer(ri.RENDERBUFFER,ei),this.current=ei,this.dirty=!1}}class _u extends Ko{getDefault(){return null}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ri.bindTexture(ri.TEXTURE_2D,ei),this.current=ei,this.dirty=!1}}class Ll extends Ko{getDefault(){return null}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ri.bindBuffer(ri.ARRAY_BUFFER,ei),this.current=ei,this.dirty=!1}}class yh extends Ko{getDefault(){return null}set(ei){const ri=this.gl;ri.bindBuffer(ri.ELEMENT_ARRAY_BUFFER,ei),this.current=ei,this.dirty=!1}}class gh extends Ko{getDefault(){return null}set(ei){var ri;if(ei===this.current&&!this.dirty)return;const ni=this.gl;Qs(ni)?ni.bindVertexArray(ei):(ri=ni.getExtension("OES_vertex_array_object"))===null||ri===void 0||ri.bindVertexArrayOES(ei),this.current=ei,this.dirty=!1}}class yu extends Ko{getDefault(){return 4}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ri.pixelStorei(ri.UNPACK_ALIGNMENT,ei),this.current=ei,this.dirty=!1}}class pl extends Ko{getDefault(){return!1}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ri.pixelStorei(ri.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ei),this.current=ei,this.dirty=!1}}class xh extends Ko{getDefault(){return!1}set(ei){if(ei===this.current&&!this.dirty)return;const ri=this.gl;ri.pixelStorei(ri.UNPACK_FLIP_Y_WEBGL,ei),this.current=ei,this.dirty=!1}}class el extends Ko{constructor(ei,ri){super(ei),this.context=ei,this.parent=ri}getDefault(){return null}}class Ol extends el{setDirty(){this.dirty=!0}set(ei){if(ei===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const ri=this.gl;ri.framebufferTexture2D(ri.FRAMEBUFFER,ri.COLOR_ATTACHMENT0,ri.TEXTURE_2D,ei,0),this.current=ei,this.dirty=!1}}class vh extends el{set(ei){if(ei===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const ri=this.gl;ri.framebufferRenderbuffer(ri.FRAMEBUFFER,ri.DEPTH_ATTACHMENT,ri.RENDERBUFFER,ei),this.current=ei,this.dirty=!1}}class gu extends el{set(ei){if(ei===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const ri=this.gl;ri.framebufferRenderbuffer(ri.FRAMEBUFFER,ri.DEPTH_STENCIL_ATTACHMENT,ri.RENDERBUFFER,ei),this.current=ei,this.dirty=!1}}class nn{constructor(ei,ri,ni,si,hi){this.context=ei,this.width=ri,this.height=ni;const fi=ei.gl,_i=this.framebuffer=fi.createFramebuffer();if(this.colorAttachment=new Ol(ei,_i),si)this.depthAttachment=hi?new gu(ei,_i):new vh(ei,_i);else if(hi)throw new Error("Stencil cannot be setted without depth");if(fi.checkFramebufferStatus(fi.FRAMEBUFFER)!==fi.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const ei=this.context.gl,ri=this.colorAttachment.get();if(ri&&ei.deleteTexture(ri),this.depthAttachment){const ni=this.depthAttachment.get();ni&&ei.deleteRenderbuffer(ni)}ei.deleteFramebuffer(this.framebuffer)}}class Tn{constructor(ei,ri,ni){this.blendFunction=ei,this.blendColor=ri,this.mask=ni}}Tn.Replace=[1,0],Tn.disabled=new Tn(Tn.Replace,li.aT.transparent,[!1,!1,!1,!1]),Tn.unblended=new Tn(Tn.Replace,li.aT.transparent,[!0,!0,!0,!0]),Tn.alphaBlended=new Tn([1,771],li.aT.transparent,[!0,!0,!0,!0]);class Ep{constructor(ei){var ri,ni;if(this.gl=ei,this.clearColor=new Ic(this),this.clearDepth=new Ya(this),this.clearStencil=new Xa(this),this.colorMask=new cu(this),this.depthMask=new Ac(this),this.stencilMask=new Pc(this),this.stencilFunc=new uu(this),this.stencilOp=new hu(this),this.stencilTest=new Cc(this),this.depthRange=new pu(this),this.depthTest=new du(this),this.depthFunc=new zc(this),this.blend=new mh(this),this.blendFunc=new _h(this),this.blendColor=new Ml(this),this.blendEquation=new gp(this),this.cullFace=new xp(this),this.cullFaceSide=new vp(this),this.frontFace=new bp(this),this.program=new wp(this),this.activeTexture=new Sp(this),this.viewport=new fu(this),this.bindFramebuffer=new Rc(this),this.bindRenderbuffer=new mu(this),this.bindTexture=new _u(this),this.bindVertexBuffer=new Ll(this),this.bindElementBuffer=new yh(this),this.bindVertexArray=new gh(this),this.pixelStoreUnpack=new yu(this),this.pixelStoreUnpackPremultiplyAlpha=new pl(this),this.pixelStoreUnpackFlipY=new xh(this),this.extTextureFilterAnisotropic=ei.getExtension("EXT_texture_filter_anisotropic")||ei.getExtension("MOZ_EXT_texture_filter_anisotropic")||ei.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=ei.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=ei.getParameter(ei.MAX_TEXTURE_SIZE),Qs(ei)){this.HALF_FLOAT=ei.HALF_FLOAT;const si=ei.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(ri=ei.RGBA16F)!==null&&ri!==void 0?ri:si==null?void 0:si.RGBA16F_EXT,this.RGB16F=(ni=ei.RGB16F)!==null&&ni!==void 0?ni:si==null?void 0:si.RGB16F_EXT,ei.getExtension("EXT_color_buffer_float")}else{ei.getExtension("EXT_color_buffer_half_float"),ei.getExtension("OES_texture_half_float_linear");const si=ei.getExtension("OES_texture_half_float");this.HALF_FLOAT=si==null?void 0:si.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(ei,ri){return new Ec(this,ei,ri)}createVertexBuffer(ei,ri,ni){return new Tc(this,ei,ri,ni)}createRenderbuffer(ei,ri,ni){const si=this.gl,hi=si.createRenderbuffer();return this.bindRenderbuffer.set(hi),si.renderbufferStorage(si.RENDERBUFFER,ei,ri,ni),this.bindRenderbuffer.set(null),hi}createFramebuffer(ei,ri,ni,si){return new nn(this,ei,ri,ni,si)}clear({color:ei,depth:ri,stencil:ni}){const si=this.gl;let hi=0;ei&&(hi|=si.COLOR_BUFFER_BIT,this.clearColor.set(ei),this.colorMask.set([!0,!0,!0,!0])),ri!==void 0&&(hi|=si.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(ri),this.depthMask.set(!0)),ni!==void 0&&(hi|=si.STENCIL_BUFFER_BIT,this.clearStencil.set(ni),this.stencilMask.set(255)),si.clear(hi)}setCullFace(ei){ei.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(ei.mode),this.frontFace.set(ei.frontFace))}setDepthMode(ei){ei.func!==this.gl.ALWAYS||ei.mask?(this.depthTest.set(!0),this.depthFunc.set(ei.func),this.depthMask.set(ei.mask),this.depthRange.set(ei.range)):this.depthTest.set(!1)}setStencilMode(ei){ei.test.func!==this.gl.ALWAYS||ei.mask?(this.stencilTest.set(!0),this.stencilMask.set(ei.mask),this.stencilOp.set([ei.fail,ei.depthFail,ei.pass]),this.stencilFunc.set({func:ei.test.func,ref:ei.ref,mask:ei.test.mask})):this.stencilTest.set(!1)}setColorMode(ei){li.aG(ei.blendFunction,Tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(ei.blendFunction),this.blendColor.set(ei.blendColor)),this.colorMask.set(ei.mask)}createVertexArray(){var ei;return Qs(this.gl)?this.gl.createVertexArray():(ei=this.gl.getExtension("OES_vertex_array_object"))===null||ei===void 0?void 0:ei.createVertexArrayOES()}deleteVertexArray(ei){var ri;return Qs(this.gl)?this.gl.deleteVertexArray(ei):(ri=this.gl.getExtension("OES_vertex_array_object"))===null||ri===void 0?void 0:ri.deleteVertexArrayOES(ei)}unbindVAO(){this.bindVertexArray.set(null)}}class Jo{constructor(ei,ri,ni){this.func=ei,this.mask=ri,this.range=ni}}Jo.ReadOnly=!1,Jo.ReadWrite=!0,Jo.disabled=new Jo(519,Jo.ReadOnly,[0,1]);const dl=7680;class In{constructor(ei,ri,ni,si,hi,fi){this.test=ei,this.ref=ri,this.mask=ni,this.fail=si,this.depthFail=hi,this.pass=fi}}In.disabled=new In({func:519,mask:0},0,0,dl,dl,dl);class wn{constructor(ei,ri,ni){this.enable=ei,this.mode=ri,this.frontFace=ni}}let Wl;function bh(ci,ei,ri,ni,si,hi,fi){const _i=ci.context,gi=_i.gl,bi=ci.useProgram("collisionBox"),Ei=[];let Ti=0,zi=0;for(let $i=0;$i<ni.length;$i++){const Ji=ni[$i],eo=ei.getTile(Ji),to=eo.getBucket(ri);if(!to)continue;let no=Ji.posMatrix;si[0]===0&&si[1]===0||(no=ci.translatePosMatrix(Ji.posMatrix,eo,si,hi));const co=fi?to.textCollisionBox:to.iconCollisionBox,lo=to.collisionCircleArray;if(lo.length>0){const ho=li.Z(),Ao=no;li.aU(ho,to.placementInvProjMatrix,ci.transform.glCoordMatrix),li.aU(ho,ho,to.placementViewportMatrix),Ei.push({circleArray:lo,circleOffset:zi,transform:Ao,invTransform:ho,coord:Ji}),Ti+=lo.length/4,zi=Ti}co&&bi.draw(_i,gi.LINES,Jo.disabled,In.disabled,ci.colorModeForRenderPass(),wn.disabled,ou(no,ci.transform,eo),ci.style.map.terrain&&ci.style.map.terrain.getTerrainData(Ji),ri.id,co.layoutVertexBuffer,co.indexBuffer,co.segments,null,ci.transform.zoom,null,null,co.collisionVertexBuffer)}if(!fi||!Ei.length)return;const Ni=ci.useProgram("collisionCircle"),Bi=new li.aV;Bi.resize(4*Ti),Bi._trim();let Vi=0;for(const $i of Ei)for(let Ji=0;Ji<$i.circleArray.length/4;Ji++){const eo=4*Ji,to=$i.circleArray[eo+0],no=$i.circleArray[eo+1],co=$i.circleArray[eo+2],lo=$i.circleArray[eo+3];Bi.emplace(Vi++,to,no,co,lo,0),Bi.emplace(Vi++,to,no,co,lo,1),Bi.emplace(Vi++,to,no,co,lo,2),Bi.emplace(Vi++,to,no,co,lo,3)}(!Wl||Wl.length<2*Ti)&&(Wl=function($i){const Ji=2*$i,eo=new li.aX;eo.resize(Ji),eo._trim();for(let to=0;to<Ji;to++){const no=6*to;eo.uint16[no+0]=4*to+0,eo.uint16[no+1]=4*to+1,eo.uint16[no+2]=4*to+2,eo.uint16[no+3]=4*to+2,eo.uint16[no+4]=4*to+3,eo.uint16[no+5]=4*to+0}return eo}(Ti));const Di=_i.createIndexBuffer(Wl,!0),Wi=_i.createVertexBuffer(Bi,li.aW.members,!0);for(const $i of Ei){const Ji={u_matrix:$i.transform,u_inv_matrix:$i.invTransform,u_camera_to_center_distance:(Kr=ci.transform).cameraToCenterDistance,u_viewport_size:[Kr.width,Kr.height]};Ni.draw(_i,gi.TRIANGLES,Jo.disabled,In.disabled,ci.colorModeForRenderPass(),wn.disabled,Ji,ci.style.map.terrain&&ci.style.map.terrain.getTerrainData($i.coord),ri.id,Wi,Di,li.S.simpleSegment(0,2*$i.circleOffset,$i.circleArray.length,$i.circleArray.length/2),null,ci.transform.zoom,null,null,null)}var Kr;Wi.destroy(),Di.destroy()}wn.disabled=new wn(!1,1029,2305),wn.backCCW=new wn(!0,1029,2305);const xu=li.ao(new Float32Array(16));function Mc(ci,ei,ri,ni,si,hi){const{horizontalAlign:fi,verticalAlign:_i}=li.au(ci);return new li.P((-(fi-.5)*ei/si+ni[0])*hi,(-(_i-.5)*ri/si+ni[1])*hi)}function Lc(ci,ei,ri,ni,si,hi,fi,_i,gi,bi,Ei){const Ti=ci.text.placedSymbolArray,zi=ci.text.dynamicLayoutVertexArray,Ni=ci.icon.dynamicLayoutVertexArray,Bi={};zi.clear();for(let Vi=0;Vi<Ti.length;Vi++){const Di=Ti.get(Vi),Wi=Di.hidden||!Di.crossTileID||ci.allowVerticalPlacement&&!Di.placedOrientation?null:ni[Di.crossTileID];if(Wi){const Kr=new li.P(Di.anchorX,Di.anchorY),$i=Cn(Kr,ri?fi:hi,Ei),Ji=cl(si.cameraToCenterDistance,$i.signedDistanceFromCamera);let eo=li.aj(ci.textSizeData,gi,Di)*Ji/li.ap;ri&&(eo*=ci.tilePixelRatio/_i);const{width:to,height:no,anchor:co,textOffset:lo,textBoxScale:ho}=Wi,Ao=Mc(co,to,no,lo,ho,eo),Ho=ri?Cn(Kr.add(Ao),hi,Ei).point:$i.point.add(ei?Ao.rotate(-si.angle):Ao),xo=ci.allowVerticalPlacement&&Di.placedOrientation===li.ai.vertical?Math.PI/2:0;for(let Bo=0;Bo<Di.numGlyphs;Bo++)li.ak(zi,Ho,xo);bi&&Di.associatedIconIndex>=0&&(Bi[Di.associatedIconIndex]={shiftedAnchor:Ho,angle:xo})}else ki(Di.numGlyphs,zi)}if(bi){Ni.clear();const Vi=ci.icon.placedSymbolArray;for(let Di=0;Di<Vi.length;Di++){const Wi=Vi.get(Di);if(Wi.hidden)ki(Wi.numGlyphs,Ni);else{const Kr=Bi[Di];if(Kr)for(let $i=0;$i<Wi.numGlyphs;$i++)li.ak(Ni,Kr.shiftedAnchor,Kr.angle);else ki(Wi.numGlyphs,Ni)}}ci.icon.dynamicLayoutVertexBuffer.updateData(Ni)}ci.text.dynamicLayoutVertexBuffer.updateData(zi)}function vu(ci,ei,ri){return ri.iconsInText&&ei?"symbolTextAndIcon":ci?"symbolSDF":"symbolIcon"}function Oc(ci,ei,ri,ni,si,hi,fi,_i,gi,bi,Ei,Ti){const zi=ci.context,Ni=zi.gl,Bi=ci.transform,Vi=_i==="map",Di=gi==="map",Wi=_i!=="viewport"&&ri.layout.get("symbol-placement")!=="point",Kr=Vi&&!Di&&!Wi,$i=!ri.layout.get("symbol-sort-key").isConstant();let Ji=!1;const eo=ci.depthModeForSublayer(0,Jo.ReadOnly),to=ri._unevaluatedLayout.hasValue("text-variable-anchor")||ri._unevaluatedLayout.hasValue("text-variable-anchor-offset"),no=[];for(const co of ni){const lo=ei.getTile(co),ho=lo.getBucket(ri);if(!ho)continue;const Ao=si?ho.text:ho.icon;if(!Ao||!Ao.segments.get().length||!Ao.hasVisibleVertices)continue;const Ho=Ao.programConfigurations.get(ri.id),xo=si||ho.sdfIcons,Bo=si?ho.textSizeData:ho.iconSizeData,Co=Di||Bi.pitch!==0,un=ci.useProgram(vu(xo,si,ho),Ho),Zo=li.ah(Bo,Bi.zoom),qo=ci.style.map.terrain&&ci.style.map.terrain.getTerrainData(co);let Yo,kn,yn,pa,Wn=[0,0],jn=null;if(si)kn=lo.glyphAtlasTexture,yn=Ni.LINEAR,Yo=lo.glyphAtlasTexture.size,ho.iconsInText&&(Wn=lo.imageAtlasTexture.size,jn=lo.imageAtlasTexture,pa=Co||ci.options.rotating||ci.options.zooming||Bo.kind==="composite"||Bo.kind==="camera"?Ni.LINEAR:Ni.NEAREST);else{const Dn=ri.layout.get("icon-size").constantOr(0)!==1||ho.iconsNeedLinear;kn=lo.imageAtlasTexture,yn=xo||ci.options.rotating||ci.options.zooming||Dn||Co?Ni.LINEAR:Ni.NEAREST,Yo=lo.imageAtlasTexture.size}const Ja=Xi(lo,1,ci.transform.zoom),xn=_o(co.posMatrix,Di,Vi,ci.transform,Ja),Is=Ss(co.posMatrix,Di,Vi,ci.transform,Ja),As=to&&ho.hasTextData(),rl=ri.layout.get("icon-text-fit")!=="none"&&As&&ho.hasIconData();if(Wi){const Dn=ci.style.map.terrain?(Na,Fn)=>ci.style.map.terrain.getElevation(co,Na,Fn):null,Kn=ri.layout.get("text-rotation-alignment")==="map";go(ho,co.posMatrix,ci,si,xn,Is,Di,bi,Kn,Dn)}const gl=ci.translatePosMatrix(co.posMatrix,lo,hi,fi),Vl=Wi||si&&to||rl?xu:xn,ga=ci.translatePosMatrix(Is,lo,hi,fi,!0),da=xo&&ri.paint.get(si?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ia;Ia=xo?ho.iconsInText?hl(Bo.kind,Zo,Kr,Di,ci,gl,Vl,ga,Yo,Wn):lu(Bo.kind,Zo,Kr,Di,ci,gl,Vl,ga,si,Yo,!0):su(Bo.kind,Zo,Kr,Di,ci,gl,Vl,ga,si,Yo);const xl={program:un,buffers:Ao,uniformValues:Ia,atlasTexture:kn,atlasTextureIcon:jn,atlasInterpolation:yn,atlasInterpolationIcon:pa,isSDF:xo,hasHalo:da};if($i&&ho.canOverlap){Ji=!0;const Dn=Ao.segments.get();for(const Kn of Dn)no.push({segments:new li.S([Kn]),sortKey:Kn.sortKey,state:xl,terrainData:qo})}else no.push({segments:Ao.segments,sortKey:0,state:xl,terrainData:qo})}Ji&&no.sort((co,lo)=>co.sortKey-lo.sortKey);for(const co of no){const lo=co.state;if(zi.activeTexture.set(Ni.TEXTURE0),lo.atlasTexture.bind(lo.atlasInterpolation,Ni.CLAMP_TO_EDGE),lo.atlasTextureIcon&&(zi.activeTexture.set(Ni.TEXTURE1),lo.atlasTextureIcon&&lo.atlasTextureIcon.bind(lo.atlasInterpolationIcon,Ni.CLAMP_TO_EDGE)),lo.isSDF){const ho=lo.uniformValues;lo.hasHalo&&(ho.u_is_halo=1,bu(lo.buffers,co.segments,ri,ci,lo.program,eo,Ei,Ti,ho,co.terrainData)),ho.u_is_halo=0}bu(lo.buffers,co.segments,ri,ci,lo.program,eo,Ei,Ti,lo.uniformValues,co.terrainData)}}function bu(ci,ei,ri,ni,si,hi,fi,_i,gi,bi){const Ei=ni.context;si.draw(Ei,Ei.gl.TRIANGLES,hi,fi,_i,wn.disabled,gi,bi,ri.id,ci.layoutVertexBuffer,ci.indexBuffer,ei,ri.paint,ni.transform.zoom,ci.programConfigurations.get(ri.id),ci.dynamicLayoutVertexBuffer,ci.opacityVertexBuffer)}function Kl(ci,ei,ri,ni,si){if(!ri||!ni||!ni.imageAtlas)return;const hi=ni.imageAtlas.patternPositions;let fi=hi[ri.to.toString()],_i=hi[ri.from.toString()];if(!fi&&_i&&(fi=_i),!_i&&fi&&(_i=fi),!fi||!_i){const gi=si.getPaintProperty(ei);fi=hi[gi],_i=hi[gi]}fi&&_i&&ci.setConstantPatternPositions(fi,_i)}function Jl(ci,ei,ri,ni,si,hi,fi){const _i=ci.context.gl,gi="fill-pattern",bi=ri.paint.get(gi),Ei=bi&&bi.constantOr(1),Ti=ri.getCrossfadeParameters();let zi,Ni,Bi,Vi,Di;fi?(Ni=Ei&&!ri.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",zi=_i.LINES):(Ni=Ei?"fillPattern":"fill",zi=_i.TRIANGLES);const Wi=bi.constantOr(null);for(const Kr of ni){const $i=ei.getTile(Kr);if(Ei&&!$i.patternsLoaded())continue;const Ji=$i.getBucket(ri);if(!Ji)continue;const eo=Ji.programConfigurations.get(ri.id),to=ci.useProgram(Ni,eo),no=ci.style.map.terrain&&ci.style.map.terrain.getTerrainData(Kr);Ei&&(ci.context.activeTexture.set(_i.TEXTURE0),$i.imageAtlasTexture.bind(_i.LINEAR,_i.CLAMP_TO_EDGE),eo.updatePaintBuffers(Ti)),Kl(eo,gi,Wi,$i,ri);const co=no?Kr:null,lo=ci.translatePosMatrix(co?co.posMatrix:Kr.posMatrix,$i,ri.paint.get("fill-translate"),ri.paint.get("fill-translate-anchor"));if(fi){Vi=Ji.indexBuffer2,Di=Ji.segments2;const ho=[_i.drawingBufferWidth,_i.drawingBufferHeight];Bi=Ni==="fillOutlinePattern"&&Ei?vc(lo,ci,Ti,$i,ho):xc(lo,ho)}else Vi=Ji.indexBuffer,Di=Ji.segments,Bi=Ei?ru(lo,ci,Ti,$i):lh(lo);to.draw(ci.context,zi,si,ci.stencilModeForClipping(Kr),hi,wn.disabled,Bi,no,ri.id,Ji.layoutVertexBuffer,Vi,Di,ri.paint,ci.transform.zoom,eo)}}function Ql(ci,ei,ri,ni,si,hi,fi){const _i=ci.context,gi=_i.gl,bi="fill-extrusion-pattern",Ei=ri.paint.get(bi),Ti=Ei.constantOr(1),zi=ri.getCrossfadeParameters(),Ni=ri.paint.get("fill-extrusion-opacity"),Bi=Ei.constantOr(null);for(const Vi of ni){const Di=ei.getTile(Vi),Wi=Di.getBucket(ri);if(!Wi)continue;const Kr=ci.style.map.terrain&&ci.style.map.terrain.getTerrainData(Vi),$i=Wi.programConfigurations.get(ri.id),Ji=ci.useProgram(Ti?"fillExtrusionPattern":"fillExtrusion",$i);Ti&&(ci.context.activeTexture.set(gi.TEXTURE0),Di.imageAtlasTexture.bind(gi.LINEAR,gi.CLAMP_TO_EDGE),$i.updatePaintBuffers(zi)),Kl($i,bi,Bi,Di,ri);const eo=ci.translatePosMatrix(Vi.posMatrix,Di,ri.paint.get("fill-extrusion-translate"),ri.paint.get("fill-extrusion-translate-anchor")),to=ri.paint.get("fill-extrusion-vertical-gradient"),no=Ti?Ks(eo,ci,to,Ni,Vi,zi,Di):iu(eo,ci,to,Ni);Ji.draw(_i,_i.gl.TRIANGLES,si,hi,fi,wn.backCCW,no,Kr,ri.id,Wi.layoutVertexBuffer,Wi.indexBuffer,Wi.segments,ri.paint,ci.transform.zoom,$i,ci.style.map.terrain&&Wi.centroidVertexBuffer)}}function Tp(ci,ei,ri,ni,si,hi,fi){const _i=ci.context,gi=_i.gl,bi=ri.fbo;if(!bi)return;const Ei=ci.useProgram("hillshade"),Ti=ci.style.map.terrain&&ci.style.map.terrain.getTerrainData(ei);_i.activeTexture.set(gi.TEXTURE0),gi.bindTexture(gi.TEXTURE_2D,bi.colorAttachment.get()),Ei.draw(_i,gi.TRIANGLES,si,hi,fi,wn.disabled,((zi,Ni,Bi,Vi)=>{const Di=Bi.paint.get("hillshade-shadow-color"),Wi=Bi.paint.get("hillshade-highlight-color"),Kr=Bi.paint.get("hillshade-accent-color");let $i=Bi.paint.get("hillshade-illumination-direction")*(Math.PI/180);Bi.paint.get("hillshade-illumination-anchor")==="viewport"&&($i-=zi.transform.angle);const Ji=!zi.options.moving;return{u_matrix:Vi?Vi.posMatrix:zi.transform.calculatePosMatrix(Ni.tileID.toUnwrapped(),Ji),u_image:0,u_latrange:nu(0,Ni.tileID),u_light:[Bi.paint.get("hillshade-exaggeration"),$i],u_shadow:Di,u_highlight:Wi,u_accent:Kr}})(ci,ri,ni,Ti?ei:null),Ti,ni.id,ci.rasterBoundsBuffer,ci.quadTriangleIndexBuffer,ci.rasterBoundsSegments)}function wu(ci,ei,ri,ni,si,hi){const fi=ci.context,_i=fi.gl,gi=ei.dem;if(gi&&gi.data){const bi=gi.dim,Ei=gi.stride,Ti=gi.getPixels();if(fi.activeTexture.set(_i.TEXTURE1),fi.pixelStoreUnpackPremultiplyAlpha.set(!1),ei.demTexture=ei.demTexture||ci.getTileTexture(Ei),ei.demTexture){const Ni=ei.demTexture;Ni.update(Ti,{premultiply:!1}),Ni.bind(_i.NEAREST,_i.CLAMP_TO_EDGE)}else ei.demTexture=new Wo(fi,Ti,_i.RGBA,{premultiply:!1}),ei.demTexture.bind(_i.NEAREST,_i.CLAMP_TO_EDGE);fi.activeTexture.set(_i.TEXTURE0);let zi=ei.fbo;if(!zi){const Ni=new Wo(fi,{width:bi,height:bi,data:null},_i.RGBA);Ni.bind(_i.LINEAR,_i.CLAMP_TO_EDGE),zi=ei.fbo=fi.createFramebuffer(bi,bi,!0,!1),zi.colorAttachment.set(Ni.texture)}fi.bindFramebuffer.set(zi.framebuffer),fi.viewport.set([0,0,bi,bi]),ci.useProgram("hillshadePrepare").draw(fi,_i.TRIANGLES,ni,si,hi,wn.disabled,((Ni,Bi)=>{const Vi=Bi.stride,Di=li.Z();return li.aS(Di,0,li.N,-li.N,0,0,1),li.$(Di,Di,[0,-li.N,0]),{u_matrix:Di,u_image:1,u_dimension:[Vi,Vi],u_zoom:Ni.overscaledZ,u_unpack:Bi.getUnpackVector()}})(ei.tileID,gi),null,ri.id,ci.rasterBoundsBuffer,ci.quadTriangleIndexBuffer,ci.rasterBoundsSegments),ei.needsHillshadePrepare=!1}}function Ip(ci,ei,ri,ni,si,hi){const fi=ni.paint.get("raster-fade-duration");if(!hi&&fi>0){const _i=li.h.now(),gi=(_i-ci.timeAdded)/fi,bi=ei?(_i-ei.timeAdded)/fi:-1,Ei=ri.getSource(),Ti=si.coveringZoomLevel({tileSize:Ei.tileSize,roundZoom:Ei.roundZoom}),zi=!ei||Math.abs(ei.tileID.overscaledZ-Ti)>Math.abs(ci.tileID.overscaledZ-Ti),Ni=zi&&ci.refreshedUponExpiration?1:li.ad(zi?gi:1-bi,0,1);return ci.refreshedUponExpiration&&gi>=1&&(ci.refreshedUponExpiration=!1),ei?{opacity:1,mix:1-Ni}:{opacity:Ni,mix:0}}return{opacity:1,mix:0}}const wh=new li.aT(1,0,0,1),kc=new li.aT(0,1,0,1),Su=new li.aT(0,0,1,1),Sh=new li.aT(1,0,1,1),Eh=new li.aT(0,1,1,1);function ec(ci,ei,ri,ni){Fc(ci,0,ei+ri/2,ci.transform.width,ri,ni)}function Dc(ci,ei,ri,ni){Fc(ci,ei-ri/2,0,ri,ci.transform.height,ni)}function Fc(ci,ei,ri,ni,si,hi){const fi=ci.context,_i=fi.gl;_i.enable(_i.SCISSOR_TEST),_i.scissor(ei*ci.pixelRatio,ri*ci.pixelRatio,ni*ci.pixelRatio,si*ci.pixelRatio),fi.clear({color:hi}),_i.disable(_i.SCISSOR_TEST)}function Th(ci,ei,ri){const ni=ci.context,si=ni.gl,hi=ri.posMatrix,fi=ci.useProgram("debug"),_i=Jo.disabled,gi=In.disabled,bi=ci.colorModeForRenderPass(),Ei="$debug",Ti=ci.style.map.terrain&&ci.style.map.terrain.getTerrainData(ri);ni.activeTexture.set(si.TEXTURE0);const zi=ei.getTileByID(ri.key).latestRawTileData,Ni=Math.floor((zi&&zi.byteLength||0)/1024),Bi=ei.getTile(ri).tileSize,Vi=512/Math.min(Bi,512)*(ri.overscaledZ/ci.transform.zoom)*.5;let Di=ri.canonical.toString();ri.overscaledZ!==ri.canonical.z&&(Di+=` => ${ri.overscaledZ}`),function(Wi,Kr){Wi.initDebugOverlayCanvas();const $i=Wi.debugOverlayCanvas,Ji=Wi.context.gl,eo=Wi.debugOverlayCanvas.getContext("2d");eo.clearRect(0,0,$i.width,$i.height),eo.shadowColor="white",eo.shadowBlur=2,eo.lineWidth=1.5,eo.strokeStyle="white",eo.textBaseline="top",eo.font="bold 36px Open Sans, sans-serif",eo.fillText(Kr,5,5),eo.strokeText(Kr,5,5),Wi.debugOverlayTexture.update($i),Wi.debugOverlayTexture.bind(Ji.LINEAR,Ji.CLAMP_TO_EDGE)}(ci,`${Di} ${Ni}kB`),fi.draw(ni,si.TRIANGLES,_i,gi,Tn.alphaBlended,wn.disabled,Yl(hi,li.aT.transparent,Vi),null,Ei,ci.debugBuffer,ci.quadTriangleIndexBuffer,ci.debugSegments),fi.draw(ni,si.LINE_STRIP,_i,gi,bi,wn.disabled,Yl(hi,li.aT.red),Ti,Ei,ci.debugBuffer,ci.tileBorderIndexBuffer,ci.debugSegments)}function Rn(ci,ei,ri){const ni=ci.context,si=ni.gl,hi=ci.colorModeForRenderPass(),fi=new Jo(si.LEQUAL,Jo.ReadWrite,ci.depthRangeFor3D),_i=ci.useProgram("terrain"),gi=ei.getTerrainMesh();ni.bindFramebuffer.set(null),ni.viewport.set([0,0,ci.width,ci.height]);for(const bi of ri){const Ei=ci.renderToTexture.getTexture(bi),Ti=ei.getTerrainData(bi.tileID);ni.activeTexture.set(si.TEXTURE0),si.bindTexture(si.TEXTURE_2D,Ei.texture);const zi={u_matrix:ci.transform.calculatePosMatrix(bi.tileID.toUnwrapped()),u_texture:0,u_ele_delta:ei.getMeshFrameDelta(ci.transform.zoom)};_i.draw(ni,si.TRIANGLES,fi,In.disabled,hi,wn.backCCW,zi,Ti,"terrain",gi.vertexBuffer,gi.indexBuffer,gi.segments)}}class fl{constructor(ei,ri){this.context=new Ep(ei),this.transform=ri,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:li.Z(),renderTime:0},this.setup(),this.numSublayers=Da.maxUnderzooming+Da.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _c}resize(ei,ri,ni){if(this.width=Math.floor(ei*ni),this.height=Math.floor(ri*ni),this.pixelRatio=ni,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const si of this.style._order)this.style._layers[si].resize()}setup(){const ei=this.context,ri=new li.a_;ri.emplaceBack(0,0),ri.emplaceBack(li.N,0),ri.emplaceBack(0,li.N),ri.emplaceBack(li.N,li.N),this.tileExtentBuffer=ei.createVertexBuffer(ri,yc.members),this.tileExtentSegments=li.S.simpleSegment(0,0,4,2);const ni=new li.a_;ni.emplaceBack(0,0),ni.emplaceBack(li.N,0),ni.emplaceBack(0,li.N),ni.emplaceBack(li.N,li.N),this.debugBuffer=ei.createVertexBuffer(ni,yc.members),this.debugSegments=li.S.simpleSegment(0,0,4,5);const si=new li.V;si.emplaceBack(0,0,0,0),si.emplaceBack(li.N,0,li.N,0),si.emplaceBack(0,li.N,0,li.N),si.emplaceBack(li.N,li.N,li.N,li.N),this.rasterBoundsBuffer=ei.createVertexBuffer(si,Nn.members),this.rasterBoundsSegments=li.S.simpleSegment(0,0,4,2);const hi=new li.a_;hi.emplaceBack(0,0),hi.emplaceBack(1,0),hi.emplaceBack(0,1),hi.emplaceBack(1,1),this.viewportBuffer=ei.createVertexBuffer(hi,yc.members),this.viewportSegments=li.S.simpleSegment(0,0,4,2);const fi=new li.a$;fi.emplaceBack(0),fi.emplaceBack(1),fi.emplaceBack(3),fi.emplaceBack(2),fi.emplaceBack(0),this.tileBorderIndexBuffer=ei.createIndexBuffer(fi);const _i=new li.b0;_i.emplaceBack(0,1,2),_i.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=ei.createIndexBuffer(_i);const gi=this.context.gl;this.stencilClearMode=new In({func:gi.ALWAYS,mask:0},0,255,gi.ZERO,gi.ZERO,gi.ZERO)}clearStencil(){const ei=this.context,ri=ei.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const ni=li.Z();li.aS(ni,0,this.width,this.height,0,0,1),li.a0(ni,ni,[ri.drawingBufferWidth,ri.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(ei,ri.TRIANGLES,Jo.disabled,this.stencilClearMode,Tn.disabled,wn.disabled,ch(ni),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(ei,ri){if(this.currentStencilSource===ei.source||!ei.isTileClipped()||!ri||!ri.length)return;this.currentStencilSource=ei.source;const ni=this.context,si=ni.gl;this.nextStencilID+ri.length>256&&this.clearStencil(),ni.setColorMode(Tn.disabled),ni.setDepthMode(Jo.disabled);const hi=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const fi of ri){const _i=this._tileClippingMaskIDs[fi.key]=this.nextStencilID++,gi=this.style.map.terrain&&this.style.map.terrain.getTerrainData(fi);hi.draw(ni,si.TRIANGLES,Jo.disabled,new In({func:si.ALWAYS,mask:0},_i,255,si.KEEP,si.KEEP,si.REPLACE),Tn.disabled,wn.disabled,ch(fi.posMatrix),gi,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const ei=this.nextStencilID++,ri=this.context.gl;return new In({func:ri.NOTEQUAL,mask:255},ei,255,ri.KEEP,ri.KEEP,ri.REPLACE)}stencilModeForClipping(ei){const ri=this.context.gl;return new In({func:ri.EQUAL,mask:255},this._tileClippingMaskIDs[ei.key],0,ri.KEEP,ri.KEEP,ri.REPLACE)}stencilConfigForOverlap(ei){const ri=this.context.gl,ni=ei.sort((fi,_i)=>_i.overscaledZ-fi.overscaledZ),si=ni[ni.length-1].overscaledZ,hi=ni[0].overscaledZ-si+1;if(hi>1){this.currentStencilSource=void 0,this.nextStencilID+hi>256&&this.clearStencil();const fi={};for(let _i=0;_i<hi;_i++)fi[_i+si]=new In({func:ri.GEQUAL,mask:255},_i+this.nextStencilID,255,ri.KEEP,ri.KEEP,ri.REPLACE);return this.nextStencilID+=hi,[fi,ni]}return[{[si]:In.disabled},ni]}colorModeForRenderPass(){const ei=this.context.gl;return this._showOverdrawInspector?new Tn([ei.CONSTANT_COLOR,ei.ONE],new li.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tn.unblended:Tn.alphaBlended}depthModeForSublayer(ei,ri,ni){if(!this.opaquePassEnabledForLayer())return Jo.disabled;const si=1-((1+this.currentLayer)*this.numSublayers+ei)*this.depthEpsilon;return new Jo(ni||this.context.gl.LEQUAL,ri,[si,si])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(ei,ri){this.style=ei,this.options=ri,this.lineAtlas=ei.lineAtlas,this.imageManager=ei.imageManager,this.glyphManager=ei.glyphManager,this.symbolFadeChange=ei.placement.symbolFadeChange(li.h.now()),this.imageManager.beginFrame();const ni=this.style._order,si=this.style.sourceCaches,hi={},fi={},_i={};for(const gi in si){const bi=si[gi];bi.used&&bi.prepare(this.context),hi[gi]=bi.getVisibleCoordinates(),fi[gi]=hi[gi].slice().reverse(),_i[gi]=bi.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let gi=0;gi<ni.length;gi++)if(this.style._layers[ni[gi]].is3D()){this.opaquePassCutoff=gi;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const gi=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!li.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||gi.length)&&(li.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(bi,Ei){const Ti=bi.context,zi=Ti.gl,Ni=Tn.unblended,Bi=new Jo(zi.LEQUAL,Jo.ReadWrite,[0,1]),Vi=Ei.getTerrainMesh(),Di=Ei.sourceCache.getRenderableTiles(),Wi=bi.useProgram("terrainDepth");Ti.bindFramebuffer.set(Ei.getFramebuffer("depth").framebuffer),Ti.viewport.set([0,0,bi.width/devicePixelRatio,bi.height/devicePixelRatio]),Ti.clear({color:li.aT.transparent,depth:1});for(const Kr of Di){const $i=Ei.getTerrainData(Kr.tileID),Ji={u_matrix:bi.transform.calculatePosMatrix(Kr.tileID.toUnwrapped()),u_ele_delta:Ei.getMeshFrameDelta(bi.transform.zoom)};Wi.draw(Ti,zi.TRIANGLES,Bi,In.disabled,Ni,wn.backCCW,Ji,$i,"terrain",Vi.vertexBuffer,Vi.indexBuffer,Vi.segments)}Ti.bindFramebuffer.set(null),Ti.viewport.set([0,0,bi.width,bi.height])}(this,this.style.map.terrain),function(bi,Ei){const Ti=bi.context,zi=Ti.gl,Ni=Tn.unblended,Bi=new Jo(zi.LEQUAL,Jo.ReadWrite,[0,1]),Vi=Ei.getTerrainMesh(),Di=Ei.getCoordsTexture(),Wi=Ei.sourceCache.getRenderableTiles(),Kr=bi.useProgram("terrainCoords");Ti.bindFramebuffer.set(Ei.getFramebuffer("coords").framebuffer),Ti.viewport.set([0,0,bi.width/devicePixelRatio,bi.height/devicePixelRatio]),Ti.clear({color:li.aT.transparent,depth:1}),Ei.coordsIndex=[];for(const $i of Wi){const Ji=Ei.getTerrainData($i.tileID);Ti.activeTexture.set(zi.TEXTURE0),zi.bindTexture(zi.TEXTURE_2D,Di.texture);const eo={u_matrix:bi.transform.calculatePosMatrix($i.tileID.toUnwrapped()),u_terrain_coords_id:(255-Ei.coordsIndex.length)/255,u_texture:0,u_ele_delta:Ei.getMeshFrameDelta(bi.transform.zoom)};Kr.draw(Ti,zi.TRIANGLES,Bi,In.disabled,Ni,wn.backCCW,eo,Ji,"terrain",Vi.vertexBuffer,Vi.indexBuffer,Vi.segments),Ei.coordsIndex.push($i.tileID.key)}Ti.bindFramebuffer.set(null),Ti.viewport.set([0,0,bi.width,bi.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const gi of ni){const bi=this.style._layers[gi];if(!bi.hasOffscreenPass()||bi.isHidden(this.transform.zoom))continue;const Ei=fi[bi.source];(bi.type==="custom"||Ei.length)&&this.renderLayer(this,si[bi.source],bi,Ei)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:ri.showOverdrawInspector?li.aT.black:li.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=ri.showOverdrawInspector,this.depthRangeFor3D=[0,1-(ei._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=ni.length-1;this.currentLayer>=0;this.currentLayer--){const gi=this.style._layers[ni[this.currentLayer]],bi=si[gi.source],Ei=hi[gi.source];this._renderTileClippingMasks(gi,Ei),this.renderLayer(this,bi,gi,Ei)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<ni.length;this.currentLayer++){const gi=this.style._layers[ni[this.currentLayer]],bi=si[gi.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(gi))continue;const Ei=(gi.type==="symbol"?_i:fi)[gi.source];this._renderTileClippingMasks(gi,hi[gi.source]),this.renderLayer(this,bi,gi,Ei)}if(this.options.showTileBoundaries){const gi=function(bi,Ei){let Ti=null;const zi=Object.values(bi._layers).flatMap(Di=>Di.source&&!Di.isHidden(Ei)?[bi.sourceCaches[Di.source]]:[]),Ni=zi.filter(Di=>Di.getSource().type==="vector"),Bi=zi.filter(Di=>Di.getSource().type!=="vector"),Vi=Di=>{(!Ti||Ti.getSource().maxzoom<Di.getSource().maxzoom)&&(Ti=Di)};return Ni.forEach(Di=>Vi(Di)),Ti||Bi.forEach(Di=>Vi(Di)),Ti}(this.style,this.transform.zoom);gi&&function(bi,Ei,Ti){for(let zi=0;zi<Ti.length;zi++)Th(bi,Ei,Ti[zi])}(this,gi,gi.getVisibleCoordinates())}this.options.showPadding&&function(gi){const bi=gi.transform.padding;ec(gi,gi.transform.height-(bi.top||0),3,wh),ec(gi,bi.bottom||0,3,kc),Dc(gi,bi.left||0,3,Su),Dc(gi,gi.transform.width-(bi.right||0),3,Sh);const Ei=gi.transform.centerPoint;(function(Ti,zi,Ni,Bi){Fc(Ti,zi-1,Ni-10,2,20,Bi),Fc(Ti,zi-10,Ni-1,20,2,Bi)})(gi,Ei.x,gi.transform.height-Ei.y,Eh)}(this),this.context.setDefault()}renderLayer(ei,ri,ni,si){if(!ni.isHidden(this.transform.zoom)&&(ni.type==="background"||ni.type==="custom"||(si||[]).length))switch(this.id=ni.id,ni.type){case"symbol":(function(hi,fi,_i,gi,bi){if(hi.renderPass!=="translucent")return;const Ei=In.disabled,Ti=hi.colorModeForRenderPass();(_i._unevaluatedLayout.hasValue("text-variable-anchor")||_i._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(zi,Ni,Bi,Vi,Di,Wi,Kr){const $i=Ni.transform,Ji=Di==="map",eo=Wi==="map";for(const to of zi){const no=Vi.getTile(to),co=no.getBucket(Bi);if(!co||!co.text||!co.text.segments.get().length)continue;const lo=li.ah(co.textSizeData,$i.zoom),ho=Xi(no,1,Ni.transform.zoom),Ao=_o(to.posMatrix,eo,Ji,Ni.transform,ho),Ho=Bi.layout.get("icon-text-fit")!=="none"&&co.hasIconData();if(lo){const xo=Math.pow(2,$i.zoom-no.tileID.overscaledZ);Lc(co,Ji,eo,Kr,$i,Ao,to.posMatrix,xo,lo,Ho,Ni.style.map.terrain?(Bo,Co)=>Ni.style.map.terrain.getElevation(to,Bo,Co):null)}}}(gi,hi,_i,fi,_i.layout.get("text-rotation-alignment"),_i.layout.get("text-pitch-alignment"),bi),_i.paint.get("icon-opacity").constantOr(1)!==0&&Oc(hi,fi,_i,gi,!1,_i.paint.get("icon-translate"),_i.paint.get("icon-translate-anchor"),_i.layout.get("icon-rotation-alignment"),_i.layout.get("icon-pitch-alignment"),_i.layout.get("icon-keep-upright"),Ei,Ti),_i.paint.get("text-opacity").constantOr(1)!==0&&Oc(hi,fi,_i,gi,!0,_i.paint.get("text-translate"),_i.paint.get("text-translate-anchor"),_i.layout.get("text-rotation-alignment"),_i.layout.get("text-pitch-alignment"),_i.layout.get("text-keep-upright"),Ei,Ti),fi.map.showCollisionBoxes&&(bh(hi,fi,_i,gi,_i.paint.get("text-translate"),_i.paint.get("text-translate-anchor"),!0),bh(hi,fi,_i,gi,_i.paint.get("icon-translate"),_i.paint.get("icon-translate-anchor"),!1))})(ei,ri,ni,si,this.style.placement.variableOffsets);break;case"circle":(function(hi,fi,_i,gi){if(hi.renderPass!=="translucent")return;const bi=_i.paint.get("circle-opacity"),Ei=_i.paint.get("circle-stroke-width"),Ti=_i.paint.get("circle-stroke-opacity"),zi=!_i.layout.get("circle-sort-key").isConstant();if(bi.constantOr(1)===0&&(Ei.constantOr(1)===0||Ti.constantOr(1)===0))return;const Ni=hi.context,Bi=Ni.gl,Vi=hi.depthModeForSublayer(0,Jo.ReadOnly),Di=In.disabled,Wi=hi.colorModeForRenderPass(),Kr=[];for(let $i=0;$i<gi.length;$i++){const Ji=gi[$i],eo=fi.getTile(Ji),to=eo.getBucket(_i);if(!to)continue;const no=to.programConfigurations.get(_i.id),co=hi.useProgram("circle",no),lo=to.layoutVertexBuffer,ho=to.indexBuffer,Ao=hi.style.map.terrain&&hi.style.map.terrain.getTerrainData(Ji),Ho={programConfiguration:no,program:co,layoutVertexBuffer:lo,indexBuffer:ho,uniformValues:Js(hi,Ji,eo,_i),terrainData:Ao};if(zi){const xo=to.segments.get();for(const Bo of xo)Kr.push({segments:new li.S([Bo]),sortKey:Bo.sortKey,state:Ho})}else Kr.push({segments:to.segments,sortKey:0,state:Ho})}zi&&Kr.sort(($i,Ji)=>$i.sortKey-Ji.sortKey);for(const $i of Kr){const{programConfiguration:Ji,program:eo,layoutVertexBuffer:to,indexBuffer:no,uniformValues:co,terrainData:lo}=$i.state;eo.draw(Ni,Bi.TRIANGLES,Vi,Di,Wi,wn.disabled,co,lo,_i.id,to,no,$i.segments,_i.paint,hi.transform.zoom,Ji)}})(ei,ri,ni,si);break;case"heatmap":(function(hi,fi,_i,gi){if(_i.paint.get("heatmap-opacity")!==0)if(hi.renderPass==="offscreen"){const bi=hi.context,Ei=bi.gl,Ti=In.disabled,zi=new Tn([Ei.ONE,Ei.ONE],li.aT.transparent,[!0,!0,!0,!0]);(function(Ni,Bi,Vi){const Di=Ni.gl;Ni.activeTexture.set(Di.TEXTURE1),Ni.viewport.set([0,0,Bi.width/4,Bi.height/4]);let Wi=Vi.heatmapFbo;if(Wi)Di.bindTexture(Di.TEXTURE_2D,Wi.colorAttachment.get()),Ni.bindFramebuffer.set(Wi.framebuffer);else{const Kr=Di.createTexture();Di.bindTexture(Di.TEXTURE_2D,Kr),Di.texParameteri(Di.TEXTURE_2D,Di.TEXTURE_WRAP_S,Di.CLAMP_TO_EDGE),Di.texParameteri(Di.TEXTURE_2D,Di.TEXTURE_WRAP_T,Di.CLAMP_TO_EDGE),Di.texParameteri(Di.TEXTURE_2D,Di.TEXTURE_MIN_FILTER,Di.LINEAR),Di.texParameteri(Di.TEXTURE_2D,Di.TEXTURE_MAG_FILTER,Di.LINEAR),Wi=Vi.heatmapFbo=Ni.createFramebuffer(Bi.width/4,Bi.height/4,!1,!1),function($i,Ji,eo,to){var no,co;const lo=$i.gl,ho=(no=$i.HALF_FLOAT)!==null&&no!==void 0?no:lo.UNSIGNED_BYTE,Ao=(co=$i.RGBA16F)!==null&&co!==void 0?co:lo.RGBA;lo.texImage2D(lo.TEXTURE_2D,0,Ao,Ji.width/4,Ji.height/4,0,lo.RGBA,ho,null),to.colorAttachment.set(eo)}(Ni,Bi,Kr,Wi)}})(bi,hi,_i),bi.clear({color:li.aT.transparent});for(let Ni=0;Ni<gi.length;Ni++){const Bi=gi[Ni];if(fi.hasRenderableParent(Bi))continue;const Vi=fi.getTile(Bi),Di=Vi.getBucket(_i);if(!Di)continue;const Wi=Di.programConfigurations.get(_i.id),Kr=hi.useProgram("heatmap",Wi),{zoom:$i}=hi.transform;Kr.draw(bi,Ei.TRIANGLES,Jo.disabled,Ti,zi,wn.disabled,_p(Bi.posMatrix,Vi,$i,_i.paint.get("heatmap-intensity")),null,_i.id,Di.layoutVertexBuffer,Di.indexBuffer,Di.segments,_i.paint,hi.transform.zoom,Wi)}bi.viewport.set([0,0,hi.width,hi.height])}else hi.renderPass==="translucent"&&(hi.context.setColorMode(hi.colorModeForRenderPass()),function(bi,Ei){const Ti=bi.context,zi=Ti.gl,Ni=Ei.heatmapFbo;if(!Ni)return;Ti.activeTexture.set(zi.TEXTURE0),zi.bindTexture(zi.TEXTURE_2D,Ni.colorAttachment.get()),Ti.activeTexture.set(zi.TEXTURE1);let Bi=Ei.colorRampTexture;Bi||(Bi=Ei.colorRampTexture=new Wo(Ti,Ei.colorRamp,zi.RGBA)),Bi.bind(zi.LINEAR,zi.CLAMP_TO_EDGE),bi.useProgram("heatmapTexture").draw(Ti,zi.TRIANGLES,Jo.disabled,In.disabled,bi.colorModeForRenderPass(),wn.disabled,((Vi,Di,Wi,Kr)=>{const $i=li.Z();li.aS($i,0,Vi.width,Vi.height,0,0,1);const Ji=Vi.context.gl;return{u_matrix:$i,u_world:[Ji.drawingBufferWidth,Ji.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Di.paint.get("heatmap-opacity")}})(bi,Ei),null,Ei.id,bi.viewportBuffer,bi.quadTriangleIndexBuffer,bi.viewportSegments,Ei.paint,bi.transform.zoom)}(hi,_i))})(ei,ri,ni,si);break;case"line":(function(hi,fi,_i,gi){if(hi.renderPass!=="translucent")return;const bi=_i.paint.get("line-opacity"),Ei=_i.paint.get("line-width");if(bi.constantOr(1)===0||Ei.constantOr(1)===0)return;const Ti=hi.depthModeForSublayer(0,Jo.ReadOnly),zi=hi.colorModeForRenderPass(),Ni=_i.paint.get("line-dasharray"),Bi=_i.paint.get("line-pattern"),Vi=Bi.constantOr(1),Di=_i.paint.get("line-gradient"),Wi=_i.getCrossfadeParameters(),Kr=Vi?"linePattern":Ni?"lineSDF":Di?"lineGradient":"line",$i=hi.context,Ji=$i.gl;let eo=!0;for(const to of gi){const no=fi.getTile(to);if(Vi&&!no.patternsLoaded())continue;const co=no.getBucket(_i);if(!co)continue;const lo=co.programConfigurations.get(_i.id),ho=hi.context.program.get(),Ao=hi.useProgram(Kr,lo),Ho=eo||Ao.program!==ho,xo=hi.style.map.terrain&&hi.style.map.terrain.getTerrainData(to),Bo=Bi.constantOr(null);if(Bo&&no.imageAtlas){const Zo=no.imageAtlas,qo=Zo.patternPositions[Bo.to.toString()],Yo=Zo.patternPositions[Bo.from.toString()];qo&&Yo&&lo.setConstantPatternPositions(qo,Yo)}const Co=xo?to:null,un=Vi?yp(hi,no,_i,Wi,Co):Ni?hh(hi,no,_i,Ni,Wi,Co):Di?uh(hi,no,_i,co.lineClipsArray.length,Co):au(hi,no,_i,Co);if(Vi)$i.activeTexture.set(Ji.TEXTURE0),no.imageAtlasTexture.bind(Ji.LINEAR,Ji.CLAMP_TO_EDGE),lo.updatePaintBuffers(Wi);else if(Ni&&(Ho||hi.lineAtlas.dirty))$i.activeTexture.set(Ji.TEXTURE0),hi.lineAtlas.bind($i);else if(Di){const Zo=co.gradients[_i.id];let qo=Zo.texture;if(_i.gradientVersion!==Zo.version){let Yo=256;if(_i.stepInterpolant){const kn=fi.getSource().maxzoom,yn=to.canonical.z===kn?Math.ceil(1<<hi.transform.maxZoom-to.canonical.z):1;Yo=li.ad(li.aY(co.maxLineLength/li.N*1024*yn),256,$i.maxTextureSize)}Zo.gradient=li.aZ({expression:_i.gradientExpression(),evaluationKey:"lineProgress",resolution:Yo,image:Zo.gradient||void 0,clips:co.lineClipsArray}),Zo.texture?Zo.texture.update(Zo.gradient):Zo.texture=new Wo($i,Zo.gradient,Ji.RGBA),Zo.version=_i.gradientVersion,qo=Zo.texture}$i.activeTexture.set(Ji.TEXTURE0),qo.bind(_i.stepInterpolant?Ji.NEAREST:Ji.LINEAR,Ji.CLAMP_TO_EDGE)}Ao.draw($i,Ji.TRIANGLES,Ti,hi.stencilModeForClipping(to),zi,wn.disabled,un,xo,_i.id,co.layoutVertexBuffer,co.indexBuffer,co.segments,_i.paint,hi.transform.zoom,lo,co.layoutVertexBuffer2),eo=!1}})(ei,ri,ni,si);break;case"fill":(function(hi,fi,_i,gi){const bi=_i.paint.get("fill-color"),Ei=_i.paint.get("fill-opacity");if(Ei.constantOr(1)===0)return;const Ti=hi.colorModeForRenderPass(),zi=_i.paint.get("fill-pattern"),Ni=hi.opaquePassEnabledForLayer()&&!zi.constantOr(1)&&bi.constantOr(li.aT.transparent).a===1&&Ei.constantOr(0)===1?"opaque":"translucent";if(hi.renderPass===Ni){const Bi=hi.depthModeForSublayer(1,hi.renderPass==="opaque"?Jo.ReadWrite:Jo.ReadOnly);Jl(hi,fi,_i,gi,Bi,Ti,!1)}if(hi.renderPass==="translucent"&&_i.paint.get("fill-antialias")){const Bi=hi.depthModeForSublayer(_i.getPaintProperty("fill-outline-color")?2:0,Jo.ReadOnly);Jl(hi,fi,_i,gi,Bi,Ti,!0)}})(ei,ri,ni,si);break;case"fill-extrusion":(function(hi,fi,_i,gi){const bi=_i.paint.get("fill-extrusion-opacity");if(bi!==0&&hi.renderPass==="translucent"){const Ei=new Jo(hi.context.gl.LEQUAL,Jo.ReadWrite,hi.depthRangeFor3D);if(bi!==1||_i.paint.get("fill-extrusion-pattern").constantOr(1))Ql(hi,fi,_i,gi,Ei,In.disabled,Tn.disabled),Ql(hi,fi,_i,gi,Ei,hi.stencilModeFor3D(),hi.colorModeForRenderPass());else{const Ti=hi.colorModeForRenderPass();Ql(hi,fi,_i,gi,Ei,In.disabled,Ti)}}})(ei,ri,ni,si);break;case"hillshade":(function(hi,fi,_i,gi){if(hi.renderPass!=="offscreen"&&hi.renderPass!=="translucent")return;const bi=hi.context,Ei=hi.depthModeForSublayer(0,Jo.ReadOnly),Ti=hi.colorModeForRenderPass(),[zi,Ni]=hi.renderPass==="translucent"?hi.stencilConfigForOverlap(gi):[{},gi];for(const Bi of Ni){const Vi=fi.getTile(Bi);Vi.needsHillshadePrepare!==void 0&&Vi.needsHillshadePrepare&&hi.renderPass==="offscreen"?wu(hi,Vi,_i,Ei,In.disabled,Ti):hi.renderPass==="translucent"&&Tp(hi,Bi,Vi,_i,Ei,zi[Bi.overscaledZ],Ti)}bi.viewport.set([0,0,hi.width,hi.height])})(ei,ri,ni,si);break;case"raster":(function(hi,fi,_i,gi){if(hi.renderPass!=="translucent"||_i.paint.get("raster-opacity")===0||!gi.length)return;const bi=hi.context,Ei=bi.gl,Ti=fi.getSource(),zi=hi.useProgram("raster"),Ni=hi.colorModeForRenderPass(),[Bi,Vi]=Ti instanceof La?[{},gi]:hi.stencilConfigForOverlap(gi),Di=Vi[Vi.length-1].overscaledZ,Wi=!hi.options.moving;for(const Kr of Vi){const $i=hi.depthModeForSublayer(Kr.overscaledZ-Di,_i.paint.get("raster-opacity")===1?Jo.ReadWrite:Jo.ReadOnly,Ei.LESS),Ji=fi.getTile(Kr);Ji.registerFadeDuration(_i.paint.get("raster-fade-duration"));const eo=fi.findLoadedParent(Kr,0),to=Ip(Ji,eo,fi,_i,hi.transform,hi.style.map.terrain);let no,co;const lo=_i.paint.get("raster-resampling")==="nearest"?Ei.NEAREST:Ei.LINEAR;bi.activeTexture.set(Ei.TEXTURE0),Ji.texture.bind(lo,Ei.CLAMP_TO_EDGE,Ei.LINEAR_MIPMAP_NEAREST),bi.activeTexture.set(Ei.TEXTURE1),eo?(eo.texture.bind(lo,Ei.CLAMP_TO_EDGE,Ei.LINEAR_MIPMAP_NEAREST),no=Math.pow(2,eo.tileID.overscaledZ-Ji.tileID.overscaledZ),co=[Ji.tileID.canonical.x*no%1,Ji.tileID.canonical.y*no%1]):Ji.texture.bind(lo,Ei.CLAMP_TO_EDGE,Ei.LINEAR_MIPMAP_NEAREST);const ho=hi.style.map.terrain&&hi.style.map.terrain.getTerrainData(Kr),Ao=ho?Kr:null,Ho=Ao?Ao.posMatrix:hi.transform.calculatePosMatrix(Kr.toUnwrapped(),Wi),xo=dh(Ho,co||[0,0],no||1,to,_i);Ti instanceof La?zi.draw(bi,Ei.TRIANGLES,$i,In.disabled,Ni,wn.disabled,xo,ho,_i.id,Ti.boundsBuffer,hi.quadTriangleIndexBuffer,Ti.boundsSegments):zi.draw(bi,Ei.TRIANGLES,$i,Bi[Kr.overscaledZ],Ni,wn.disabled,xo,ho,_i.id,hi.rasterBoundsBuffer,hi.quadTriangleIndexBuffer,hi.rasterBoundsSegments)}})(ei,ri,ni,si);break;case"background":(function(hi,fi,_i,gi){const bi=_i.paint.get("background-color"),Ei=_i.paint.get("background-opacity");if(Ei===0)return;const Ti=hi.context,zi=Ti.gl,Ni=hi.transform,Bi=Ni.tileSize,Vi=_i.paint.get("background-pattern");if(hi.isPatternMissing(Vi))return;const Di=!Vi&&bi.a===1&&Ei===1&&hi.opaquePassEnabledForLayer()?"opaque":"translucent";if(hi.renderPass!==Di)return;const Wi=In.disabled,Kr=hi.depthModeForSublayer(0,Di==="opaque"?Jo.ReadWrite:Jo.ReadOnly),$i=hi.colorModeForRenderPass(),Ji=hi.useProgram(Vi?"backgroundPattern":"background"),eo=gi||Ni.coveringTiles({tileSize:Bi,terrain:hi.style.map.terrain});Vi&&(Ti.activeTexture.set(zi.TEXTURE0),hi.imageManager.bind(hi.context));const to=_i.getCrossfadeParameters();for(const no of eo){const co=gi?no.posMatrix:hi.transform.calculatePosMatrix(no.toUnwrapped()),lo=Vi?cs(co,Ei,hi,Vi,{tileID:no,tileSize:Bi},to):wc(co,Ei,bi),ho=hi.style.map.terrain&&hi.style.map.terrain.getTerrainData(no);Ji.draw(Ti,zi.TRIANGLES,Kr,Wi,$i,wn.disabled,lo,ho,_i.id,hi.tileExtentBuffer,hi.quadTriangleIndexBuffer,hi.tileExtentSegments)}})(ei,0,ni,si);break;case"custom":(function(hi,fi,_i){const gi=hi.context,bi=_i.implementation;if(hi.renderPass==="offscreen"){const Ei=bi.prerender;Ei&&(hi.setCustomLayerDefaults(),gi.setColorMode(hi.colorModeForRenderPass()),Ei.call(bi,gi.gl,hi.transform.customLayerMatrix()),gi.setDirty(),hi.setBaseState())}else if(hi.renderPass==="translucent"){hi.setCustomLayerDefaults(),gi.setColorMode(hi.colorModeForRenderPass()),gi.setStencilMode(In.disabled);const Ei=bi.renderingMode==="3d"?new Jo(hi.context.gl.LEQUAL,Jo.ReadWrite,hi.depthRangeFor3D):hi.depthModeForSublayer(0,Jo.ReadOnly);gi.setDepthMode(Ei),bi.render(gi.gl,hi.transform.customLayerMatrix()),gi.setDirty(),hi.setBaseState(),gi.bindFramebuffer.set(null)}})(ei,0,ni)}}translatePosMatrix(ei,ri,ni,si,hi){if(!ni[0]&&!ni[1])return ei;const fi=hi?si==="map"?this.transform.angle:0:si==="viewport"?-this.transform.angle:0;if(fi){const bi=Math.sin(fi),Ei=Math.cos(fi);ni=[ni[0]*Ei-ni[1]*bi,ni[0]*bi+ni[1]*Ei]}const _i=[hi?ni[0]:Xi(ri,ni[0],this.transform.zoom),hi?ni[1]:Xi(ri,ni[1],this.transform.zoom),0],gi=new Float32Array(16);return li.$(gi,ei,_i),gi}saveTileTexture(ei){const ri=this._tileTextures[ei.size[0]];ri?ri.push(ei):this._tileTextures[ei.size[0]]=[ei]}getTileTexture(ei){const ri=this._tileTextures[ei];return ri&&ri.length>0?ri.pop():null}isPatternMissing(ei){if(!ei)return!1;if(!ei.from||!ei.to)return!0;const ri=this.imageManager.getPattern(ei.from.toString()),ni=this.imageManager.getPattern(ei.to.toString());return!ri||!ni}useProgram(ei,ri){this.cache=this.cache||{};const ni=ei+(ri?ri.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[ni]||(this.cache[ni]=new gc(this.context,En[ei],ri,Sc[ei],this._showOverdrawInspector,this.style.map.terrain)),this.cache[ni]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const ei=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(ei.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Wo(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:ei,drawingBufferHeight:ri}=this.context.gl;return this.width!==ei||this.height!==ri}}class Fa{constructor(ei,ri){this.points=ei,this.planes=ri}static fromInvProjectionMatrix(ei,ri,ni){const si=Math.pow(2,ni),hi=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_i=>{const gi=1/(_i=li.ag([],_i,ei))[3]/ri*si;return li.b3(_i,_i,[gi,gi,1/_i[3],gi])}),fi=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_i=>{const gi=function(zi,Ni){var Bi=Ni[0],Vi=Ni[1],Di=Ni[2],Wi=Bi*Bi+Vi*Vi+Di*Di;return Wi>0&&(Wi=1/Math.sqrt(Wi)),zi[0]=Ni[0]*Wi,zi[1]=Ni[1]*Wi,zi[2]=Ni[2]*Wi,zi}([],function(zi,Ni,Bi){var Vi=Ni[0],Di=Ni[1],Wi=Ni[2],Kr=Bi[0],$i=Bi[1],Ji=Bi[2];return zi[0]=Di*Ji-Wi*$i,zi[1]=Wi*Kr-Vi*Ji,zi[2]=Vi*$i-Di*Kr,zi}([],Za([],hi[_i[0]],hi[_i[1]]),Za([],hi[_i[2]],hi[_i[1]]))),bi=-((Ei=gi)[0]*(Ti=hi[_i[1]])[0]+Ei[1]*Ti[1]+Ei[2]*Ti[2]);var Ei,Ti;return gi.concat(bi)});return new Fa(hi,fi)}}class kl{constructor(ei,ri){this.min=ei,this.max=ri,this.center=function(ni,si,hi){return ni[0]=.5*si[0],ni[1]=.5*si[1],ni[2]=.5*si[2],ni}([],function(ni,si,hi){return ni[0]=si[0]+hi[0],ni[1]=si[1]+hi[1],ni[2]=si[2]+hi[2],ni}([],this.min,this.max))}quadrant(ei){const ri=[ei%2==0,ei<2],ni=ma(this.min),si=ma(this.max);for(let hi=0;hi<ri.length;hi++)ni[hi]=ri[hi]?this.min[hi]:this.center[hi],si[hi]=ri[hi]?this.center[hi]:this.max[hi];return si[2]=this.max[2],new kl(ni,si)}distanceX(ei){return Math.max(Math.min(this.max[0],ei[0]),this.min[0])-ei[0]}distanceY(ei){return Math.max(Math.min(this.max[1],ei[1]),this.min[1])-ei[1]}intersects(ei){const ri=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let ni=!0;for(let si=0;si<ei.planes.length;si++){const hi=ei.planes[si];let fi=0;for(let _i=0;_i<ri.length;_i++)li.b4(hi,ri[_i])>=0&&fi++;if(fi===0)return 0;fi!==ri.length&&(ni=!1)}if(ni)return 2;for(let si=0;si<3;si++){let hi=Number.MAX_VALUE,fi=-Number.MAX_VALUE;for(let _i=0;_i<ei.points.length;_i++){const gi=ei.points[_i][si]-this.min[si];hi=Math.min(hi,gi),fi=Math.max(fi,gi)}if(fi<0||hi>this.max[si]-this.min[si])return 0}return 1}}class tc{constructor(ei=0,ri=0,ni=0,si=0){if(isNaN(ei)||ei<0||isNaN(ri)||ri<0||isNaN(ni)||ni<0||isNaN(si)||si<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=ei,this.bottom=ri,this.left=ni,this.right=si}interpolate(ei,ri,ni){return ri.top!=null&&ei.top!=null&&(this.top=li.B.number(ei.top,ri.top,ni)),ri.bottom!=null&&ei.bottom!=null&&(this.bottom=li.B.number(ei.bottom,ri.bottom,ni)),ri.left!=null&&ei.left!=null&&(this.left=li.B.number(ei.left,ri.left,ni)),ri.right!=null&&ei.right!=null&&(this.right=li.B.number(ei.right,ri.right,ni)),this}getCenter(ei,ri){const ni=li.ad((this.left+ei-this.right)/2,0,ei),si=li.ad((this.top+ri-this.bottom)/2,0,ri);return new li.P(ni,si)}equals(ei){return this.top===ei.top&&this.bottom===ei.bottom&&this.left===ei.left&&this.right===ei.right}clone(){return new tc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Bc{constructor(ei,ri,ni,si,hi){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=hi===void 0||!!hi,this._minZoom=ei||0,this._maxZoom=ri||22,this._minPitch=ni??0,this._maxPitch=si??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new li.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new tc,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const ei=new Bc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return ei.apply(this),ei}apply(ei){this.tileSize=ei.tileSize,this.latRange=ei.latRange,this.width=ei.width,this.height=ei.height,this._center=ei._center,this._elevation=ei._elevation,this._minEleveationForCurrentTile=ei._minEleveationForCurrentTile,this.zoom=ei.zoom,this.angle=ei.angle,this._fov=ei._fov,this._pitch=ei._pitch,this._unmodified=ei._unmodified,this._edgeInsets=ei._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(ei){this._minZoom!==ei&&(this._minZoom=ei,this.zoom=Math.max(this.zoom,ei))}get maxZoom(){return this._maxZoom}set maxZoom(ei){this._maxZoom!==ei&&(this._maxZoom=ei,this.zoom=Math.min(this.zoom,ei))}get minPitch(){return this._minPitch}set minPitch(ei){this._minPitch!==ei&&(this._minPitch=ei,this.pitch=Math.max(this.pitch,ei))}get maxPitch(){return this._maxPitch}set maxPitch(ei){this._maxPitch!==ei&&(this._maxPitch=ei,this.pitch=Math.min(this.pitch,ei))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(ei){ei===void 0?ei=!0:ei===null&&(ei=!1),this._renderWorldCopies=ei}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new li.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(ei){const ri=-li.b5(ei,-180,180)*Math.PI/180;this.angle!==ri&&(this._unmodified=!1,this.angle=ri,this._calcMatrices(),this.rotationMatrix=function(){var ni=new li.A(4);return li.A!=Float32Array&&(ni[1]=0,ni[2]=0),ni[0]=1,ni[3]=1,ni}(),function(ni,si,hi){var fi=si[0],_i=si[1],gi=si[2],bi=si[3],Ei=Math.sin(hi),Ti=Math.cos(hi);ni[0]=fi*Ti+gi*Ei,ni[1]=_i*Ti+bi*Ei,ni[2]=fi*-Ei+gi*Ti,ni[3]=_i*-Ei+bi*Ti}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(ei){const ri=li.ad(ei,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==ri&&(this._unmodified=!1,this._pitch=ri,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(ei){ei=Math.max(.01,Math.min(60,ei)),this._fov!==ei&&(this._unmodified=!1,this._fov=ei/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(ei){const ri=Math.min(Math.max(ei,this.minZoom),this.maxZoom);this._zoom!==ri&&(this._unmodified=!1,this._zoom=ri,this.tileZoom=Math.max(0,Math.floor(ri)),this.scale=this.zoomScale(ri),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(ei){ei.lat===this._center.lat&&ei.lng===this._center.lng||(this._unmodified=!1,this._center=ei,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(ei){ei!==this._elevation&&(this._elevation=ei,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(ei){this._edgeInsets.equals(ei)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,ei,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(ei){return this._edgeInsets.equals(ei)}interpolatePadding(ei,ri,ni){this._unmodified=!1,this._edgeInsets.interpolate(ei,ri,ni),this._constrain(),this._calcMatrices()}coveringZoomLevel(ei){const ri=(ei.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/ei.tileSize));return Math.max(0,ri)}getVisibleUnwrappedCoordinates(ei){const ri=[new li.b6(0,ei)];if(this._renderWorldCopies){const ni=this.pointCoordinate(new li.P(0,0)),si=this.pointCoordinate(new li.P(this.width,0)),hi=this.pointCoordinate(new li.P(this.width,this.height)),fi=this.pointCoordinate(new li.P(0,this.height)),_i=Math.floor(Math.min(ni.x,si.x,hi.x,fi.x)),gi=Math.floor(Math.max(ni.x,si.x,hi.x,fi.x)),bi=1;for(let Ei=_i-bi;Ei<=gi+bi;Ei++)Ei!==0&&ri.push(new li.b6(Ei,ei))}return ri}coveringTiles(ei){var ri,ni;let si=this.coveringZoomLevel(ei);const hi=si;if(ei.minzoom!==void 0&&si<ei.minzoom)return[];ei.maxzoom!==void 0&&si>ei.maxzoom&&(si=ei.maxzoom);const fi=this.pointCoordinate(this.getCameraPoint()),_i=li.U.fromLngLat(this.center),gi=Math.pow(2,si),bi=[gi*fi.x,gi*fi.y,0],Ei=[gi*_i.x,gi*_i.y,0],Ti=Fa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,si);let zi=ei.minzoom||0;!ei.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(zi=si);const Ni=ei.terrain?2/Math.min(this.tileSize,ei.tileSize)*this.tileSize:3,Bi=$i=>({aabb:new kl([$i*gi,0,0],[($i+1)*gi,gi,0]),zoom:0,x:0,y:0,wrap:$i,fullyVisible:!1}),Vi=[],Di=[],Wi=si,Kr=ei.reparseOverscaled?hi:si;if(this._renderWorldCopies)for(let $i=1;$i<=3;$i++)Vi.push(Bi(-$i)),Vi.push(Bi($i));for(Vi.push(Bi(0));Vi.length>0;){const $i=Vi.pop(),Ji=$i.x,eo=$i.y;let to=$i.fullyVisible;if(!to){const Ao=$i.aabb.intersects(Ti);if(Ao===0)continue;to=Ao===2}const no=ei.terrain?bi:Ei,co=$i.aabb.distanceX(no),lo=$i.aabb.distanceY(no),ho=Math.max(Math.abs(co),Math.abs(lo));if($i.zoom===Wi||ho>Ni+(1<<Wi-$i.zoom)-2&&$i.zoom>=zi){const Ao=Wi-$i.zoom,Ho=bi[0]-.5-(Ji<<Ao),xo=bi[1]-.5-(eo<<Ao);Di.push({tileID:new li.O($i.zoom===Wi?Kr:$i.zoom,$i.wrap,$i.zoom,Ji,eo),distanceSq:oa([Ei[0]-.5-Ji,Ei[1]-.5-eo]),tileDistanceToCamera:Math.sqrt(Ho*Ho+xo*xo)})}else for(let Ao=0;Ao<4;Ao++){const Ho=(Ji<<1)+Ao%2,xo=(eo<<1)+(Ao>>1),Bo=$i.zoom+1;let Co=$i.aabb.quadrant(Ao);if(ei.terrain){const un=new li.O(Bo,$i.wrap,Bo,Ho,xo),Zo=ei.terrain.getMinMaxElevation(un),qo=(ri=Zo.minElevation)!==null&&ri!==void 0?ri:this.elevation,Yo=(ni=Zo.maxElevation)!==null&&ni!==void 0?ni:this.elevation;Co=new kl([Co.min[0],Co.min[1],qo],[Co.max[0],Co.max[1],Yo])}Vi.push({aabb:Co,zoom:Bo,x:Ho,y:xo,wrap:$i.wrap,fullyVisible:to})}}return Di.sort(($i,Ji)=>$i.distanceSq-Ji.distanceSq).map($i=>$i.tileID)}resize(ei,ri){this.width=ei,this.height=ri,this.pixelsToGLUnits=[2/ei,-2/ri],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(ei){return Math.pow(2,ei)}scaleZoom(ei){return Math.log(ei)/Math.LN2}project(ei){const ri=li.ad(ei.lat,-this.maxValidLatitude,this.maxValidLatitude);return new li.P(li.G(ei.lng)*this.worldSize,li.H(ri)*this.worldSize)}unproject(ei){return new li.U(ei.x/this.worldSize,ei.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(ei){const ri=this.pointLocation(this.centerPoint,ei),ni=ei.getElevationForLngLatZoom(ri,this.tileZoom);if(!(this.elevation-ni))return;const si=this.getCameraPosition(),hi=li.U.fromLngLat(si.lngLat,si.altitude),fi=li.U.fromLngLat(ri,ni),_i=hi.x-fi.x,gi=hi.y-fi.y,bi=hi.z-fi.z,Ei=Math.sqrt(_i*_i+gi*gi+bi*bi),Ti=this.scaleZoom(this.cameraToCenterDistance/Ei/this.tileSize);this._elevation=ni,this._center=ri,this.zoom=Ti}setLocationAtPoint(ei,ri){const ni=this.pointCoordinate(ri),si=this.pointCoordinate(this.centerPoint),hi=this.locationCoordinate(ei),fi=new li.U(hi.x-(ni.x-si.x),hi.y-(ni.y-si.y));this.center=this.coordinateLocation(fi),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(ei,ri){return ri?this.coordinatePoint(this.locationCoordinate(ei),ri.getElevationForLngLatZoom(ei,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(ei))}pointLocation(ei,ri){return this.coordinateLocation(this.pointCoordinate(ei,ri))}locationCoordinate(ei){return li.U.fromLngLat(ei)}coordinateLocation(ei){return ei&&ei.toLngLat()}pointCoordinate(ei,ri){if(ri){const zi=ri.pointCoordinate(ei);if(zi!=null)return zi}const ni=[ei.x,ei.y,0,1],si=[ei.x,ei.y,1,1];li.ag(ni,ni,this.pixelMatrixInverse),li.ag(si,si,this.pixelMatrixInverse);const hi=ni[3],fi=si[3],_i=ni[1]/hi,gi=si[1]/fi,bi=ni[2]/hi,Ei=si[2]/fi,Ti=bi===Ei?0:(0-bi)/(Ei-bi);return new li.U(li.B.number(ni[0]/hi,si[0]/fi,Ti)/this.worldSize,li.B.number(_i,gi,Ti)/this.worldSize)}coordinatePoint(ei,ri=0,ni=this.pixelMatrix){const si=[ei.x*this.worldSize,ei.y*this.worldSize,ri,1];return li.ag(si,si,ni),new li.P(si[0]/si[3],si[1]/si[3])}getBounds(){const ei=Math.max(0,this.height/2-this.getHorizon());return new hn().extend(this.pointLocation(new li.P(0,ei))).extend(this.pointLocation(new li.P(this.width,ei))).extend(this.pointLocation(new li.P(this.width,this.height))).extend(this.pointLocation(new li.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new hn([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(ei){ei?(this.lngRange=[ei.getWest(),ei.getEast()],this.latRange=[ei.getSouth(),ei.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(ei,ri=!1){const ni=ei.key,si=ri?this._alignedPosMatrixCache:this._posMatrixCache;if(si[ni])return si[ni];const hi=ei.canonical,fi=this.worldSize/this.zoomScale(hi.z),_i=hi.x+Math.pow(2,hi.z)*ei.wrap,gi=li.ao(new Float64Array(16));return li.$(gi,gi,[_i*fi,hi.y*fi,0]),li.a0(gi,gi,[fi/li.N,fi/li.N,1]),li.a1(gi,ri?this.alignedProjMatrix:this.projMatrix,gi),si[ni]=new Float32Array(gi),si[ni]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let ei,ri,ni,si,hi=-90,fi=90,_i=-180,gi=180;const bi=this.size,Ei=this._unmodified;if(this.latRange){const Ni=this.latRange;hi=li.H(Ni[1])*this.worldSize,fi=li.H(Ni[0])*this.worldSize,ei=fi-hi<bi.y?bi.y/(fi-hi):0}if(this.lngRange){const Ni=this.lngRange;_i=li.b5(li.G(Ni[0])*this.worldSize,0,this.worldSize),gi=li.b5(li.G(Ni[1])*this.worldSize,0,this.worldSize),gi<_i&&(gi+=this.worldSize),ri=gi-_i<bi.x?bi.x/(gi-_i):0}const Ti=this.point,zi=Math.max(ri||0,ei||0);if(zi)return this.center=this.unproject(new li.P(ri?(gi+_i)/2:Ti.x,ei?(fi+hi)/2:Ti.y)),this.zoom+=this.scaleZoom(zi),this._unmodified=Ei,void(this._constraining=!1);if(this.latRange){const Ni=Ti.y,Bi=bi.y/2;Ni-Bi<hi&&(si=hi+Bi),Ni+Bi>fi&&(si=fi-Bi)}if(this.lngRange){const Ni=(_i+gi)/2,Bi=li.b5(Ti.x,Ni-this.worldSize/2,Ni+this.worldSize/2),Vi=bi.x/2;Bi-Vi<_i&&(ni=_i+Vi),Bi+Vi>gi&&(ni=gi-Vi)}ni===void 0&&si===void 0||(this.center=this.unproject(new li.P(ni!==void 0?ni:Ti.x,si!==void 0?si:Ti.y)).wrap()),this._unmodified=Ei,this._constraining=!1}_calcMatrices(){if(!this.height)return;const ei=this.centerOffset,ri=this.point.x,ni=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=li.b7(1,this.center.lat)*this.worldSize;let si=li.ao(new Float64Array(16));li.a0(si,si,[this.width/2,-this.height/2,1]),li.$(si,si,[1,-1,0]),this.labelPlaneMatrix=si,si=li.ao(new Float64Array(16)),li.a0(si,si,[1,-1,1]),li.$(si,si,[-1,-1,0]),li.a0(si,si,[2/this.width,2/this.height,1]),this.glCoordMatrix=si;const hi=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),fi=Math.min(this.elevation,this._minEleveationForCurrentTile),_i=hi-fi*this._pixelPerMeter/Math.cos(this._pitch),gi=fi<0?_i:hi,bi=Math.PI/2+this._pitch,Ei=this._fov*(.5+ei.y/this.height),Ti=Math.sin(Ei)*gi/Math.sin(li.ad(Math.PI-bi-Ei,.01,Math.PI-.01)),zi=this.getHorizon(),Ni=2*Math.atan(zi/this.cameraToCenterDistance)*(.5+ei.y/(2*zi)),Bi=Math.sin(Ni)*gi/Math.sin(li.ad(Math.PI-bi-Ni,.01,Math.PI-.01)),Vi=Math.min(Ti,Bi),Di=1.01*(Math.cos(Math.PI/2-this._pitch)*Vi+gi),Wi=this.height/50;si=new Float64Array(16),li.b8(si,this._fov,this.width/this.height,Wi,Di),si[8]=2*-ei.x/this.width,si[9]=2*ei.y/this.height,li.a0(si,si,[1,-1,1]),li.$(si,si,[0,0,-this.cameraToCenterDistance]),li.b9(si,si,this._pitch),li.ae(si,si,this.angle),li.$(si,si,[-ri,-ni,0]),this.mercatorMatrix=li.a0([],si,[this.worldSize,this.worldSize,this.worldSize]),li.a0(si,si,[1,1,this._pixelPerMeter]),this.pixelMatrix=li.a1(new Float64Array(16),this.labelPlaneMatrix,si),li.$(si,si,[0,0,-this.elevation]),this.projMatrix=si,this.invProjMatrix=li.as([],si),this.pixelMatrix3D=li.a1(new Float64Array(16),this.labelPlaneMatrix,si);const Kr=this.width%2/2,$i=this.height%2/2,Ji=Math.cos(this.angle),eo=Math.sin(this.angle),to=ri-Math.round(ri)+Ji*Kr+eo*$i,no=ni-Math.round(ni)+Ji*$i+eo*Kr,co=new Float64Array(si);if(li.$(co,co,[to>.5?to-1:to,no>.5?no-1:no,0]),this.alignedProjMatrix=co,si=li.as(new Float64Array(16),this.pixelMatrix),!si)throw new Error("failed to invert matrix");this.pixelMatrixInverse=si,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const ei=this.pointCoordinate(new li.P(0,0)),ri=[ei.x*this.worldSize,ei.y*this.worldSize,0,1];return li.ag(ri,ri,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const ei=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new li.P(0,ei))}getCameraQueryGeometry(ei){const ri=this.getCameraPoint();if(ei.length===1)return[ei[0],ri];{let ni=ri.x,si=ri.y,hi=ri.x,fi=ri.y;for(const _i of ei)ni=Math.min(ni,_i.x),si=Math.min(si,_i.y),hi=Math.max(hi,_i.x),fi=Math.max(fi,_i.y);return[new li.P(ni,si),new li.P(hi,si),new li.P(hi,fi),new li.P(ni,fi),new li.P(ni,si)]}}}function ml(ci,ei){let ri,ni=!1,si=null,hi=null;const fi=()=>{si=null,ni&&(ci.apply(hi,ri),si=setTimeout(fi,ei),ni=!1)};return(..._i)=>(ni=!0,hi=this,ri=_i,si||fi(),si)}class ic{constructor(ei){this._getCurrentHash=()=>{const ri=window.location.hash.replace("#","");if(this._hashName){let ni;return ri.split("&").map(si=>si.split("=")).forEach(si=>{si[0]===this._hashName&&(ni=si)}),(ni&&ni[1]||"").split("/")}return ri.split("/")},this._onHashChange=()=>{const ri=this._getCurrentHash();if(ri.length>=3&&!ri.some(ni=>isNaN(ni))){const ni=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(ri[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+ri[2],+ri[1]],zoom:+ri[0],bearing:ni,pitch:+(ri[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const ri=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,ri)}catch{}},this._updateHash=ml(this._updateHashUnthrottled,300),this._hashName=ei&&encodeURIComponent(ei)}addTo(ei){return this._map=ei,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(ei){const ri=this._map.getCenter(),ni=Math.round(100*this._map.getZoom())/100,si=Math.ceil((ni*Math.LN2+Math.log(512/360/.5))/Math.LN10),hi=Math.pow(10,si),fi=Math.round(ri.lng*hi)/hi,_i=Math.round(ri.lat*hi)/hi,gi=this._map.getBearing(),bi=this._map.getPitch();let Ei="";if(Ei+=ei?`/${fi}/${_i}/${ni}`:`${ni}/${_i}/${fi}`,(gi||bi)&&(Ei+="/"+Math.round(10*gi)/10),bi&&(Ei+=`/${Math.round(bi)}`),this._hashName){const Ti=this._hashName;let zi=!1;const Ni=window.location.hash.slice(1).split("&").map(Bi=>{const Vi=Bi.split("=")[0];return Vi===Ti?(zi=!0,`${Vi}=${Ei}`):Bi}).filter(Bi=>Bi);return zi||Ni.push(`${Ti}=${Ei}`),`#${Ni.join("&")}`}return`#${Ei}`}}const Dl={linearity:.3,easing:li.ba(0,0,.3,1)},Ih=li.e({deceleration:2500,maxSpeed:1400},Dl),Ah=li.e({deceleration:20,maxSpeed:1400},Dl),Ph=li.e({deceleration:1e3,maxSpeed:360},Dl),Ch=li.e({deceleration:1e3,maxSpeed:90},Dl);class zh{constructor(ei){this._map=ei,this.clear()}clear(){this._inertiaBuffer=[]}record(ei){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:li.h.now(),settings:ei})}_drainInertiaBuffer(){const ei=this._inertiaBuffer,ri=li.h.now();for(;ei.length>0&&ri-ei[0].time>160;)ei.shift()}_onMoveEnd(ei){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const ri={zoom:0,bearing:0,pitch:0,pan:new li.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:hi}of this._inertiaBuffer)ri.zoom+=hi.zoomDelta||0,ri.bearing+=hi.bearingDelta||0,ri.pitch+=hi.pitchDelta||0,hi.panDelta&&ri.pan._add(hi.panDelta),hi.around&&(ri.around=hi.around),hi.pinchAround&&(ri.pinchAround=hi.pinchAround);const ni=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,si={};if(ri.pan.mag()){const hi=rc(ri.pan.mag(),ni,li.e({},Ih,ei||{}));si.offset=ri.pan.mult(hi.amount/ri.pan.mag()),si.center=this._map.transform.center,Ts(si,hi)}if(ri.zoom){const hi=rc(ri.zoom,ni,Ah);si.zoom=this._map.transform.zoom+hi.amount,Ts(si,hi)}if(ri.bearing){const hi=rc(ri.bearing,ni,Ph);si.bearing=this._map.transform.bearing+li.ad(hi.amount,-179,179),Ts(si,hi)}if(ri.pitch){const hi=rc(ri.pitch,ni,Ch);si.pitch=this._map.transform.pitch+hi.amount,Ts(si,hi)}if(si.zoom||si.bearing){const hi=ri.pinchAround===void 0?ri.around:ri.pinchAround;si.around=hi?this._map.unproject(hi):this._map.getCenter()}return this.clear(),li.e(si,{noMoveStart:!0})}}function Ts(ci,ei){(!ci.duration||ci.duration<ei.duration)&&(ci.duration=ei.duration,ci.easing=ei.easing)}function rc(ci,ei,ri){const{maxSpeed:ni,linearity:si,deceleration:hi}=ri,fi=li.ad(ci*si/(ei/1e3),-ni,ni),_i=Math.abs(fi)/(hi*si);return{easing:ri.easing,duration:1e3*_i,amount:fi*(_i/2)}}class Wa extends li.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(ei,ri,ni,si={}){const hi=Ki.mousePos(ri.getCanvasContainer(),ni),fi=ri.unproject(hi);super(ei,li.e({point:hi,lngLat:fi,originalEvent:ni},si)),this._defaultPrevented=!1,this.target=ri}}class oc extends li.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(ei,ri,ni){const si=ei==="touchend"?ni.changedTouches:ni.touches,hi=Ki.touchPos(ri.getCanvasContainer(),si),fi=hi.map(gi=>ri.unproject(gi)),_i=hi.reduce((gi,bi,Ei,Ti)=>gi.add(bi.div(Ti.length)),new li.P(0,0));super(ei,{points:hi,point:_i,lngLats:fi,lngLat:ri.unproject(_i),originalEvent:ni}),this._defaultPrevented=!1}}class Rh extends li.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(ei,ri,ni){super(ei,{originalEvent:ni}),this._defaultPrevented=!1}}class Mh{constructor(ei,ri){this._map=ei,this._clickTolerance=ri.clickTolerance}reset(){delete this._mousedownPos}wheel(ei){return this._firePreventable(new Rh(ei.type,this._map,ei))}mousedown(ei,ri){return this._mousedownPos=ri,this._firePreventable(new Wa(ei.type,this._map,ei))}mouseup(ei){this._map.fire(new Wa(ei.type,this._map,ei))}click(ei,ri){this._mousedownPos&&this._mousedownPos.dist(ri)>=this._clickTolerance||this._map.fire(new Wa(ei.type,this._map,ei))}dblclick(ei){return this._firePreventable(new Wa(ei.type,this._map,ei))}mouseover(ei){this._map.fire(new Wa(ei.type,this._map,ei))}mouseout(ei){this._map.fire(new Wa(ei.type,this._map,ei))}touchstart(ei){return this._firePreventable(new oc(ei.type,this._map,ei))}touchmove(ei){this._map.fire(new oc(ei.type,this._map,ei))}touchend(ei){this._map.fire(new oc(ei.type,this._map,ei))}touchcancel(ei){this._map.fire(new oc(ei.type,this._map,ei))}_firePreventable(ei){if(this._map.fire(ei),ei.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lh{constructor(ei){this._map=ei}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(ei){this._map.fire(new Wa(ei.type,this._map,ei))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(ei){this._delayContextMenu?this._contextMenuEvent=ei:this._ignoreContextMenu||this._map.fire(new Wa(ei.type,this._map,ei)),this._map.listens("contextmenu")&&ei.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ns{constructor(ei){this._map=ei}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(ei){return this.transform.pointLocation(li.P.convert(ei),this._map.terrain)}}class Oh{constructor(ei,ri){this._map=ei,this._tr=new Ns(ei),this._el=ei.getCanvasContainer(),this._container=ei.getContainer(),this._clickTolerance=ri.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(ei,ri){this.isEnabled()&&ei.shiftKey&&ei.button===0&&(Ki.disableDrag(),this._startPos=this._lastPos=ri,this._active=!0)}mousemoveWindow(ei,ri){if(!this._active)return;const ni=ri;if(this._lastPos.equals(ni)||!this._box&&ni.dist(this._startPos)<this._clickTolerance)return;const si=this._startPos;this._lastPos=ni,this._box||(this._box=Ki.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",ei));const hi=Math.min(si.x,ni.x),fi=Math.max(si.x,ni.x),_i=Math.min(si.y,ni.y),gi=Math.max(si.y,ni.y);Ki.setTransform(this._box,`translate(${hi}px,${_i}px)`),this._box.style.width=fi-hi+"px",this._box.style.height=gi-_i+"px"}mouseupWindow(ei,ri){if(!this._active||ei.button!==0)return;const ni=this._startPos,si=ri;if(this.reset(),Ki.suppressClick(),ni.x!==si.x||ni.y!==si.y)return this._map.fire(new li.k("boxzoomend",{originalEvent:ei})),{cameraAnimation:hi=>hi.fitScreenCoordinates(ni,si,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",ei)}keydown(ei){this._active&&ei.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",ei))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Ki.remove(this._box),this._box=null),Ki.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(ei,ri){return this._map.fire(new li.k(ei,{originalEvent:ri}))}}function us(ci,ei){if(ci.length!==ei.length)throw new Error(`The number of touches and points are not equal - touches ${ci.length}, points ${ei.length}`);const ri={};for(let ni=0;ni<ci.length;ni++)ri[ci[ni].identifier]=ei[ni];return ri}class Us{constructor(ei){this.reset(),this.numTouches=ei.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(ei,ri,ni){(this.centroid||ni.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=ei.timeStamp),ni.length===this.numTouches&&(this.centroid=function(si){const hi=new li.P(0,0);for(const fi of si)hi._add(fi);return hi.div(si.length)}(ri),this.touches=us(ni,ri)))}touchmove(ei,ri,ni){if(this.aborted||!this.centroid)return;const si=us(ni,ri);for(const hi in this.touches){const fi=si[hi];(!fi||fi.dist(this.touches[hi])>30)&&(this.aborted=!0)}}touchend(ei,ri,ni){if((!this.centroid||ei.timeStamp-this.startTime>500)&&(this.aborted=!0),ni.length===0){const si=!this.aborted&&this.centroid;if(this.reset(),si)return si}}}class Nc{constructor(ei){this.singleTap=new Us(ei),this.numTaps=ei.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(ei,ri,ni){this.singleTap.touchstart(ei,ri,ni)}touchmove(ei,ri,ni){this.singleTap.touchmove(ei,ri,ni)}touchend(ei,ri,ni){const si=this.singleTap.touchend(ei,ri,ni);if(si){const hi=ei.timeStamp-this.lastTime<500,fi=!this.lastTap||this.lastTap.dist(si)<30;if(hi&&fi||this.reset(),this.count++,this.lastTime=ei.timeStamp,this.lastTap=si,this.count===this.numTaps)return this.reset(),si}}}class Vs{constructor(ei){this._tr=new Ns(ei),this._zoomIn=new Nc({numTouches:1,numTaps:2}),this._zoomOut=new Nc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(ei,ri,ni){this._zoomIn.touchstart(ei,ri,ni),this._zoomOut.touchstart(ei,ri,ni)}touchmove(ei,ri,ni){this._zoomIn.touchmove(ei,ri,ni),this._zoomOut.touchmove(ei,ri,ni)}touchend(ei,ri,ni){const si=this._zoomIn.touchend(ei,ri,ni),hi=this._zoomOut.touchend(ei,ri,ni),fi=this._tr;return si?(this._active=!0,ei.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_i=>_i.easeTo({duration:300,zoom:fi.zoom+1,around:fi.unproject(si)},{originalEvent:ei})}):hi?(this._active=!0,ei.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_i=>_i.easeTo({duration:300,zoom:fi.zoom-1,around:fi.unproject(hi)},{originalEvent:ei})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class js{constructor(ei){this._enabled=!!ei.enable,this._moveStateManager=ei.moveStateManager,this._clickTolerance=ei.clickTolerance||1,this._moveFunction=ei.move,this._activateOnStart=!!ei.activateOnStart,ei.assignEvents(this),this.reset()}reset(ei){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(ei)}_move(...ei){const ri=this._moveFunction(...ei);if(ri.bearingDelta||ri.pitchDelta||ri.around||ri.panDelta)return this._active=!0,ri}dragStart(ei,ri){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(ei)&&(this._moveStateManager.startMove(ei),this._lastPoint=ri.length?ri[0]:ri,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(ei,ri){if(!this.isEnabled())return;const ni=this._lastPoint;if(!ni)return;if(ei.preventDefault(),!this._moveStateManager.isValidMoveEvent(ei))return void this.reset(ei);const si=ri.length?ri[0]:ri;return!this._moved&&si.dist(ni)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=si,this._move(ni,si))}dragEnd(ei){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(ei)&&(this._moved&&Ki.suppressClick(),this.reset(ei))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ap={0:1,2:2};class Eu{constructor(ei){this._correctEvent=ei.checkCorrectEvent}startMove(ei){const ri=Ki.mouseButton(ei);this._eventButton=ri}endMove(ei){delete this._eventButton}isValidStartEvent(ei){return this._correctEvent(ei)}isValidMoveEvent(ei){return!function(ri,ni){const si=Ap[ni];return ri.buttons===void 0||(ri.buttons&si)!==si}(ei,this._eventButton)}isValidEndEvent(ei){return Ki.mouseButton(ei)===this._eventButton}}class kh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(ei){return ei.targetTouches.length===1}_isSameTouchEvent(ei){return ei.targetTouches[0].identifier===this._firstTouch}startMove(ei){this._firstTouch=ei.targetTouches[0].identifier}endMove(ei){delete this._firstTouch}isValidStartEvent(ei){return this._isOneFingerTouch(ei)}isValidMoveEvent(ei){return this._isOneFingerTouch(ei)&&this._isSameTouchEvent(ei)}isValidEndEvent(ei){return this._isOneFingerTouch(ei)&&this._isSameTouchEvent(ei)}}const Uc=ci=>{ci.mousedown=ci.dragStart,ci.mousemoveWindow=ci.dragMove,ci.mouseup=ci.dragEnd,ci.contextmenu=function(ei){ei.preventDefault()}},Fl=({enable:ci,clickTolerance:ei,bearingDegreesPerPixelMoved:ri=.8})=>{const ni=new Eu({checkCorrectEvent:si=>Ki.mouseButton(si)===0&&si.ctrlKey||Ki.mouseButton(si)===2});return new js({clickTolerance:ei,move:(si,hi)=>({bearingDelta:(hi.x-si.x)*ri}),moveStateManager:ni,enable:ci,assignEvents:Uc})},qs=({enable:ci,clickTolerance:ei,pitchDegreesPerPixelMoved:ri=-.5})=>{const ni=new Eu({checkCorrectEvent:si=>Ki.mouseButton(si)===0&&si.ctrlKey||Ki.mouseButton(si)===2});return new js({clickTolerance:ei,move:(si,hi)=>({pitchDelta:(hi.y-si.y)*ri}),moveStateManager:ni,enable:ci,assignEvents:Uc})};class Eo{constructor(ei,ri){this._minTouches=ei.cooperativeGestures?2:1,this._clickTolerance=ei.clickTolerance||1,this._map=ri,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new li.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(ei,ri,ni){return this._calculateTransform(ei,ri,ni)}touchmove(ei,ri,ni){if(this._map._cooperativeGestures&&(this._minTouches===2&&ni.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(ei,!1,ni.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(ni.length<this._minTouches))return ei.preventDefault(),this._calculateTransform(ei,ri,ni)}touchend(ei,ri,ni){this._calculateTransform(ei,ri,ni),this._active&&ni.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(ei,ri,ni){ni.length>0&&(this._active=!0);const si=us(ni,ri),hi=new li.P(0,0),fi=new li.P(0,0);let _i=0;for(const bi in si){const Ei=si[bi],Ti=this._touches[bi];Ti&&(hi._add(Ei),fi._add(Ei.sub(Ti)),_i++,si[bi]=Ei)}if(this._touches=si,_i<this._minTouches||!fi.mag())return;const gi=fi.div(_i);return this._sum._add(gi),this._sum.mag()<this._clickTolerance?void 0:{around:hi.div(_i),panDelta:gi}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(ei,ri,ni){this._firstTwoTouches||ni.length<2||(this._firstTwoTouches=[ni[0].identifier,ni[1].identifier],this._start([ri[0],ri[1]]))}touchmove(ei,ri,ni){if(!this._firstTwoTouches)return;ei.preventDefault();const[si,hi]=this._firstTwoTouches,fi=tl(ni,ri,si),_i=tl(ni,ri,hi);if(!fi||!_i)return;const gi=this._aroundCenter?null:fi.add(_i).div(2);return this._move([fi,_i],gi,ei)}touchend(ei,ri,ni){if(!this._firstTwoTouches)return;const[si,hi]=this._firstTwoTouches,fi=tl(ni,ri,si),_i=tl(ni,ri,hi);fi&&_i||(this._active&&Ki.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(ei){this._enabled=!0,this._aroundCenter=!!ei&&ei.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function tl(ci,ei,ri){for(let ni=0;ni<ci.length;ni++)if(ci[ni].identifier===ri)return ei[ni]}function Bl(ci,ei){return Math.log(ci/ei)/Math.LN2}class Dh extends Vc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(ei){this._startDistance=this._distance=ei[0].dist(ei[1])}_move(ei,ri){const ni=this._distance;if(this._distance=ei[0].dist(ei[1]),this._active||!(Math.abs(Bl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bl(this._distance,ni),pinchAround:ri}}}function wo(ci,ei){return 180*ci.angleWith(ei)/Math.PI}class Tu extends Vc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(ei){this._startVector=this._vector=ei[0].sub(ei[1]),this._minDiameter=ei[0].dist(ei[1])}_move(ei,ri){const ni=this._vector;if(this._vector=ei[0].sub(ei[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wo(this._vector,ni),pinchAround:ri}}_isBelowThreshold(ei){this._minDiameter=Math.min(this._minDiameter,ei.mag());const ri=25/(Math.PI*this._minDiameter)*360,ni=wo(ei,this._startVector);return Math.abs(ni)<ri}}function Iu(ci){return Math.abs(ci.y)>Math.abs(ci.x)}class Pp extends Vc{constructor(ei){super(),this._map=ei}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(ei,ri,ni){super.touchstart(ei,ri,ni),this._currentTouchCount=ni.length}_start(ei){this._lastPoints=ei,Iu(ei[0].sub(ei[1]))&&(this._valid=!1)}_move(ei,ri,ni){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const si=ei[0].sub(this._lastPoints[0]),hi=ei[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(si,hi,ni.timeStamp),this._valid?(this._lastPoints=ei,this._active=!0,{pitchDelta:(si.y+hi.y)/2*-.5}):void 0}gestureBeginsVertically(ei,ri,ni){if(this._valid!==void 0)return this._valid;const si=ei.mag()>=2,hi=ri.mag()>=2;if(!si&&!hi)return;if(!si||!hi)return this._firstMove===void 0&&(this._firstMove=ni),ni-this._firstMove<100&&void 0;const fi=ei.y>0==ri.y>0;return Iu(ei)&&Iu(ri)&&fi}}const Au={panStep:100,bearingStep:15,pitchStep:10};class Fh{constructor(ei){this._tr=new Ns(ei);const ri=Au;this._panStep=ri.panStep,this._bearingStep=ri.bearingStep,this._pitchStep=ri.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(ei){if(ei.altKey||ei.ctrlKey||ei.metaKey)return;let ri=0,ni=0,si=0,hi=0,fi=0;switch(ei.keyCode){case 61:case 107:case 171:case 187:ri=1;break;case 189:case 109:case 173:ri=-1;break;case 37:ei.shiftKey?ni=-1:(ei.preventDefault(),hi=-1);break;case 39:ei.shiftKey?ni=1:(ei.preventDefault(),hi=1);break;case 38:ei.shiftKey?si=1:(ei.preventDefault(),fi=-1);break;case 40:ei.shiftKey?si=-1:(ei.preventDefault(),fi=1);break;default:return}return this._rotationDisabled&&(ni=0,si=0),{cameraAnimation:_i=>{const gi=this._tr;_i.easeTo({duration:300,easeId:"keyboardHandler",easing:Bh,zoom:ri?Math.round(gi.zoom)+ri*(ei.shiftKey?2:1):gi.zoom,bearing:gi.bearing+ni*this._bearingStep,pitch:gi.pitch+si*this._pitchStep,offset:[-hi*this._panStep,-fi*this._panStep],center:gi.center},{originalEvent:ei})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bh(ci){return ci*(2-ci)}const Nh=4.000244140625;class Cp{constructor(ei,ri){this._onTimeout=ni=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(ni)},this._map=ei,this._tr=new Ns(ei),this._el=ei.getCanvasContainer(),this._triggerRenderFrame=ri,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(ei){this._defaultZoomRate=ei}setWheelZoomRate(ei){this._wheelZoomRate=ei}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(ei){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!ei&&ei.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(ei){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!ei[this._map._metaKey])return;ei.preventDefault()}let ri=ei.deltaMode===WheelEvent.DOM_DELTA_LINE?40*ei.deltaY:ei.deltaY;const ni=li.h.now(),si=ni-(this._lastWheelEventTime||0);this._lastWheelEventTime=ni,ri!==0&&ri%Nh==0?this._type="wheel":ri!==0&&Math.abs(ri)<4?this._type="trackpad":si>400?(this._type=null,this._lastValue=ri,this._timeout=setTimeout(this._onTimeout,40,ei)):this._type||(this._type=Math.abs(si*ri)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,ri+=this._lastValue)),ei.shiftKey&&ri&&(ri/=4),this._type&&(this._lastWheelEvent=ei,this._delta-=ri,this._active||this._start(ei)),ei.preventDefault()}_start(ei){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const ri=Ki.mousePos(this._el,ei),ni=this._tr;this._around=li.L.convert(this._aroundCenter?ni.center:ni.unproject(ri)),this._aroundPoint=ni.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const ei=this._tr.transform;if(this._delta!==0){const _i=this._type==="wheel"&&Math.abs(this._delta)>Nh?this._wheelZoomRate:this._defaultZoomRate;let gi=2/(1+Math.exp(-Math.abs(this._delta*_i)));this._delta<0&&gi!==0&&(gi=1/gi);const bi=typeof this._targetZoom=="number"?ei.zoomScale(this._targetZoom):ei.scale;this._targetZoom=Math.min(ei.maxZoom,Math.max(ei.minZoom,ei.scaleZoom(bi*gi))),this._type==="wheel"&&(this._startZoom=ei.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const ri=typeof this._targetZoom=="number"?this._targetZoom:ei.zoom,ni=this._startZoom,si=this._easing;let hi,fi=!1;if(this._type==="wheel"&&ni&&si){const _i=Math.min((li.h.now()-this._lastWheelEventTime)/200,1),gi=si(_i);hi=li.B.number(ni,ri,gi),_i<1?this._frameId||(this._frameId=!0):fi=!0}else hi=ri,fi=!0;return this._active=!0,fi&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!fi,zoomDelta:hi-ei.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(ei){let ri=li.bb;if(this._prevEase){const ni=this._prevEase,si=(li.h.now()-ni.start)/ni.duration,hi=ni.easing(si+.01)-ni.easing(si),fi=.27/Math.sqrt(hi*hi+1e-4)*.01,_i=Math.sqrt(.0729-fi*fi);ri=li.ba(fi,_i,.25,1)}return this._prevEase={start:li.h.now(),duration:ei,easing:ri},ri}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Pu{constructor(ei,ri){this._clickZoom=ei,this._tapZoom=ri}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cu{constructor(ei){this._tr=new Ns(ei),this.reset()}reset(){this._active=!1}dblclick(ei,ri){return ei.preventDefault(),{cameraAnimation:ni=>{ni.easeTo({duration:300,zoom:this._tr.zoom+(ei.shiftKey?-1:1),around:this._tr.unproject(ri)},{originalEvent:ei})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zu{constructor(){this._tap=new Nc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(ei,ri,ni){if(!this._swipePoint)if(this._tapTime){const si=ri[0],hi=ei.timeStamp-this._tapTime<500,fi=this._tapPoint.dist(si)<30;hi&&fi?ni.length>0&&(this._swipePoint=si,this._swipeTouch=ni[0].identifier):this.reset()}else this._tap.touchstart(ei,ri,ni)}touchmove(ei,ri,ni){if(this._tapTime){if(this._swipePoint){if(ni[0].identifier!==this._swipeTouch)return;const si=ri[0],hi=si.y-this._swipePoint.y;return this._swipePoint=si,ei.preventDefault(),this._active=!0,{zoomDelta:hi/128}}}else this._tap.touchmove(ei,ri,ni)}touchend(ei,ri,ni){if(this._tapTime)this._swipePoint&&ni.length===0&&this.reset();else{const si=this._tap.touchend(ei,ri,ni);si&&(this._tapTime=ei.timeStamp,this._tapPoint=si)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ru{constructor(ei,ri,ni){this._el=ei,this._mousePan=ri,this._touchPan=ni}enable(ei){this._inertiaOptions=ei||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ba{constructor(ei,ri,ni){this._pitchWithRotate=ei.pitchWithRotate,this._mouseRotate=ri,this._mousePitch=ni}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class il{constructor(ei,ri,ni,si){this._el=ei,this._touchZoom=ri,this._touchRotate=ni,this._tapDragZoom=si,this._rotationDisabled=!1,this._enabled=!0}enable(ei){this._touchZoom.enable(ei),this._rotationDisabled||this._touchRotate.enable(ei),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const nc=ci=>ci.zoom||ci.drag||ci.pitch||ci.rotate;class Mu extends li.k{}function ac(ci){return ci.panDelta&&ci.panDelta.mag()||ci.zoomDelta||ci.bearingDelta||ci.pitchDelta}class Lu{constructor(ei,ri){this.handleWindowEvent=si=>{this.handleEvent(si,`${si.type}Window`)},this.handleEvent=(si,hi)=>{if(si.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const fi=si.type==="renderFrame"?void 0:si,_i={needsRenderFrame:!1},gi={},bi={},Ei=si.touches,Ti=Ei?this._getMapTouches(Ei):void 0,zi=Ti?Ki.touchPos(this._el,Ti):Ki.mousePos(this._el,si);for(const{handlerName:Vi,handler:Di,allowed:Wi}of this._handlers){if(!Di.isEnabled())continue;let Kr;this._blockedByActive(bi,Wi,Vi)?Di.reset():Di[hi||si.type]&&(Kr=Di[hi||si.type](si,zi,Ti),this.mergeHandlerResult(_i,gi,Kr,Vi,fi),Kr&&Kr.needsRenderFrame&&this._triggerRenderFrame()),(Kr||Di.isActive())&&(bi[Vi]=Di)}const Ni={};for(const Vi in this._previousActiveHandlers)bi[Vi]||(Ni[Vi]=fi);this._previousActiveHandlers=bi,(Object.keys(Ni).length||ac(_i))&&(this._changes.push([_i,gi,Ni]),this._triggerRenderFrame()),(Object.keys(bi).length||ac(_i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Bi}=_i;Bi&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Bi(this._map))},this._map=ei,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zh(ei),this._bearingSnap=ri.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(ri);const ni=this._el;this._listeners=[[ni,"touchstart",{passive:!0}],[ni,"touchmove",{passive:!1}],[ni,"touchend",void 0],[ni,"touchcancel",void 0],[ni,"mousedown",void 0],[ni,"mousemove",void 0],[ni,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[ni,"mouseover",void 0],[ni,"mouseout",void 0],[ni,"dblclick",void 0],[ni,"click",void 0],[ni,"keydown",{capture:!1}],[ni,"keyup",void 0],[ni,"wheel",{passive:!1}],[ni,"contextmenu",void 0],[window,"blur",void 0]];for(const[si,hi,fi]of this._listeners)Ki.addEventListener(si,hi,si===document?this.handleWindowEvent:this.handleEvent,fi)}destroy(){for(const[ei,ri,ni]of this._listeners)Ki.removeEventListener(ei,ri,ei===document?this.handleWindowEvent:this.handleEvent,ni)}_addDefaultHandlers(ei){const ri=this._map,ni=ri.getCanvasContainer();this._add("mapEvent",new Mh(ri,ei));const si=ri.boxZoom=new Oh(ri,ei);this._add("boxZoom",si),ei.interactive&&ei.boxZoom&&si.enable();const hi=new Vs(ri),fi=new Cu(ri);ri.doubleClickZoom=new Pu(fi,hi),this._add("tapZoom",hi),this._add("clickZoom",fi),ei.interactive&&ei.doubleClickZoom&&ri.doubleClickZoom.enable();const _i=new zu;this._add("tapDragZoom",_i);const gi=ri.touchPitch=new Pp(ri);this._add("touchPitch",gi),ei.interactive&&ei.touchPitch&&ri.touchPitch.enable(ei.touchPitch);const bi=Fl(ei),Ei=qs(ei);ri.dragRotate=new Ba(ei,bi,Ei),this._add("mouseRotate",bi,["mousePitch"]),this._add("mousePitch",Ei,["mouseRotate"]),ei.interactive&&ei.dragRotate&&ri.dragRotate.enable();const Ti=(({enable:Wi,clickTolerance:Kr})=>{const $i=new Eu({checkCorrectEvent:Ji=>Ki.mouseButton(Ji)===0&&!Ji.ctrlKey});return new js({clickTolerance:Kr,move:(Ji,eo)=>({around:eo,panDelta:eo.sub(Ji)}),activateOnStart:!0,moveStateManager:$i,enable:Wi,assignEvents:Uc})})(ei),zi=new Eo(ei,ri);ri.dragPan=new Ru(ni,Ti,zi),this._add("mousePan",Ti),this._add("touchPan",zi,["touchZoom","touchRotate"]),ei.interactive&&ei.dragPan&&ri.dragPan.enable(ei.dragPan);const Ni=new Tu,Bi=new Dh;ri.touchZoomRotate=new il(ni,Bi,Ni,_i),this._add("touchRotate",Ni,["touchPan","touchZoom"]),this._add("touchZoom",Bi,["touchPan","touchRotate"]),ei.interactive&&ei.touchZoomRotate&&ri.touchZoomRotate.enable(ei.touchZoomRotate);const Vi=ri.scrollZoom=new Cp(ri,()=>this._triggerRenderFrame());this._add("scrollZoom",Vi,["mousePan"]),ei.interactive&&ei.scrollZoom&&ri.scrollZoom.enable(ei.scrollZoom);const Di=ri.keyboard=new Fh(ri);this._add("keyboard",Di),ei.interactive&&ei.keyboard&&ri.keyboard.enable(),this._add("blockableMapEvent",new Lh(ri))}_add(ei,ri,ni){this._handlers.push({handlerName:ei,handler:ri,allowed:ni}),this._handlersById[ei]=ri}stop(ei){if(!this._updatingCamera){for(const{handler:ri}of this._handlers)ri.reset();this._inertia.clear(),this._fireEvents({},{},ei),this._changes=[]}}isActive(){for(const{handler:ei}of this._handlers)if(ei.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!nc(this._eventsInProgress)||this.isZooming()}_blockedByActive(ei,ri,ni){for(const si in ei)if(si!==ni&&(!ri||ri.indexOf(si)<0))return!0;return!1}_getMapTouches(ei){const ri=[];for(const ni of ei)this._el.contains(ni.target)&&ri.push(ni);return ri}mergeHandlerResult(ei,ri,ni,si,hi){if(!ni)return;li.e(ei,ni);const fi={handlerName:si,originalEvent:ni.originalEvent||hi};ni.zoomDelta!==void 0&&(ri.zoom=fi),ni.panDelta!==void 0&&(ri.drag=fi),ni.pitchDelta!==void 0&&(ri.pitch=fi),ni.bearingDelta!==void 0&&(ri.rotate=fi)}_applyChanges(){const ei={},ri={},ni={};for(const[si,hi,fi]of this._changes)si.panDelta&&(ei.panDelta=(ei.panDelta||new li.P(0,0))._add(si.panDelta)),si.zoomDelta&&(ei.zoomDelta=(ei.zoomDelta||0)+si.zoomDelta),si.bearingDelta&&(ei.bearingDelta=(ei.bearingDelta||0)+si.bearingDelta),si.pitchDelta&&(ei.pitchDelta=(ei.pitchDelta||0)+si.pitchDelta),si.around!==void 0&&(ei.around=si.around),si.pinchAround!==void 0&&(ei.pinchAround=si.pinchAround),si.noInertia&&(ei.noInertia=si.noInertia),li.e(ri,hi),li.e(ni,fi);this._updateMapTransform(ei,ri,ni),this._changes=[]}_updateMapTransform(ei,ri,ni){const si=this._map,hi=si._getTransformForUpdate(),fi=si.terrain;if(!(ac(ei)||fi&&this._terrainMovement))return this._fireEvents(ri,ni,!0);let{panDelta:_i,zoomDelta:gi,bearingDelta:bi,pitchDelta:Ei,around:Ti,pinchAround:zi}=ei;zi!==void 0&&(Ti=zi),si._stop(!0),Ti=Ti||si.transform.centerPoint;const Ni=hi.pointLocation(_i?Ti.sub(_i):Ti);bi&&(hi.bearing+=bi),Ei&&(hi.pitch+=Ei),gi&&(hi.zoom+=gi),fi?this._terrainMovement||!ri.drag&&!ri.zoom?ri.drag&&this._terrainMovement?hi.center=hi.pointLocation(hi.centerPoint.sub(_i)):hi.setLocationAtPoint(Ni,Ti):(this._terrainMovement=!0,this._map._elevationFreeze=!0,hi.setLocationAtPoint(Ni,Ti),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,hi.recalculateZoom(si.terrain)})):hi.setLocationAtPoint(Ni,Ti),si._applyUpdatedTransform(hi),this._map._update(),ei.noInertia||this._inertia.record(ei),this._fireEvents(ri,ni,!0)}_fireEvents(ei,ri,ni){const si=nc(this._eventsInProgress),hi=nc(ei),fi={};for(const Ei in ei){const{originalEvent:Ti}=ei[Ei];this._eventsInProgress[Ei]||(fi[`${Ei}start`]=Ti),this._eventsInProgress[Ei]=ei[Ei]}!si&&hi&&this._fireEvent("movestart",hi.originalEvent);for(const Ei in fi)this._fireEvent(Ei,fi[Ei]);hi&&this._fireEvent("move",hi.originalEvent);for(const Ei in ei){const{originalEvent:Ti}=ei[Ei];this._fireEvent(Ei,Ti)}const _i={};let gi;for(const Ei in this._eventsInProgress){const{handlerName:Ti,originalEvent:zi}=this._eventsInProgress[Ei];this._handlersById[Ti].isActive()||(delete this._eventsInProgress[Ei],gi=ri[Ti]||zi,_i[`${Ei}end`]=gi)}for(const Ei in _i)this._fireEvent(Ei,_i[Ei]);const bi=nc(this._eventsInProgress);if(ni&&(si||hi)&&!bi){this._updatingCamera=!0;const Ei=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ti=zi=>zi!==0&&-this._bearingSnap<zi&&zi<this._bearingSnap;!Ei||!Ei.essential&&li.h.prefersReducedMotion?(this._map.fire(new li.k("moveend",{originalEvent:gi})),Ti(this._map.getBearing())&&this._map.resetNorth()):(Ti(Ei.bearing||this._map.getBearing())&&(Ei.bearing=0),Ei.freezeElevation=!0,this._map.easeTo(Ei,{originalEvent:gi})),this._updatingCamera=!1}}_fireEvent(ei,ri){this._map.fire(new li.k(ei,ri?{originalEvent:ri}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(ei=>{delete this._frameId,this.handleEvent(new Mu("renderFrame",{timeStamp:ei})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Uh extends li.E{constructor(ei,ri){super(),this._renderFrameCallback=()=>{const ni=Math.min((li.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(ni)),ni<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=ei,this._bearingSnap=ri.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new li.L(this.transform.center.lng,this.transform.center.lat)}setCenter(ei,ri){return this.jumpTo({center:ei},ri)}panBy(ei,ri,ni){return ei=li.P.convert(ei).mult(-1),this.panTo(this.transform.center,li.e({offset:ei},ri),ni)}panTo(ei,ri,ni){return this.easeTo(li.e({center:ei},ri),ni)}getZoom(){return this.transform.zoom}setZoom(ei,ri){return this.jumpTo({zoom:ei},ri),this}zoomTo(ei,ri,ni){return this.easeTo(li.e({zoom:ei},ri),ni)}zoomIn(ei,ri){return this.zoomTo(this.getZoom()+1,ei,ri),this}zoomOut(ei,ri){return this.zoomTo(this.getZoom()-1,ei,ri),this}getBearing(){return this.transform.bearing}setBearing(ei,ri){return this.jumpTo({bearing:ei},ri),this}getPadding(){return this.transform.padding}setPadding(ei,ri){return this.jumpTo({padding:ei},ri),this}rotateTo(ei,ri,ni){return this.easeTo(li.e({bearing:ei},ri),ni)}resetNorth(ei,ri){return this.rotateTo(0,li.e({duration:1e3},ei),ri),this}resetNorthPitch(ei,ri){return this.easeTo(li.e({bearing:0,pitch:0,duration:1e3},ei),ri),this}snapToNorth(ei,ri){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(ei,ri):this}getPitch(){return this.transform.pitch}setPitch(ei,ri){return this.jumpTo({pitch:ei},ri),this}cameraForBounds(ei,ri){ei=hn.convert(ei);const ni=ri&&ri.bearing||0;return this._cameraForBoxAndBearing(ei.getNorthWest(),ei.getSouthEast(),ni,ri)}_cameraForBoxAndBearing(ei,ri,ni,si){const hi={top:0,bottom:0,right:0,left:0};if(typeof(si=li.e({padding:hi,offset:[0,0],maxZoom:this.transform.maxZoom},si)).padding=="number"){const eo=si.padding;si.padding={top:eo,bottom:eo,right:eo,left:eo}}si.padding=li.e(hi,si.padding);const fi=this.transform,_i=fi.padding,gi=fi.project(li.L.convert(ei)),bi=fi.project(li.L.convert(ri)),Ei=gi.rotate(-ni*Math.PI/180),Ti=bi.rotate(-ni*Math.PI/180),zi=new li.P(Math.max(Ei.x,Ti.x),Math.max(Ei.y,Ti.y)),Ni=new li.P(Math.min(Ei.x,Ti.x),Math.min(Ei.y,Ti.y)),Bi=zi.sub(Ni),Vi=(fi.width-(_i.left+_i.right+si.padding.left+si.padding.right))/Bi.x,Di=(fi.height-(_i.top+_i.bottom+si.padding.top+si.padding.bottom))/Bi.y;if(Di<0||Vi<0)return void li.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Wi=Math.min(fi.scaleZoom(fi.scale*Math.min(Vi,Di)),si.maxZoom),Kr=li.P.convert(si.offset),$i=new li.P((si.padding.left-si.padding.right)/2,(si.padding.top-si.padding.bottom)/2).rotate(ni*Math.PI/180),Ji=Kr.add($i).mult(fi.scale/fi.zoomScale(Wi));return{center:fi.unproject(gi.add(bi).div(2).sub(Ji)),zoom:Wi,bearing:ni}}fitBounds(ei,ri,ni){return this._fitInternal(this.cameraForBounds(ei,ri),ri,ni)}fitScreenCoordinates(ei,ri,ni,si,hi){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(li.P.convert(ei)),this.transform.pointLocation(li.P.convert(ri)),ni,si),si,hi)}_fitInternal(ei,ri,ni){return ei?(delete(ri=li.e(ei,ri)).padding,ri.linear?this.easeTo(ri,ni):this.flyTo(ri,ni)):this}jumpTo(ei,ri){this.stop();const ni=this._getTransformForUpdate();let si=!1,hi=!1,fi=!1;return"zoom"in ei&&ni.zoom!==+ei.zoom&&(si=!0,ni.zoom=+ei.zoom),ei.center!==void 0&&(ni.center=li.L.convert(ei.center)),"bearing"in ei&&ni.bearing!==+ei.bearing&&(hi=!0,ni.bearing=+ei.bearing),"pitch"in ei&&ni.pitch!==+ei.pitch&&(fi=!0,ni.pitch=+ei.pitch),ei.padding==null||ni.isPaddingEqual(ei.padding)||(ni.padding=ei.padding),this._applyUpdatedTransform(ni),this.fire(new li.k("movestart",ri)).fire(new li.k("move",ri)),si&&this.fire(new li.k("zoomstart",ri)).fire(new li.k("zoom",ri)).fire(new li.k("zoomend",ri)),hi&&this.fire(new li.k("rotatestart",ri)).fire(new li.k("rotate",ri)).fire(new li.k("rotateend",ri)),fi&&this.fire(new li.k("pitchstart",ri)).fire(new li.k("pitch",ri)).fire(new li.k("pitchend",ri)),this.fire(new li.k("moveend",ri))}calculateCameraOptionsFromTo(ei,ri,ni,si=0){const hi=li.U.fromLngLat(ei,ri),fi=li.U.fromLngLat(ni,si),_i=fi.x-hi.x,gi=fi.y-hi.y,bi=fi.z-hi.z,Ei=Math.hypot(_i,gi,bi);if(Ei===0)throw new Error("Can't calculate camera options with same From and To");const Ti=Math.hypot(_i,gi),zi=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Ei/this.transform.tileSize),Ni=180*Math.atan2(_i,-gi)/Math.PI;let Bi=180*Math.acos(Ti/Ei)/Math.PI;return Bi=bi<0?90-Bi:90+Bi,{center:fi.toLngLat(),zoom:zi,pitch:Bi,bearing:Ni}}easeTo(ei,ri){this._stop(!1,ei.easeId),((ei=li.e({offset:[0,0],duration:500,easing:li.bb},ei)).animate===!1||!ei.essential&&li.h.prefersReducedMotion)&&(ei.duration=0);const ni=this._getTransformForUpdate(),si=this.getZoom(),hi=this.getBearing(),fi=this.getPitch(),_i=this.getPadding(),gi="zoom"in ei?+ei.zoom:si,bi="bearing"in ei?this._normalizeBearing(ei.bearing,hi):hi,Ei="pitch"in ei?+ei.pitch:fi,Ti="padding"in ei?ei.padding:ni.padding,zi=li.P.convert(ei.offset);let Ni=ni.centerPoint.add(zi);const Bi=ni.pointLocation(Ni),Vi=li.L.convert(ei.center||Bi);this._normalizeCenter(Vi);const Di=ni.project(Bi),Wi=ni.project(Vi).sub(Di),Kr=ni.zoomScale(gi-si);let $i,Ji;ei.around&&($i=li.L.convert(ei.around),Ji=ni.locationPoint($i));const eo={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||gi!==si,this._rotating=this._rotating||hi!==bi,this._pitching=this._pitching||Ei!==fi,this._padding=!ni.isPaddingEqual(Ti),this._easeId=ei.easeId,this._prepareEase(ri,ei.noMoveStart,eo),this.terrain&&this._prepareElevation(Vi),this._ease(to=>{if(this._zooming&&(ni.zoom=li.B.number(si,gi,to)),this._rotating&&(ni.bearing=li.B.number(hi,bi,to)),this._pitching&&(ni.pitch=li.B.number(fi,Ei,to)),this._padding&&(ni.interpolatePadding(_i,Ti,to),Ni=ni.centerPoint.add(zi)),this.terrain&&!ei.freezeElevation&&this._updateElevation(to),$i)ni.setLocationAtPoint($i,Ji);else{const no=ni.zoomScale(ni.zoom-si),co=gi>si?Math.min(2,Kr):Math.max(.5,Kr),lo=Math.pow(co,1-to),ho=ni.unproject(Di.add(Wi.mult(to*lo)).mult(no));ni.setLocationAtPoint(ni.renderWorldCopies?ho.wrap():ho,Ni)}this._applyUpdatedTransform(ni),this._fireMoveEvents(ri)},to=>{this.terrain&&this._finalizeElevation(),this._afterEase(ri,to)},ei),this}_prepareEase(ei,ri,ni={}){this._moving=!0,ri||ni.moving||this.fire(new li.k("movestart",ei)),this._zooming&&!ni.zooming&&this.fire(new li.k("zoomstart",ei)),this._rotating&&!ni.rotating&&this.fire(new li.k("rotatestart",ei)),this._pitching&&!ni.pitching&&this.fire(new li.k("pitchstart",ei))}_prepareElevation(ei){this._elevationCenter=ei,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(ei,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(ei){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const ri=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(ei<1&&ri!==this._elevationTarget){const ni=this._elevationTarget-this._elevationStart;this._elevationStart+=ei*(ni-(ri-(ni*ei+this._elevationStart))/(1-ei)),this._elevationTarget=ri}this.transform.elevation=li.B.number(this._elevationStart,this._elevationTarget,ei)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(ei){if(!this.transformCameraUpdate)return;const ri=ei.clone(),{center:ni,zoom:si,pitch:hi,bearing:fi,elevation:_i}=this.transformCameraUpdate(ri);ni&&(ri.center=ni),si!==void 0&&(ri.zoom=si),hi!==void 0&&(ri.pitch=hi),fi!==void 0&&(ri.bearing=fi),_i!==void 0&&(ri.elevation=_i),this.transform.apply(ri)}_fireMoveEvents(ei){this.fire(new li.k("move",ei)),this._zooming&&this.fire(new li.k("zoom",ei)),this._rotating&&this.fire(new li.k("rotate",ei)),this._pitching&&this.fire(new li.k("pitch",ei))}_afterEase(ei,ri){if(this._easeId&&ri&&this._easeId===ri)return;delete this._easeId;const ni=this._zooming,si=this._rotating,hi=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,ni&&this.fire(new li.k("zoomend",ei)),si&&this.fire(new li.k("rotateend",ei)),hi&&this.fire(new li.k("pitchend",ei)),this.fire(new li.k("moveend",ei))}flyTo(ei,ri){if(!ei.essential&&li.h.prefersReducedMotion){const Co=li.F(ei,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Co,ri)}this.stop(),ei=li.e({offset:[0,0],speed:1.2,curve:1.42,easing:li.bb},ei);const ni=this._getTransformForUpdate(),si=this.getZoom(),hi=this.getBearing(),fi=this.getPitch(),_i=this.getPadding(),gi="zoom"in ei?li.ad(+ei.zoom,ni.minZoom,ni.maxZoom):si,bi="bearing"in ei?this._normalizeBearing(ei.bearing,hi):hi,Ei="pitch"in ei?+ei.pitch:fi,Ti="padding"in ei?ei.padding:ni.padding,zi=ni.zoomScale(gi-si),Ni=li.P.convert(ei.offset);let Bi=ni.centerPoint.add(Ni);const Vi=ni.pointLocation(Bi),Di=li.L.convert(ei.center||Vi);this._normalizeCenter(Di);const Wi=ni.project(Vi),Kr=ni.project(Di).sub(Wi);let $i=ei.curve;const Ji=Math.max(ni.width,ni.height),eo=Ji/zi,to=Kr.mag();if("minZoom"in ei){const Co=li.ad(Math.min(ei.minZoom,si,gi),ni.minZoom,ni.maxZoom),un=Ji/ni.zoomScale(Co-si);$i=Math.sqrt(un/to*2)}const no=$i*$i;function co(Co){const un=(eo*eo-Ji*Ji+(Co?-1:1)*no*no*to*to)/(2*(Co?eo:Ji)*no*to);return Math.log(Math.sqrt(un*un+1)-un)}function lo(Co){return(Math.exp(Co)-Math.exp(-Co))/2}function ho(Co){return(Math.exp(Co)+Math.exp(-Co))/2}const Ao=co(!1);let Ho=function(Co){return ho(Ao)/ho(Ao+$i*Co)},xo=function(Co){return Ji*((ho(Ao)*(lo(un=Ao+$i*Co)/ho(un))-lo(Ao))/no)/to;var un},Bo=(co(!0)-Ao)/$i;if(Math.abs(to)<1e-6||!isFinite(Bo)){if(Math.abs(Ji-eo)<1e-6)return this.easeTo(ei,ri);const Co=eo<Ji?-1:1;Bo=Math.abs(Math.log(eo/Ji))/$i,xo=function(){return 0},Ho=function(un){return Math.exp(Co*$i*un)}}return ei.duration="duration"in ei?+ei.duration:1e3*Bo/("screenSpeed"in ei?+ei.screenSpeed/$i:+ei.speed),ei.maxDuration&&ei.duration>ei.maxDuration&&(ei.duration=0),this._zooming=!0,this._rotating=hi!==bi,this._pitching=Ei!==fi,this._padding=!ni.isPaddingEqual(Ti),this._prepareEase(ri,!1),this.terrain&&this._prepareElevation(Di),this._ease(Co=>{const un=Co*Bo,Zo=1/Ho(un);ni.zoom=Co===1?gi:si+ni.scaleZoom(Zo),this._rotating&&(ni.bearing=li.B.number(hi,bi,Co)),this._pitching&&(ni.pitch=li.B.number(fi,Ei,Co)),this._padding&&(ni.interpolatePadding(_i,Ti,Co),Bi=ni.centerPoint.add(Ni)),this.terrain&&!ei.freezeElevation&&this._updateElevation(Co);const qo=Co===1?Di:ni.unproject(Wi.add(Kr.mult(xo(un))).mult(Zo));ni.setLocationAtPoint(ni.renderWorldCopies?qo.wrap():qo,Bi),this._applyUpdatedTransform(ni),this._fireMoveEvents(ri)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(ri)},ei),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(ei,ri){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const ni=this._onEaseEnd;delete this._onEaseEnd,ni.call(this,ri)}if(!ei){const ni=this.handlers;ni&&ni.stop(!1)}return this}_ease(ei,ri,ni){ni.animate===!1||ni.duration===0?(ei(1),ri()):(this._easeStart=li.h.now(),this._easeOptions=ni,this._onEaseFrame=ei,this._onEaseEnd=ri,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(ei,ri){ei=li.b5(ei,-180,180);const ni=Math.abs(ei-ri);return Math.abs(ei-360-ri)<ni&&(ei-=360),Math.abs(ei+360-ri)<ni&&(ei+=360),ei}_normalizeCenter(ei){const ri=this.transform;if(!ri.renderWorldCopies||ri.lngRange)return;const ni=ei.lng-ri.center.lng;ei.lng+=ni>180?-360:ni<-180?360:0}queryTerrainElevation(ei){return this.terrain?this.terrain.getElevationForLngLatZoom(li.L.convert(ei),this.transform.tileZoom)-this.transform.elevation:null}}class Ka{constructor(ei={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=ri=>{!ri||ri.sourceDataType!=="metadata"&&ri.sourceDataType!=="visibility"&&ri.dataType!=="style"&&ri.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=ei}getDefaultPosition(){return"bottom-right"}onAdd(ei){return this._map=ei,this._compact=this.options&&this.options.compact,this._container=Ki.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Ki.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ki.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ki.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(ei,ri){const ni=this._map._getUIString(`AttributionControl.${ri}`);ei.title=ni,ei.setAttribute("aria-label",ni)}_updateAttributions(){if(!this._map.style)return;let ei=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?ei=ei.concat(this.options.customAttribution.map(si=>typeof si!="string"?"":si)):typeof this.options.customAttribution=="string"&&ei.push(this.options.customAttribution)),this._map.style.stylesheet){const si=this._map.style.stylesheet;this.styleOwner=si.owner,this.styleId=si.id}const ri=this._map.style.sourceCaches;for(const si in ri){const hi=ri[si];if(hi.used||hi.usedForTerrain){const fi=hi.getSource();fi.attribution&&ei.indexOf(fi.attribution)<0&&ei.push(fi.attribution)}}ei=ei.filter(si=>String(si).trim()),ei.sort((si,hi)=>si.length-hi.length),ei=ei.filter((si,hi)=>{for(let fi=hi+1;fi<ei.length;fi++)if(ei[fi].indexOf(si)>=0)return!1;return!0});const ni=ei.join(" | ");ni!==this._attribHTML&&(this._attribHTML=ni,ei.length?(this._innerContainer.innerHTML=ni,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class gn{constructor(ei={}){this._updateCompact=()=>{const ri=this._container.children;if(ri.length){const ni=ri[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&ni.classList.add("maplibregl-compact"):ni.classList.remove("maplibregl-compact")}},this.options=ei}getDefaultPosition(){return"bottom-left"}onAdd(ei){this._map=ei,this._compact=this.options&&this.options.compact,this._container=Ki.create("div","maplibregl-ctrl");const ri=Ki.create("a","maplibregl-ctrl-logo");return ri.target="_blank",ri.rel="noopener nofollow",ri.href="https://maplibre.org/",ri.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),ri.setAttribute("rel","noopener nofollow"),this._container.appendChild(ri),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ki.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class jc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(ei){const ri=++this._id;return this._queue.push({callback:ei,id:ri,cancelled:!1}),ri}remove(ei){const ri=this._currentlyRunning,ni=ri?this._queue.concat(ri):this._queue;for(const si of ni)if(si.id===ei)return void(si.cancelled=!0)}run(ei=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const ri=this._currentlyRunning=this._queue;this._queue=[];for(const ni of ri)if(!ni.cancelled&&(ni.callback(ei),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Ou={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Vh=li.Q([{name:"a_pos3d",type:"Int16",components:3}]);class jh extends li.E{constructor(ei){super(),this.sourceCache=ei,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,ei.usedForTerrain=!0,ei.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(ei,ri){this.sourceCache.update(ei,ri),this._renderableTilesKeys=[];const ni={};for(const si of ei.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:ri}))ni[si.key]=!0,this._renderableTilesKeys.push(si.key),this._tiles[si.key]||(si.posMatrix=new Float64Array(16),li.aS(si.posMatrix,0,li.N,0,li.N,0,1),this._tiles[si.key]=new na(si,this.tileSize));for(const si in this._tiles)ni[si]||delete this._tiles[si]}freeRtt(ei){for(const ri in this._tiles){const ni=this._tiles[ri];(!ei||ni.tileID.equals(ei)||ni.tileID.isChildOf(ei)||ei.isChildOf(ni.tileID))&&(ni.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(ei=>this.getTileByID(ei))}getTileByID(ei){return this._tiles[ei]}getTerrainCoords(ei){const ri={};for(const ni of this._renderableTilesKeys){const si=this._tiles[ni].tileID;if(si.canonical.equals(ei.canonical)){const hi=ei.clone();hi.posMatrix=new Float64Array(16),li.aS(hi.posMatrix,0,li.N,0,li.N,0,1),ri[ni]=hi}else if(si.canonical.isChildOf(ei.canonical)){const hi=ei.clone();hi.posMatrix=new Float64Array(16);const fi=si.canonical.z-ei.canonical.z,_i=si.canonical.x-(si.canonical.x>>fi<<fi),gi=si.canonical.y-(si.canonical.y>>fi<<fi),bi=li.N>>fi;li.aS(hi.posMatrix,0,bi,0,bi,0,1),li.$(hi.posMatrix,hi.posMatrix,[-_i*bi,-gi*bi,0]),ri[ni]=hi}else if(ei.canonical.isChildOf(si.canonical)){const hi=ei.clone();hi.posMatrix=new Float64Array(16);const fi=ei.canonical.z-si.canonical.z,_i=ei.canonical.x-(ei.canonical.x>>fi<<fi),gi=ei.canonical.y-(ei.canonical.y>>fi<<fi),bi=li.N>>fi;li.aS(hi.posMatrix,0,li.N,0,li.N,0,1),li.$(hi.posMatrix,hi.posMatrix,[_i*bi,gi*bi,0]),li.a0(hi.posMatrix,hi.posMatrix,[1/2**fi,1/2**fi,0]),ri[ni]=hi}}return ri}getSourceTile(ei,ri){const ni=this.sourceCache._source;let si=ei.overscaledZ-this.deltaZoom;if(si>ni.maxzoom&&(si=ni.maxzoom),si<ni.minzoom)return null;this._sourceTileCache[ei.key]||(this._sourceTileCache[ei.key]=ei.scaledTo(si).key);let hi=this.sourceCache.getTileByID(this._sourceTileCache[ei.key]);if((!hi||!hi.dem)&&ri)for(;si>=ni.minzoom&&(!hi||!hi.dem);)hi=this.sourceCache.getTileByID(ei.scaledTo(si--).key);return hi}tilesAfterTime(ei=Date.now()){return Object.values(this._tiles).filter(ri=>ri.timeAdded>=ei)}}class qh{constructor(ei,ri,ni){this.painter=ei,this.sourceCache=new jh(ri),this.options=ni,this.exaggeration=typeof ni.exaggeration=="number"?ni.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(ei,ri,ni,si=li.N){var hi;if(!(ri>=0&&ri<si&&ni>=0&&ni<si))return 0;const fi=this.getTerrainData(ei),_i=(hi=fi.tile)===null||hi===void 0?void 0:hi.dem;if(!_i)return 0;const gi=function(Bi,Vi,Di){var Wi=Vi[0],Kr=Vi[1];return Bi[0]=Di[0]*Wi+Di[4]*Kr+Di[12],Bi[1]=Di[1]*Wi+Di[5]*Kr+Di[13],Bi}([],[ri/si*li.N,ni/si*li.N],fi.u_terrain_matrix),bi=[gi[0]*_i.dim,gi[1]*_i.dim],Ei=Math.floor(bi[0]),Ti=Math.floor(bi[1]),zi=bi[0]-Ei,Ni=bi[1]-Ti;return _i.get(Ei,Ti)*(1-zi)*(1-Ni)+_i.get(Ei+1,Ti)*zi*(1-Ni)+_i.get(Ei,Ti+1)*(1-zi)*Ni+_i.get(Ei+1,Ti+1)*zi*Ni}getElevationForLngLatZoom(ei,ri){const{tileID:ni,mercatorX:si,mercatorY:hi}=this._getOverscaledTileIDFromLngLatZoom(ei,ri);return this.getElevation(ni,si%li.N,hi%li.N,li.N)}getElevation(ei,ri,ni,si=li.N){return this.getDEMElevation(ei,ri,ni,si)*this.exaggeration}getTerrainData(ei){if(!this._emptyDemTexture){const si=this.painter.context,hi=new li.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Wo(si,hi,si.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Wo(si,new li.R({width:1,height:1}),si.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(si.gl.NEAREST,si.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=li.ao([])}const ri=this.sourceCache.getSourceTile(ei,!0);if(ri&&ri.dem&&(!ri.demTexture||ri.needsTerrainPrepare)){const si=this.painter.context;ri.demTexture=this.painter.getTileTexture(ri.dem.stride),ri.demTexture?ri.demTexture.update(ri.dem.getPixels(),{premultiply:!1}):ri.demTexture=new Wo(si,ri.dem.getPixels(),si.gl.RGBA,{premultiply:!1}),ri.demTexture.bind(si.gl.NEAREST,si.gl.CLAMP_TO_EDGE),ri.needsTerrainPrepare=!1}const ni=ri&&ri+ri.tileID.key+ei.key;if(ni&&!this._demMatrixCache[ni]){const si=this.sourceCache.sourceCache._source.maxzoom;let hi=ei.canonical.z-ri.tileID.canonical.z;ei.overscaledZ>ei.canonical.z&&(ei.canonical.z>=si?hi=ei.canonical.z-si:li.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const fi=ei.canonical.x-(ei.canonical.x>>hi<<hi),_i=ei.canonical.y-(ei.canonical.y>>hi<<hi),gi=li.bc(new Float64Array(16),[1/(li.N<<hi),1/(li.N<<hi),0]);li.$(gi,gi,[fi*li.N,_i*li.N,0]),this._demMatrixCache[ei.key]={matrix:gi,coord:ei}}return{u_depth:2,u_terrain:3,u_terrain_dim:ri&&ri.dem&&ri.dem.dim||1,u_terrain_matrix:ni?this._demMatrixCache[ei.key].matrix:this._emptyDemMatrix,u_terrain_unpack:ri&&ri.dem&&ri.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(ri&&ri.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:ri}}getFramebuffer(ei){const ri=this.painter,ni=ri.width/devicePixelRatio,si=ri.height/devicePixelRatio;return!this._fbo||this._fbo.width===ni&&this._fbo.height===si||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Wo(ri.context,{width:ni,height:si,data:null},ri.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(ri.context.gl.NEAREST,ri.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Wo(ri.context,{width:ni,height:si,data:null},ri.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(ri.context.gl.NEAREST,ri.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=ri.context.createFramebuffer(ni,si,!0,!1),this._fbo.depthAttachment.set(ri.context.createRenderbuffer(ri.context.gl.DEPTH_COMPONENT16,ni,si))),this._fbo.colorAttachment.set(ei==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const ei=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const ri=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let hi=0,fi=0;hi<this._coordsTextureSize;hi++)for(let _i=0;_i<this._coordsTextureSize;_i++,fi+=4)ri[fi+0]=255&_i,ri[fi+1]=255&hi,ri[fi+2]=_i>>8<<4|hi>>8,ri[fi+3]=0;const ni=new li.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(ri.buffer)),si=new Wo(ei,ni,ei.gl.RGBA,{premultiply:!1});return si.bind(ei.gl.NEAREST,ei.gl.CLAMP_TO_EDGE),this._coordsTexture=si,si}pointCoordinate(ei){const ri=new Uint8Array(4),ni=this.painter.context,si=ni.gl;ni.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),si.readPixels(ei.x,this.painter.height/devicePixelRatio-ei.y-1,1,1,si.RGBA,si.UNSIGNED_BYTE,ri),ni.bindFramebuffer.set(null);const hi=ri[0]+(ri[2]>>4<<8),fi=ri[1]+((15&ri[2])<<8),_i=this.coordsIndex[255-ri[3]],gi=_i&&this.sourceCache.getTileByID(_i);if(!gi)return null;const bi=this._coordsTextureSize,Ei=(1<<gi.tileID.canonical.z)*bi;return new li.U(this._allowMercatorOverflow(ei,(gi.tileID.canonical.x*bi+hi)/Ei),(gi.tileID.canonical.y*bi+fi)/Ei,this.getElevation(gi.tileID,hi,fi,bi))}getTerrainMesh(){if(this._mesh)return this._mesh;const ei=this.painter.context,ri=new li.bd,ni=new li.b0,si=this.meshSize,hi=li.N/si,fi=si*si;for(let Ti=0;Ti<=si;Ti++)for(let zi=0;zi<=si;zi++)ri.emplaceBack(zi*hi,Ti*hi,0);for(let Ti=0;Ti<fi;Ti+=si+1)for(let zi=0;zi<si;zi++)ni.emplaceBack(zi+Ti,si+zi+Ti+1,si+zi+Ti+2),ni.emplaceBack(zi+Ti,si+zi+Ti+2,zi+Ti+1);const _i=ri.length,gi=_i+2*(si+1);for(const Ti of[0,1])for(let zi=0;zi<=si;zi++)for(const Ni of[0,1])ri.emplaceBack(zi*hi,Ti*li.N,Ni);for(let Ti=0;Ti<2*si;Ti+=2)ni.emplaceBack(gi+Ti,gi+Ti+1,gi+Ti+3),ni.emplaceBack(gi+Ti,gi+Ti+3,gi+Ti+2),ni.emplaceBack(_i+Ti,_i+Ti+3,_i+Ti+1),ni.emplaceBack(_i+Ti,_i+Ti+2,_i+Ti+3);const bi=ri.length,Ei=bi+2*(si+1);for(const Ti of[0,1])for(let zi=0;zi<=si;zi++)for(const Ni of[0,1])ri.emplaceBack(Ti*li.N,zi*hi,Ni);for(let Ti=0;Ti<2*si;Ti+=2)ni.emplaceBack(bi+Ti,bi+Ti+1,bi+Ti+3),ni.emplaceBack(bi+Ti,bi+Ti+3,bi+Ti+2),ni.emplaceBack(Ei+Ti,Ei+Ti+3,Ei+Ti+1),ni.emplaceBack(Ei+Ti,Ei+Ti+2,Ei+Ti+3);return this._mesh={indexBuffer:ei.createIndexBuffer(ni),vertexBuffer:ei.createVertexBuffer(ri,Vh.members),segments:li.S.simpleSegment(0,0,ri.length,ni.length)},this._mesh}getMeshFrameDelta(ei){return 2*Math.PI*li.be/Math.pow(2,ei)/5}getMinTileElevationForLngLatZoom(ei,ri){var ni;const{tileID:si}=this._getOverscaledTileIDFromLngLatZoom(ei,ri);return(ni=this.getMinMaxElevation(si).minElevation)!==null&&ni!==void 0?ni:0}getMinMaxElevation(ei){const ri=this.getTerrainData(ei).tile,ni={minElevation:null,maxElevation:null};return ri&&ri.dem&&(ni.minElevation=ri.dem.min*this.exaggeration,ni.maxElevation=ri.dem.max*this.exaggeration),ni}_getOverscaledTileIDFromLngLatZoom(ei,ri){const ni=li.U.fromLngLat(ei.wrap()),si=(1<<ri)*li.N,hi=ni.x*si,fi=ni.y*si,_i=Math.floor(hi/li.N),gi=Math.floor(fi/li.N);return{tileID:new li.O(ri,0,ri,_i,gi),mercatorX:hi,mercatorY:fi}}_allowMercatorOverflow(ei,ri){const ni=ei.x<this.painter.width/2;let si=li.bf(ri);const hi=this.painter.transform.center.lng;return ni&&Math.sign(si)>0&&Math.sign(hi)<0||!ni&&Math.sign(si)<0&&Math.sign(hi)>0?(si=360*Math.sign(hi)+si,li.G(si)):ri}}class zp{constructor(ei,ri,ni){this._context=ei,this._size=ri,this._tileSize=ni,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const ei of this._objects)ei.texture.destroy(),ei.fbo.destroy()}_createObject(ei){const ri=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),ni=new Wo(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return ni.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),ri.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),ri.colorAttachment.set(ni.texture),{id:ei,fbo:ri,texture:ni,stamp:-1,inUse:!1}}getObjectForId(ei){return this._objects[ei]}useObject(ei){ei.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(ri=>ei.id!==ri),this._recentlyUsed.push(ei.id)}stampObject(ei){ei.stamp=++this._stamp}getOrCreateFreeObject(){for(const ri of this._recentlyUsed)if(!this._objects[ri].inUse)return this._objects[ri];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const ei=this._createObject(this._objects.length);return this._objects.push(ei),ei}freeObject(ei){ei.inUse=!1}freeAllObjects(){for(const ei of this._objects)this.freeObject(ei)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(ei=>!ei.inUse)===!1}}const Ta={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class qc{constructor(ei,ri){this.painter=ei,this.terrain=ri,this.pool=new zp(ei.context,30,ri.sourceCache.tileSize*ri.qualityFactor)}destruct(){this.pool.destruct()}getTexture(ei){return this.pool.getObjectForId(ei.rtt[this._stacks.length-1].id).texture}prepareForRender(ei,ri){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=ei._order.filter(ni=>!ei._layers[ni].isHidden(ri)),this._coordsDescendingInv={};for(const ni in ei.sourceCaches){this._coordsDescendingInv[ni]={};const si=ei.sourceCaches[ni].getVisibleCoordinates();for(const hi of si){const fi=this.terrain.sourceCache.getTerrainCoords(hi);for(const _i in fi)this._coordsDescendingInv[ni][_i]||(this._coordsDescendingInv[ni][_i]=[]),this._coordsDescendingInv[ni][_i].push(fi[_i])}}this._coordsDescendingInvStr={};for(const ni of ei._order){const si=ei._layers[ni],hi=si.source;if(Ta[si.type]&&!this._coordsDescendingInvStr[hi]){this._coordsDescendingInvStr[hi]={};for(const fi in this._coordsDescendingInv[hi])this._coordsDescendingInvStr[hi][fi]=this._coordsDescendingInv[hi][fi].map(_i=>_i.key).sort().join()}}for(const ni of this._renderableTiles)for(const si in this._coordsDescendingInvStr){const hi=this._coordsDescendingInvStr[si][ni.tileID.key];hi&&hi!==ni.rttCoords[si]&&(ni.rtt=[])}}renderLayer(ei){if(ei.isHidden(this.painter.transform.zoom))return!1;const ri=ei.type,ni=this.painter,si=this._renderableLayerIds[this._renderableLayerIds.length-1]===ei.id;if(Ta[ri]&&(this._prevType&&Ta[this._prevType]||this._stacks.push([]),this._prevType=ri,this._stacks[this._stacks.length-1].push(ei.id),!si))return!0;if(Ta[this._prevType]||Ta[ri]&&si){this._prevType=ri;const hi=this._stacks.length-1,fi=this._stacks[hi]||[];for(const _i of this._renderableTiles){if(this.pool.isFull()&&(Rn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(_i),_i.rtt[hi]){const bi=this.pool.getObjectForId(_i.rtt[hi].id);if(bi.stamp===_i.rtt[hi].stamp){this.pool.useObject(bi);continue}}const gi=this.pool.getOrCreateFreeObject();this.pool.useObject(gi),this.pool.stampObject(gi),_i.rtt[hi]={id:gi.id,stamp:gi.stamp},ni.context.bindFramebuffer.set(gi.fbo.framebuffer),ni.context.clear({color:li.aT.transparent,stencil:0}),ni.currentStencilSource=void 0;for(let bi=0;bi<fi.length;bi++){const Ei=ni.style._layers[fi[bi]],Ti=Ei.source?this._coordsDescendingInv[Ei.source][_i.tileID.key]:[_i.tileID];ni.context.viewport.set([0,0,gi.fbo.width,gi.fbo.height]),ni._renderTileClippingMasks(Ei,Ti),ni.renderLayer(ni,ni.style.sourceCaches[Ei.source],Ei,Ti),Ei.source&&(_i.rttCoords[Ei.source]=this._coordsDescendingInvStr[Ei.source][_i.tileID.key])}}return Rn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ta[ri]}return!1}}const Mo=po,Fo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:li.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},sc=ci=>{ci.touchstart=ci.dragStart,ci.touchmoveWindow=ci.dragMove,ci.touchend=ci.dragEnd},ku={showCompass:!0,showZoom:!0,visualizePitch:!1};class Du{constructor(ei,ri,ni=!1){this.mousedown=fi=>{this.startMouse(li.e({},fi,{ctrlKey:!0,preventDefault:()=>fi.preventDefault()}),Ki.mousePos(this.element,fi)),Ki.addEventListener(window,"mousemove",this.mousemove),Ki.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=fi=>{this.moveMouse(fi,Ki.mousePos(this.element,fi))},this.mouseup=fi=>{this.mouseRotate.dragEnd(fi),this.mousePitch&&this.mousePitch.dragEnd(fi),this.offTemp()},this.touchstart=fi=>{fi.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ki.touchPos(this.element,fi.targetTouches)[0],this.startTouch(fi,this._startPos),Ki.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ki.addEventListener(window,"touchend",this.touchend))},this.touchmove=fi=>{fi.targetTouches.length!==1?this.reset():(this._lastPos=Ki.touchPos(this.element,fi.targetTouches)[0],this.moveTouch(fi,this._lastPos))},this.touchend=fi=>{fi.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const si=ei.dragRotate._mouseRotate.getClickTolerance(),hi=ei.dragRotate._mousePitch.getClickTolerance();this.element=ri,this.mouseRotate=Fl({clickTolerance:si,enable:!0}),this.touchRotate=(({enable:fi,clickTolerance:_i,bearingDegreesPerPixelMoved:gi=.8})=>{const bi=new kh;return new js({clickTolerance:_i,move:(Ei,Ti)=>({bearingDelta:(Ti.x-Ei.x)*gi}),moveStateManager:bi,enable:fi,assignEvents:sc})})({clickTolerance:si,enable:!0}),this.map=ei,ni&&(this.mousePitch=qs({clickTolerance:hi,enable:!0}),this.touchPitch=(({enable:fi,clickTolerance:_i,pitchDegreesPerPixelMoved:gi=-.5})=>{const bi=new kh;return new js({clickTolerance:_i,move:(Ei,Ti)=>({pitchDelta:(Ti.y-Ei.y)*gi}),moveStateManager:bi,enable:fi,assignEvents:sc})})({clickTolerance:hi,enable:!0})),Ki.addEventListener(ri,"mousedown",this.mousedown),Ki.addEventListener(ri,"touchstart",this.touchstart,{passive:!1}),Ki.addEventListener(ri,"touchcancel",this.reset)}startMouse(ei,ri){this.mouseRotate.dragStart(ei,ri),this.mousePitch&&this.mousePitch.dragStart(ei,ri),Ki.disableDrag()}startTouch(ei,ri){this.touchRotate.dragStart(ei,ri),this.touchPitch&&this.touchPitch.dragStart(ei,ri),Ki.disableDrag()}moveMouse(ei,ri){const ni=this.map,{bearingDelta:si}=this.mouseRotate.dragMove(ei,ri)||{};if(si&&ni.setBearing(ni.getBearing()+si),this.mousePitch){const{pitchDelta:hi}=this.mousePitch.dragMove(ei,ri)||{};hi&&ni.setPitch(ni.getPitch()+hi)}}moveTouch(ei,ri){const ni=this.map,{bearingDelta:si}=this.touchRotate.dragMove(ei,ri)||{};if(si&&ni.setBearing(ni.getBearing()+si),this.touchPitch){const{pitchDelta:hi}=this.touchPitch.dragMove(ei,ri)||{};hi&&ni.setPitch(ni.getPitch()+hi)}}off(){const ei=this.element;Ki.removeEventListener(ei,"mousedown",this.mousedown),Ki.removeEventListener(ei,"touchstart",this.touchstart,{passive:!1}),Ki.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ki.removeEventListener(window,"touchend",this.touchend),Ki.removeEventListener(ei,"touchcancel",this.reset),this.offTemp()}offTemp(){Ki.enableDrag(),Ki.removeEventListener(window,"mousemove",this.mousemove),Ki.removeEventListener(window,"mouseup",this.mouseup),Ki.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ki.removeEventListener(window,"touchend",this.touchend)}}let Vn;function Fu(ci,ei,ri){if(ci=new li.L(ci.lng,ci.lat),ei){const ni=new li.L(ci.lng-360,ci.lat),si=new li.L(ci.lng+360,ci.lat),hi=ri.locationPoint(ci).distSqr(ei);ri.locationPoint(ni).distSqr(ei)<hi?ci=ni:ri.locationPoint(si).distSqr(ei)<hi&&(ci=si)}for(;Math.abs(ci.lng-ri.center.lng)>180;){const ni=ri.locationPoint(ci);if(ni.x>=0&&ni.y>=0&&ni.x<=ri.width&&ni.y<=ri.height)break;ci.lng>ri.center.lng?ci.lng-=360:ci.lng+=360}return ci}const hs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gh(ci,ei,ri){const ni=ci.classList;for(const si in hs)ni.remove(`maplibregl-${ri}-anchor-${si}`);ni.add(`maplibregl-${ri}-anchor-${ei}`)}class _l extends li.E{constructor(ei){if(super(),this._onKeyPress=ri=>{const ni=ri.code,si=ri.charCode||ri.keyCode;ni!=="Space"&&ni!=="Enter"&&si!==32&&si!==13||this.togglePopup()},this._onMapClick=ri=>{const ni=ri.originalEvent.target,si=this._element;this._popup&&(ni===si||si.contains(ni))&&this.togglePopup()},this._update=ri=>{if(!this._map)return;const ni=this._map.loaded()&&!this._map.isMoving();((ri==null?void 0:ri.type)==="terrain"||(ri==null?void 0:ri.type)==="render"&&!ni)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Fu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let si="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?si=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(si=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let hi="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?hi="rotateX(0deg)":this._pitchAlignment==="map"&&(hi=`rotateX(${this._map.getPitch()}deg)`),ri&&ri.type!=="moveend"||(this._pos=this._pos.round()),Ki.setTransform(this._element,`${hs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${hi} ${si}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const fi=this._map.unproject(this._pos),_i=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=fi.distanceTo(this._lngLat)>20*_i?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=ri=>{if(!this._isDragging){const ni=this._clickTolerance||this._map._clickTolerance;this._isDragging=ri.point.dist(this._pointerdownPos)>=ni}this._isDragging&&(this._pos=ri.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new li.k("dragstart"))),this.fire(new li.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new li.k("dragend")),this._state="inactive"},this._addDragHandler=ri=>{this._element.contains(ri.originalEvent.target)&&(ri.preventDefault(),this._positionDelta=ri.point.sub(this._pos).add(this._offset),this._pointerdownPos=ri.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=ei&&ei.anchor||"center",this._color=ei&&ei.color||"#3FB1CE",this._scale=ei&&ei.scale||1,this._draggable=ei&&ei.draggable||!1,this._clickTolerance=ei&&ei.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=ei&&ei.rotation||0,this._rotationAlignment=ei&&ei.rotationAlignment||"auto",this._pitchAlignment=ei&&ei.pitchAlignment&&ei.pitchAlignment!=="auto"?ei.pitchAlignment:this._rotationAlignment,ei&&ei.element)this._element=ei.element,this._offset=li.P.convert(ei&&ei.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ki.create("div"),this._element.setAttribute("aria-label","Map marker");const ri=Ki.createNS("http://www.w3.org/2000/svg","svg"),ni=41,si=27;ri.setAttributeNS(null,"display","block"),ri.setAttributeNS(null,"height",`${ni}px`),ri.setAttributeNS(null,"width",`${si}px`),ri.setAttributeNS(null,"viewBox",`0 0 ${si} ${ni}`);const hi=Ki.createNS("http://www.w3.org/2000/svg","g");hi.setAttributeNS(null,"stroke","none"),hi.setAttributeNS(null,"stroke-width","1"),hi.setAttributeNS(null,"fill","none"),hi.setAttributeNS(null,"fill-rule","evenodd");const fi=Ki.createNS("http://www.w3.org/2000/svg","g");fi.setAttributeNS(null,"fill-rule","nonzero");const _i=Ki.createNS("http://www.w3.org/2000/svg","g");_i.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_i.setAttributeNS(null,"fill","#000000");const gi=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Wi of gi){const Kr=Ki.createNS("http://www.w3.org/2000/svg","ellipse");Kr.setAttributeNS(null,"opacity","0.04"),Kr.setAttributeNS(null,"cx","10.5"),Kr.setAttributeNS(null,"cy","5.80029008"),Kr.setAttributeNS(null,"rx",Wi.rx),Kr.setAttributeNS(null,"ry",Wi.ry),_i.appendChild(Kr)}const bi=Ki.createNS("http://www.w3.org/2000/svg","g");bi.setAttributeNS(null,"fill",this._color);const Ei=Ki.createNS("http://www.w3.org/2000/svg","path");Ei.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),bi.appendChild(Ei);const Ti=Ki.createNS("http://www.w3.org/2000/svg","g");Ti.setAttributeNS(null,"opacity","0.25"),Ti.setAttributeNS(null,"fill","#000000");const zi=Ki.createNS("http://www.w3.org/2000/svg","path");zi.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ti.appendChild(zi);const Ni=Ki.createNS("http://www.w3.org/2000/svg","g");Ni.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ni.setAttributeNS(null,"fill","#FFFFFF");const Bi=Ki.createNS("http://www.w3.org/2000/svg","g");Bi.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Vi=Ki.createNS("http://www.w3.org/2000/svg","circle");Vi.setAttributeNS(null,"fill","#000000"),Vi.setAttributeNS(null,"opacity","0.25"),Vi.setAttributeNS(null,"cx","5.5"),Vi.setAttributeNS(null,"cy","5.5"),Vi.setAttributeNS(null,"r","5.4999962");const Di=Ki.createNS("http://www.w3.org/2000/svg","circle");Di.setAttributeNS(null,"fill","#FFFFFF"),Di.setAttributeNS(null,"cx","5.5"),Di.setAttributeNS(null,"cy","5.5"),Di.setAttributeNS(null,"r","5.4999962"),Bi.appendChild(Vi),Bi.appendChild(Di),fi.appendChild(_i),fi.appendChild(bi),fi.appendChild(Ti),fi.appendChild(Ni),fi.appendChild(Bi),ri.appendChild(fi),ri.setAttributeNS(null,"height",ni*this._scale+"px"),ri.setAttributeNS(null,"width",si*this._scale+"px"),this._element.appendChild(ri),this._offset=li.P.convert(ei&&ei.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",ri=>{ri.preventDefault()}),this._element.addEventListener("mousedown",ri=>{ri.preventDefault()}),Gh(this._element,this._anchor,"marker"),ei&&ei.className)for(const ri of ei.className.split(" "))this._element.classList.add(ri);this._popup=null}addTo(ei){return this.remove(),this._map=ei,ei.getCanvasContainer().appendChild(this._element),ei.on("move",this._update),ei.on("moveend",this._update),ei.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ki.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(ei){return this._lngLat=li.L.convert(ei),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(ei){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),ei){if(!("offset"in ei.options)){const si=Math.abs(13.5)/Math.SQRT2;ei.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[si,-1*(38.1-13.5+si)],"bottom-right":[-si,-1*(38.1-13.5+si)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=ei,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const ei=this._popup;return ei?(ei.isOpen()?ei.remove():ei.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(ei){return this._offset=li.P.convert(ei),this._update(),this}addClassName(ei){this._element.classList.add(ei)}removeClassName(ei){this._element.classList.remove(ei)}toggleClassName(ei){return this._element.classList.toggle(ei)}setDraggable(ei){return this._draggable=!!ei,this._map&&(ei?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(ei){return this._rotation=ei||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(ei){return this._rotationAlignment=ei||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(ei){return this._pitchAlignment=ei&&ei!=="auto"?ei:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Mn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let An=0,Nl=!1;const lc={maxWidth:100,unit:"metric"};function cc(ci,ei,ri){const ni=ri&&ri.maxWidth||100,si=ci._container.clientHeight/2,hi=ci.unproject([0,si]),fi=ci.unproject([ni,si]),_i=hi.distanceTo(fi);if(ri&&ri.unit==="imperial"){const gi=3.2808*_i;gi>5280?yl(ei,ni,gi/5280,ci._getUIString("ScaleControl.Miles")):yl(ei,ni,gi,ci._getUIString("ScaleControl.Feet"))}else ri&&ri.unit==="nautical"?yl(ei,ni,_i/1852,ci._getUIString("ScaleControl.NauticalMiles")):_i>=1e3?yl(ei,ni,_i/1e3,ci._getUIString("ScaleControl.Kilometers")):yl(ei,ni,_i,ci._getUIString("ScaleControl.Meters"))}function yl(ci,ei,ri,ni){const si=function(hi){const fi=Math.pow(10,`${Math.floor(hi)}`.length-1);let _i=hi/fi;return _i=_i>=10?10:_i>=5?5:_i>=3?3:_i>=2?2:_i>=1?1:function(gi){const bi=Math.pow(10,Math.ceil(-Math.log(gi)/Math.LN10));return Math.round(gi*bi)/bi}(_i),fi*_i}(ri);ci.style.width=ei*(si/ri)+"px",ci.innerHTML=`${si}&nbsp;${ni}`}const Bu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ul(ci){if(ci){if(typeof ci=="number"){const ei=Math.round(Math.abs(ci)/Math.SQRT2);return{center:new li.P(0,0),top:new li.P(0,ci),"top-left":new li.P(ei,ei),"top-right":new li.P(-ei,ei),bottom:new li.P(0,-ci),"bottom-left":new li.P(ei,-ei),"bottom-right":new li.P(-ei,-ei),left:new li.P(ci,0),right:new li.P(-ci,0)}}if(ci instanceof li.P||Array.isArray(ci)){const ei=li.P.convert(ci);return{center:ei,top:ei,"top-left":ei,"top-right":ei,bottom:ei,"bottom-left":ei,"bottom-right":ei,left:ei,right:ei}}return{center:li.P.convert(ci.center||[0,0]),top:li.P.convert(ci.top||[0,0]),"top-left":li.P.convert(ci["top-left"]||[0,0]),"top-right":li.P.convert(ci["top-right"]||[0,0]),bottom:li.P.convert(ci.bottom||[0,0]),"bottom-left":li.P.convert(ci["bottom-left"]||[0,0]),"bottom-right":li.P.convert(ci["bottom-right"]||[0,0]),left:li.P.convert(ci.left||[0,0]),right:li.P.convert(ci.right||[0,0])}}return Ul(new li.P(0,0))}const Uu={extend:(ci,...ei)=>li.e(ci,...ei),run(ci){ci()},logToElement(ci,ei=!1,ri="log"){const ni=window.document.getElementById(ri);ni&&(ei&&(ni.innerHTML=""),ni.innerHTML+=`<br>${ci}`)}},Vu=po;class an{static get version(){return Vu}static get workerCount(){return ws.workerCount}static set workerCount(ei){ws.workerCount=ei}static get maxParallelImageRequests(){return li.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(ei){li.c.MAX_PARALLEL_IMAGE_REQUESTS=ei}static get workerUrl(){return li.c.WORKER_URL}static set workerUrl(ei){li.c.WORKER_URL=ei}static addProtocol(ei,ri){li.c.REGISTERED_PROTOCOLS[ei]=ri}static removeProtocol(ei){delete li.c.REGISTERED_PROTOCOLS[ei]}}return an.Map=class extends Uh{constructor(ci){if(li.bg.mark(li.bh.create),(ci=li.e({},Fo,ci)).minZoom!=null&&ci.maxZoom!=null&&ci.minZoom>ci.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(ci.minPitch!=null&&ci.maxPitch!=null&&ci.minPitch>ci.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(ci.minPitch!=null&&ci.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(ci.maxPitch!=null&&ci.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Bc(ci.minZoom,ci.maxZoom,ci.minPitch,ci.maxPitch,ci.renderWorldCopies),{bearingSnap:ci.bearingSnap}),this._cooperativeGesturesOnWheel=ei=>{this._onCooperativeGesture(ei,ei[this._metaKey],1)},this._contextLost=ei=>{ei.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new li.k("webglcontextlost",{originalEvent:ei}))},this._contextRestored=ei=>{this._setupPainter(),this.resize(),this._update(),this.fire(new li.k("webglcontextrestored",{originalEvent:ei}))},this._onMapScroll=ei=>{if(ei.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=ci.interactive,this._cooperativeGestures=ci.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=ci.maxTileCacheSize,this._maxTileCacheZoomLevels=ci.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=ci.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=ci.preserveDrawingBuffer,this._antialias=ci.antialias,this._trackResize=ci.trackResize,this._bearingSnap=ci.bearingSnap,this._refreshExpiredTiles=ci.refreshExpiredTiles,this._fadeDuration=ci.fadeDuration,this._crossSourceCollisions=ci.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=ci.collectResourceTiming,this._renderTaskQueue=new jc,this._controls=[],this._mapId=li.a2(),this._locale=li.e({},Ou,ci.locale),this._clickTolerance=ci.clickTolerance,this._overridePixelRatio=ci.pixelRatio,this._maxCanvasSize=ci.maxCanvasSize,this.transformCameraUpdate=ci.transformCameraUpdate,this._imageQueueHandle=Ln.addThrottleControl(()=>this.isMoving()),this._requestManager=new fs(ci.transformRequest),typeof ci.container=="string"){if(this._container=document.getElementById(ci.container),!this._container)throw new Error(`Container '${ci.container}' not found.`)}else{if(!(ci.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=ci.container}if(ci.maxBounds&&this.setMaxBounds(ci.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let ei=!1;const ri=ml(ni=>{this._trackResize&&!this._removed&&this.resize(ni)._update()},50);this._resizeObserver=new ResizeObserver(ni=>{ei?ri(ni):ei=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Lu(this,ci),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=ci.hash&&new ic(typeof ci.hash=="string"&&ci.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:ci.center,zoom:ci.zoom,bearing:ci.bearing,pitch:ci.pitch}),ci.bounds&&(this.resize(),this.fitBounds(ci.bounds,li.e({},ci.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=ci.localIdeographFontFamily,this._validateStyle=ci.validateStyle,ci.style&&this.setStyle(ci.style,{localIdeographFontFamily:ci.localIdeographFontFamily}),ci.attributionControl&&this.addControl(new Ka({customAttribution:ci.customAttribution})),ci.maplibreLogo&&this.addControl(new gn,ci.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",ei=>{this._update(ei.dataType==="style"),this.fire(new li.k(`${ei.dataType}data`,ei))}),this.on("dataloading",ei=>{this.fire(new li.k(`${ei.dataType}dataloading`,ei))}),this.on("dataabort",ei=>{this.fire(new li.k("sourcedataabort",ei))})}_getMapId(){return this._mapId}addControl(ci,ei){if(ei===void 0&&(ei=ci.getDefaultPosition?ci.getDefaultPosition():"top-right"),!ci||!ci.onAdd)return this.fire(new li.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const ri=ci.onAdd(this);this._controls.push(ci);const ni=this._controlPositions[ei];return ei.indexOf("bottom")!==-1?ni.insertBefore(ri,ni.firstChild):ni.appendChild(ri),this}removeControl(ci){if(!ci||!ci.onRemove)return this.fire(new li.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const ei=this._controls.indexOf(ci);return ei>-1&&this._controls.splice(ei,1),ci.onRemove(this),this}hasControl(ci){return this._controls.indexOf(ci)>-1}calculateCameraOptionsFromTo(ci,ei,ri,ni){return ni==null&&this.terrain&&(ni=this.terrain.getElevationForLngLatZoom(ri,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(ci,ei,ri,ni)}resize(ci){var ei;const ri=this._containerDimensions(),ni=ri[0],si=ri[1],hi=this._getClampedPixelRatio(ni,si);if(this._resizeCanvas(ni,si,hi),this.painter.resize(ni,si,hi),this.painter.overLimit()){const _i=this.painter.context.gl;this._maxCanvasSize=[_i.drawingBufferWidth,_i.drawingBufferHeight];const gi=this._getClampedPixelRatio(ni,si);this._resizeCanvas(ni,si,gi),this.painter.resize(ni,si,gi)}this.transform.resize(ni,si),(ei=this._requestedCameraState)===null||ei===void 0||ei.resize(ni,si);const fi=!this._moving;return fi&&(this.stop(),this.fire(new li.k("movestart",ci)).fire(new li.k("move",ci))),this.fire(new li.k("resize",ci)),fi&&this.fire(new li.k("moveend",ci)),this}_getClampedPixelRatio(ci,ei){const{0:ri,1:ni}=this._maxCanvasSize,si=this.getPixelRatio(),hi=ci*si,fi=ei*si;return Math.min(hi>ri?ri/hi:1,fi>ni?ni/fi:1)*si}getPixelRatio(){var ci;return(ci=this._overridePixelRatio)!==null&&ci!==void 0?ci:devicePixelRatio}setPixelRatio(ci){this._overridePixelRatio=ci,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(ci){return this.transform.setMaxBounds(hn.convert(ci)),this._update()}setMinZoom(ci){if((ci=ci??-2)>=-2&&ci<=this.transform.maxZoom)return this.transform.minZoom=ci,this._update(),this.getZoom()<ci&&this.setZoom(ci),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(ci){if((ci=ci??22)>=this.transform.minZoom)return this.transform.maxZoom=ci,this._update(),this.getZoom()>ci&&this.setZoom(ci),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(ci){if((ci=ci??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(ci>=0&&ci<=this.transform.maxPitch)return this.transform.minPitch=ci,this._update(),this.getPitch()<ci&&this.setPitch(ci),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(ci){if((ci=ci??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(ci>=this.transform.minPitch)return this.transform.maxPitch=ci,this._update(),this.getPitch()>ci&&this.setPitch(ci),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(ci){return this.transform.renderWorldCopies=ci,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(ci){return this._cooperativeGestures=ci,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(ci){return this.transform.locationPoint(li.L.convert(ci),this.style&&this.terrain)}unproject(ci){return this.transform.pointLocation(li.P.convert(ci),this.terrain)}isMoving(){var ci;return this._moving||((ci=this.handlers)===null||ci===void 0?void 0:ci.isMoving())}isZooming(){var ci;return this._zooming||((ci=this.handlers)===null||ci===void 0?void 0:ci.isZooming())}isRotating(){var ci;return this._rotating||((ci=this.handlers)===null||ci===void 0?void 0:ci.isRotating())}_createDelegatedListener(ci,ei,ri){if(ci==="mouseenter"||ci==="mouseover"){let ni=!1;return{layer:ei,listener:ri,delegates:{mousemove:hi=>{const fi=this.getLayer(ei)?this.queryRenderedFeatures(hi.point,{layers:[ei]}):[];fi.length?ni||(ni=!0,ri.call(this,new Wa(ci,this,hi.originalEvent,{features:fi}))):ni=!1},mouseout:()=>{ni=!1}}}}if(ci==="mouseleave"||ci==="mouseout"){let ni=!1;return{layer:ei,listener:ri,delegates:{mousemove:fi=>{(this.getLayer(ei)?this.queryRenderedFeatures(fi.point,{layers:[ei]}):[]).length?ni=!0:ni&&(ni=!1,ri.call(this,new Wa(ci,this,fi.originalEvent)))},mouseout:fi=>{ni&&(ni=!1,ri.call(this,new Wa(ci,this,fi.originalEvent)))}}}}{const ni=si=>{const hi=this.getLayer(ei)?this.queryRenderedFeatures(si.point,{layers:[ei]}):[];hi.length&&(si.features=hi,ri.call(this,si),delete si.features)};return{layer:ei,listener:ri,delegates:{[ci]:ni}}}}on(ci,ei,ri){if(ri===void 0)return super.on(ci,ei);const ni=this._createDelegatedListener(ci,ei,ri);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[ci]=this._delegatedListeners[ci]||[],this._delegatedListeners[ci].push(ni);for(const si in ni.delegates)this.on(si,ni.delegates[si]);return this}once(ci,ei,ri){if(ri===void 0)return super.once(ci,ei);const ni=this._createDelegatedListener(ci,ei,ri);for(const si in ni.delegates)this.once(si,ni.delegates[si]);return this}off(ci,ei,ri){return ri===void 0?super.off(ci,ei):(this._delegatedListeners&&this._delegatedListeners[ci]&&(ni=>{const si=this._delegatedListeners[ci];for(let hi=0;hi<si.length;hi++){const fi=si[hi];if(fi.layer===ei&&fi.listener===ri){for(const _i in fi.delegates)this.off(_i,fi.delegates[_i]);return si.splice(hi,1),this}}})(),this)}queryRenderedFeatures(ci,ei){if(!this.style)return[];let ri;const ni=ci instanceof li.P||Array.isArray(ci),si=ni?ci:[[0,0],[this.transform.width,this.transform.height]];if(ei=ei||(ni?{}:ci)||{},si instanceof li.P||typeof si[0]=="number")ri=[li.P.convert(si)];else{const hi=li.P.convert(si[0]),fi=li.P.convert(si[1]);ri=[hi,new li.P(fi.x,hi.y),fi,new li.P(hi.x,fi.y),hi]}return this.style.queryRenderedFeatures(ri,ei,this.transform)}querySourceFeatures(ci,ei){return this.style.querySourceFeatures(ci,ei)}setStyle(ci,ei){return(ei=li.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},ei)).diff!==!1&&ei.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&ci?(this._diffStyle(ci,ei),this):(this._localIdeographFontFamily=ei.localIdeographFontFamily,this._updateStyle(ci,ei))}setTransformRequest(ci){return this._requestManager.setTransformRequest(ci),this}_getUIString(ci){const ei=this._locale[ci];if(ei==null)throw new Error(`Missing UI string '${ci}'`);return ei}_updateStyle(ci,ei){if(ei.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(ci,ei));const ri=this.style&&ei.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!ci)),ci?(this.style=new ha(this,ei||{}),this.style.setEventedParent(this,{style:this.style}),typeof ci=="string"?this.style.loadURL(ci,ei,ri):this.style.loadJSON(ci,ei,ri),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ha(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(ci,ei){if(typeof ci=="string"){const ri=this._requestManager.transformRequest(ci,bn.Style);li.f(ri,(ni,si)=>{ni?this.fire(new li.j(ni)):si&&this._updateDiff(si,ei)})}else typeof ci=="object"&&this._updateDiff(ci,ei)}_updateDiff(ci,ei){try{this.style.setState(ci,ei)&&this._update(!0)}catch(ri){li.w(`Unable to perform style diff: ${ri.message||ri.error||ri}.  Rebuilding the style from scratch.`),this._updateStyle(ci,ei)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():li.w("There is no style added to the map.")}addSource(ci,ei){return this._lazyInitEmptyStyle(),this.style.addSource(ci,ei),this._update(!0)}isSourceLoaded(ci){const ei=this.style&&this.style.sourceCaches[ci];if(ei!==void 0)return ei.loaded();this.fire(new li.j(new Error(`There is no source with ID '${ci}'`)))}setTerrain(ci){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),ci){const ei=this.style.sourceCaches[ci.source];if(!ei)throw new Error(`cannot load terrain, because there exists no source with ID: ${ci.source}`);for(const ri in this.style._layers){const ni=this.style._layers[ri];ni.type==="hillshade"&&ni.source===ci.source&&li.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new qh(this.painter,ei,ci),this.painter.renderToTexture=new qc(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=ri=>{ri.dataType==="style"?this.terrain.sourceCache.freeRtt():ri.dataType==="source"&&ri.tile&&(ri.sourceId!==ci.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(ri.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new li.k("terrain",{terrain:ci})),this}getTerrain(){var ci,ei;return(ei=(ci=this.terrain)===null||ci===void 0?void 0:ci.options)!==null&&ei!==void 0?ei:null}areTilesLoaded(){const ci=this.style&&this.style.sourceCaches;for(const ei in ci){const ri=ci[ei]._tiles;for(const ni in ri){const si=ri[ni];if(si.state!=="loaded"&&si.state!=="errored")return!1}}return!0}addSourceType(ci,ei,ri){return this._lazyInitEmptyStyle(),this.style.addSourceType(ci,ei,ri)}removeSource(ci){return this.style.removeSource(ci),this._update(!0)}getSource(ci){return this.style.getSource(ci)}addImage(ci,ei,ri={}){const{pixelRatio:ni=1,sdf:si=!1,stretchX:hi,stretchY:fi,content:_i}=ri;if(this._lazyInitEmptyStyle(),!(ei instanceof HTMLImageElement||li.a(ei))){if(ei.width===void 0||ei.height===void 0)return this.fire(new li.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:gi,height:bi,data:Ei}=ei,Ti=ei;return this.style.addImage(ci,{data:new li.R({width:gi,height:bi},new Uint8Array(Ei)),pixelRatio:ni,stretchX:hi,stretchY:fi,content:_i,sdf:si,version:0,userImage:Ti}),Ti.onAdd&&Ti.onAdd(this,ci),this}}{const{width:gi,height:bi,data:Ei}=li.h.getImageData(ei);this.style.addImage(ci,{data:new li.R({width:gi,height:bi},Ei),pixelRatio:ni,stretchX:hi,stretchY:fi,content:_i,sdf:si,version:0})}}updateImage(ci,ei){const ri=this.style.getImage(ci);if(!ri)return this.fire(new li.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const ni=ei instanceof HTMLImageElement||li.a(ei)?li.h.getImageData(ei):ei,{width:si,height:hi,data:fi}=ni;if(si===void 0||hi===void 0)return this.fire(new li.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(si!==ri.data.width||hi!==ri.data.height)return this.fire(new li.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const _i=!(ei instanceof HTMLImageElement||li.a(ei));return ri.data.replace(fi,_i),this.style.updateImage(ci,ri),this}getImage(ci){return this.style.getImage(ci)}hasImage(ci){return ci?!!this.style.getImage(ci):(this.fire(new li.j(new Error("Missing required image id"))),!1)}removeImage(ci){this.style.removeImage(ci)}loadImage(ci,ei){Ln.getImage(this._requestManager.transformRequest(ci,bn.Image),ei)}listImages(){return this.style.listImages()}addLayer(ci,ei){return this._lazyInitEmptyStyle(),this.style.addLayer(ci,ei),this._update(!0)}moveLayer(ci,ei){return this.style.moveLayer(ci,ei),this._update(!0)}removeLayer(ci){return this.style.removeLayer(ci),this._update(!0)}getLayer(ci){return this.style.getLayer(ci)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(ci,ei,ri){return this.style.setLayerZoomRange(ci,ei,ri),this._update(!0)}setFilter(ci,ei,ri={}){return this.style.setFilter(ci,ei,ri),this._update(!0)}getFilter(ci){return this.style.getFilter(ci)}setPaintProperty(ci,ei,ri,ni={}){return this.style.setPaintProperty(ci,ei,ri,ni),this._update(!0)}getPaintProperty(ci,ei){return this.style.getPaintProperty(ci,ei)}setLayoutProperty(ci,ei,ri,ni={}){return this.style.setLayoutProperty(ci,ei,ri,ni),this._update(!0)}getLayoutProperty(ci,ei){return this.style.getLayoutProperty(ci,ei)}setGlyphs(ci,ei={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(ci,ei),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(ci,ei,ri={}){return this._lazyInitEmptyStyle(),this.style.addSprite(ci,ei,ri,ni=>{ni||this._update(!0)}),this}removeSprite(ci){return this._lazyInitEmptyStyle(),this.style.removeSprite(ci),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(ci,ei={}){return this._lazyInitEmptyStyle(),this.style.setSprite(ci,ei,ri=>{ri||this._update(!0)}),this}setLight(ci,ei={}){return this._lazyInitEmptyStyle(),this.style.setLight(ci,ei),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(ci,ei){return this.style.setFeatureState(ci,ei),this._update()}removeFeatureState(ci,ei){return this.style.removeFeatureState(ci,ei),this._update()}getFeatureState(ci){return this.style.getFeatureState(ci)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let ci=0,ei=0;return this._container&&(ci=this._container.clientWidth||400,ei=this._container.clientHeight||300),[ci,ei]}_setupContainer(){const ci=this._container;ci.classList.add("maplibregl-map");const ei=this._canvasContainer=Ki.create("div","maplibregl-canvas-container",ci);this._interactive&&ei.classList.add("maplibregl-interactive"),this._canvas=Ki.create("canvas","maplibregl-canvas",ei),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const ri=this._containerDimensions(),ni=this._getClampedPixelRatio(ri[0],ri[1]);this._resizeCanvas(ri[0],ri[1],ni);const si=this._controlContainer=Ki.create("div","maplibregl-control-container",ci),hi=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(fi=>{hi[fi]=Ki.create("div",`maplibregl-ctrl-${fi} `,si)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=Ki.create("div","maplibregl-cooperative-gesture-screen",this._container);let ci=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(ci=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${ci}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){Ki.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(ci,ei,ri){this._canvas.width=Math.floor(ri*ci),this._canvas.height=Math.floor(ri*ei),this._canvas.style.width=`${ci}px`,this._canvas.style.height=`${ei}px`}_setupPainter(){const ci={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let ei=null;this._canvas.addEventListener("webglcontextcreationerror",ni=>{ei={requestedAttributes:ci},ni&&(ei.statusMessage=ni.statusMessage,ei.type=ni.type)},{once:!0});const ri=this._canvas.getContext("webgl2",ci)||this._canvas.getContext("webgl",ci);if(!ri){const ni="Failed to initialize WebGL";throw ei?(ei.message=ni,new Error(JSON.stringify(ei))):new Error(ni)}this.painter=new fl(ri,this.transform),Lo.testSupport(ri)}_onCooperativeGesture(ci,ei,ri){return!ei&&ri<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(ci){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||ci,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(ci){return this._update(),this._renderTaskQueue.add(ci)}_cancelRenderFrame(ci){this._renderTaskQueue.remove(ci)}_render(ci){const ei=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(ci),this._removed)return;let ri=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const si=this.transform.zoom,hi=li.h.now();this.style.zoomHistory.update(si,hi);const fi=new li.a8(si,{now:hi,fadeDuration:ei,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_i=fi.crossFadingFactor();_i===1&&_i===this._crossFadingFactor||(ri=!0,this._crossFadingFactor=_i),this.style.update(fi)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,ei,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:ei,showPadding:this.showPadding}),this.fire(new li.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,li.bg.mark(li.bh.load),this.fire(new li.k("load"))),this.style&&(this.style.hasTransitions()||ri)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const ni=this._sourcesDirty||this._styleDirty||this._placementDirty;return ni||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new li.k("idle")),!this._loaded||this._fullyLoaded||ni||(this._fullyLoaded=!0,li.bg.mark(li.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var ci;this._hash&&this._hash.remove();for(const ri of this._controls)ri.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ln.removeThrottleControl(this._imageQueueHandle),(ci=this._resizeObserver)===null||ci===void 0||ci.disconnect();const ei=this.painter.context.gl.getExtension("WEBGL_lose_context");ei&&ei.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ki.remove(this._canvasContainer),Ki.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),li.bg.clearMetrics(),this._removed=!0,this.fire(new li.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=li.h.frame(ci=>{li.bg.frame(ci),this._frame=null,this._render(ci)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(ci){this._showTileBoundaries!==ci&&(this._showTileBoundaries=ci,this._update())}get showPadding(){return!!this._showPadding}set showPadding(ci){this._showPadding!==ci&&(this._showPadding=ci,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(ci){this._showCollisionBoxes!==ci&&(this._showCollisionBoxes=ci,ci?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(ci){this._showOverdrawInspector!==ci&&(this._showOverdrawInspector=ci,this._update())}get repaint(){return!!this._repaint}set repaint(ci){this._repaint!==ci&&(this._repaint=ci,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(ci){this._vertices=ci,this._update()}get version(){return Mo}getCameraTargetElevation(){return this.transform.elevation}},an.NavigationControl=class{constructor(ci){this._updateZoomButtons=()=>{const ei=this._map.getZoom(),ri=ei===this._map.getMaxZoom(),ni=ei===this._map.getMinZoom();this._zoomInButton.disabled=ri,this._zoomOutButton.disabled=ni,this._zoomInButton.setAttribute("aria-disabled",ri.toString()),this._zoomOutButton.setAttribute("aria-disabled",ni.toString())},this._rotateCompassArrow=()=>{const ei=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=ei},this._setButtonTitle=(ei,ri)=>{const ni=this._map._getUIString(`NavigationControl.${ri}`);ei.title=ni,ei.setAttribute("aria-label",ni)},this.options=li.e({},ku,ci),this._container=Ki.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",ei=>ei.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",ei=>this._map.zoomIn({},{originalEvent:ei})),Ki.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",ei=>this._map.zoomOut({},{originalEvent:ei})),Ki.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",ei=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:ei}):this._map.resetNorth({},{originalEvent:ei})}),this._compassIcon=Ki.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(ci){return this._map=ci,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Du(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ki.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(ci,ei){const ri=Ki.create("button",ci,this._container);return ri.type="button",ri.addEventListener("click",ei),ri}},an.GeolocateControl=class extends li.E{constructor(ci){super(),this._onSuccess=ei=>{if(this._map){if(this._isOutOfMapMaxBounds(ei))return this._setErrorState(),this.fire(new li.k("outofmaxbounds",ei)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=ei,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(ei),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(ei),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new li.k("geolocate",ei)),this._finish()}},this._updateCamera=ei=>{const ri=new li.L(ei.coords.longitude,ei.coords.latitude),ni=ei.coords.accuracy,si=this._map.getBearing(),hi=li.e({bearing:si},this.options.fitBoundsOptions),fi=hn.fromLngLat(ri,ni);this._map.fitBounds(fi,hi,{geolocateSource:!0})},this._updateMarker=ei=>{if(ei){const ri=new li.L(ei.coords.longitude,ei.coords.latitude);this._accuracyCircleMarker.setLngLat(ri).addTo(this._map),this._userLocationDotMarker.setLngLat(ri).addTo(this._map),this._accuracy=ei.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=ei=>{if(this._map){if(this.options.trackUserLocation)if(ei.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const ri=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=ri,this._geolocateButton.setAttribute("aria-label",ri),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(ei.code===3&&Nl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new li.k("error",ei)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=ei=>{if(this._map){if(this._container.addEventListener("contextmenu",ri=>ri.preventDefault()),this._geolocateButton=Ki.create("button","maplibregl-ctrl-geolocate",this._container),Ki.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",ei===!1){li.w("Geolocation support is not available so the GeolocateControl will be disabled.");const ri=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=ri,this._geolocateButton.setAttribute("aria-label",ri)}else{const ri=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=ri,this._geolocateButton.setAttribute("aria-label",ri)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ki.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new _l({element:this._dotElement}),this._circleElement=Ki.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _l({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",ri=>{ri.geolocateSource||this._watchState!=="ACTIVE_LOCK"||ri.originalEvent&&ri.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new li.k("trackuserlocationend")))})}},this.options=li.e({},Mn,ci)}onAdd(ci){return this._map=ci,this._container=Ki.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(ei,ri=!1){Vn===void 0||ri?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(ni=>{Vn=ni.state!=="denied",ei(Vn)}).catch(()=>{Vn=!!window.navigator.geolocation,ei(Vn)}):(Vn=!!window.navigator.geolocation,ei(Vn)):ei(Vn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ki.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,An=0,Nl=!1}_isOutOfMapMaxBounds(ci){const ei=this._map.getMaxBounds(),ri=ci.coords;return ei&&(ri.longitude<ei.getWest()||ri.longitude>ei.getEast()||ri.latitude<ei.getSouth()||ri.latitude>ei.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const ci=this._map.getBounds(),ei=ci.getSouthEast(),ri=ci.getNorthEast(),ni=ei.distanceTo(ri),si=Math.ceil(this._accuracy/(ni/this._map._container.clientHeight)*2);this._circleElement.style.width=`${si}px`,this._circleElement.style.height=`${si}px`}trigger(){if(!this._setup)return li.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new li.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":An--,Nl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new li.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new li.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let ci;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),An++,An>1?(ci={maximumAge:6e5,timeout:0},Nl=!0):(ci=this.options.positionOptions,Nl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,ci)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},an.AttributionControl=Ka,an.LogoControl=gn,an.ScaleControl=class{constructor(ci){this._onMove=()=>{cc(this._map,this._container,this.options)},this.setUnit=ei=>{this.options.unit=ei,cc(this._map,this._container,this.options)},this.options=li.e({},lc,ci)}getDefaultPosition(){return"bottom-left"}onAdd(ci){return this._map=ci,this._container=Ki.create("div","maplibregl-ctrl maplibregl-ctrl-scale",ci.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ki.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},an.FullscreenControl=class extends li.E{constructor(ci={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,ci&&ci.container&&(ci.container instanceof HTMLElement?this._container=ci.container:li.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(ci){return this._map=ci,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ki.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Ki.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const ci=this._fullscreenButton=Ki.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Ki.create("span","maplibregl-ctrl-icon",ci).setAttribute("aria-hidden","true"),ci.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const ci=this._getTitle();this._fullscreenButton.setAttribute("aria-label",ci),this._fullscreenButton.title=ci}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new li.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new li.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},an.TerrainControl=class{constructor(ci){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=ci}onAdd(ci){return this._map=ci,this._container=Ki.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ki.create("button","maplibregl-ctrl-terrain",this._container),Ki.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ki.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},an.Popup=class extends li.E{constructor(ci){super(),this.remove=()=>(this._content&&Ki.remove(this._content),this._container&&(Ki.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new li.k("close")),this),this._onMouseUp=ei=>{this._update(ei.point)},this._onMouseMove=ei=>{this._update(ei.point)},this._onDrag=ei=>{this._update(ei.point)},this._update=ei=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Ki.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Ki.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const fi of this.options.className.split(" "))this._container.classList.add(fi);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fu(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!ei)return;const ri=this._pos=this._trackPointer&&ei?ei:this._map.project(this._lngLat);let ni=this.options.anchor;const si=Ul(this.options.offset);if(!ni){const fi=this._container.offsetWidth,_i=this._container.offsetHeight;let gi;gi=ri.y+si.bottom.y<_i?["top"]:ri.y>this._map.transform.height-_i?["bottom"]:[],ri.x<fi/2?gi.push("left"):ri.x>this._map.transform.width-fi/2&&gi.push("right"),ni=gi.length===0?"bottom":gi.join("-")}const hi=ri.add(si[ni]).round();Ki.setTransform(this._container,`${hs[ni]} translate(${hi.x}px,${hi.y}px)`),Gh(this._container,ni,"popup")},this._onClose=()=>{this.remove()},this.options=li.e(Object.create(Bu),ci)}addTo(ci){return this._map&&this.remove(),this._map=ci,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new li.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(ci){return this._lngLat=li.L.convert(ci),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(ci){return this.setDOMContent(document.createTextNode(ci))}setHTML(ci){const ei=document.createDocumentFragment(),ri=document.createElement("body");let ni;for(ri.innerHTML=ci;ni=ri.firstChild,ni;)ei.appendChild(ni);return this.setDOMContent(ei)}getMaxWidth(){var ci;return(ci=this._container)===null||ci===void 0?void 0:ci.style.maxWidth}setMaxWidth(ci){return this.options.maxWidth=ci,this._update(),this}setDOMContent(ci){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ki.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(ci),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(ci){this._container&&this._container.classList.add(ci)}removeClassName(ci){this._container&&this._container.classList.remove(ci)}setOffset(ci){return this.options.offset=ci,this._update(),this}toggleClassName(ci){if(this._container)return this._container.classList.toggle(ci)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ki.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const ci=this._container.querySelector(Nu);ci&&ci.focus()}},an.Marker=_l,an.Style=ha,an.LngLat=li.L,an.LngLatBounds=hn,an.Point=li.P,an.MercatorCoordinate=li.U,an.Evented=li.E,an.AJAXError=li.bi,an.config=li.c,an.CanvasSource=bs,an.GeoJSONSource=os,an.ImageSource=La,an.RasterDEMTileSource=Xs,an.RasterTileSource=Ls,an.VectorTileSource=Bn,an.VideoSource=Os,an.setRTLTextPlugin=li.bj,an.getRTLTextPluginStatus=li.bk,an.prewarm=function(){mc().acquire(tn)},an.clearPrewarmedResources=function(){const ci=Ds;ci&&(ci.isPreloaded()&&ci.numActive()===1?(ci.release(tn),Ds=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Uu.extend(an,{isSafari:li.ac,getPerformanceMetrics:li.bg.getPerformanceMetrics}),an});var Qr=Oi;return Qr})})(maplibreGl);var maplibreGlExports=maplibreGl.exports;const style$1={version:8,name:"PLAN IGN",metadata:{"maputnik:renderer":"mbgljs"},sources:{plan_ign:{type:"vector",tiles:["https://data.geopf.fr/tms/1.0.0/PLAN.IGN/{z}/{x}/{y}.pbf"]},parc_elec:{type:"vector",url:"http://localhost:8080/capabilities/parc-elec.json?debug=true"}},glyphs:"https://data.geopf.fr/annexes/ressources/vectorTiles/fonts/{fontstack}/{range}.pbf",sprite:"https://data.geopf.fr/annexes/ressources/vectorTiles/styles/PLAN.IGN/sprite/PlanIgn-Gris",transition:{duration:300,delay:0},layers:[],id:"6lc64jimd"},ignLayers=[{id:"bckgrd",type:"fill",source:"plan_ign","source-layer":"fond_opaque",minzoom:0,layout:{visibility:"visible"},paint:{"fill-color":"#ffffff","fill-opacity":1}},{id:"orographie : relief - 0m",type:"fill",source:"plan_ign","source-layer":"oro_relief",minzoom:0,layout:{visibility:"visible"},filter:["==","symbo","HYPSO_0"],paint:{"fill-color":"#fafafa","fill-opacity":1}},{id:"orographie : relief - 100m",type:"fill",source:"plan_ign","source-layer":"oro_relief",minzoom:0,layout:{visibility:"visible"},filter:["==","symbo","HYPSO_100"],paint:{"fill-color":"#fafafa","fill-opacity":1}},{id:"orographie : relief - 200m",type:"fill",source:"plan_ign","source-layer":"oro_relief",minzoom:0,layout:{visibility:"visible"},filter:["==","symbo","HYPSO_200"],paint:{"fill-color":"#fafafa","fill-opacity":1}},{id:"orographie : relief - 1000m",type:"fill",source:"plan_ign","source-layer":"oro_relief",minzoom:0,layout:{visibility:"visible"},filter:["==","symbo","HYPSO_1000"],paint:{"fill-color":"#d6d6d6","fill-opacity":1}},{id:"orographie : relief - 3000m",type:"fill",source:"plan_ign","source-layer":"oro_relief",minzoom:0,layout:{visibility:"visible"},filter:["==","symbo","HYPSO_3000"],paint:{"fill-color":"#d6d6d6","fill-opacity":1}},{id:"orographie : relief - 4000m",type:"fill",source:"plan_ign","source-layer":"oro_relief",minzoom:0,layout:{visibility:"visible"},filter:["==","symbo","HYPSO_4000"],paint:{"fill-color":"#bbbbbb","fill-opacity":1}},{id:"orographie : relief - 5000m",type:"fill",source:"plan_ign","source-layer":"oro_relief",minzoom:0,layout:{visibility:"visible"},filter:["==","symbo","HYPSO_5000"],paint:{"fill-color":"#bbbbbb","fill-opacity":1}},{id:"orographie : relief - glacier",type:"fill",source:"plan_ign","source-layer":"oro_relief",minzoom:0,layout:{visibility:"visible"},filter:["==","symbo","GLACIER"],paint:{"fill-color":"#ffffff","fill-opacity":.7}},{id:"ocs - vegetation - zone boiséee, foret fermee, peupleraie",type:"fill",source:"plan_ign","source-layer":"ocs_vegetation_surf",layout:{visibility:"visible"},filter:["in","symbo","ZONE_BOISEE","ZONE_FORET_FERMEE_FEUIL","ZONE_FORET_FERMEE_CONI","ZONE_FORET_FERMEE_MIXTE","ZONE_PEUPLERAIE"],paint:{"fill-color":"#f0f0f0","fill-outline-color":"#f0f0f0"}},{id:"ocs - vegetation - forêt ouverte",type:"fill",source:"plan_ign","source-layer":"ocs_vegetation_surf",layout:{visibility:"visible"},filter:["in","symbo","ZONE_FORET_OUVERTE"],paint:{"fill-color":"#f0f0f0","fill-outline-color":"#f0f0f0"}},{id:"ocs - vegetation - lande ligneuse",type:"fill",source:"plan_ign","source-layer":"ocs_vegetation_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_LANDE_LIGNEUSE"],paint:{"fill-color":"#f0f0f0"}},{id:"ocs - vegetation - vigne",type:"fill",source:"plan_ign","source-layer":"ocs_vegetation_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_VIGNE"],paint:{"fill-color":"#f0f0f0"}},{id:"ocs - vegetation - verger",type:"fill",source:"plan_ign","source-layer":"ocs_vegetation_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_VERGER"],paint:{"fill-color":"#f0f0f0"}},{id:"ocs - vegetation - canne à sucre, bananeraie",type:"fill",source:"plan_ign","source-layer":"ocs_vegetation_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_CANNE_BANANE"],paint:{"fill-color":"#f1f1f1"}},{id:"hydro surfacique - Estran",type:"fill",source:"plan_ign","source-layer":"hydro_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_D_ESTRAN"],paint:{"fill-color":"#e7e7e7","fill-outline-color":"#e7e7e7"}},{id:"ocs - vegetation - mangrovre",type:"fill",source:"plan_ign","source-layer":"ocs_vegetation_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_MANGROVE"],paint:{"fill-color":{stops:[[9,"#c0c0c0"],[10,"#c1c1c1"]]}}},{id:"ocs - vegetation - marais",type:"fill",source:"plan_ign","source-layer":"ocs_vegetation_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_MARAIS"],paint:{"fill-color":"#ededed"}},{id:"hydro surfacique - marais",type:"fill",source:"plan_ign","source-layer":"hydro_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_MARAIS"],paint:{"fill-pattern":"Marais"}},{id:"ocs - vegetation - marais salant",type:"fill",source:"plan_ign","source-layer":"ocs_vegetation_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_MARAIS_SALANT"],paint:{"fill-color":"#e4e4e4"}},{id:"ocs - Zone sable sec",type:"fill",source:"plan_ign","source-layer":"ocs_nature_sol_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_SABLE_SEC"],paint:{"fill-color":"#fcfcfc"}},{id:"ocs - Zone sable humide",type:"fill",source:"plan_ign","source-layer":"ocs_nature_sol_surf",layout:{visibility:"visible"},filter:["in","symbo","ZONE_SABLE_HUMIDE","FOND_CUVETTE_HUMIDE"],paint:{"fill-color":"#ebebeb"}},{id:"ocs - Zone graviers galets secs",type:"fill",source:"plan_ign","source-layer":"ocs_nature_sol_surf",layout:{visibility:"visible"},filter:["==","symbo","GRAVIERS_GALETS_SEC"],paint:{"fill-color":"#efefef"}},{id:"ocs - Zone graviers galets humides",type:"fill",source:"plan_ign","source-layer":"ocs_nature_sol_surf",layout:{visibility:"visible"},filter:["==","symbo","GRAVIERS_GALETS_HUM"],paint:{"fill-color":"#e5e5e5"}},{id:"ocs - Zone rocher hydro",type:"fill",source:"plan_ign","source-layer":"ocs_nature_sol_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_ROCHER_HYDRO"],paint:{"fill-color":"#e0e0e0"}},{id:"ocs - Zone glacier",type:"fill",source:"plan_ign","source-layer":"ocs_nature_sol_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_GLACIER"],paint:{"fill-pattern":"Glacier","fill-opacity":{stops:[[10,.5],[12,.3]]}}},{id:"zone batie",type:"fill",source:"plan_ign","source-layer":"bati_zone_surf",minzoom:7,maxzoom:15,layout:{visibility:"visible"},filter:["==","symbo","ZONE_BATI"],paint:{"fill-color":"#ebebeb","fill-opacity":{stops:[[12,1],[13,1],[14,1]]}}},{id:"zone d'activité",type:"fill",source:"plan_ign","source-layer":"bati_zone_surf",layout:{visibility:"visible"},filter:["==","symbo","ZONE_INDUS_ACTI"],paint:{"fill-color":"#ebebeb"}},{id:"hydro surfacique",type:"fill",source:"plan_ign","source-layer":"hydro_surf",layout:{visibility:"visible"},filter:["in","symbo","SURFACE_D_EAU","BASSIN","ZONE_MARINE"],paint:{"fill-color":"#e1e1e1","fill-outline-color":"#e1e1e1"}},{id:"hydro surfacique temporaire",type:"fill",source:"plan_ign","source-layer":"hydro_surf",layout:{visibility:"visible"},filter:["==","symbo","SURFACE_D_EAU_TEMP"],paint:{"fill-color":"rgba(233,233,233,0.5)"}},{id:"réseau hydro  - cours d'eau souterrain",type:"line",source:"plan_ign","source-layer":"hydro_reseau_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","COURS_D_EAU_SOU","COURS_D_EAU_MOY_SOU"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,1.5],[17,6.5]]},"line-dasharray":[2,2]}},{id:"réseau hydro - filet interieur - aqueduc souterrain",type:"line",source:"plan_ign","source-layer":"hydro_reseau_sou",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","AQUEDUC_SOU"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,1.4],[16,3.5],[17,5.9]]},"line-dasharray":[2,2]}},{id:"réseau hydro - carre - aqueduc souterrain",type:"line",source:"plan_ign","source-layer":"hydro_reseau_sou",minzoom:12,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","AQUEDUC_SOU"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,3.5],[16,8.7],[17,14.7]]},"line-dasharray":[1,5]}},{id:"Ferre souterrain - voie normale",type:"line",source:"plan_ign","source-layer":"ferre_sou",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","VF_1_SOU","VF_2_SOU","VF_3_SOU","VF_4_SOU","VF_ELEC_1_SOU","VF_ELEC_2_SOU","VF_ELEC_3_SOU","VF_ELEC_4_SOU","VF_FERRO_ROUTIER_SOU"],paint:{"line-color":"#bebebe","line-width":{stops:[[10,.8],[17,2.5]]}}},{id:"Ferre souterrain - trait perpendic épais",type:"line",source:"plan_ign","source-layer":"ferre_sou",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","VF_1_SOU","VF_2_SOU","VF_3_SOU","VF_4_SOU","VF_ELEC_1_SOU","VF_ELEC_2_SOU","VF_ELEC_3_SOU","VF_ELEC_4_SOU","VF_FERRO_ROUTIER_SOU"],paint:{"line-color":"#bebebe","line-width":{stops:[[10,3.5],[17,14.7]]},"line-dasharray":[.1,10]}},{id:"Ferre souterrain - voie etroite",type:"line",source:"plan_ign","source-layer":"ferre_sou",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","VF_ETROITE_1_SOU","VF_ETROITE_2_SOU","VF_ETROITE_SOU"],paint:{"line-color":"#bebebe","line-width":{stops:[[10,.3],[17,1.8]]}}},{id:"Ferre souterrain - trait perpendic fin",type:"line",source:"plan_ign","source-layer":"ferre_sou",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","VF_ETROITE_1_SOU","VF_ETROITE_2_SOU","VF_ETROITE_SOU"],paint:{"line-color":"#bebebe","line-width":{stops:[[10,3.5],[17,14.7]]},"line-dasharray":[.1,10]}},{id:"Ferre souterrain - voie service",type:"line",source:"plan_ign","source-layer":"ferre_sou",minzoom:14,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","VF_SERVICE_SOU","VF_NON_EXPLOITEE_SOU"],paint:{"line-color":"#bebebe","line-width":{stops:[[10,.3],[17,1.8]]},"line-dasharray":[5,2,1,2]}},{id:"Ferre souterrain - funic/urbain",type:"line",source:"plan_ign","source-layer":"ferre_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","FUNI_CREMAILLERE_SOU","TRANSPORT_URBAIN_SOU"],paint:{"line-color":"#bebebe","line-width":{stops:[[10,.3],[17,1.8]]}}},{id:"Ferre souterrain - 2 trait perpendic - funic/urbain",type:"line",source:"plan_ign","source-layer":"ferre_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","FUNI_CREMAILLERE_SOU","TRANSPORT_URBAIN_SOU"],paint:{"line-color":"#bebebe","line-width":{stops:[[10,3.5],[17,17]]},"line-dasharray":[.1,.2,.1,10]}},{id:"Chemin souterrain - filet exterieur - escalier",type:"line",source:"plan_ign","source-layer":"routier_chemin_sou",minzoom:14,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","ESCALIER_SOU"],paint:{"line-color":"#c3c3c3","line-width":{stops:[[14,1.75],[15,3],[16,4.2],[17,9.5]]}}},{id:"Chemin souterrain - filet interieur - escalier",type:"line",source:"plan_ign","source-layer":"routier_chemin_sou",minzoom:14,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","ESCALIER_SOU"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,1],[15,1.9],[16,2.7],[17,5.8]]},"line-dasharray":[1,.2]}},{id:"Chemin souterrain - Rue pietonne",type:"line",source:"plan_ign","source-layer":"routier_chemin_sou",minzoom:14,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","RUE_PIETONNE_SOU"],paint:{"line-color":"#c3c3c3","line-width":{stops:[[14,1],[15,1.2],[16,1.4],[17,2]]},"line-dasharray":[1,3]}},{id:"Chemin souterrain - sentier",type:"line",source:"plan_ign","source-layer":"routier_chemin_sou",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","SENTIER_SOU"],paint:{"line-color":"#c3c3c3","line-width":{stops:[[14,1],[15,1.2],[16,1.4],[17,2]]},"line-dasharray":[4,3]}},{id:"Chemin souterrain - chemin",type:"line",source:"plan_ign","source-layer":"routier_chemin_sou",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","CHEMIN_SOU"],paint:{"line-color":"#c3c3c3","line-width":{stops:[[14,1],[15,1.2],[16,1.4],[17,2]]}}},{id:"Routier souterrain - filet extérieur - route non revetu carrosable",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","NON_REVETUE_CARRO_SOU"],paint:{"line-color":"#afafaf","line-width":{stops:[[14,3.2],[15,5.4],[16,7.7],[17,16.8]]},"line-dasharray":[2,2]}},{id:"Routier souterrain - filet extérieur - bretelle autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_AUTO_PEAGE_3_SOU","BRET_AUTO_PEAGE_2_SOU","BRET_AUTO_PEAGE_1_SOU","BRET_AUTO_LIBRE_3_SOU","BRET_AUTO_LIBRE_2_SOU","BRET_AUTO_LIBRE_1_SOU"],paint:{"line-color":"rgba(182,182,182,0.5)","line-width":{stops:[[12,2.5],[14,3.7],[15,6.8],[16,8.4],[17,14]]}}},{id:"Routier souterrain - filet extérieur - route non classee restreint",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","NON_CLASSEE_RESTREINT_SOU"],paint:{"line-color":"#afafaf","line-width":{stops:[[14,3.2],[15,5.4],[16,7.7],[17,16.8]]}}},{id:"Routier souterrain - filet extérieur - route non classee",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","NON_CLASSEE_4_SOU","NON_CLASSEE_SOU"],paint:{"line-color":"#afafaf","line-width":{stops:[[14,3.2],[15,5.4],[16,7.7],[17,16.8]]}}},{id:"Routier souterrain - filet extérieur - route locale",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_LOCALE_SOU","LOCALE_4_SOU","LOCALE_3_SOU","LOCALE_2_SOU","LOCALE_1_SOU"],paint:{"line-color":"rgba(130,130,130,0.5)","line-width":{stops:[[9,2],[14,3.5],[15,6],[16,8.4],[17,18.3]]}}},{id:"Routier souterrain - filet extérieur - route locale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:11,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","LOCALE_CONSTR_SOU"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[9,2],[14,3.5],[15,6],[16,8.4],[17,18.3]]}}},{id:"Routier souterrain - filet extérieur - route regionale",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_REGIONALE_SOU","REGIONALE_4_SOU","REGIONALE_3_SOU","REGIONALE_2_SOU","REGIONALE_1_SOU"],paint:{"line-color":"rgba(130,130,130,0.5)","line-width":{stops:[[6,1.5],[9,2.3],[14,5],[15,8.1],[16,11.2],[17,22]]}}},{id:"Routier souterrain - filet extérieur - route regionale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","REGIONALE_CONSTR_SOU"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[6,1.5],[9,2.3],[14,5],[15,8.1],[16,11.2],[17,22]]}}},{id:"Routier souterrain - filet extérieur - route principale",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:7,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_PRINCIPALE_SOU","PRINCIPALE_4_SOU","PRINCIPALE_3_SOU","PRINCIPALE_2_SOU","PRINCIPALE_1_SOU"],paint:{"line-color":"rgba(183,183,183,0.5)","line-width":{stops:[[6,1.8],[9,2.7],[14,5.9],[15,9],[16,12.2],[17,22.5]]}}},{id:"Routier souterrain - filet extérieur - route principale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","PRINCIPALE_CONSTR_SOU"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[6,1.8],[9,2.7],[14,5.9],[15,9],[16,12.2],[17,22.5]]}}},{id:"Routier souterrain - filet extérieur - autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:7,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","AUTOROU_PEAGE_SOU","AUTOROU_LIBRE_SOU"],paint:{"line-color":"rgba(182,182,182,0.5)","line-width":{stops:[[6,2.5],[9,3.5],[14,7.5],[15,11],[16,15],[17,26]]}}},{id:"Routier souterrain - filet extérieur - autoroute en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","AUTOROU_CONSTR_SOU"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[6,2.5],[9,3.5],[14,7.5],[15,11],[16,15],[17,26]]}}},{id:"Routier souterrain - filet interieur - route non revetu carrosable",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","NON_REVETUE_CARRO_SOU"],paint:{"line-color":"#dcdcdc","line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5]]}}},{id:"Routier souterrain - filet interieur - bretelle autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_AUTO_PEAGE_3_SOU","BRET_AUTO_PEAGE_2_SOU","BRET_AUTO_PEAGE_1_SOU","BRET_AUTO_LIBRE_3_SOU","BRET_AUTO_LIBRE_2_SOU","BRET_AUTO_LIBRE_1_SOU"],paint:{"line-color":"rgba(255,255,255,0.5)","line-width":{stops:[[12,1.5],[14,2.6],[15,5.2],[16,6.7],[17,10.8]]}}},{id:"Routier souterrain - filet interieur - route non classee restreint",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","NON_CLASSEE_RESTREINT_SOU"],paint:{"line-color":"#dcdcdc","line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5]]}}},{id:"Routier souterrain - filet interieur - route non classee",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","NON_CLASSEE_4_SOU","NON_CLASSEE_SOU"],paint:{"line-color":"#dcdcdc","line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5]]}}},{id:"Routier souterrain - filet interieur - route locale",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_LOCALE_SOU","LOCALE_4_SOU","LOCALE_3_SOU","LOCALE_2_SOU","LOCALE_1_SOU"],paint:{"line-color":"rgba(255,255,255,0.5)","line-width":{stops:[[9,1.3],[14,2.3],[15,4.1],[16,6.1],[17,13.1]]}}},{id:"Routier souterrain - filet interieur - route locale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:11,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","LOCALE_CONSTR_SOU"],paint:{"line-color":{stops:[[12,"#ffffff"],[13,"#eeead2"],[17,"#eeead2"]]},"line-width":{stops:[[9,2],[14,3.5],[15,6],[16,8.4],[17,18.3]]},"line-dasharray":[2,2]}},{id:"Routier souterrain - filet interieur - route regionale",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_REGIONALE_SOU","REGIONALE_4_SOU","REGIONALE_3_SOU","REGIONALE_2_SOU","REGIONALE_1_SOU"],paint:{"line-color":"rgba(255,255,255,0.5)","line-width":{stops:[[6,1.4],[9,1.5],[14,3.2],[15,5.8],[16,8.3],[17,16.2]]}}},{id:"Routier souterrain - filet interieur - route regionale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","REGIONALE_CONSTR_SOU"],paint:{"line-color":{stops:[[9,"#ffffff"],[10,"#eeead2"],[17,"#eeead2"]]},"line-width":{stops:[[4,.4],[6,1.5],[9,2.3],[14,5],[15,8.1],[16,11.2],[17,22]]},"line-dasharray":[2,2]}},{id:"Routier souterrain - filet interieur - route principale",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_PRINCIPALE_SOU","PRINCIPALE_4_SOU","PRINCIPALE_3_SOU","PRINCIPALE_2_SOU","PRINCIPALE_1_SOU"],paint:{"line-color":"rgba(255,255,255,0.5)","line-width":{stops:[[4,.5],[6,1.8],[9,2.1],[14,4.4],[15,7.3],[16,10],[17,18.5]]}}},{id:"Routier souterrain - filet interieur - route principale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","PRINCIPALE_CONSTR_SOU"],paint:{"line-color":{stops:[[9,"#c7b9af"],[17,"#c7b9af"]]},"line-width":{stops:[[4,.5],[6,1.8],[9,2.7],[14,5.9],[15,9],[16,12.2],[17,22.5]]},"line-dasharray":[2,2]}},{id:"Routier souterrain - filet interieur - autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sou",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","AUTOROU_PEAGE_SOU","AUTOROU_LIBRE_SOU"],paint:{"line-color":"rgba(255,255,255,0.5)","line-width":{stops:[[4,.7],[6,2.5],[9,2.7],[14,5.8],[15,9],[16,12],[17,20.8]]}}},{id:"Routier souterrain - axe central - autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","AUTOROU_PEAGE_SOU","AUTOROU_LIBRE_SOU"],paint:{"line-color":"#ffffff","line-width":{stops:[[9,.6],[14,.7],[15,1],[16,1.2],[17,2.1]]}}},{id:"Routier souterrain - filet interieur - autoroute en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","AUTOROU_CONSTR_SOU"],paint:{"line-color":{stops:[[9,"#c8c8c8"],[17,"#c8c8c8"]]},"line-width":{stops:[[4,.7],[6,2.5],[9,3.5],[14,7.5],[15,11],[16,15],[17,26]]},"line-dasharray":[2,2]}},{id:"Routier souterrain - axe central - autoroute en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sou",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","AUTOROU_CONSTR_SOU"],paint:{"line-color":"#808080","line-width":{stops:[[9,.6],[14,.7],[15,1],[16,1.2],[17,2.1]]}}},{id:"réseau hydro - cours d'eau temporaire",type:"line",source:"plan_ign","source-layer":"hydro_reseau",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","COURS_D_EAU_TEMP","COURS_D_EAU_TEMP_MOY"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,1.5],[17,4]]},"line-dasharray":[6,2]}},{id:"réseau hydro - cours d'eau",type:"line",source:"plan_ign","source-layer":"hydro_reseau",minzoom:3,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","COURS_D_EAU"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[4,.3],[7,1.5],[12,1.5],[17,6.5]]}}},{id:"réseau hydro - canal",type:"line",source:"plan_ign","source-layer":"hydro_reseau",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","CANAL"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,1.4],[17,5.9]]}}},{id:"réseau hydro - filet interieur - aqueduc",type:"line",source:"plan_ign","source-layer":"hydro_reseau",minzoom:12,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","AQUEDUC_AU_SOL"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,1.4],[16,3.5],[17,5.9]]}}},{id:"réseau hydro - carre - aqueduc",type:"line",source:"plan_ign","source-layer":"hydro_reseau",minzoom:12,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","AQUEDUC_AU_SOL"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,3.5],[16,8.7],[17,14.7]]},"line-dasharray":[1,5]}},{id:"réseau hydro - cours d'eau moyen ",type:"line",source:"plan_ign","source-layer":"hydro_reseau",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","COURS_D_EAU_MOY"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[7,2],[12,2.5]]}}},{id:"réseau hydro - cours d'eau large ",type:"line",source:"plan_ign","source-layer":"hydro_reseau",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","COURS_D_EAU_LAR"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[7,3],[11,5]]}}},{id:"parcellaire - parcelle surface",type:"fill",source:"plan_ign","source-layer":"parcellaire_parcelle",layout:{visibility:"visible"},filter:["==","symbo","PARCELLE"],paint:{"fill-color":"#fcfcfc","fill-opacity":.7}},{id:"cimetiere surfacique 1",type:"fill",source:"plan_ign","source-layer":"bati_surf",layout:{visibility:"visible"},filter:["in","symbo","CIMETIERE_SURF","CIMETIERE_MILI_SURF","NECROPOLE_NATIONALE"],paint:{"fill-color":"#e6e6e6","fill-opacity":.5,"fill-outline-color":"#818181"}},{id:"bati surfacique mairie - Zoom 15,16,17,18",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["in","symbo","MAIRIE","MAIRIE_ANNEXE"],paint:{"fill-color":{stops:[[14,"#e5e5e5"],[15,"#e5e5e5"]]},"fill-outline-color":"#e7e7e7"}},{id:"bati surfacique fonctionnel industriel ou commercial - Zoom 16,17,18",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["in","symbo","BATI_COMMERCIAL","BATI_INDUSTRIEL","HANGAR","HANGAR_COMMERCIAL","HANGAR_INDUSTRIEL"],paint:{"fill-color":{stops:[[15,"#e2e2e2"],[16,"#e2e2e2"]]},"fill-outline-color":"#dcdcdc"}},{id:"bati surfacique fonctionnel public - Zoom 16,17,18",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["in","symbo","BATI_PUBLIC","HANGAR_PUBLIC"],paint:{"fill-color":{stops:[[15,"#e2e2e2"],[16,"#e2e2e2"]]},"fill-outline-color":"#dedede"}},{id:"bati surfacique fonctionnel sportif - bordure",type:"line",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","BATI_SPORTIF"],paint:{"line-color":"#dedede","line-width":4}},{id:"bati surfacique fonctionnel sportif",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["==","symbo","BATI_SPORTIF"],paint:{"fill-color":{stops:[[14,"#e2e2e2"],[15,"#e2e2e2"]]}}},{id:"bati surfacique fonctionnel gare - Zoom 16,17,18",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["==","symbo","BATI_GARE"],paint:{"fill-color":{stops:[[15,"#e2e2e2"],[16,"#e2e2e2"]]},"fill-outline-color":"#dcdcdc"}},{id:"bati surfacique quelconque - Zoom 16,17,18",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["==","symbo","BATI_QQUE"],paint:{"fill-color":{stops:[[15,"#e2e2e2"],[16,"#e2e2e2"]]},"fill-outline-color":"#dedede"}},{id:"bati infra surfacique - Silo",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["==","symbo","SILO_SURF"],paint:{"fill-color":"#e2e2e2","fill-outline-color":"#dcdcdc"}},{id:"bati infra surfacique - Serre",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["in","symbo","SERRE_SURF"],paint:{"fill-color":"#e2e2e2","fill-outline-color":"#dcdcdc"}},{id:"bati religieux surfacique - Zoom 15,16,17,18",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["in","symbo","CHAPELLE_SURF","EGLISE_SURF","CHRETIEN_SURF","SYNAGOGUE_SURF","MOSQUEE_SURF","AUTRE_CULTE_SURF","RELIGIEUX_QQUE"],paint:{"fill-color":{stops:[[14,"#e2e2e2"],[15,"#e2e2e2"]]},"fill-outline-color":{stops:[[14,"#dedede"],[15,"#dedede"]]}}},{id:"bati remarquable surfacique",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["in","symbo","FORTIF_SURF","CHATEAU_SURF","TOUR_MOULIN_SURF","ARENE_THEATRE","ARC_TRIOMPHE_SURF","MONUMENT_SURF"],paint:{"fill-color":"#e2e2e2","fill-outline-color":"#dedede"}},{id:"bati transport surfacique - piste",type:"fill",source:"plan_ign","source-layer":"bati_surf",layout:{visibility:"visible"},filter:["in","symbo","PISTE_DUR","PISTE_HERBE"],paint:{"fill-color":"#e2e2e2","fill-outline-color":"#dcdcdc"}},{id:"construction hydrographique linéaire - Quai",type:"line",source:"plan_ign","source-layer":"bati_lin",minzoom:12,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","QUAI","DIGUE"],paint:{"line-color":"#a0a0a0","line-width":{stops:[[14,1],[17,2.5]]}}},{id:"Chemin a niveau - filet exterieur - escalier",type:"line",source:"plan_ign","source-layer":"routier_chemin",minzoom:14,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","ESCALIER"],paint:{"line-color":{stops:[[17,"#c3c3c3"],[18,"#c8c8c8"]]},"line-width":{stops:[[14,1.75],[15,3],[16,4.2],[17,9.5]]}}},{id:"Chemin a niveau - filet interieur - escalier",type:"line",source:"plan_ign","source-layer":"routier_chemin",minzoom:14,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","ESCALIER"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,1],[15,1.9],[16,2.7],[17,5.8]]},"line-dasharray":[1,.2]}},{id:"Chemin a niveau - Rue pietonne",type:"line",source:"plan_ign","source-layer":"routier_chemin",minzoom:14,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","RUE_PIETONNE"],paint:{"line-color":{stops:[[17,"#c3c3c3"],[18,"#e8e8e8"]]},"line-width":{stops:[[14,1],[15,1.2],[16,1.4],[17,2],[18,5]]},"line-dasharray":[1,3]}},{id:"Chemin a niveau - sentier",type:"line",source:"plan_ign","source-layer":"routier_chemin",minzoom:13,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","SENTIER"],paint:{"line-color":{stops:[[17,"#c3c3c3"],[18,"#ffffff"]]},"line-width":{stops:[[14,1],[15,1.2],[16,1.4],[17,2],[18,6]]},"line-dasharray":[4,3]}},{id:"Chemin a niveau - chemin",type:"line",source:"plan_ign","source-layer":"routier_chemin",minzoom:12,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","CHEMIN"],paint:{"line-color":{stops:[[17,"#c3c3c3"],[18,"#ffffff"]]},"line-width":{stops:[[14,1],[15,1.2],[16,1.4],[17,2],[18,7]]}}},{id:"Routier a niveau - filet extérieur - route non revetu carrosable",type:"line",source:"plan_ign","source-layer":"routier_route",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","NON_REVETUE_CARRO"],paint:{"line-color":{stops:[[12,"#c3c3c3"],[17,"#c3c3c3"]]},"line-width":{stops:[[14,3.2],[15,5.4],[16,7.7],[17,16.8]]},"line-dasharray":[2,2]}},{id:"Routier a niveau - filet interieur - route non revetu carrosable",type:"line",source:"plan_ign","source-layer":"routier_route",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","NON_REVETUE_CARRO"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5],[18,16.8]]}}},{id:"Routier a niveau - filet extérieur - bretelle autoroute",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:12,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_AUTO_PEAGE_3","BRET_AUTO_PEAGE_2","BRET_AUTO_PEAGE_1","BRET_AUTO_LIBRE_3","BRET_AUTO_LIBRE_2","BRET_AUTO_LIBRE_1"],paint:{"line-color":{stops:[[9,"#b6b6b6"],[17,"#b6b6b6"],[18,"#ffffff"]]},"line-width":{stops:[[12,2.5],[14,3.7],[15,6.8],[16,8.4],[17,14]]}}},{id:"Routier a niveau - filet extérieur - route non classee restreint",type:"line",source:"plan_ign","source-layer":"routier_route",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","NON_CLASSEE_RESTREINT"],paint:{"line-color":{stops:[[17,"#969696"],[18,"#ffffff"]]},"line-width":{stops:[[14,3.2],[15,5.4],[16,7.7],[17,16.8]]}}},{id:"Routier a niveau - filet extérieur - route non classee",type:"line",source:"plan_ign","source-layer":"routier_route",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","NON_CLASSEE_4","NON_CLASSEE"],paint:{"line-color":{stops:[[17,"#969696"],[18,"#ffffff"]]},"line-width":{stops:[[14,3.2],[15,5.4],[16,7.7],[17,16.8]]}}},{id:"Routier a niveau - filet extérieur - route locale",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:7,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_LOCALE","LOCALE_4","LOCALE_3","LOCALE_2","LOCALE_1"],paint:{"line-color":{stops:[[12,"#8c8c8c"],[13,"#b4b4b4"],[17,"#b4b4b4"],[18,"#ffffff"]]},"line-width":{stops:[[9,2],[14,3.5],[15,6],[16,8.4],[17,18.3]]}}},{id:"Routier a niveau - filet extérieur - route locale en construction",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:11,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","LOCALE_CONSTR"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[9,2],[14,3.5],[15,6],[16,8.4],[17,18.3]]}}},{id:"Routier a niveau - filet extérieur - route regionale",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:8,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_REGIONALE","REGIONALE_4","REGIONALE_3","REGIONALE_2","REGIONALE_1"],paint:{"line-color":{stops:[[9,"#828282"],[10,"#b4b4b4"],[17,"#b4b4b4"],[18,"#ffffff"]]},"line-width":{stops:[[6,1.5],[9,2.3],[14,5],[15,8.1],[16,11.2],[17,22]]}}},{id:"Routier a niveau - filet extérieur - route regionale en construction",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","REGIONALE_CONSTR"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[6,1.5],[9,2.3],[14,5],[15,8.1],[16,11.2],[17,22]]}}},{id:"Routier a niveau - filet extérieur - route principale",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:8,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_PRINCIPALE","PRINCIPALE_4","PRINCIPALE_3","PRINCIPALE_2","PRINCIPALE_1"],paint:{"line-color":{stops:[[17,"#b7b7b7"],[18,"#ffffff"]]},"line-width":{stops:[[6,1.8],[9,2.7],[14,5.9],[15,9],[16,12.2],[17,22.5]]}}},{id:"Routier a niveau - filet extérieur - route principale en construction",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","PRINCIPALE_CONSTR"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[6,1.8],[9,2.7],[14,5.9],[15,9],[16,12.2],[17,22.5]]}}},{id:"Routier a niveau - filet extérieur - autoroute",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:8,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","AUTOROU_PEAGE","AUTOROU_LIBRE"],paint:{"line-color":{stops:[[9,"#b6b6b6"],[17,"#b6b6b6"],[18,"#ffffff"]]},"line-width":{stops:[[6,2.5],[9,3.5],[14,7.5],[15,11],[16,15],[17,26]]}}},{id:"Routier a niveau - filet extérieur - autoroute en construction",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:8,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","AUTOROU_CONSTR"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[6,2.5],[9,3.5],[14,7.5],[15,11],[16,15],[17,26]]}}},{id:"Routier a niveau - filet interieur - bretelle autoroute",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_AUTO_PEAGE_3","BRET_AUTO_PEAGE_2","BRET_AUTO_PEAGE_1","BRET_AUTO_LIBRE_3","BRET_AUTO_LIBRE_2","BRET_AUTO_LIBRE_1"],paint:{"line-color":{stops:[[9,"#b3b3b3"],[17,"#b3b3b3"]]},"line-width":{stops:[[12,1.5],[14,2.6],[15,5.2],[16,6.7],[17,10.8]]}}},{id:"Routier a niveau - filet interieur - route non classee restreint",type:"line",source:"plan_ign","source-layer":"routier_route",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","NON_CLASSEE_RESTREINT"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5]]}}},{id:"Routier a niveau - filet interieur - route non classee",type:"line",source:"plan_ign","source-layer":"routier_route",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","NON_CLASSEE_4","NON_CLASSEE"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5]]}}},{id:"Routier a niveau - filet interieur - route locale",type:"line",source:"plan_ign","source-layer":"routier_route",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_LOCALE","LOCALE_4","LOCALE_3","LOCALE_2","LOCALE_1"],paint:{"line-color":{stops:[[6,"#d2bba2"],[7,"#ffffff"],[12,"#ffffff"],[13,"#eeead2"],[17,"#eeead2"]]},"line-width":{stops:[[9,1.3],[14,2.3],[15,4.1],[16,6.1],[17,13.1]]}}},{id:"Routier a niveau - filet interieur - route locale en construction",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:11,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","LOCALE_CONSTR"],paint:{"line-color":{stops:[[12,"#ffffff"],[13,"#eeead2"],[17,"#eeead2"],[18,"#ededed"]]},"line-width":{stops:[[9,2],[14,3.5],[15,6],[16,8.4],[17,18.3]]},"line-dasharray":[2,2]}},{id:"Routier a niveau - filet interieur - route regionale",type:"line",source:"plan_ign","source-layer":"routier_route",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_REGIONALE","REGIONALE_4","REGIONALE_3","REGIONALE_2","REGIONALE_1"],paint:{"line-color":{stops:[[6,"#d5b28c"],[7,"#ffffff"],[9,"#ffffff"],[10,"#eeead2"],[17,"#eeead2"]]},"line-width":{stops:[[4,1.1],[6,1.4],[9,1.5],[14,3.2],[15,5.8],[16,8.3],[17,16.2]]}}},{id:"Routier a niveau - filet interieur - route regionale en construction",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:10,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","REGIONALE_CONSTR"],paint:{"line-color":{stops:[[9,"#ffffff"],[10,"#eeead2"],[17,"#eeead2"],[18,"#ededed"]]},"line-width":{stops:[[4,.4],[6,1.5],[9,2.3],[14,5],[15,8.1],[16,11.2],[17,22]]},"line-dasharray":[2,2]}},{id:"Routier a niveau - filet interieur - route principale",type:"line",source:"plan_ign","source-layer":"routier_route",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","BRET_PRINCIPALE","PRINCIPALE_4","PRINCIPALE_3","PRINCIPALE_2","PRINCIPALE_1"],paint:{"line-color":{stops:[[6,"#d7a36e"],[7,"#c7b9af"],[9,"#c7b9af"],[17,"#c7b9af"]]},"line-width":{stops:[[4,.6],[6,1.8],[9,2.1],[14,4.4],[15,7.3],[16,10],[17,18.5]]}}},{id:"Routier a niveau - filet interieur - route principale en construction",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:10,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","PRINCIPALE_CONSTR"],paint:{"line-color":{stops:[[9,"#c7b9af"],[17,"#c7b9af"],[18,"#ededed"]]},"line-width":{stops:[[4,.5],[6,1.8],[9,2.7],[14,5.9],[15,9],[16,12.2],[17,22.5]]},"line-dasharray":[2,2]}},{id:"Routier a niveau - filet interieur - autoroute",type:"line",source:"plan_ign","source-layer":"routier_route",maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","AUTOROU_PEAGE","AUTOROU_LIBRE"],paint:{"line-color":{stops:[[9,"#b3b3b3"],[17,"#b3b3b3"]]},"line-width":{stops:[[4,.7],[6,2.5],[9,2.7],[14,5.8],[15,9],[16,12],[17,20.8]]}}},{id:"Routier a niveau - axe central - autoroute",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","AUTOROU_PEAGE","AUTOROU_LIBRE"],paint:{"line-color":"#ffffff","line-width":{stops:[[9,.6],[14,.7],[15,1],[16,1.2],[17,2.1]]}}},{id:"Routier a niveau - filet interieur - autoroute en construction",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:8,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","AUTOROU_CONSTR"],paint:{"line-color":{stops:[[9,"#b3b3b3"],[17,"#b3b3b3"],[18,"#ededed"]]},"line-width":{stops:[[4,.7],[6,2.5],[9,3.5],[14,7.5],[15,11],[16,15],[17,26]]},"line-dasharray":[2,2]}},{id:"Routier a niveau - axe centrale - autoroute en construction",type:"line",source:"plan_ign","source-layer":"routier_route",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","AUTOROU_CONSTR"],paint:{"line-color":"#808080","line-width":{stops:[[9,.6],[14,.7],[15,1],[16,1.2],[17,2.1]]}}},{id:"Ferre a niveau - voie normale",type:"line",source:"plan_ign","source-layer":"ferre",minzoom:12,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","VF_1","VF_2","VF_3","VF_4","VF_ELEC_1","VF_ELEC_2","VF_ELEC_3","VF_ELEC_4"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.8],[17,2.5]]}}},{id:"Ferre a niveau - voie normale trait perpendic",type:"line",source:"plan_ign","source-layer":"ferre",minzoom:12,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","VF_1","VF_2","VF_3","VF_4","VF_ELEC_1","VF_ELEC_2","VF_ELEC_3","VF_ELEC_4"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,3.5],[17,14.7]]},"line-dasharray":[.1,10]}},{id:"Ferre a niveau - voie etroite",type:"line",source:"plan_ign","source-layer":"ferre",minzoom:12,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","VF_ETROITE_1","VF_ETROITE_2","VF_ETROITE"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.3],[17,1.8]]}}},{id:"Ferre a niveau - voie etroite trait perpendic",type:"line",source:"plan_ign","source-layer":"ferre",minzoom:12,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","VF_ETROITE_1","VF_ETROITE_2","VF_ETROITE"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,3.5],[17,14.7]]},"line-dasharray":[.1,10]}},{id:"Ferre a niveau - voie service",type:"line",source:"plan_ign","source-layer":"ferre",minzoom:14,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","VF_SERVICE","VF_NON_EXPLOITEE"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.3],[17,1.8]]},"line-dasharray":[5,2,1,2]}},{id:"Ferre a niveau - voie en construction",type:"line",source:"plan_ign","source-layer":"ferre",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","VF_EN_CONSTR"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.3],[17,1.8]]},"line-dasharray":[2,2]}},{id:"Ferre a niveau - voie en construction trait perpendic",type:"line",source:"plan_ign","source-layer":"ferre",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","VF_EN_CONSTR"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,3.5],[17,14.7]]},"line-dasharray":[.1,10]}},{id:"Ferre a niveau - funic/urbain",type:"line",source:"plan_ign","source-layer":"ferre",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","FUNI_CREMAILLERE","TRANSPORT_URBAIN"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.3],[17,1.8]]}}},{id:"Ferre a niveau - 2 trait perpendic - funic/urbain",type:"line",source:"plan_ign","source-layer":"ferre",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","FUNI_CREMAILLERE","TRANSPORT_URBAIN"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,3.5],[17,17]]},"line-dasharray":[.1,.2,.1,10]}},{id:"liaison routiere - Gue route",type:"line",source:"plan_ign","source-layer":"routier_liaison",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","GUE_ROUTE"],paint:{"line-color":{stops:[[13,"#bebebe"],[17,"#646464"],[18,"#ffffff"]]},"line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5]]}}},{id:"liaison routiere - Gue chemin",type:"line",source:"plan_ign","source-layer":"routier_liaison",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","GUE_CHEMIN"],paint:{"line-color":{stops:[[13,"#bebebe"],[17,"#646464"]]},"line-width":{stops:[[14,1.6],[15,2.9],[16,4.4],[17,6.5]]}}},{id:"liaison routiere - filet extérieur - Pont passerelle",type:"line",source:"plan_ign","source-layer":"routier_liaison",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","PONT_PASSERELLE","PONT_LIN","PONT_MOBILE_LIN"],paint:{"line-color":{stops:[[17,"#c8c8c8"],[18,"#ffffff"]]},"line-width":{stops:[[14,2.2],[15,3.8],[16,5.4],[17,11.8]]}}},{id:"liaison routiere - filet intérieur - Pont passerelle",type:"line",source:"plan_ign","source-layer":"routier_liaison",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","PONT_PASSERELLE","PONT_LIN","PONT_MOBILE_LIN"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,.7],[15,1.1],[16,1.7],[17,3.8]]}}},{id:"Routier surfacique",type:"fill",source:"plan_ign","source-layer":"routier_surf",layout:{visibility:"visible"},filter:["in","symbo","SURF_ROUT_PRINC","SURF_ROUT_REG","SURF_ROUT_LOC","SURF_ROUT_NON_CLA"],paint:{"fill-color":"#ffffff","fill-outline-color":"#000000"}},{id:"bati transport surfacique - bati peage",type:"fill",source:"plan_ign","source-layer":"bati_surf",minzoom:15,layout:{visibility:"visible"},filter:["==","symbo","BATI_PEAGE"],paint:{"fill-color":"#e2e2e2","fill-outline-color":"#dcdcdc"}},{id:"réseau hydro  - cours d'eau superieur",type:"line",source:"plan_ign","source-layer":"hydro_reseau_sup",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","COURS_D_EAU_SUP","COURS_D_EAU_MOY_SUP"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,1.5],[17,6.5]]}}},{id:"réseau hydro - canal superieur",type:"line",source:"plan_ign","source-layer":"hydro_reseau_sup",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","CANAL_SUP"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,1.4],[17,5.9]]}}},{id:"réseau hydro - filet interieur - aqueduc superieur",type:"line",source:"plan_ign","source-layer":"hydro_reseau_sup",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","AQUEDUC_SUP"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,1.4],[16,3.5],[17,5.9]]}}},{id:"réseau hydro - carre - aqueduc superieur",type:"line",source:"plan_ign","source-layer":"hydro_reseau_sup",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","AQUEDUC_SUP"],paint:{"line-color":"#e1e1e1","line-width":{stops:[[12,3.5],[16,8.7],[17,14.7]]},"line-dasharray":[1,5]}},{id:"Chemin superieur - filet exterieur - escalier",type:"line",source:"plan_ign","source-layer":"routier_chemin_sup",minzoom:14,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","ESCALIER_SUP"],paint:{"line-color":{stops:[[17,"#c3c3c3"],[18,"#c8c8c8"]]},"line-width":{stops:[[14,1.75],[15,3],[16,4.2],[17,9.5]]}}},{id:"Chemin superieur - filet interieur - escalier",type:"line",source:"plan_ign","source-layer":"routier_chemin_sup",minzoom:14,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","ESCALIER_SUP"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,1],[15,1.9],[16,2.7],[17,5.8]]},"line-dasharray":[1,.2]}},{id:"Chemin superieur - Rue pietonne",type:"line",source:"plan_ign","source-layer":"routier_chemin_sup",minzoom:14,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","RUE_PIETONNE_SUP"],paint:{"line-color":{stops:[[17,"#c3c3c3"],[18,"#ebebeb"]]},"line-width":{stops:[[14,1],[15,1.2],[16,1.4],[17,2],[18,5]]},"line-dasharray":[1,3]}},{id:"Chemin superieur - sentier",type:"line",source:"plan_ign","source-layer":"routier_chemin_sup",minzoom:13,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","SENTIER_SUP"],paint:{"line-color":{stops:[[17,"#c3c3c3"],[18,"#ffffff"]]},"line-width":{stops:[[14,1],[15,1.2],[16,1.4],[17,2],[18,6]]},"line-dasharray":[4,3]}},{id:"Chemin superieur - chemin",type:"line",source:"plan_ign","source-layer":"routier_chemin_sup",minzoom:12,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","CHEMIN_SUP"],paint:{"line-color":{stops:[[17,"#c3c3c3"],[18,"#ffffff"]]},"line-width":{stops:[[14,1],[15,1.2],[16,1.4],[17,2],[18,7]]}}},{id:"Routier superieur - filet extérieur - route non revetu carrosable",type:"line",source:"plan_ign","source-layer":"routier_route_sup",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","NON_REVETUE_CARRO_SUP"],paint:{"line-color":{stops:[[12,"#c3c3c3"],[17,"#c3c3c3"]]},"line-width":{stops:[[14,3.2],[15,5.4],[16,7.7],[17,16.8]]},"line-dasharray":[2,2]}},{id:"Routier superieur - filet extérieur - bretelle autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:12,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","BRET_AUTO_PEAGE_3_SUP","BRET_AUTO_PEAGE_2_SUP","BRET_AUTO_PEAGE_1_SUP","BRET_AUTO_LIBRE_3_SUP","BRET_AUTO_LIBRE_2_SUP","BRET_AUTO_LIBRE_1_SUP"],paint:{"line-color":{stops:[[9,"#b6b6b6"],[17,"#b6b6b6"],[18,"#ffffff"]]},"line-width":{stops:[[12,2.5],[14,3.7],[15,6.8],[16,8.4],[17,14]]}}},{id:"Routier superieur - filet extérieur - route non classee restreint",type:"line",source:"plan_ign","source-layer":"routier_route_sup",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","NON_CLASSEE_RESTREINT_SUP"],paint:{"line-color":{stops:[[17,"#969696"],[18,"#ffffff"]]},"line-width":{stops:[[14,3.2],[15,5.4],[16,7.7],[17,16.8]]}}},{id:"Routier superieur - filet extérieur - route non classee",type:"line",source:"plan_ign","source-layer":"routier_route_sup",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","NON_CLASSEE_4_SUP","NON_CLASSEE_SUP"],paint:{"line-color":{stops:[[17,"#969696"],[18,"#ffffff"]]},"line-width":{stops:[[14,3.2],[15,5.4],[16,7.7],[17,16.8]]}}},{id:"Routier superieur - filet extérieur - route locale",type:"line",source:"plan_ign","source-layer":"routier_route_sup",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","BRET_LOCALE_SUP","LOCALE_4_SUP","LOCALE_3_SUP","LOCALE_2_SUP","LOCALE_1_SUP"],paint:{"line-color":{stops:[[12,"#8c8c8c"],[13,"#b4b4b4"],[17,"#b4b4b4"],[18,"#ffffff"]]},"line-width":{stops:[[9,2],[14,3.5],[15,6],[16,8.4],[17,18.3]]}}},{id:"Routier superieur - filet extérieur - route locale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:11,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","LOCALE_CONSTR_SUP"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[9,2],[14,3.5],[15,6],[16,8.4],[17,18.3]]}}},{id:"Routier superieur - filet extérieur - route regionale",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:8,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","BRET_REGIONALE_SUP","REGIONALE_4_SUP","REGIONALE_3_SUP","REGIONALE_2_SUP","REGIONALE_1_SUP"],paint:{"line-color":{stops:[[9,"#828282"],[10,"#b4b4b4"],[17,"#b4b4b4"],[18,"#ffffff"]]},"line-width":{stops:[[6,1.5],[9,2.3],[14,5],[15,8.1],[16,11.2],[17,22]]}}},{id:"Routier superieur - filet extérieur - route regionale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","REGIONALE_CONSTR_SUP"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[6,1.5],[9,2.3],[14,5],[15,8.1],[16,11.2],[17,22]]}}},{id:"Routier superieur - filet extérieur - route principale",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:8,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","BRET_PRINCIPALE_SUP","PRINCIPALE_4_SUP","PRINCIPALE_3_SUP","PRINCIPALE_2_SUP","PRINCIPALE_1_SUP"],paint:{"line-color":{stops:[[17,"#b7b7b7"],[18,"#ffffff"]]},"line-width":{stops:[[6,1.8],[9,2.7],[14,5.9],[15,9],[16,12.2],[17,22.5]]}}},{id:"Routier superieur - filet extérieur - route principale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","PRINCIPALE_CONSTR_SUP"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[6,1.8],[9,2.7],[14,5.9],[15,9],[16,12.2],[17,22.5]]}}},{id:"Routier superieur - filet extérieur - autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:8,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","AUTOROU_PEAGE_SUP","AUTOROU_LIBRE_SUP"],paint:{"line-color":{stops:[[9,"#b6b6b6"],[17,"#b6b6b6"],[18,"#ffffff"]]},"line-width":{stops:[[6,2.5],[9,3.5],[14,7.5],[15,11],[16,15],[17,26]]}}},{id:"Routier superieur - filet extérieur - autoroute en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","AUTOROU_CONSTR_SUP"],paint:{"line-color":"#c8c8c8","line-width":{stops:[[6,2.5],[9,3.5],[14,7.5],[15,11],[16,15],[17,26]]}}},{id:"Routier superieur - filet interieur - route non revetu carrosable",type:"line",source:"plan_ign","source-layer":"routier_route_sup",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","NON_REVETUE_CARRO_SUP"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5],[18,16.8]]}}},{id:"Routier superieur - filet interieur - bretelle autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","BRET_AUTO_PEAGE_3_SUP","BRET_AUTO_PEAGE_2_SUP","BRET_AUTO_PEAGE_1_SUP","BRET_AUTO_LIBRE_3_SUP","BRET_AUTO_LIBRE_2_SUP","BRET_AUTO_LIBRE_1_SUP"],paint:{"line-color":{stops:[[9,"#b3b3b3"],[17,"#b3b3b3"]]},"line-width":{stops:[[12,1.5],[14,2.6],[15,5.2],[16,6.7],[17,10.8]]}}},{id:"Routier superieur - filet interieur - route non classee restreint",type:"line",source:"plan_ign","source-layer":"routier_route_sup",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","NON_CLASSEE_RESTREINT_SUP"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5]]}}},{id:"Routier superieur - filet interieur - route non classee",type:"line",source:"plan_ign","source-layer":"routier_route_sup",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","NON_CLASSEE_4_SUP","NON_CLASSEE_SUP"],paint:{"line-color":"#ffffff","line-width":{stops:[[14,2.3],[15,4.1],[16,6.3],[17,13.5]]}}},{id:"Routier superieur - filet interieur - route locale",type:"line",source:"plan_ign","source-layer":"routier_route_sup",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","BRET_LOCALE_SUP","LOCALE_4_SUP","LOCALE_3_SUP","LOCALE_2_SUP","LOCALE_1_SUP"],paint:{"line-color":{stops:[[12,"#ffffff"],[13,"#eeead2"],[17,"#eeead2"]]},"line-width":{stops:[[9,1.3],[14,2.3],[15,4.1],[16,6.1],[17,13.1]]}}},{id:"Routier superieur - filet interieur - route locale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:11,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","LOCALE_CONSTR_SUP"],paint:{"line-color":{stops:[[12,"#ffffff"],[13,"#eeead2"],[17,"#eeead2"]]},"line-width":{stops:[[9,2],[14,3.5],[15,6],[16,8.4],[17,18.3]]},"line-dasharray":[2,2]}},{id:"Routier superieur - filet interieur - route regionale",type:"line",source:"plan_ign","source-layer":"routier_route_sup",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","BRET_REGIONALE_SUP","REGIONALE_4_SUP","REGIONALE_3_SUP","REGIONALE_2_SUP","REGIONALE_1_SUP"],paint:{"line-color":{stops:[[9,"#ffffff"],[10,"#eeead2"],[17,"#eeead2"]]},"line-width":{stops:[[6,1.4],[9,1.5],[14,3.2],[15,5.8],[16,8.3],[17,16.2]]}}},{id:"Routier superieur - filet interieur - route regionale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","REGIONALE_CONSTR_SUP"],paint:{"line-color":{stops:[[9,"#ffffff"],[10,"#eeead2"],[17,"#eeead2"]]},"line-width":{stops:[[6,1.5],[9,2.3],[14,5],[15,8.1],[16,11.2],[17,22]]},"line-dasharray":[2,2]}},{id:"Routier superieur - filet interieur - route principale",type:"line",source:"plan_ign","source-layer":"routier_route_sup",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","BRET_PRINCIPALE_SUP","PRINCIPALE_4_SUP","PRINCIPALE_3_SUP","PRINCIPALE_2_SUP","PRINCIPALE_1_SUP"],paint:{"line-color":{stops:[[9,"#c7b9af"],[17,"#c7b9af"]]},"line-width":{stops:[[4,.5],[6,1.8],[9,2.1],[14,4.4],[15,7.3],[16,10],[17,18.5]]}}},{id:"Routier superieur - filet interieur - route principale en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","PRINCIPALE_CONSTR_SUP"],paint:{"line-color":{stops:[[9,"#c7b9af"],[17,"#c7b9af"]]},"line-width":{stops:[[6,1.8],[9,2.7],[14,5.9],[15,9],[16,12.2],[17,22.5]]},"line-dasharray":[2,2]}},{id:"Routier superieur - filet interieur - autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sup",maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","AUTOROU_PEAGE_SUP","AUTOROU_LIBRE_SUP"],paint:{"line-color":{stops:[[9,"#b3b3b3"],[17,"#b3b3b3"]]},"line-width":{stops:[[4,.7],[6,2.5],[9,2.7],[14,5.8],[15,9],[16,12],[17,20.8]]}}},{id:"Routier superieur - axe central - autoroute",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","AUTOROU_PEAGE_SUP","AUTOROU_LIBRE_SUP"],paint:{"line-color":"#ffffff","line-width":{stops:[[9,.6],[14,.7],[15,1],[16,1.2],[17,2.1]]}}},{id:"Routier superieur - filet interieur - autoroute en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:10,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","AUTOROU_CONSTR_SUP"],paint:{"line-color":{stops:[[9,"#b3b3b3"],[17,"#b3b3b3"]]},"line-width":{stops:[[4,.7],[6,2.5],[9,3.5],[14,7.5],[15,11],[16,15],[17,26]]},"line-dasharray":[2,2]}},{id:"Routier superieur - axe centrale - autoroute en construction",type:"line",source:"plan_ign","source-layer":"routier_route_sup",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","AUTOROU_CONSTR_SUP"],paint:{"line-color":"#808080","line-width":{stops:[[9,.6],[14,.7],[15,1],[16,1.2],[17,2.1]]}}},{id:"Ferre superieur - voie normale",type:"line",source:"plan_ign","source-layer":"ferre_sup",minzoom:12,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","VF_1_SUP","VF_2_SUP","VF_3_SUP","VF_4_SUP","VF_ELEC_1_SUP","VF_ELEC_2_SUP","VF_ELEC_3_SUP","VF_ELEC_4_SUP"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.8],[17,2.5]]}}},{id:"Ferre superieur - voie normale trait perpendic",type:"line",source:"plan_ign","source-layer":"ferre_sup",minzoom:12,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","VF_1_SUP","VF_2_SUP","VF_3_SUP","VF_4_SUP","VF_ELEC_1_SUP","VF_ELEC_2_SUP","VF_ELEC_3_SUP","VF_ELEC_4_SUP"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,3.5],[17,14.7]]},"line-dasharray":[.1,10]}},{id:"Ferre superieur - voie etroite",type:"line",source:"plan_ign","source-layer":"ferre_sup",minzoom:12,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","VF_ETROITE_1_SUP","VF_ETROITE_2_SUP","VF_ETROITE_SUP"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.3],[17,1.8]]}}},{id:"Ferre superieur - voie etroite trait perpendic",type:"line",source:"plan_ign","source-layer":"ferre_sup",minzoom:12,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","VF_ETROITE_1_SUP","VF_ETROITE_2_SUP","VF_ETROITE_SUP"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,3.5],[17,14.7]]},"line-dasharray":[.1,10]}},{id:"Ferre superieur - voie service",type:"line",source:"plan_ign","source-layer":"ferre_sup",minzoom:14,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","VF_SERVICE_SUP","VF_NON_EXPLOITEE_SUP"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.3],[17,1.8]]},"line-dasharray":[5,2,1,2]}},{id:"Ferre superieur - voie en construction",type:"line",source:"plan_ign","source-layer":"ferre_sup",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","VF_EN_CONSTR_SUP"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.3],[17,1.8]]},"line-dasharray":[2,2]}},{id:"Ferre superieur - voie en construction trait perpendic",type:"line",source:"plan_ign","source-layer":"ferre_sup",minzoom:12,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","VF_EN_CONSTR_SUP"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,3.5],[17,14.7]]},"line-dasharray":[.1,10]}},{id:"Ferre superieur - funic/urbain",type:"line",source:"plan_ign","source-layer":"ferre_sup",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","FUNI_CREMAILLERE_SUP","TRANSPORT_URBAIN_SUP"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,.3],[17,1.8]]}}},{id:"Ferre superieur - 2 trait perpendic - funic/urbain",type:"line",source:"plan_ign","source-layer":"ferre_sup",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","FUNI_CREMAILLERE_SUP","TRANSPORT_URBAIN_SUP"],paint:{"line-color":"#8c8c8c","line-width":{stops:[[10,3.5],[17,17]]},"line-dasharray":[.1,.2,.1,10]}},{id:"parcellaire - parcelle bordure",type:"line",source:"plan_ign","source-layer":"parcellaire_parcelle",layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["==","symbo","PARCELLE"],paint:{"line-color":"#9250d0","line-width":1}},{id:"parcellaire - section",type:"line",source:"plan_ign","source-layer":"parcellaire_section",layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","SECTION"],paint:{"line-color":"#557344","line-width":1.9,"line-dasharray":[2,4,2]}},{id:"toponyme - parcellaire - section",type:"symbol",source:"plan_ign","source-layer":"toponyme_parcellaire_section",filter:["==","txt_typo","SECTION"],layout:{"symbol-placement":"line","text-offset":[0,0],"text-field":"{texte}","text-size":15,"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#557344"}},{id:"toponyme - parcellaire - parcelle",type:"symbol",source:"plan_ign","source-layer":"toponyme_parcellaire_parcelle",filter:["==","txt_typo","PARCELLE"],layout:{"symbol-placement":"point","text-field":"{texte}","text-size":11,"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-font":["Source Sans Pro Bold"],visibility:"visible"},paint:{"text-color":"#9250d0","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - parcellaire - adresse",type:"symbol",source:"plan_ign","source-layer":"toponyme_parcellaire_adresse_ponc",filter:["==","txt_typo","ADRESSE"],layout:{"symbol-placement":"point","text-field":["concat",["get","numero"],["get","indice_de_repetition"]],"text-size":11,"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-font":["Source Sans Pro Bold"],visibility:"visible"},paint:{"text-color":"#5a5a5a","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"limite admin - limite de commune",type:"line",source:"plan_ign","source-layer":"limite_lin",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","LIM_COMMUNE","LIM_CANTON","LIM_ARRONDISSEMENT"],paint:{"line-color":"rgba(167,167,167,0.5)","line-width":{stops:[[13,3],[17,5.5]]},"line-dasharray":[4,2,1,1,1,1,1,2]}},{id:"limite admin - limite de département bandeau",type:"line",source:"plan_ign","source-layer":"limite_lin",minzoom:8,maxzoom:13,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","LIM_DEPARTEMENT"],paint:{"line-color":"rgba(186,186,186,0.4)","line-width":{stops:[[9,4.1],[12,6]]}}},{id:"limite admin - limite de département tiret",type:"line",source:"plan_ign","source-layer":"limite_lin",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","LIM_DEPARTEMENT"],paint:{"line-color":"rgba(167,167,167,0.5)","line-width":{stops:[[13,3],[17,5.5]]},"line-dasharray":[4,2,1,1,1,2]}},{id:"limite admin - limite de région bandeau",type:"line",source:"plan_ign","source-layer":"limite_lin",minzoom:7,maxzoom:13,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","LIM_REGION"],paint:{"line-color":"rgba(186,186,186,0.5)","line-width":{stops:[[9,4.5],[12,6.7]]}}},{id:"limite admin - limite de région tiret",type:"line",source:"plan_ign","source-layer":"limite_lin",minzoom:13,maxzoom:18,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["==","symbo","LIM_REGION"],paint:{"line-color":"rgba(167,167,167,0.5)","line-width":{stops:[[13,3],[17,5.5]]},"line-dasharray":[4,2,1,2]}},{id:"limite etat 1",type:"line",source:"plan_ign","source-layer":"limite_lin",minzoom:2,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","LIM_ETAT","LIM_ETAT_ETRANGER"],paint:{"line-color":"rgba(186,186,186,0.6)","line-width":{stops:[[2,2],[3,3.5],[9,5],[14,13],[15,20],[16,24],[17,42]]}}},{id:"limite etat 2",type:"line",source:"plan_ign","source-layer":"limite_lin",minzoom:7,layout:{visibility:"visible","line-cap":"butt","line-join":"round"},filter:["in","symbo","LIM_ETAT","LIM_ETAT_ETRANGER"],paint:{"line-color":"#b3b3b3","line-width":{stops:[[9,1.5],[14,3.5],[15,5.5],[16,6.5],[17,11]]},"line-dasharray":[4,2]}},{id:"limite cote",type:"line",source:"plan_ign","source-layer":"limite_lin",minzoom:7,maxzoom:10,layout:{visibility:"visible","line-cap":"round","line-join":"round"},filter:["in","symbo","LIM_COTE"],paint:{"line-color":"#c8c8c8","line-width":1}},{id:"toponyme - bornes postales haute - chemins",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","CHEMIN","CHEMIN_SOU","CHEMIN_SUP","PISTE_CYCLABLE","PISTE_CYCLABLE_SOU","PISTE_CYCLABLE_SUP","RUE_PIETONNE","RUE_PIETONNE_SOU","RUE_PIETONNE_SUP","SENTIER","SENTIER_SOU","SENTIER_SUP","ESCALIER","ESCALIER_SUP"],layout:{"symbol-placement":"line","text-field":"{borne_sur}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,-1],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - bornes postales haute - non revetue, non classee",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","NON_CLASSEE","NON_CLASSEE_4","NON_CLASSEE_4_SUP","NON_CLASSEE_RESTREINT","NON_CLASSEE_RESTREINT_SUP","NON_CLASSEE_SOU","NON_CLASSEE_SUP","NON_REVETUE_CARRO","NON_REVETUE_CARRO_SUP"],layout:{"symbol-placement":"line","text-field":"{borne_sur}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,-1.3],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - bornes postales haute - locales",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","LOCALE_1","LOCALE_1_SOU","LOCALE_1_SUP","LOCALE_2","LOCALE_2_SOU","LOCALE_2_SUP","LOCALE_3","LOCALE_3_SOU","LOCALE_3_SUP","LOCALE_4","LOCALE_4_SOU","LOCALE_4_SUP","LOCALE_CONSTR","LOCALE_CONSTR_SUP"],layout:{"symbol-placement":"line","text-field":"{borne_sur}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,-1.4],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - bornes postales haute - regionales",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","REGIONALE_1","REGIONALE_1_SOU","REGIONALE_1_SUP","REGIONALE_2","REGIONALE_2_SOU","REGIONALE_2_SUP","REGIONALE_3","REGIONALE_3_SOU","REGIONALE_3_SUP","REGIONALE_4","REGIONALE_4_SUP","REGIONALE_CONSTR"],layout:{"symbol-placement":"line","text-field":"{borne_sur}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,-1.5],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - bornes postales haute - principales",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","PRINCIPALE_1","PRINCIPALE_1_SOU","PRINCIPALE_1_SUP","PRINCIPALE_2","PRINCIPALE_2_SOU","PRINCIPALE_2_SUP","PRINCIPALE_3","PRINCIPALE_3_SOU","PRINCIPALE_3_SUP","PRINCIPALE_4","PRINCIPALE_4_SOU","PRINCIPALE_4_SUP","PRINCIPALE_CONSTR"],layout:{"symbol-placement":"line","text-field":"{borne_sur}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,-1.6],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - bornes postales bas - chemins",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","CHEMIN","CHEMIN_SOU","CHEMIN_SUP","PISTE_CYCLABLE","PISTE_CYCLABLE_SOU","PISTE_CYCLABLE_SUP","RUE_PIETONNE","RUE_PIETONNE_SOU","RUE_PIETONNE_SUP","SENTIER","SENTIER_SOU","SENTIER_SUP","ESCALIER","ESCALIER_SUP"],layout:{"symbol-placement":"line","text-field":"{borne_sous}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,1],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - bornes postales bas - non revetue, non classee",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","NON_CLASSEE","NON_CLASSEE_4","NON_CLASSEE_4_SUP","NON_CLASSEE_RESTREINT","NON_CLASSEE_RESTREINT_SUP","NON_CLASSEE_SOU","NON_CLASSEE_SUP","NON_REVETUE_CARRO","NON_REVETUE_CARRO_SUP"],layout:{"symbol-placement":"line","text-field":"{borne_sous}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,1.3],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - bornes postales bas - locales",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","LOCALE_1","LOCALE_1_SOU","LOCALE_1_SUP","LOCALE_2","LOCALE_2_SOU","LOCALE_2_SUP","LOCALE_3","LOCALE_3_SOU","LOCALE_3_SUP","LOCALE_4","LOCALE_4_SOU","LOCALE_4_SUP","LOCALE_CONSTR","LOCALE_CONSTR_SUP"],layout:{"symbol-placement":"line","text-field":"{borne_sous}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,1.4],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - bornes postales bas - regionales",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","REGIONALE_1","REGIONALE_1_SOU","REGIONALE_1_SUP","REGIONALE_2","REGIONALE_2_SOU","REGIONALE_2_SUP","REGIONALE_3","REGIONALE_3_SOU","REGIONALE_3_SUP","REGIONALE_4","REGIONALE_4_SUP","REGIONALE_CONSTR"],layout:{"symbol-placement":"line","text-field":"{borne_sous}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,1.5],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme - bornes postales bas - principales",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_borne",minzoom:17,maxzoom:18,filter:["in","symbo","PRINCIPALE_1","PRINCIPALE_1_SOU","PRINCIPALE_1_SUP","PRINCIPALE_2","PRINCIPALE_2_SOU","PRINCIPALE_2_SUP","PRINCIPALE_3","PRINCIPALE_3_SOU","PRINCIPALE_3_SUP","PRINCIPALE_4","PRINCIPALE_4_SOU","PRINCIPALE_4_SUP","PRINCIPALE_CONSTR"],layout:{"symbol-placement":"line","text-field":"{borne_sous}","text-size":11,"text-anchor":"center","text-allow-overlap":!0,"text-offset":[0,1.6],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#686868","text-halo-width":1,"text-halo-color":"#FFFFFF"}},{id:"toponyme ferre lineaire",type:"symbol",source:"plan_ign","source-layer":"toponyme_ferre_lin",minzoom:12,filter:["in","txt_typo","FER_NOM","FER_OUVRAGE"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":10,"text-anchor":"center","text-offset":[0,-1],"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#000000","text-halo-width":1,"text-halo-color":"rgba(255, 255, 255, 1)"}},{id:"toponyme religieux zoom 15 16",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:14,maxzoom:16,filter:["==","txt_typo","religieux"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{designation}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme religieux zoom 17 à 19",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:16,filter:["==","txt_typo","religieux"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme parc d'attractions zoom 14",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:13,maxzoom:14,filter:["all",["==","txt_typo","divers_bati"],["==","symbo","PARC_ATTRACTIONS"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{designation}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme parc d'attractions zoom 15 à 19",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:14,filter:["all",["==","txt_typo","divers_bati"],["==","symbo","PARC_ATTRACTIONS"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme bati divers zoom 15",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:14,maxzoom:15,filter:["all",["==","txt_typo","divers_bati"],["in","symbo","CENTRALE_ELECTRIQUE","HIPPODROME","STADE"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{designation}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme bati divers zoom 16 à 19",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:15,filter:["all",["==","txt_typo","divers_bati"],["in","symbo","CENTRALE_ELECTRIQUE","HIPPODROME","STADE"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme chateau zoom 16",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:15,maxzoom:16,filter:["all",["==","txt_typo","divers_bati"],["in","symbo","CHATEAU","CHATEAU_FORT"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{designation}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme chateau zoom 17 à 19",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:16,filter:["all",["==","txt_typo","divers_bati"],["in","symbo","CHATEAU","CHATEAU_FORT"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme station epuration, de pompage, usine de production eau",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:14,filter:["==","txt_typo","station"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{designation}","text-anchor":"left","text-offset":[.8,0],"text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#cacaca"}},{id:"toponyme bati ponc gare",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:15,filter:["==","txt_typo","gore"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{designation}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme bati ponc barrage",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:12,filter:["==","txt_typo","BARRAGE_PONC"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"left","text-offset":[.8,0],"text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro"]},paint:{"text-color":"#cacaca"}},{id:"toponyme bati ponc phare - niveau 13",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",maxzoom:13,filter:["==","txt_typo","PHARE"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"right","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro"]},paint:{"text-color":"#363636"}},{id:"toponyme bati ponc phare - niveau 14à19",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:13,filter:["all",["==","symbo","PHARE"],["in","txt_typo","TYPO_C_6","TYPO_C_7","TYPO_C_8","TYPO_E_GE"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"right","text-size":{stops:[[13,12],[18,18]]},"text-allow-overlap":!1,"text-offset":[-2,0],"text-padding":3,"text-font":["Source Sans Pro"]},paint:{"text-color":"#363636"}},{id:"toponyme bati ponc autre",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:12,filter:["in","txt_typo","BAT_ACTIVITE","BAT_FORTIF","BAT_VILLAGE_DETRUIT"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"center","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro"]},paint:{"text-color":"#363636"}},{id:"toponyme bati ponc aerogare",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:14,maxzoom:17,filter:["all",["==","txt_typo","TYPO_E_GE"],["==","symbo","AEROGARE"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"center","text-size":{stops:[[12,9],[16,11]]},"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#170e22","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":1}},{id:"toponyme bati ponc aeroport 12",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:11,maxzoom:12,filter:["==","txt_typo","AEROPORT_PONC"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"bottom","text-offset":[0,-1.3],"text-size":10.5,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro"]},paint:{"text-color":"#170e22","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme bati ponc aeroport 13",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:12,maxzoom:13,filter:["==","txt_typo","AEROPORT_PONC"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"bottom","text-offset":[0,-2],"text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro"]},paint:{"text-color":"#170e22","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme bati ponc aeroport",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:13,maxzoom:17,filter:["all",["==","txt_typo","TYPO_A_5"],["==","symbo","AEROPORT"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"center","text-size":{stops:[[12,11],[16,13]]},"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro"]},paint:{"text-color":"#170e22","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme bati ponc aerodrome 12",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:11,maxzoom:12,filter:["==","txt_typo","AERODROME_PONC"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"bottom","text-offset":[0,-1.3],"text-size":9.5,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro"]},paint:{"text-color":"#170e22","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme bati ponc aerodrome 13",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:12,maxzoom:13,filter:["in","txt_typo","AERODROME_PONC","AERODROME_IMPORT_PONC"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"bottom","text-offset":[0,-2],"text-size":10,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro"]},paint:{"text-color":"#170e22","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme bati ponc aerodrome",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:13,maxzoom:17,filter:["all",["==","txt_typo","TYPO_A_7"],["==","symbo","AERODROME"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-anchor":"center","text-size":{stops:[[12,10],[16,12]]},"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro"]},paint:{"text-color":"#170e22","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - hydro ponc 5",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_ponc",filter:["in","txt_typo","TYPO_D_9","TYPO_D_10","TYPO_E_1_cyan"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,11],[17,14]]},"text-allow-overlap":!0,"text-padding":5,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#cacaca","text-halo-color":"#FFFFFF","text-halo-width":1}},{id:"toponyme - hydro ponc glacier",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_ponc",filter:["==","txt_typo","ORO_GLACIER_2"],layout:{"symbol-placement":"point","text-field":"{texte}","text-size":14,"text-anchor":"center","text-allow-overlap":!0,"text-padding":1,"text-font":["Source Sans Pro Italic"],visibility:"visible"},paint:{"text-color":"#cacaca","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - limite militaire ponc 3 et 4",type:"symbol",source:"plan_ign","source-layer":"toponyme_limite_ponc",filter:["in","txt_typo","LIM_MILI_3","LIM_MILI_4"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":12,"text-allow-overlap":!1,"text-padding":2,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#1b1b1b","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":1}},{id:"toponyme - limite parc ponc 3 et 4",type:"symbol",source:"plan_ign","source-layer":"toponyme_limite_ponc",filter:["in","txt_typo","LIM_PARC_3","LIM_PARC_4","RESERVE_NATURELLE_PONC"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":13,"text-allow-overlap":!1,"text-padding":2,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#557344","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":1}},{id:"toponyme numéro de route - départementale",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_numero_lin",minzoom:11,maxzoom:16,filter:["==","txt_typo","Départementale"],layout:{visibility:"visible","symbol-placement":"line","text-field":"{texte}","text-size":10.5,"text-allow-overlap":!1,"text-padding":2,"text-anchor":"center","text-font":["Source Sans Pro Semibold"],"text-rotation-alignment":"viewport"},paint:{"text-color":"#4d4d4d","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme numéro de route - nationale",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_numero_lin",minzoom:7,maxzoom:16,filter:["==","txt_typo","Nationale"],layout:{visibility:"visible","symbol-placement":"line","text-field":"{texte}","text-size":12,"text-allow-overlap":!1,"text-padding":0,"text-anchor":"center","text-font":["Source Sans Pro Regular"],"icon-image":"Ecluse","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","icon-text-fit":"both","icon-size":0},paint:{"text-color":"#f0f0f0","icon-color":"#646464","text-halo-color":"rgba(80, 80, 80, 0.5)","text-halo-width":4}},{id:"toponyme numéro de route - autoroute",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_numero_lin",minzoom:7,maxzoom:16,filter:["==","txt_typo","Autoroute"],layout:{visibility:"visible","symbol-placement":"line","text-field":"{texte}","text-size":15,"text-allow-overlap":!1,"text-padding":0,"text-anchor":"center","text-font":["Source Sans Pro Regular"],"icon-image":"Ecluse","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","icon-text-fit":"both","icon-size":0},paint:{"text-color":"#f0f0f0","icon-color":"#646464","text-halo-color":"rgba(80, 80, 80, 0.5)","text-halo-width":5}},{id:"toponyme - odonyme abrégé",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_odonyme_lin",minzoom:15,maxzoom:17,layout:{"symbol-placement":"line","text-field":"{nom_gauche}","text-size":10,"text-anchor":"center","text-max-angle":30,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#000000","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 1)"}},{id:"toponyme - odonyme desabrégé",type:"symbol",source:"plan_ign","source-layer":"toponyme_routier_odonyme_lin",minzoom:17,layout:{"symbol-placement":"line","text-field":"{nom_desabrege}","text-size":11,"text-anchor":"center","text-max-angle":30,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#000000","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 1)"}},{id:"toponyme - lieu dit non habité 3",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["all",["==","symbo","LIEU-DIT_NON_HABITE"],["in","txt_typo","TYPO_B_10","TYPO_B_11"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":1}},{id:"toponyme - bois",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["all",["==","symbo","BOIS"],["in","txt_typo","TYPO_F_9","TYPO_F_10"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":13,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#557344","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":1}},{id:"toponyme - oro lineaire 4",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_lin",filter:["in","txt_typo","ORO_SOMMET_3","ORO_GORGE_2"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":11,"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-padding":1,"text-font":["Source Sans Pro Italic"],visibility:"visible"},paint:{"text-color":"#564f4e","text-halo-width":1.5,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - oro ponc 4",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_ponc",filter:["in","txt_typo","ORO_SOMMET_3","ORO_GORGE_2","GROTTE","GORGE","TYPO_G_8","TYPO_G_9"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[13,11],[16,16]]},"text-allow-overlap":!0,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#564f4e","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":1.5}},{id:"toponyme - hydro ponc 4",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_ponc",filter:["in","txt_typo","HYD_SURF_4","HYD_SURF_4_T","HYD_SURF_5","HYD_SURF_5_T","TYPO_D_8","SOURCE"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[14,13],[17,16]]},"text-allow-overlap":!0,"text-padding":5,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#cacaca","text-halo-color":"#FFFFFF","text-halo-width":1}},{id:"toponyme quartier ",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",filter:["in","txt_typo","BAT_QUARTIER","BAT_QUARTIER_T"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typo_E_GE Quartier",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:17,maxzoom:18,filter:["all",["==","symbo","QUARTIER"],["==","txt_typo","TYPO_E_GE"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,11],[17,13.5]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typo_E_GE Lieu-dit",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:16,maxzoom:18,filter:["all",["==","symbo","LIEU-DIT-HABITE"],["==","txt_typo","TYPO_E_GE"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,11],[17,13.5]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typoA10",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",maxzoom:18,filter:["==","txt_typo","TYPO_A_10"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,11],[17,13.5]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - lieu dit non habité",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["all",["==","symbo","LIEU-DIT_NON_HABITE"],["in","txt_typo","TYPO_B_7","TYPO_B_8","TYPO_B_9"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":12,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":1}},{id:"toponyme - bois 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["all",["==","symbo","BOIS"],["in","txt_typo","TYPO_F_6","TYPO_F_7","TYPO_F_8"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":16,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#557344","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite hameau ",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:11,maxzoom:13,filter:["in","txt_typo","BAT_HAMEAU","BAT_HAMEAU_T"],layout:{visibility:"visible","symbol-placement":"point","icon-image":"Localite","icon-size":.17,"text-field":"{texte}","text-size":11,"text-allow-overlap":!1,"text-anchor":"bottom-left","text-offset":[.3,.1],"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite importance 6et7 - Special DOM",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:7,maxzoom:13,filter:["in","txt_typo","TYPO_A_6","TYPO_A_7"],layout:{visibility:"visible","symbol-placement":"point","icon-image":"Localite","icon-size":.21,"text-field":"{texte}","text-size":12.5,"text-allow-overlap":!1,"text-anchor":"bottom-left","text-offset":[.3,.1],"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite importance 5",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:9,maxzoom:13,filter:["in","txt_typo","TYPO_A_5","BAT_COMMUNE_5","BAT_COMMUNE_5_T","BAT_CHEF_LIEU_COM","BAT_CHEF_LIEU_COM_T","BAT_CHEF_LIEU_COM-T","BAT_ANCIENNE_COM","BAT_ANCIENNE_COM_T","BAT_COMMUNE_ASSOCIEE","BAT_COMMUNE_ASSOCIEE_T","Commune très petite"],layout:{visibility:"visible","symbol-placement":"point","icon-image":"Localite","icon-size":.21,"text-field":"{texte}","text-size":11.5,"text-allow-overlap":!1,"text-anchor":"bottom-left","text-offset":[.3,.1],"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - ocs lineaire 3",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_lin",filter:["==","txt_typo","OCS_FORET_3"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":{stops:[[10,12],[12,15]]},"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-padding":1,"text-font":["Source Sans Pro Italic"],visibility:"visible"},paint:{"text-color":"#557344","text-halo-width":1,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - lieu dit non habité 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["all",["==","symbo","LIEU-DIT_NON_HABITE"],["in","txt_typo","TYPO_B_5","TYPO_B_4"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":15,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":1}},{id:"toponyme - bois 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["all",["==","symbo","BOIS"],["in","txt_typo","TYPO_F_5","TYPO_F_4"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":19,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#557344","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - bois 0",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["all",["==","symbo","BOIS"],["in","txt_typo","TYPO_F_3","TYPO_F_2"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":22,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#557344","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - ocs ponc 3",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["==","txt_typo","OCS_FORET_3"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[10,12],[12,15]]},"text-allow-overlap":!1,"text-padding":1,"text-anchor":"center","text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#557344","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":1}},{id:"toponyme - oro lineaire 3",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_lin",filter:["in","txt_typo","ORO_ILE_3","ORO_RELIEF_3","ORO_RELIEF_3_T","ORO_RELIEF_4","ORO_RELIEF_4_T","ORO_CAP_2","ORO_CAP_3","ORO_SOMMET_2","ORO_COL_2","ORO_GORGE_1","ORO_GORGE-1"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":12,"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-padding":10,"text-font":["Source Sans Pro Italic"],visibility:"visible"},paint:{"text-color":"#564f4e","text-halo-width":1.5,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - oro ponc 3",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_ponc",filter:["in","txt_typo","ORO_ILE_3","ORO_RELIEF_3","ORO_RELIEF_3_T","ORO_RELIEF_4","ORO_RELIEF_4_T","ORO_CAP_2","ORO_CAP_3","ORO_SOMMET_2","ORO_COL_2","ORO_GORGE_1","ORO_GORGE-1","TYPO_G_6","TYPO_G_7"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[13,12],[16,17]]},"text-allow-overlap":!0,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#564f4e","text-halo-color":"#FFFFFF","text-halo-width":1.5}},{id:"toponyme - hydro lineaire 3",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_lin",filter:["in","txt_typo","HYD_LIN_3","HYD_LIN_4","HYD_LIN_5","TYPO_D_LIN_3","TYPO_D_LIN_4","HYD_SURF_3","HYD_SURF_3_T","HYD_SURF_4","HYD_SURF_4_T","HYD_SURF_5","HYD_SURF_5_T","TYPO_D_5","TYPO_D_7"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":{stops:[[14,12],[18,19]]},"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-padding":10,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#cacaca","text-halo-width":1.5,"text-halo-color":"rgba(255, 255, 255, 0.7)"}},{id:"toponyme - hydro lineaire 4",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_lin",minzoom:14,filter:["in","txt_typo","TYPO_D_6","TYPO_D_8","TYPO_D_9","TYPO_D_10"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":{stops:[[14,10],[18,16]]},"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-padding":10,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#cacaca","text-halo-width":1.5,"text-halo-color":"rgba(255, 255, 255, 0.7)"}},{id:"toponyme - hydro ponc 3",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_ponc",filter:["in","txt_typo","HYD_SURF_3","TYPO_D_5","TYPO_D_6","TYPO_D_7"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[9,13],[10,15],[15,15],[17,18]]},"text-allow-overlap":!0,"text-padding":10,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#cacaca","text-halo-color":"#FFFFFF","text-halo-width":2}},{id:"toponyme bati ponc zai zoom 16",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:15,maxzoom:16,filter:["==","txt_typo","zai"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{designation}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme bati ponc zai zoom 17 et 18",type:"symbol",source:"plan_ign","source-layer":"toponyme_bati_ponc",minzoom:16,filter:["==","txt_typo","zai"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#000000"}},{id:"toponyme localite importance 4",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:7,maxzoom:13,filter:["in","txt_typo","TYPO_A_4","BAT_COMMUNE_4","BAT_COMMUNE_4_T"],layout:{visibility:"visible","symbol-placement":"point","icon-image":"Localite","icon-size":.21,"text-field":"{texte}","text-size":13,"text-allow-overlap":!1,"text-anchor":"bottom-left","text-offset":[.3,.1],"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typoA9",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",maxzoom:18,filter:["==","txt_typo","TYPO_A_9"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,11.5],[17,14]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typoA8 non commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:18,filter:["all",["!=","symbo","COMMUNE_FUSIONNEE"],["!=","symbo","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_8"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,12],[17,15]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - limite militaire ponc 1 et 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_limite_ponc",filter:["in","txt_typo","LIM_MILI_1","LIM_MILI_2"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":15,"text-allow-overlap":!1,"text-padding":5,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#1b1b1b","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - limite parc marin",type:"symbol",source:"plan_ign","source-layer":"toponyme_limite_ponc",minzoom:8,filter:["in","txt_typo","PARC_MARIN_1","PARC_MARIN_2"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":15,"text-allow-overlap":!1,"text-padding":10,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#787878","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - limite parc ponc 1 et 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_limite_ponc",minzoom:8,filter:["in","txt_typo","LIM_PARC_1","LIM_PARC_2","PARC_1","PARC_2"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":15,"text-allow-overlap":!1,"text-padding":10,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#557344","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - ocs lineaire 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_lin",filter:["==","txt_typo","OCS_FORET_2"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":{stops:[[10,15],[12,18]]},"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-padding":1,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#557344","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - ocs ponc 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["==","txt_typo","OCS_FORET_2"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[10,15],[12,18]]},"text-allow-overlap":!1,"text-padding":1,"text-anchor":"center","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#557344","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - oro lineaire 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_lin",filter:["in","txt_typo","ORO_ILE_2","ORO_RELIEF_2","ORO_RELIEF_2_T","ORO_CAP_1","ORO_SOMMET_1"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":15,"text-anchor":"center","text-keep-upright":!0,"text-padding":10,"text-max-angle":45,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#564f4e","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - oro ponc 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_ponc",minzoom:9,filter:["in","txt_typo","ORO_ILE_2","ORO_RELIEF_2","ORO_RELIEF_2_T","ORO_CAP_1","ORO_COL_1","TYPO_G_5","ORO_SOMMET_1"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[9,13],[10,15],[13,15],[16,19]]},"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#564f4e","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - oro ponc 2B",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_ponc",minzoom:8,filter:["==","txt_typo","TYPO_G_4"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[13,15],[16,19]]},"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#564f4e","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - hydro lineaire 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_lin",filter:["in","txt_typo","HYD_LIN_2","TYPO_D_LIN_2","HYD_SURF_2","HYD_SURF_2_T","TYPO_D_4"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":{stops:[[14,15],[18,21]]},"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-padding":10,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#cacaca","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - hydro ponc 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_ponc",minzoom:5,filter:["in","txt_typo","moyen","HYD_SURF_2","TYPO_D_2"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[5,12],[6,18],[10,17],[18,21]]},"text-allow-overlap":!1,"text-padding":10,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#cacaca","text-halo-color":"#FFFFFF","text-halo-width":2}},{id:"toponyme - hydro ponc 2B",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_ponc",filter:["in","txt_typo","TYPO_D_3","TYPO_D_4"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[9,15],[10,17],[18,21]]},"text-allow-overlap":!1,"text-padding":10,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#cacaca","text-halo-color":"#FFFFFF","text-halo-width":2}},{id:"toponyme localite importance 3",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:5,maxzoom:13,filter:["in","txt_typo","commune 3","TYPO_A_3","BAT_COMMUNE_3","BAT_COMMUNE_3_T"],layout:{visibility:"visible","symbol-placement":"point","icon-image":"Localite","icon-size":.21,"text-field":"{texte}","text-size":{stops:[[5,10],[6,15]]},"text-allow-overlap":!1,"text-anchor":"bottom-left","text-offset":[.3,.1],"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typoA7 non commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:18,filter:["all",["!=","symbo","COMMUNE_FUSIONNEE"],["!=","symbo","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_7"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,13],[17,16]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typoA5etA6 non commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:18,filter:["all",["!=","symbo","COMMUNE_FUSIONNEE"],["!=","symbo","COMMUNE_CHEF_LIEU"],["in","txt_typo","TYPO_A_5","TYPO_A_6"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,15],[17,18]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - oro lineaire 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_lin",filter:["in","txt_typo","ORO_ILE_1","ORO_RELIEF_1","ORO_RELIEF_1_T"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":20,"text-anchor":"center","text-keep-upright":!0,"text-padding":5,"text-max-angle":45,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#564f4e","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - oro ponc monde",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_ponc",minzoom:5,filter:["in","txt_typo","Basin","Depression","Desert","Geoarea","Gorge","Isthmus","Lake","Lowland","Pen/cape","Plain","Plateau","Range/mtn","Tundra","Valley","Island","Island group"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":11,"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Italic"]},paint:{"text-color":"#564f4e","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typoA4 non commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:16,filter:["all",["!=","symbo","COMMUNE_FUSIONNEE"],["!=","symbo","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_4"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":17,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":3}},{id:"toponyme - ocs lineaire 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_lin",filter:["==","txt_typo","OCS_FORET_1"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":{stops:[[10,18],[12,22]]},"text-anchor":"center","text-keep-upright":!0,"text-padding":1,"text-max-angle":45,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#557344","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - ocs ponc 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_ocs_ponc",filter:["==","txt_typo","OCS_FORET_1"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[10,18],[12,22]]},"text-allow-overlap":!0,"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#557344","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - oro ponc 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_ponc",minzoom:8,filter:["in","txt_typo","ORO_ILE_1","ORO_RELIEF_1","ORO_RELIEF_1_T","TYPO_G_1"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":21,"text-allow-overlap":!0,"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#564f4e","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - oro ponc 1B",type:"symbol",source:"plan_ign","source-layer":"toponyme_oro_ponc",minzoom:8,filter:["in","txt_typo","TYPO_G_2","TYPO_G_3"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[12,15],[13,21]]},"text-allow-overlap":!1,"text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#564f4e","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme - hydro lineaire glacier",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_lin",filter:["in","txt_typo","ORO_GLACIER_1","ORO_GLACIER_2"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":15,"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-font":["Source Sans Pro Italic"],visibility:"visible"},paint:{"text-color":"#cacaca","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - hydro lineaire 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_lin",filter:["in","txt_typo","HYD_LIN_1","HYD-LIN-1","TYPO_D_LIN_1","HYD_SURF_1","HYD_SURF_1_T","TYPO_D_1","TYPO_D_2","TYPO_D_3_T","TYPO_D_4_T"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":18,"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-padding":10,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#cacaca","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - hydro lineaire ocean",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_lin",filter:["==","txt_typo","OCEAN_MER"],layout:{"symbol-placement":"line","text-field":"{texte}","text-size":30,"text-anchor":"center","text-keep-upright":!0,"text-max-angle":45,"text-padding":10,"text-font":["Source Sans Pro Regular"],visibility:"visible"},paint:{"text-color":"#cacaca","text-halo-width":4,"text-halo-color":"rgba(255, 255, 255, 0.5)"}},{id:"toponyme - hydro ponc 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_ponc",minzoom:4,filter:["in","txt_typo","mer","grand","HYD_SURF_1","TYPO_D_1"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[4,16],[6,30],[10,25]]},"text-allow-overlap":!0,"text-padding":10,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#cacaca","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme localite importance 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:4,maxzoom:13,filter:["in","txt_typo","commune 2","TYPO_A_2","BAT_COMMUNE_2","BAT_COMMUNE-2","BAT_COMMUNE_2_T"],layout:{visibility:"visible","symbol-placement":"point","icon-image":"Localite","icon-size":.25,"text-field":"{texte}","text-size":{stops:[[4,10],[6,17]]},"text-allow-overlap":!0,"text-anchor":"bottom-left","text-offset":[.3,.2],"text-padding":1,"text-transform":"uppercase","text-font":{stops:[[1,["Source Sans Pro Regular"]],[7,["Source Sans Pro Bold"]],[10,["Source Sans Pro Regular"]]]}},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":3}},{id:"toponyme localite n0 typoA3 non commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:16,filter:["all",["!=","symbo","COMMUNE_FUSIONNEE"],["!=","symbo","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_3"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":19,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":3}},{id:"toponyme localite n0 typoA2 non commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:16,filter:["all",["!=","symbo","COMMUNE_FUSIONNEE"],["!=","symbo","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_2"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":21,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme localite n0 typoA8 commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:18,filter:["all",["in","symbo","COMMUNE_FUSIONNEE","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_8"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,12],[17,15]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typoA7 commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:18,filter:["all",["in","symbo","COMMUNE_FUSIONNEE","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_7"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,13],[17,16]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typoA5etA6 commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:18,filter:["all",["in","symbo","COMMUNE_FUSIONNEE","COMMUNE_CHEF_LIEU"],["in","txt_typo","TYPO_A_5","TYPO_A_6"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[15,15],[17,18]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":2}},{id:"toponyme localite n0 typoA1 non commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:16,filter:["all",["!=","symbo","COMMUNE_FUSIONNEE"],["!=","symbo","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_1"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":23,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme localite n0 typoA4 commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:16,filter:["all",["in","symbo","COMMUNE_FUSIONNEE","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_4"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":17,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":3}},{id:"toponyme localite n0 typoA3 commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:16,filter:["all",["in","symbo","COMMUNE_FUSIONNEE","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_3"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":19,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":3}},{id:"toponyme localite n0 typoA2 commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:16,filter:["all",["in","symbo","COMMUNE_FUSIONNEE","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_2"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":21,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme localite importance 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:3,maxzoom:13,filter:["in","txt_typo","commune 1","TYPO_A_1","BAT_COMMUNE_1","BAT_COMMUNE_1_T"],layout:{visibility:"visible","symbol-placement":"point","icon-image":"Localite","icon-size":.3,"text-field":"{texte}","text-size":{stops:[[3,10],[6,20]]},"text-allow-overlap":!1,"text-anchor":"bottom-left","text-offset":[.25,-.1],"text-padding":1,"text-transform":"uppercase","text-font":{stops:[[1,["Source Sans Pro Regular"]],[7,["Source Sans Pro Bold"]],[10,["Source Sans Pro Regular"]]]}},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme localite n0 typoA1 commune",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:13,maxzoom:16,filter:["all",["in","symbo","COMMUNE_FUSIONNEE","COMMUNE_CHEF_LIEU"],["==","txt_typo","TYPO_A_1"]],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":23,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#000000","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme - hydro ponc ocean",type:"symbol",source:"plan_ign","source-layer":"toponyme_hydro_ponc",minzoom:1,filter:["==","txt_typo","ocean"],layout:{visibility:"visible","symbol-placement":"point","text-field":"{texte}","text-size":{stops:[[1,16],[6,30]]},"text-allow-overlap":!0,"text-anchor":"center","text-padding":10,"text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#cacaca","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme pays 3",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:4,maxzoom:5,filter:["==","txt_typo","pays 3"],layout:{visibility:"visible","text-field":"{texte}","text-size":9,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#787878","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme pays 2",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:2,maxzoom:5,filter:["==","txt_typo","pays 2"],layout:{visibility:"visible","text-field":"{texte}","text-size":13,"text-allow-overlap":!0,"text-anchor":"center","text-padding":2,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#787878","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme pays 1",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",minzoom:2,maxzoom:5,filter:["==","txt_typo","pays 1"],layout:{visibility:"visible","text-field":"{texte}","text-size":13,"text-allow-overlap":!0,"text-anchor":"center","text-padding":2,"text-transform":"uppercase","text-font":["Source Sans Pro Regular"]},paint:{"text-color":"#787878","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}},{id:"toponyme continent",type:"symbol",source:"plan_ign","source-layer":"toponyme_localite_ponc",maxzoom:3,filter:["==","txt_typo","continent"],layout:{visibility:"visible","text-field":"{texte}","text-size":15,"text-allow-overlap":!0,"text-anchor":"center","text-padding":1,"text-transform":"uppercase","text-font":["Source Sans Pro Bold"]},paint:{"text-color":"#787878","text-halo-color":"rgba(255, 255, 255, 0.5)","text-halo-width":4}}];var im;const energyStyles=JSON.parse(((im=document.getElementById("energy-styles"))==null?void 0:im.innerText)??"{}");var rm;const energyFamilies=JSON.parse(((rm=document.getElementById("energy-families"))==null?void 0:rm.innerText)??"{}"),colorExpression=()=>{const mi=["match",["get","source"]];for(const vi in energyFamilies)mi.push(vi),mi.push(energyStyles[energyFamilies[vi]].color);return mi.push("#828282"),mi},iconExpression=()=>{const mi=["match",["get","source"]];for(const vi in energyFamilies)mi.push(vi),mi.push(energyStyles[energyFamilies[vi]].icon);return mi.push("electricity"),mi},energyLayers=()=>[{id:"power_plants_area",source:"parc_elec","source-layer":"power_plants",type:"fill",minzoom:10,paint:{"fill-antialias":!0,"fill-color":colorExpression(),"fill-opacity":.5}},{id:"power_plants_outline",source:"parc_elec","source-layer":"power_plants",type:"line",minzoom:10,paint:{"line-width":3,"line-color":colorExpression()}},{id:"power_plants_circle",source:"parc_elec","source-layer":"power_plants_name",type:"circle",filter:["all",["<",["zoom"],10],["<=",["get","output"],1e9]],paint:{"circle-color":colorExpression(),"circle-radius":["interpolate",["linear"],["zoom"],7,3,10,9],"circle-opacity":.7}},{id:"power_plants_icon",source:"parc_elec","source-layer":"power_plants_name",type:"symbol",filter:["any",[">=",["get","output"],1e9],["all",[">=",["zoom"],7],[">=",["get","output"],1e8]],["all",[">=",["zoom"],9],[">=",["get","output"],1e7]],[">=",["zoom"],10]],layout:{"icon-allow-overlap":!0,"icon-image":iconExpression(),"icon-size":["interpolate",["linear"],["zoom"],7,.7,18,1]}},{id:"power_plants_name",source:"parc_elec","source-layer":"power_plants_name",type:"symbol",minzoom:6.5,filter:["any",[">=",["get","output"],1e9],["all",[">=",["zoom"],7],[">=",["get","output"],1e8]],["all",[">=",["zoom"],9],[">=",["get","output"],1e7]],[">=",["zoom"],10]],layout:{"symbol-placement":"point","text-field":"{name}","text-offset":[0,1.7],"text-size":["interpolate",["linear"],["zoom"],10,11,18,13],"text-anchor":"top","text-keep-upright":!0,"text-max-angle":45,"text-font":["Source Sans Pro Bold Italic"]},paint:{"text-halo-color":"#fff","text-halo-width":1}}];var htmx_min={exports:{}};(function(module){(function(mi,vi){module.exports?module.exports=vi():mi.htmx=mi.htmx||vi()})(typeof self<"u"?self:commonjsGlobal,function(){return function(){var Q={onLoad:B,process:zt,on:de,off:ge,trigger:ce,ajax:Nr,find:C,findAll:f,closest:v,values:function(mi,vi){var Si=dr(mi,vi||"post");return Si.values},remove:_,addClass:z,removeClass:n,toggleClass:$,takeClass:W,defineExtension:Ur,removeExtension:Fr,logAll:V,logNone:j,logger:null,config:{historyEnabled:!0,historyCacheSize:10,refreshOnHistoryMiss:!1,defaultSwapStyle:"innerHTML",defaultSwapDelay:0,defaultSettleDelay:20,includeIndicatorStyles:!0,indicatorClass:"htmx-indicator",requestClass:"htmx-request",addedClass:"htmx-added",settlingClass:"htmx-settling",swappingClass:"htmx-swapping",allowEval:!0,allowScriptTags:!0,inlineScriptNonce:"",attributesToSettle:["class","style","width","height"],withCredentials:!1,timeout:0,wsReconnectDelay:"full-jitter",wsBinaryType:"blob",disableSelector:"[hx-disable], [data-hx-disable]",useTemplateFragments:!1,scrollBehavior:"smooth",defaultFocusScroll:!1,getCacheBusterParam:!1,globalViewTransitions:!1,methodsThatUseUrlParams:["get"],selfRequestsOnly:!1,ignoreTitle:!1,scrollIntoViewOnBoost:!0,triggerSpecsCache:null},parseInterval:d,_:t,createEventSource:function(mi){return new EventSource(mi,{withCredentials:!0})},createWebSocket:function(mi){var vi=new WebSocket(mi,[]);return vi.binaryType=Q.config.wsBinaryType,vi},version:"1.9.11"},r={addTriggerHandler:Lt,bodyContains:se,canAccessLocalStorage:U,findThisElement:xe,filterValues:yr,hasAttribute:o,getAttributeValue:te,getClosestAttributeValue:ne,getClosestMatch:c,getExpressionVars:Hr,getHeaders:xr,getInputValues:dr,getInternalData:ae,getSwapSpecification:wr,getTriggerSpecs:it,getTarget:ye,makeFragment:l,mergeObjects:le,makeSettleInfo:T,oobSwap:Ee,querySelectorExt:ue,selectAndSwap:je,settleImmediately:nr,shouldCancel:ut,triggerEvent:ce,triggerErrorEvent:fe,withExtensions:R},w=["get","post","put","delete","patch"],i=w.map(function(mi){return"[hx-"+mi+"], [data-hx-"+mi+"]"}).join(", "),S=e("head"),q=e("title"),H=e("svg",!0);function e(mi,vi=!1){return new RegExp(`<${mi}(\\s[^>]*>|>)([\\s\\S]*?)<\\/${mi}>`,vi?"gim":"im")}function d(mi){if(mi==null)return;let vi=NaN;return mi.slice(-2)=="ms"?vi=parseFloat(mi.slice(0,-2)):mi.slice(-1)=="s"?vi=parseFloat(mi.slice(0,-1))*1e3:mi.slice(-1)=="m"?vi=parseFloat(mi.slice(0,-1))*1e3*60:vi=parseFloat(mi),isNaN(vi)?void 0:vi}function ee(mi,vi){return mi.getAttribute&&mi.getAttribute(vi)}function o(mi,vi){return mi.hasAttribute&&(mi.hasAttribute(vi)||mi.hasAttribute("data-"+vi))}function te(mi,vi){return ee(mi,vi)||ee(mi,"data-"+vi)}function u(mi){return mi.parentElement}function re(){return document}function c(mi,vi){for(;mi&&!vi(mi);)mi=u(mi);return mi||null}function L(mi,vi,Si){var Mi=te(vi,Si),Oi=te(vi,"hx-disinherit");return mi!==vi&&Oi&&(Oi==="*"||Oi.split(" ").indexOf(Si)>=0)?"unset":Mi}function ne(mi,vi){var Si=null;if(c(mi,function(Mi){return Si=L(mi,Mi,vi)}),Si!=="unset")return Si}function h(mi,vi){var Si=mi.matches||mi.matchesSelector||mi.msMatchesSelector||mi.mozMatchesSelector||mi.webkitMatchesSelector||mi.oMatchesSelector;return Si&&Si.call(mi,vi)}function A(mi){var vi=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Si=vi.exec(mi);return Si?Si[1].toLowerCase():""}function s(mi,vi){for(var Si=new DOMParser,Mi=Si.parseFromString(mi,"text/html"),Oi=Mi.body;vi>0;)vi--,Oi=Oi.firstChild;return Oi==null&&(Oi=re().createDocumentFragment()),Oi}function N(mi){return/<body/.test(mi)}function l(mi){var vi=!N(mi),Si=A(mi),Mi=mi;if(Si==="head"&&(Mi=Mi.replace(S,"")),Q.config.useTemplateFragments&&vi){var Oi=s("<body><template>"+Mi+"</template></body>",0),Wr=Oi.querySelector("template").content;return Q.config.allowScriptTags?oe(Wr.querySelectorAll("script"),function(Qr){Q.config.inlineScriptNonce&&(Qr.nonce=Q.config.inlineScriptNonce),Qr.htmxExecuted=navigator.userAgent.indexOf("Firefox")===-1}):oe(Wr.querySelectorAll("script"),function(Qr){_(Qr)}),Wr}switch(Si){case"thead":case"tbody":case"tfoot":case"colgroup":case"caption":return s("<table>"+Mi+"</table>",1);case"col":return s("<table><colgroup>"+Mi+"</colgroup></table>",2);case"tr":return s("<table><tbody>"+Mi+"</tbody></table>",2);case"td":case"th":return s("<table><tbody><tr>"+Mi+"</tr></tbody></table>",3);case"script":case"style":return s("<div>"+Mi+"</div>",1);default:return s(Mi,0)}}function ie(mi){mi&&mi()}function I(mi,vi){return Object.prototype.toString.call(mi)==="[object "+vi+"]"}function k(mi){return I(mi,"Function")}function P(mi){return I(mi,"Object")}function ae(mi){var vi="htmx-internal-data",Si=mi[vi];return Si||(Si=mi[vi]={}),Si}function M(mi){var vi=[];if(mi)for(var Si=0;Si<mi.length;Si++)vi.push(mi[Si]);return vi}function oe(mi,vi){if(mi)for(var Si=0;Si<mi.length;Si++)vi(mi[Si])}function X(mi){var vi=mi.getBoundingClientRect(),Si=vi.top,Mi=vi.bottom;return Si<window.innerHeight&&Mi>=0}function se(mi){return mi.getRootNode&&mi.getRootNode()instanceof window.ShadowRoot?re().body.contains(mi.getRootNode().host):re().body.contains(mi)}function D(mi){return mi.trim().split(/\s+/)}function le(mi,vi){for(var Si in vi)vi.hasOwnProperty(Si)&&(mi[Si]=vi[Si]);return mi}function E(mi){try{return JSON.parse(mi)}catch(vi){return b(vi),null}}function U(){var mi="htmx:localStorageTest";try{return localStorage.setItem(mi,mi),localStorage.removeItem(mi),!0}catch{return!1}}function F(mi){try{var vi=new URL(mi);return vi&&(mi=vi.pathname+vi.search),/^\/$/.test(mi)||(mi=mi.replace(/\/+$/,"")),mi}catch{return mi}}function t(e){return Tr(re().body,function(){return eval(e)})}function B(mi){var vi=Q.on("htmx:load",function(Si){mi(Si.detail.elt)});return vi}function V(){Q.logger=function(mi,vi,Si){console&&console.log(vi,mi,Si)}}function j(){Q.logger=null}function C(mi,vi){return vi?mi.querySelector(vi):C(re(),mi)}function f(mi,vi){return vi?mi.querySelectorAll(vi):f(re(),mi)}function _(mi,vi){mi=p(mi),vi?setTimeout(function(){_(mi),mi=null},vi):mi.parentElement.removeChild(mi)}function z(mi,vi,Si){mi=p(mi),Si?setTimeout(function(){z(mi,vi),mi=null},Si):mi.classList&&mi.classList.add(vi)}function n(mi,vi,Si){mi=p(mi),Si?setTimeout(function(){n(mi,vi),mi=null},Si):mi.classList&&(mi.classList.remove(vi),mi.classList.length===0&&mi.removeAttribute("class"))}function $(mi,vi){mi=p(mi),mi.classList.toggle(vi)}function W(mi,vi){mi=p(mi),oe(mi.parentElement.children,function(Si){n(Si,vi)}),z(mi,vi)}function v(mi,vi){if(mi=p(mi),mi.closest)return mi.closest(vi);do if(mi==null||h(mi,vi))return mi;while(mi=mi&&u(mi));return null}function g(mi,vi){return mi.substring(0,vi.length)===vi}function G(mi,vi){return mi.substring(mi.length-vi.length)===vi}function J(mi){var vi=mi.trim();return g(vi,"<")&&G(vi,"/>")?vi.substring(1,vi.length-2):vi}function Z(mi,vi){return vi.indexOf("closest ")===0?[v(mi,J(vi.substr(8)))]:vi.indexOf("find ")===0?[C(mi,J(vi.substr(5)))]:vi==="next"?[mi.nextElementSibling]:vi.indexOf("next ")===0?[K(mi,J(vi.substr(5)))]:vi==="previous"?[mi.previousElementSibling]:vi.indexOf("previous ")===0?[Y(mi,J(vi.substr(9)))]:vi==="document"?[document]:vi==="window"?[window]:vi==="body"?[document.body]:re().querySelectorAll(J(vi))}var K=function(mi,vi){for(var Si=re().querySelectorAll(vi),Mi=0;Mi<Si.length;Mi++){var Oi=Si[Mi];if(Oi.compareDocumentPosition(mi)===Node.DOCUMENT_POSITION_PRECEDING)return Oi}},Y=function(mi,vi){for(var Si=re().querySelectorAll(vi),Mi=Si.length-1;Mi>=0;Mi--){var Oi=Si[Mi];if(Oi.compareDocumentPosition(mi)===Node.DOCUMENT_POSITION_FOLLOWING)return Oi}};function ue(mi,vi){return vi?Z(mi,vi)[0]:Z(re().body,mi)[0]}function p(mi){return I(mi,"String")?C(mi):mi}function ve(mi,vi,Si){return k(vi)?{target:re().body,event:mi,listener:vi}:{target:p(mi),event:vi,listener:Si}}function de(mi,vi,Si){jr(function(){var Oi=ve(mi,vi,Si);Oi.target.addEventListener(Oi.event,Oi.listener)});var Mi=k(vi);return Mi?vi:Si}function ge(mi,vi,Si){return jr(function(){var Mi=ve(mi,vi,Si);Mi.target.removeEventListener(Mi.event,Mi.listener)}),k(vi)?vi:Si}var pe=re().createElement("output");function me(mi,vi){var Si=ne(mi,vi);if(Si){if(Si==="this")return[xe(mi,vi)];var Mi=Z(mi,Si);return Mi.length===0?(b('The selector "'+Si+'" on '+vi+" returned no matches!"),[pe]):Mi}}function xe(mi,vi){return c(mi,function(Si){return te(Si,vi)!=null})}function ye(mi){var vi=ne(mi,"hx-target");if(vi)return vi==="this"?xe(mi,"hx-target"):ue(mi,vi);var Si=ae(mi);return Si.boosted?re().body:mi}function be(mi){for(var vi=Q.config.attributesToSettle,Si=0;Si<vi.length;Si++)if(mi===vi[Si])return!0;return!1}function we(mi,vi){oe(mi.attributes,function(Si){!vi.hasAttribute(Si.name)&&be(Si.name)&&mi.removeAttribute(Si.name)}),oe(vi.attributes,function(Si){be(Si.name)&&mi.setAttribute(Si.name,Si.value)})}function Se(mi,vi){for(var Si=Br(vi),Mi=0;Mi<Si.length;Mi++){var Oi=Si[Mi];try{if(Oi.isInlineSwap(mi))return!0}catch(Wr){b(Wr)}}return mi==="outerHTML"}function Ee(mi,vi,Si){var Mi="#"+ee(vi,"id"),Oi="outerHTML";mi==="true"||(mi.indexOf(":")>0?(Oi=mi.substr(0,mi.indexOf(":")),Mi=mi.substr(mi.indexOf(":")+1,mi.length)):Oi=mi);var Wr=re().querySelectorAll(Mi);return Wr?(oe(Wr,function(Qr){var li,po=vi.cloneNode(!0);li=re().createDocumentFragment(),li.appendChild(po),Se(Oi,Qr)||(li=po);var Ki={shouldSwap:!0,target:Qr,fragment:li};ce(Qr,"htmx:oobBeforeSwap",Ki)&&(Qr=Ki.target,Ki.shouldSwap&&Be(Oi,Qr,Qr,li,Si),oe(Si.elts,function(Lo){ce(Lo,"htmx:oobAfterSwap",Ki)}))}),vi.parentNode.removeChild(vi)):(vi.parentNode.removeChild(vi),fe(re().body,"htmx:oobErrorNoTarget",{content:vi})),mi}function Ce(mi,vi,Si){var Mi=ne(mi,"hx-select-oob");if(Mi)for(var Oi=Mi.split(","),Wr=0;Wr<Oi.length;Wr++){var Qr=Oi[Wr].split(":",2),li=Qr[0].trim();li.indexOf("#")===0&&(li=li.substring(1));var po=Qr[1]||"true",Ki=vi.querySelector("#"+li);Ki&&Ee(po,Ki,Si)}oe(f(vi,"[hx-swap-oob], [data-hx-swap-oob]"),function(Lo){var Ro=te(Lo,"hx-swap-oob");Ro!=null&&Ee(Ro,Lo,Si)})}function Re(mi){oe(f(mi,"[hx-preserve], [data-hx-preserve]"),function(vi){var Si=te(vi,"id"),Mi=re().getElementById(Si);Mi!=null&&vi.parentNode.replaceChild(Mi,vi)})}function Te(mi,vi,Si){oe(vi.querySelectorAll("[id]"),function(Mi){var Oi=ee(Mi,"id");if(Oi&&Oi.length>0){var Wr=Oi.replace("'","\\'"),Qr=Mi.tagName.replace(":","\\:"),li=mi.querySelector(Qr+"[id='"+Wr+"']");if(li&&li!==mi){var po=Mi.cloneNode();we(Mi,li),Si.tasks.push(function(){we(Mi,po)})}}})}function Oe(mi){return function(){n(mi,Q.config.addedClass),zt(mi),Nt(mi),qe(mi),ce(mi,"htmx:load")}}function qe(mi){var vi="[autofocus]",Si=h(mi,vi)?mi:mi.querySelector(vi);Si!=null&&Si.focus()}function a(mi,vi,Si,Mi){for(Te(mi,Si,Mi);Si.childNodes.length>0;){var Oi=Si.firstChild;z(Oi,Q.config.addedClass),mi.insertBefore(Oi,vi),Oi.nodeType!==Node.TEXT_NODE&&Oi.nodeType!==Node.COMMENT_NODE&&Mi.tasks.push(Oe(Oi))}}function He(mi,vi){for(var Si=0;Si<mi.length;)vi=(vi<<5)-vi+mi.charCodeAt(Si++)|0;return vi}function Le(mi){var vi=0;if(mi.attributes)for(var Si=0;Si<mi.attributes.length;Si++){var Mi=mi.attributes[Si];Mi.value&&(vi=He(Mi.name,vi),vi=He(Mi.value,vi))}return vi}function Ae(mi){var vi=ae(mi);if(vi.onHandlers){for(var Si=0;Si<vi.onHandlers.length;Si++){const Mi=vi.onHandlers[Si];mi.removeEventListener(Mi.event,Mi.listener)}delete vi.onHandlers}}function Ne(mi){var vi=ae(mi);vi.timeout&&clearTimeout(vi.timeout),vi.webSocket&&vi.webSocket.close(),vi.sseEventSource&&vi.sseEventSource.close(),vi.listenerInfos&&oe(vi.listenerInfos,function(Si){Si.on&&Si.on.removeEventListener(Si.trigger,Si.listener)}),Ae(mi),oe(Object.keys(vi),function(Si){delete vi[Si]})}function m(mi){ce(mi,"htmx:beforeCleanupElement"),Ne(mi),mi.children&&oe(mi.children,function(vi){m(vi)})}function Ie(mi,vi,Si){if(mi.tagName==="BODY")return Ue(mi,vi,Si);var Mi,Oi=mi.previousSibling;for(a(u(mi),mi,vi,Si),Oi==null?Mi=u(mi).firstChild:Mi=Oi.nextSibling,Si.elts=Si.elts.filter(function(Wr){return Wr!=mi});Mi&&Mi!==mi;)Mi.nodeType===Node.ELEMENT_NODE&&Si.elts.push(Mi),Mi=Mi.nextElementSibling;m(mi),u(mi).removeChild(mi)}function ke(mi,vi,Si){return a(mi,mi.firstChild,vi,Si)}function Pe(mi,vi,Si){return a(u(mi),mi,vi,Si)}function Me(mi,vi,Si){return a(mi,null,vi,Si)}function Xe(mi,vi,Si){return a(u(mi),mi.nextSibling,vi,Si)}function De(mi,vi,Si){return m(mi),u(mi).removeChild(mi)}function Ue(mi,vi,Si){var Mi=mi.firstChild;if(a(mi,Mi,vi,Si),Mi){for(;Mi.nextSibling;)m(Mi.nextSibling),mi.removeChild(Mi.nextSibling);m(Mi),mi.removeChild(Mi)}}function Fe(mi,vi,Si){var Mi=Si||ne(mi,"hx-select");if(Mi){var Oi=re().createDocumentFragment();oe(vi.querySelectorAll(Mi),function(Wr){Oi.appendChild(Wr)}),vi=Oi}return vi}function Be(mi,vi,Si,Mi,Oi){switch(mi){case"none":return;case"outerHTML":Ie(Si,Mi,Oi);return;case"afterbegin":ke(Si,Mi,Oi);return;case"beforebegin":Pe(Si,Mi,Oi);return;case"beforeend":Me(Si,Mi,Oi);return;case"afterend":Xe(Si,Mi,Oi);return;case"delete":De(Si);return;default:for(var Wr=Br(vi),Qr=0;Qr<Wr.length;Qr++){var li=Wr[Qr];try{var po=li.handleSwap(mi,Si,Mi,Oi);if(po){if(typeof po.length<"u")for(var Ki=0;Ki<po.length;Ki++){var Lo=po[Ki];Lo.nodeType!==Node.TEXT_NODE&&Lo.nodeType!==Node.COMMENT_NODE&&Oi.tasks.push(Oe(Lo))}return}}catch(Ro){b(Ro)}}mi==="innerHTML"?Ue(Si,Mi,Oi):Be(Q.config.defaultSwapStyle,vi,Si,Mi,Oi)}}function Ve(mi){if(mi.indexOf("<title")>-1){var vi=mi.replace(H,""),Si=vi.match(q);if(Si)return Si[2]}}function je(mi,vi,Si,Mi,Oi,Wr){Oi.title=Ve(Mi);var Qr=l(Mi);if(Qr)return Ce(Si,Qr,Oi),Qr=Fe(Si,Qr,Wr),Re(Qr),Be(mi,Si,vi,Qr,Oi)}function _e(mi,vi,Si){var Mi=mi.getResponseHeader(vi);if(Mi.indexOf("{")===0){var Oi=E(Mi);for(var Wr in Oi)if(Oi.hasOwnProperty(Wr)){var Qr=Oi[Wr];P(Qr)||(Qr={value:Qr}),ce(Si,Wr,Qr)}}else for(var li=Mi.split(","),po=0;po<li.length;po++)ce(Si,li[po].trim(),[])}var x=/[\s,]/,$e=/[_$a-zA-Z]/,We=/[_$a-zA-Z0-9]/,Ge=['"',"'","/"],Je=/[^\s]/,Ze=/[{(]/,Ke=/[})]/;function Ye(mi){for(var vi=[],Si=0;Si<mi.length;){if($e.exec(mi.charAt(Si))){for(var Mi=Si;We.exec(mi.charAt(Si+1));)Si++;vi.push(mi.substr(Mi,Si-Mi+1))}else if(Ge.indexOf(mi.charAt(Si))!==-1){var Oi=mi.charAt(Si),Mi=Si;for(Si++;Si<mi.length&&mi.charAt(Si)!==Oi;)mi.charAt(Si)==="\\"&&Si++,Si++;vi.push(mi.substr(Mi,Si-Mi+1))}else{var Wr=mi.charAt(Si);vi.push(Wr)}Si++}return vi}function Qe(mi,vi,Si){return $e.exec(mi.charAt(0))&&mi!=="true"&&mi!=="false"&&mi!=="this"&&mi!==Si&&vi!=="."}function et(mi,vi,Si){if(vi[0]==="["){vi.shift();for(var Mi=1,Oi=" return (function("+Si+"){ return (",Wr=null;vi.length>0;){var Qr=vi[0];if(Qr==="]"){if(Mi--,Mi===0){Wr===null&&(Oi=Oi+"true"),vi.shift(),Oi+=")})";try{var li=Tr(mi,function(){return Function(Oi)()},function(){return!0});return li.source=Oi,li}catch(po){return fe(re().body,"htmx:syntax:error",{error:po,source:Oi}),null}}}else Qr==="["&&Mi++;Qe(Qr,Wr,Si)?Oi+="(("+Si+"."+Qr+") ? ("+Si+"."+Qr+") : (window."+Qr+"))":Oi=Oi+Qr,Wr=vi.shift()}}}function y(mi,vi){for(var Si="";mi.length>0&&!vi.test(mi[0]);)Si+=mi.shift();return Si}function tt(mi){var vi;return mi.length>0&&Ze.test(mi[0])?(mi.shift(),vi=y(mi,Ke).trim(),mi.shift()):vi=y(mi,x),vi}var rt="input, textarea, select";function nt(mi,vi,Si){var Mi=[],Oi=Ye(vi);do{y(Oi,Je);var Wr=Oi.length,Qr=y(Oi,/[,\[\s]/);if(Qr!=="")if(Qr==="every"){var li={trigger:"every"};y(Oi,Je),li.pollInterval=d(y(Oi,/[,\[\s]/)),y(Oi,Je);var po=et(mi,Oi,"event");po&&(li.eventFilter=po),Mi.push(li)}else if(Qr.indexOf("sse:")===0)Mi.push({trigger:"sse",sseEvent:Qr.substr(4)});else{var Ki={trigger:Qr},po=et(mi,Oi,"event");for(po&&(Ki.eventFilter=po);Oi.length>0&&Oi[0]!==",";){y(Oi,Je);var Lo=Oi.shift();if(Lo==="changed")Ki.changed=!0;else if(Lo==="once")Ki.once=!0;else if(Lo==="consume")Ki.consume=!0;else if(Lo==="delay"&&Oi[0]===":")Oi.shift(),Ki.delay=d(y(Oi,x));else if(Lo==="from"&&Oi[0]===":"){if(Oi.shift(),Ze.test(Oi[0]))var Ro=tt(Oi);else{var Ro=y(Oi,x);if(Ro==="closest"||Ro==="find"||Ro==="next"||Ro==="previous"){Oi.shift();var fo=tt(Oi);fo.length>0&&(Ro+=" "+fo)}}Ki.from=Ro}else Lo==="target"&&Oi[0]===":"?(Oi.shift(),Ki.target=tt(Oi)):Lo==="throttle"&&Oi[0]===":"?(Oi.shift(),Ki.throttle=d(y(Oi,x))):Lo==="queue"&&Oi[0]===":"?(Oi.shift(),Ki.queue=y(Oi,x)):Lo==="root"&&Oi[0]===":"?(Oi.shift(),Ki[Lo]=tt(Oi)):Lo==="threshold"&&Oi[0]===":"?(Oi.shift(),Ki[Lo]=y(Oi,x)):fe(mi,"htmx:syntax:error",{token:Oi.shift()})}Mi.push(Ki)}Oi.length===Wr&&fe(mi,"htmx:syntax:error",{token:Oi.shift()}),y(Oi,Je)}while(Oi[0]===","&&Oi.shift());return Si&&(Si[vi]=Mi),Mi}function it(mi){var vi=te(mi,"hx-trigger"),Si=[];if(vi){var Mi=Q.config.triggerSpecsCache;Si=Mi&&Mi[vi]||nt(mi,vi,Mi)}return Si.length>0?Si:h(mi,"form")?[{trigger:"submit"}]:h(mi,'input[type="button"], input[type="submit"]')?[{trigger:"click"}]:h(mi,rt)?[{trigger:"change"}]:[{trigger:"click"}]}function at(mi){ae(mi).cancelled=!0}function ot(mi,vi,Si){var Mi=ae(mi);Mi.timeout=setTimeout(function(){se(mi)&&Mi.cancelled!==!0&&(ct(Si,mi,Wt("hx:poll:trigger",{triggerSpec:Si,target:mi}))||vi(mi),ot(mi,vi,Si))},Si.pollInterval)}function st(mi){return location.hostname===mi.hostname&&ee(mi,"href")&&ee(mi,"href").indexOf("#")!==0}function lt(mi,vi,Si){if(mi.tagName==="A"&&st(mi)&&(mi.target===""||mi.target==="_self")||mi.tagName==="FORM"){vi.boosted=!0;var Mi,Oi;if(mi.tagName==="A")Mi="get",Oi=ee(mi,"href");else{var Wr=ee(mi,"method");Mi=Wr?Wr.toLowerCase():"get",Oi=ee(mi,"action")}Si.forEach(function(Qr){ht(mi,function(li,po){if(v(li,Q.config.disableSelector)){m(li);return}he(Mi,Oi,li,po)},vi,Qr,!0)})}}function ut(mi,vi){return!!((mi.type==="submit"||mi.type==="click")&&(vi.tagName==="FORM"||h(vi,'input[type="submit"], button')&&v(vi,"form")!==null||vi.tagName==="A"&&vi.href&&(vi.getAttribute("href")==="#"||vi.getAttribute("href").indexOf("#")!==0)))}function ft(mi,vi){return ae(mi).boosted&&mi.tagName==="A"&&vi.type==="click"&&(vi.ctrlKey||vi.metaKey)}function ct(mi,vi,Si){var Mi=mi.eventFilter;if(Mi)try{return Mi.call(vi,Si)!==!0}catch(Oi){return fe(re().body,"htmx:eventFilter:error",{error:Oi,source:Mi.source}),!0}return!1}function ht(mi,vi,Si,Mi,Oi){var Wr=ae(mi),Qr;Mi.from?Qr=Z(mi,Mi.from):Qr=[mi],Mi.changed&&Qr.forEach(function(li){var po=ae(li);po.lastValue=li.value}),oe(Qr,function(li){var po=function(Ki){if(!se(mi)){li.removeEventListener(Mi.trigger,po);return}if(!ft(mi,Ki)&&((Oi||ut(Ki,mi))&&Ki.preventDefault(),!ct(Mi,mi,Ki))){var Lo=ae(Ki);if(Lo.triggerSpec=Mi,Lo.handledFor==null&&(Lo.handledFor=[]),Lo.handledFor.indexOf(mi)<0){if(Lo.handledFor.push(mi),Mi.consume&&Ki.stopPropagation(),Mi.target&&Ki.target&&!h(Ki.target,Mi.target))return;if(Mi.once){if(Wr.triggeredOnce)return;Wr.triggeredOnce=!0}if(Mi.changed){var Ro=ae(li);if(Ro.lastValue===li.value)return;Ro.lastValue=li.value}if(Wr.delayed&&clearTimeout(Wr.delayed),Wr.throttle)return;Mi.throttle>0?Wr.throttle||(vi(mi,Ki),Wr.throttle=setTimeout(function(){Wr.throttle=null},Mi.throttle)):Mi.delay>0?Wr.delayed=setTimeout(function(){vi(mi,Ki)},Mi.delay):(ce(mi,"htmx:trigger"),vi(mi,Ki))}}};Si.listenerInfos==null&&(Si.listenerInfos=[]),Si.listenerInfos.push({trigger:Mi.trigger,listener:po,on:li}),li.addEventListener(Mi.trigger,po)})}var vt=!1,dt=null;function gt(){dt||(dt=function(){vt=!0},window.addEventListener("scroll",dt),setInterval(function(){vt&&(vt=!1,oe(re().querySelectorAll("[hx-trigger='revealed'],[data-hx-trigger='revealed']"),function(mi){pt(mi)}))},200))}function pt(mi){if(!o(mi,"data-hx-revealed")&&X(mi)){mi.setAttribute("data-hx-revealed","true");var vi=ae(mi);vi.initHash?ce(mi,"revealed"):mi.addEventListener("htmx:afterProcessNode",function(Si){ce(mi,"revealed")},{once:!0})}}function mt(mi,vi,Si){for(var Mi=D(Si),Oi=0;Oi<Mi.length;Oi++){var Wr=Mi[Oi].split(/:(.+)/);Wr[0]==="connect"&&xt(mi,Wr[1],0),Wr[0]==="send"&&bt(mi)}}function xt(mi,vi,Si){if(se(mi)){if(vi.indexOf("/")==0){var Mi=location.hostname+(location.port?":"+location.port:"");location.protocol=="https:"?vi="wss://"+Mi+vi:location.protocol=="http:"&&(vi="ws://"+Mi+vi)}var Oi=Q.createWebSocket(vi);Oi.onerror=function(Wr){fe(mi,"htmx:wsError",{error:Wr,socket:Oi}),yt(mi)},Oi.onclose=function(Wr){if([1006,1012,1013].indexOf(Wr.code)>=0){var Qr=wt(Si);setTimeout(function(){xt(mi,vi,Si+1)},Qr)}},Oi.onopen=function(Wr){Si=0},ae(mi).webSocket=Oi,Oi.addEventListener("message",function(Wr){if(!yt(mi)){var Qr=Wr.data;R(mi,function(fo){Qr=fo.transformResponse(Qr,null,mi)});for(var li=T(mi),po=l(Qr),Ki=M(po.children),Lo=0;Lo<Ki.length;Lo++){var Ro=Ki[Lo];Ee(te(Ro,"hx-swap-oob")||"true",Ro,li)}nr(li.tasks)}})}}function yt(mi){if(!se(mi))return ae(mi).webSocket.close(),!0}function bt(mi){var vi=c(mi,function(Si){return ae(Si).webSocket!=null});vi?mi.addEventListener(it(mi)[0].trigger,function(Si){var Mi=ae(vi).webSocket,Oi=xr(mi,vi),Wr=dr(mi,"post"),Qr=Wr.errors,li=Wr.values,po=Hr(mi),Ki=le(li,po),Lo=yr(Ki,mi);if(Lo.HEADERS=Oi,Qr&&Qr.length>0){ce(mi,"htmx:validation:halted",Qr);return}Mi.send(JSON.stringify(Lo)),ut(Si,mi)&&Si.preventDefault()}):fe(mi,"htmx:noWebSocketSourceError")}function wt(mi){var vi=Q.config.wsReconnectDelay;if(typeof vi=="function")return vi(mi);if(vi==="full-jitter"){var Si=Math.min(mi,6),Mi=1e3*Math.pow(2,Si);return Mi*Math.random()}b('htmx.config.wsReconnectDelay must either be a function or the string "full-jitter"')}function St(mi,vi,Si){for(var Mi=D(Si),Oi=0;Oi<Mi.length;Oi++){var Wr=Mi[Oi].split(/:(.+)/);Wr[0]==="connect"&&Et(mi,Wr[1]),Wr[0]==="swap"&&Ct(mi,Wr[1])}}function Et(mi,vi){var Si=Q.createEventSource(vi);Si.onerror=function(Mi){fe(mi,"htmx:sseError",{error:Mi,source:Si}),Tt(mi)},ae(mi).sseEventSource=Si}function Ct(mi,vi){var Si=c(mi,Ot);if(Si){var Mi=ae(Si).sseEventSource,Oi=function(Wr){if(!Tt(Si)){if(!se(mi)){Mi.removeEventListener(vi,Oi);return}var Qr=Wr.data;R(mi,function(Lo){Qr=Lo.transformResponse(Qr,null,mi)});var li=wr(mi),po=ye(mi),Ki=T(mi);je(li.swapStyle,po,mi,Qr,Ki),nr(Ki.tasks),ce(mi,"htmx:sseMessage",Wr)}};ae(mi).sseListener=Oi,Mi.addEventListener(vi,Oi)}else fe(mi,"htmx:noSSESourceError")}function Rt(mi,vi,Si){var Mi=c(mi,Ot);if(Mi){var Oi=ae(Mi).sseEventSource,Wr=function(){Tt(Mi)||(se(mi)?vi(mi):Oi.removeEventListener(Si,Wr))};ae(mi).sseListener=Wr,Oi.addEventListener(Si,Wr)}else fe(mi,"htmx:noSSESourceError")}function Tt(mi){if(!se(mi))return ae(mi).sseEventSource.close(),!0}function Ot(mi){return ae(mi).sseEventSource!=null}function qt(mi,vi,Si,Mi){var Oi=function(){Si.loaded||(Si.loaded=!0,vi(mi))};Mi>0?setTimeout(Oi,Mi):Oi()}function Ht(mi,vi,Si){var Mi=!1;return oe(w,function(Oi){if(o(mi,"hx-"+Oi)){var Wr=te(mi,"hx-"+Oi);Mi=!0,vi.path=Wr,vi.verb=Oi,Si.forEach(function(Qr){Lt(mi,Qr,vi,function(li,po){if(v(li,Q.config.disableSelector)){m(li);return}he(Oi,Wr,li,po)})})}}),Mi}function Lt(mi,vi,Si,Mi){if(vi.sseEvent)Rt(mi,Mi,vi.sseEvent);else if(vi.trigger==="revealed")gt(),ht(mi,Mi,Si,vi),pt(mi);else if(vi.trigger==="intersect"){var Oi={};vi.root&&(Oi.root=ue(mi,vi.root)),vi.threshold&&(Oi.threshold=parseFloat(vi.threshold));var Wr=new IntersectionObserver(function(Qr){for(var li=0;li<Qr.length;li++){var po=Qr[li];if(po.isIntersecting){ce(mi,"intersect");break}}},Oi);Wr.observe(mi),ht(mi,Mi,Si,vi)}else vi.trigger==="load"?ct(vi,mi,Wt("load",{elt:mi}))||qt(mi,Mi,Si,vi.delay):vi.pollInterval>0?(Si.polling=!0,ot(mi,Mi,vi)):ht(mi,Mi,Si,vi)}function At(mi){if(!mi.htmxExecuted&&Q.config.allowScriptTags&&(mi.type==="text/javascript"||mi.type==="module"||mi.type==="")){var vi=re().createElement("script");oe(mi.attributes,function(Mi){vi.setAttribute(Mi.name,Mi.value)}),vi.textContent=mi.textContent,vi.async=!1,Q.config.inlineScriptNonce&&(vi.nonce=Q.config.inlineScriptNonce);var Si=mi.parentElement;try{Si.insertBefore(vi,mi)}catch(Mi){b(Mi)}finally{mi.parentElement&&mi.parentElement.removeChild(mi)}}}function Nt(mi){h(mi,"script")&&At(mi),oe(f(mi,"script"),function(vi){At(vi)})}function It(mi){for(var vi=mi.attributes,Si=0;Si<vi.length;Si++){var Mi=vi[Si].name;if(g(Mi,"hx-on:")||g(Mi,"data-hx-on:")||g(Mi,"hx-on-")||g(Mi,"data-hx-on-"))return!0}return!1}function kt(mi){var vi=null,Si=[];if(It(mi)&&Si.push(mi),document.evaluate)for(var Mi=document.evaluate('.//*[@*[ starts-with(name(), "hx-on:") or starts-with(name(), "data-hx-on:") or starts-with(name(), "hx-on-") or starts-with(name(), "data-hx-on-") ]]',mi);vi=Mi.iterateNext();)Si.push(vi);else for(var Oi=mi.getElementsByTagName("*"),Wr=0;Wr<Oi.length;Wr++)It(Oi[Wr])&&Si.push(Oi[Wr]);return Si}function Pt(mi){if(mi.querySelectorAll){var vi=", [hx-boost] a, [data-hx-boost] a, a[hx-boost], a[data-hx-boost]",Si=mi.querySelectorAll(i+vi+", form, [type='submit'], [hx-sse], [data-hx-sse], [hx-ws], [data-hx-ws], [hx-ext], [data-hx-ext], [hx-trigger], [data-hx-trigger], [hx-on], [data-hx-on]");return Si}else return[]}function Mt(mi){var vi=v(mi.target,"button, input[type='submit']"),Si=Dt(mi);Si&&(Si.lastButtonClicked=vi)}function Xt(mi){var vi=Dt(mi);vi&&(vi.lastButtonClicked=null)}function Dt(mi){var vi=v(mi.target,"button, input[type='submit']");if(vi){var Si=p("#"+ee(vi,"form"))||v(vi,"form");if(Si)return ae(Si)}}function Ut(mi){mi.addEventListener("click",Mt),mi.addEventListener("focusin",Mt),mi.addEventListener("focusout",Xt)}function Ft(mi){for(var vi=Ye(mi),Si=0,Mi=0;Mi<vi.length;Mi++){const Oi=vi[Mi];Oi==="{"?Si++:Oi==="}"&&Si--}return Si}function Bt(mi,vi,Si){var Mi=ae(mi);Array.isArray(Mi.onHandlers)||(Mi.onHandlers=[]);var Oi,Wr=function(Qr){return Tr(mi,function(){Oi||(Oi=new Function("event",Si)),Oi.call(mi,Qr)})};mi.addEventListener(vi,Wr),Mi.onHandlers.push({event:vi,listener:Wr})}function Vt(mi){var vi=te(mi,"hx-on");if(vi){for(var Si={},Mi=vi.split(`
`),Oi=null,Wr=0;Mi.length>0;){var Qr=Mi.shift(),li=Qr.match(/^\s*([a-zA-Z:\-\.]+:)(.*)/);Wr===0&&li?(Qr.split(":"),Oi=li[1].slice(0,-1),Si[Oi]=li[2]):Si[Oi]+=Qr,Wr+=Ft(Qr)}for(var po in Si)Bt(mi,po,Si[po])}}function jt(mi){Ae(mi);for(var vi=0;vi<mi.attributes.length;vi++){var Si=mi.attributes[vi].name,Mi=mi.attributes[vi].value;if(g(Si,"hx-on")||g(Si,"data-hx-on")){var Oi=Si.indexOf("-on")+3,Wr=Si.slice(Oi,Oi+1);if(Wr==="-"||Wr===":"){var Qr=Si.slice(Oi+1);g(Qr,":")?Qr="htmx"+Qr:g(Qr,"-")?Qr="htmx:"+Qr.slice(1):g(Qr,"htmx-")&&(Qr="htmx:"+Qr.slice(5)),Bt(mi,Qr,Mi)}}}}function _t(mi){if(v(mi,Q.config.disableSelector)){m(mi);return}var vi=ae(mi);if(vi.initHash!==Le(mi)){Ne(mi),vi.initHash=Le(mi),Vt(mi),ce(mi,"htmx:beforeProcessNode"),mi.value&&(vi.lastValue=mi.value);var Si=it(mi),Mi=Ht(mi,vi,Si);Mi||(ne(mi,"hx-boost")==="true"?lt(mi,vi,Si):o(mi,"hx-trigger")&&Si.forEach(function(Qr){Lt(mi,Qr,vi,function(){})})),(mi.tagName==="FORM"||ee(mi,"type")==="submit"&&o(mi,"form"))&&Ut(mi);var Oi=te(mi,"hx-sse");Oi&&St(mi,vi,Oi);var Wr=te(mi,"hx-ws");Wr&&mt(mi,vi,Wr),ce(mi,"htmx:afterProcessNode")}}function zt(mi){if(mi=p(mi),v(mi,Q.config.disableSelector)){m(mi);return}_t(mi),oe(Pt(mi),function(vi){_t(vi)}),oe(kt(mi),jt)}function $t(mi){return mi.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}function Wt(mi,vi){var Si;return window.CustomEvent&&typeof window.CustomEvent=="function"?Si=new CustomEvent(mi,{bubbles:!0,cancelable:!0,detail:vi}):(Si=re().createEvent("CustomEvent"),Si.initCustomEvent(mi,!0,!0,vi)),Si}function fe(mi,vi,Si){ce(mi,vi,le({error:vi},Si))}function Gt(mi){return mi==="htmx:afterProcessNode"}function R(mi,vi){oe(Br(mi),function(Si){try{vi(Si)}catch(Mi){b(Mi)}})}function b(mi){console.error?console.error(mi):console.log&&console.log("ERROR: ",mi)}function ce(mi,vi,Si){mi=p(mi),Si==null&&(Si={}),Si.elt=mi;var Mi=Wt(vi,Si);Q.logger&&!Gt(vi)&&Q.logger(mi,vi,Si),Si.error&&(b(Si.error),ce(mi,"htmx:error",{errorInfo:Si}));var Oi=mi.dispatchEvent(Mi),Wr=$t(vi);if(Oi&&Wr!==vi){var Qr=Wt(Wr,Mi.detail);Oi=Oi&&mi.dispatchEvent(Qr)}return R(mi,function(li){Oi=Oi&&li.onEvent(vi,Mi)!==!1&&!Mi.defaultPrevented}),Oi}var Jt=location.pathname+location.search;function Zt(){var mi=re().querySelector("[hx-history-elt],[data-hx-history-elt]");return mi||re().body}function Kt(mi,vi,Si,Mi){if(U()){if(Q.config.historyCacheSize<=0){localStorage.removeItem("htmx-history-cache");return}mi=F(mi);for(var Oi=E(localStorage.getItem("htmx-history-cache"))||[],Wr=0;Wr<Oi.length;Wr++)if(Oi[Wr].url===mi){Oi.splice(Wr,1);break}var Qr={url:mi,content:vi,title:Si,scroll:Mi};for(ce(re().body,"htmx:historyItemCreated",{item:Qr,cache:Oi}),Oi.push(Qr);Oi.length>Q.config.historyCacheSize;)Oi.shift();for(;Oi.length>0;)try{localStorage.setItem("htmx-history-cache",JSON.stringify(Oi));break}catch(li){fe(re().body,"htmx:historyCacheError",{cause:li,cache:Oi}),Oi.shift()}}}function Yt(mi){if(!U())return null;mi=F(mi);for(var vi=E(localStorage.getItem("htmx-history-cache"))||[],Si=0;Si<vi.length;Si++)if(vi[Si].url===mi)return vi[Si];return null}function Qt(mi){var vi=Q.config.requestClass,Si=mi.cloneNode(!0);return oe(f(Si,"."+vi),function(Mi){n(Mi,vi)}),Si.innerHTML}function er(){var mi=Zt(),vi=Jt||location.pathname+location.search,Si;try{Si=re().querySelector('[hx-history="false" i],[data-hx-history="false" i]')}catch{Si=re().querySelector('[hx-history="false"],[data-hx-history="false"]')}Si||(ce(re().body,"htmx:beforeHistorySave",{path:vi,historyElt:mi}),Kt(vi,Qt(mi),re().title,window.scrollY)),Q.config.historyEnabled&&history.replaceState({htmx:!0},re().title,window.location.href)}function tr(mi){Q.config.getCacheBusterParam&&(mi=mi.replace(/org\.htmx\.cache-buster=[^&]*&?/,""),(G(mi,"&")||G(mi,"?"))&&(mi=mi.slice(0,-1))),Q.config.historyEnabled&&history.pushState({htmx:!0},"",mi),Jt=mi}function rr(mi){Q.config.historyEnabled&&history.replaceState({htmx:!0},"",mi),Jt=mi}function nr(mi){oe(mi,function(vi){vi.call()})}function ir(mi){var vi=new XMLHttpRequest,Si={path:mi,xhr:vi};ce(re().body,"htmx:historyCacheMiss",Si),vi.open("GET",mi,!0),vi.setRequestHeader("HX-Request","true"),vi.setRequestHeader("HX-History-Restore-Request","true"),vi.setRequestHeader("HX-Current-URL",re().location.href),vi.onload=function(){if(this.status>=200&&this.status<400){ce(re().body,"htmx:historyCacheMissLoad",Si);var Mi=l(this.response);Mi=Mi.querySelector("[hx-history-elt],[data-hx-history-elt]")||Mi;var Oi=Zt(),Wr=T(Oi),Qr=Ve(this.response);if(Qr){var li=C("title");li?li.innerHTML=Qr:window.document.title=Qr}Ue(Oi,Mi,Wr),nr(Wr.tasks),Jt=mi,ce(re().body,"htmx:historyRestore",{path:mi,cacheMiss:!0,serverResponse:this.response})}else fe(re().body,"htmx:historyCacheMissLoadError",Si)},vi.send()}function ar(mi){er(),mi=mi||location.pathname+location.search;var vi=Yt(mi);if(vi){var Si=l(vi.content),Mi=Zt(),Oi=T(Mi);Ue(Mi,Si,Oi),nr(Oi.tasks),document.title=vi.title,setTimeout(function(){window.scrollTo(0,vi.scroll)},0),Jt=mi,ce(re().body,"htmx:historyRestore",{path:mi,item:vi})}else Q.config.refreshOnHistoryMiss?window.location.reload(!0):ir(mi)}function or(mi){var vi=me(mi,"hx-indicator");return vi==null&&(vi=[mi]),oe(vi,function(Si){var Mi=ae(Si);Mi.requestCount=(Mi.requestCount||0)+1,Si.classList.add.call(Si.classList,Q.config.requestClass)}),vi}function sr(mi){var vi=me(mi,"hx-disabled-elt");return vi==null&&(vi=[]),oe(vi,function(Si){var Mi=ae(Si);Mi.requestCount=(Mi.requestCount||0)+1,Si.setAttribute("disabled","")}),vi}function lr(mi,vi){oe(mi,function(Si){var Mi=ae(Si);Mi.requestCount=(Mi.requestCount||0)-1,Mi.requestCount===0&&Si.classList.remove.call(Si.classList,Q.config.requestClass)}),oe(vi,function(Si){var Mi=ae(Si);Mi.requestCount=(Mi.requestCount||0)-1,Mi.requestCount===0&&Si.removeAttribute("disabled")})}function ur(mi,vi){for(var Si=0;Si<mi.length;Si++){var Mi=mi[Si];if(Mi.isSameNode(vi))return!0}return!1}function fr(mi){return mi.name===""||mi.name==null||mi.disabled||v(mi,"fieldset[disabled]")||mi.type==="button"||mi.type==="submit"||mi.tagName==="image"||mi.tagName==="reset"||mi.tagName==="file"?!1:mi.type==="checkbox"||mi.type==="radio"?mi.checked:!0}function cr(mi,vi,Si){if(mi!=null&&vi!=null){var Mi=Si[mi];Mi===void 0?Si[mi]=vi:Array.isArray(Mi)?Array.isArray(vi)?Si[mi]=Mi.concat(vi):Mi.push(vi):Array.isArray(vi)?Si[mi]=[Mi].concat(vi):Si[mi]=[Mi,vi]}}function hr(mi,vi,Si,Mi,Oi){if(!(Mi==null||ur(mi,Mi))){if(mi.push(Mi),fr(Mi)){var Wr=ee(Mi,"name"),Qr=Mi.value;Mi.multiple&&Mi.tagName==="SELECT"&&(Qr=M(Mi.querySelectorAll("option:checked")).map(function(po){return po.value})),Mi.files&&(Qr=M(Mi.files)),cr(Wr,Qr,vi),Oi&&vr(Mi,Si)}if(h(Mi,"form")){var li=Mi.elements;oe(li,function(po){hr(mi,vi,Si,po,Oi)})}}}function vr(mi,vi){mi.willValidate&&(ce(mi,"htmx:validation:validate"),mi.checkValidity()||(vi.push({elt:mi,message:mi.validationMessage,validity:mi.validity}),ce(mi,"htmx:validation:failed",{message:mi.validationMessage,validity:mi.validity})))}function dr(mi,vi){var Si=[],Mi={},Oi={},Wr=[],Qr=ae(mi);Qr.lastButtonClicked&&!se(Qr.lastButtonClicked)&&(Qr.lastButtonClicked=null);var li=h(mi,"form")&&mi.noValidate!==!0||te(mi,"hx-validate")==="true";if(Qr.lastButtonClicked&&(li=li&&Qr.lastButtonClicked.formNoValidate!==!0),vi!=="get"&&hr(Si,Oi,Wr,v(mi,"form"),li),hr(Si,Mi,Wr,mi,li),Qr.lastButtonClicked||mi.tagName==="BUTTON"||mi.tagName==="INPUT"&&ee(mi,"type")==="submit"){var po=Qr.lastButtonClicked||mi,Ki=ee(po,"name");cr(Ki,po.value,Oi)}var Lo=me(mi,"hx-include");return oe(Lo,function(Ro){hr(Si,Mi,Wr,Ro,li),h(Ro,"form")||oe(Ro.querySelectorAll(rt),function(fo){hr(Si,Mi,Wr,fo,li)})}),Mi=le(Mi,Oi),{errors:Wr,values:Mi}}function gr(mi,vi,Si){mi!==""&&(mi+="&"),String(Si)==="[object Object]"&&(Si=JSON.stringify(Si));var Mi=encodeURIComponent(Si);return mi+=encodeURIComponent(vi)+"="+Mi,mi}function pr(mi){var vi="";for(var Si in mi)if(mi.hasOwnProperty(Si)){var Mi=mi[Si];Array.isArray(Mi)?oe(Mi,function(Oi){vi=gr(vi,Si,Oi)}):vi=gr(vi,Si,Mi)}return vi}function mr(mi){var vi=new FormData;for(var Si in mi)if(mi.hasOwnProperty(Si)){var Mi=mi[Si];Array.isArray(Mi)?oe(Mi,function(Oi){vi.append(Si,Oi)}):vi.append(Si,Mi)}return vi}function xr(mi,vi,Si){var Mi={"HX-Request":"true","HX-Trigger":ee(mi,"id"),"HX-Trigger-Name":ee(mi,"name"),"HX-Target":te(vi,"id"),"HX-Current-URL":re().location.href};return Rr(mi,"hx-headers",!1,Mi),Si!==void 0&&(Mi["HX-Prompt"]=Si),ae(mi).boosted&&(Mi["HX-Boosted"]="true"),Mi}function yr(mi,vi){var Si=ne(vi,"hx-params");if(Si){if(Si==="none")return{};if(Si==="*")return mi;if(Si.indexOf("not ")===0)return oe(Si.substr(4).split(","),function(Oi){Oi=Oi.trim(),delete mi[Oi]}),mi;var Mi={};return oe(Si.split(","),function(Oi){Oi=Oi.trim(),Mi[Oi]=mi[Oi]}),Mi}else return mi}function br(mi){return ee(mi,"href")&&ee(mi,"href").indexOf("#")>=0}function wr(mi,vi){var Si=vi||ne(mi,"hx-swap"),Mi={swapStyle:ae(mi).boosted?"innerHTML":Q.config.defaultSwapStyle,swapDelay:Q.config.defaultSwapDelay,settleDelay:Q.config.defaultSettleDelay};if(Q.config.scrollIntoViewOnBoost&&ae(mi).boosted&&!br(mi)&&(Mi.show="top"),Si){var Oi=D(Si);if(Oi.length>0)for(var Wr=0;Wr<Oi.length;Wr++){var Qr=Oi[Wr];if(Qr.indexOf("swap:")===0)Mi.swapDelay=d(Qr.substr(5));else if(Qr.indexOf("settle:")===0)Mi.settleDelay=d(Qr.substr(7));else if(Qr.indexOf("transition:")===0)Mi.transition=Qr.substr(11)==="true";else if(Qr.indexOf("ignoreTitle:")===0)Mi.ignoreTitle=Qr.substr(12)==="true";else if(Qr.indexOf("scroll:")===0){var li=Qr.substr(7),po=li.split(":"),Ki=po.pop(),Lo=po.length>0?po.join(":"):null;Mi.scroll=Ki,Mi.scrollTarget=Lo}else if(Qr.indexOf("show:")===0){var Ro=Qr.substr(5),po=Ro.split(":"),fo=po.pop(),Lo=po.length>0?po.join(":"):null;Mi.show=fo,Mi.showTarget=Lo}else if(Qr.indexOf("focus-scroll:")===0){var aa=Qr.substr(13);Mi.focusScroll=aa=="true"}else Wr==0?Mi.swapStyle=Qr:b("Unknown modifier in hx-swap: "+Qr)}}return Mi}function Sr(mi){return ne(mi,"hx-encoding")==="multipart/form-data"||h(mi,"form")&&ee(mi,"enctype")==="multipart/form-data"}function Er(mi,vi,Si){var Mi=null;return R(vi,function(Oi){Mi==null&&(Mi=Oi.encodeParameters(mi,Si,vi))}),Mi??(Sr(vi)?mr(Si):pr(Si))}function T(mi){return{tasks:[],elts:[mi]}}function Cr(mi,vi){var Si=mi[0],Mi=mi[mi.length-1];if(vi.scroll){var Oi=null;vi.scrollTarget&&(Oi=ue(Si,vi.scrollTarget)),vi.scroll==="top"&&(Si||Oi)&&(Oi=Oi||Si,Oi.scrollTop=0),vi.scroll==="bottom"&&(Mi||Oi)&&(Oi=Oi||Mi,Oi.scrollTop=Oi.scrollHeight)}if(vi.show){var Oi=null;if(vi.showTarget){var Wr=vi.showTarget;vi.showTarget==="window"&&(Wr="body"),Oi=ue(Si,Wr)}vi.show==="top"&&(Si||Oi)&&(Oi=Oi||Si,Oi.scrollIntoView({block:"start",behavior:Q.config.scrollBehavior})),vi.show==="bottom"&&(Mi||Oi)&&(Oi=Oi||Mi,Oi.scrollIntoView({block:"end",behavior:Q.config.scrollBehavior}))}}function Rr(mi,vi,Si,Mi){if(Mi==null&&(Mi={}),mi==null)return Mi;var Oi=te(mi,vi);if(Oi){var Wr=Oi.trim(),Qr=Si;if(Wr==="unset")return null;Wr.indexOf("javascript:")===0?(Wr=Wr.substr(11),Qr=!0):Wr.indexOf("js:")===0&&(Wr=Wr.substr(3),Qr=!0),Wr.indexOf("{")!==0&&(Wr="{"+Wr+"}");var li;Qr?li=Tr(mi,function(){return Function("return ("+Wr+")")()},{}):li=E(Wr);for(var po in li)li.hasOwnProperty(po)&&Mi[po]==null&&(Mi[po]=li[po])}return Rr(u(mi),vi,Si,Mi)}function Tr(mi,vi,Si){return Q.config.allowEval?vi():(fe(mi,"htmx:evalDisallowedError"),Si)}function Or(mi,vi){return Rr(mi,"hx-vars",!0,vi)}function qr(mi,vi){return Rr(mi,"hx-vals",!1,vi)}function Hr(mi){return le(Or(mi),qr(mi))}function Lr(mi,vi,Si){if(Si!==null)try{mi.setRequestHeader(vi,Si)}catch{mi.setRequestHeader(vi,encodeURIComponent(Si)),mi.setRequestHeader(vi+"-URI-AutoEncoded","true")}}function Ar(mi){if(mi.responseURL&&typeof URL<"u")try{var vi=new URL(mi.responseURL);return vi.pathname+vi.search}catch{fe(re().body,"htmx:badResponseUrl",{url:mi.responseURL})}}function O(mi,vi){return vi.test(mi.getAllResponseHeaders())}function Nr(mi,vi,Si){return mi=mi.toLowerCase(),Si?Si instanceof Element||I(Si,"String")?he(mi,vi,null,null,{targetOverride:p(Si),returnPromise:!0}):he(mi,vi,p(Si.source),Si.event,{handler:Si.handler,headers:Si.headers,values:Si.values,targetOverride:p(Si.target),swapOverride:Si.swap,select:Si.select,returnPromise:!0}):he(mi,vi,null,null,{returnPromise:!0})}function Ir(mi){for(var vi=[];mi;)vi.push(mi),mi=mi.parentElement;return vi}function kr(mi,vi,Si){var Mi,Oi;if(typeof URL=="function"){Oi=new URL(vi,document.location.href);var Wr=document.location.origin;Mi=Wr===Oi.origin}else Oi=vi,Mi=g(vi,document.location.origin);return Q.config.selfRequestsOnly&&!Mi?!1:ce(mi,"htmx:validateUrl",le({url:Oi,sameHost:Mi},Si))}function he(mi,vi,Si,Mi,Oi,Wr){var Qr=null,li=null;if(Oi=Oi??{},Oi.returnPromise&&typeof Promise<"u")var po=new Promise(function($n,na){Qr=$n,li=na});Si==null&&(Si=re().body);var Ki=Oi.handler||Mr,Lo=Oi.select||null;if(!se(Si))return ie(Qr),po;var Ro=Oi.targetOverride||ye(Si);if(Ro==null||Ro==pe)return fe(Si,"htmx:targetError",{target:te(Si,"hx-target")}),ie(li),po;var fo=ae(Si),aa=fo.lastButtonClicked;if(aa){var wa=ee(aa,"formaction");wa!=null&&(vi=wa);var $a=ee(aa,"formmethod");$a!=null&&$a.toLowerCase()!=="dialog"&&(mi=$a)}var Ln=ne(Si,"hx-confirm");if(Wr===void 0){var bn=function($n){return he(mi,vi,Si,Mi,Oi,!!$n)},fs={target:Ro,elt:Si,path:vi,verb:mi,triggeringEvent:Mi,etc:Oi,issueRequest:bn,question:Ln};if(ce(Si,"htmx:confirm",fs)===!1)return ie(Qr),po}var sa=Si,ma=ne(Si,"hx-sync"),la=null,Za=!1;if(ma){var oa=ma.split(":"),ln=oa[0].trim();if(ln==="this"?sa=xe(Si,"hx-sync"):sa=ue(Si,ln),ma=(oa[1]||"drop").trim(),fo=ae(sa),ma==="drop"&&fo.xhr&&fo.abortable!==!0)return ie(Qr),po;if(ma==="abort"){if(fo.xhr)return ie(Qr),po;Za=!0}else if(ma==="replace")ce(sa,"htmx:abort");else if(ma.indexOf("queue")===0){var vs=ma.split(" ");la=(vs[1]||"last").trim()}}if(fo.xhr)if(fo.abortable)ce(sa,"htmx:abort");else{if(la==null){if(Mi){var Wo=ae(Mi);Wo&&Wo.triggerSpec&&Wo.triggerSpec.queue&&(la=Wo.triggerSpec.queue)}la==null&&(la="last")}return fo.queuedRequests==null&&(fo.queuedRequests=[]),la==="first"&&fo.queuedRequests.length===0?fo.queuedRequests.push(function(){he(mi,vi,Si,Mi,Oi)}):la==="all"?fo.queuedRequests.push(function(){he(mi,vi,Si,Mi,Oi)}):la==="last"&&(fo.queuedRequests=[],fo.queuedRequests.push(function(){he(mi,vi,Si,Mi,Oi)})),ie(Qr),po}var fn=new XMLHttpRequest;fo.xhr=fn,fo.abortable=Za;var Pn=function(){if(fo.xhr=null,fo.abortable=!1,fo.queuedRequests!=null&&fo.queuedRequests.length>0){var $n=fo.queuedRequests.shift();$n()}},Ra=ne(Si,"hx-prompt");if(Ra){var On=prompt(Ra);if(On===null||!ce(Si,"htmx:prompt",{prompt:On,target:Ro}))return ie(Qr),Pn(),po}if(Ln&&!Wr&&!confirm(Ln))return ie(Qr),Pn(),po;var rn=xr(Si,Ro,On);mi!=="get"&&!Sr(Si)&&(rn["Content-Type"]="application/x-www-form-urlencoded"),Oi.headers&&(rn=le(rn,Oi.headers));var Sa=dr(Si,mi),Gn=Sa.errors,ca=Sa.values;Oi.values&&(ca=le(ca,Oi.values));var al=Hr(Si),sl=le(ca,al),rs=yr(sl,Si);Q.config.getCacheBusterParam&&mi==="get"&&(rs["org.htmx.cache-buster"]=ee(Ro,"id")||"true"),(vi==null||vi==="")&&(vi=re().location.href);var Ma=Rr(Si,"hx-request"),hn=ae(Si).boosted,Xn=Q.config.methodsThatUseUrlParams.indexOf(mi)>=0,Bn={boosted:hn,useUrlParams:Xn,parameters:rs,unfilteredParameters:sl,headers:rn,target:Ro,verb:mi,errors:Gn,withCredentials:Oi.credentials||Ma.credentials||Q.config.withCredentials,timeout:Oi.timeout||Ma.timeout||Q.config.timeout,path:vi,triggeringEvent:Mi};if(!ce(Si,"htmx:configRequest",Bn))return ie(Qr),Pn(),po;if(vi=Bn.path,mi=Bn.verb,rn=Bn.headers,rs=Bn.parameters,Gn=Bn.errors,Xn=Bn.useUrlParams,Gn&&Gn.length>0)return ce(Si,"htmx:validation:halted",Bn),ie(Qr),Pn(),po;var Ls=vi.split("#"),Xs=Ls[0],os=Ls[1],Nn=vi;if(Xn){Nn=Xs;var La=Object.keys(rs).length!==0;La&&(Nn.indexOf("?")<0?Nn+="?":Nn+="&",Nn+=pr(rs),os&&(Nn+="#"+os))}if(!kr(Si,Nn,Bn))return fe(Si,"htmx:invalidPath",Bn),ie(li),po;if(fn.open(mi.toUpperCase(),Nn,!0),fn.overrideMimeType("text/html"),fn.withCredentials=Bn.withCredentials,fn.timeout=Bn.timeout,!Ma.noHeaders){for(var Os in rn)if(rn.hasOwnProperty(Os)){var bs=rn[Os];Lr(fn,Os,bs)}}var Un={xhr:fn,target:Ro,requestConfig:Bn,etc:Oi,boosted:hn,select:Lo,pathInfo:{requestPath:vi,finalRequestPath:Nn,anchor:os}};if(fn.onload=function(){try{var $n=Ir(Si);if(Un.pathInfo.responsePath=Ar(fn),Ki(Si,Un),lr(Oa,ms),ce(Si,"htmx:afterRequest",Un),ce(Si,"htmx:afterOnLoad",Un),!se(Si)){for(var na=null;$n.length>0&&na==null;){var ka=$n.shift();se(ka)&&(na=ka)}na&&(ce(na,"htmx:afterRequest",Un),ce(na,"htmx:afterOnLoad",Un))}ie(Qr),Pn()}catch(io){throw fe(Si,"htmx:onLoadError",le({error:io},Un)),io}},fn.onerror=function(){lr(Oa,ms),fe(Si,"htmx:afterRequest",Un),fe(Si,"htmx:sendError",Un),ie(li),Pn()},fn.onabort=function(){lr(Oa,ms),fe(Si,"htmx:afterRequest",Un),fe(Si,"htmx:sendAbort",Un),ie(li),Pn()},fn.ontimeout=function(){lr(Oa,ms),fe(Si,"htmx:afterRequest",Un),fe(Si,"htmx:timeout",Un),ie(li),Pn()},!ce(Si,"htmx:beforeRequest",Un))return ie(Qr),Pn(),po;var Oa=or(Si),ms=sr(Si);oe(["loadstart","loadend","progress","abort"],function($n){oe([fn,fn.upload],function(na){na.addEventListener($n,function(ka){ce(Si,"htmx:xhr:"+$n,{lengthComputable:ka.lengthComputable,loaded:ka.loaded,total:ka.total})})})}),ce(Si,"htmx:beforeSend",Un);var ks=Xn?null:Er(fn,Si,rs);return fn.send(ks),po}function Pr(mi,vi){var Si=vi.xhr,Mi=null,Oi=null;if(O(Si,/HX-Push:/i)?(Mi=Si.getResponseHeader("HX-Push"),Oi="push"):O(Si,/HX-Push-Url:/i)?(Mi=Si.getResponseHeader("HX-Push-Url"),Oi="push"):O(Si,/HX-Replace-Url:/i)&&(Mi=Si.getResponseHeader("HX-Replace-Url"),Oi="replace"),Mi)return Mi==="false"?{}:{type:Oi,path:Mi};var Wr=vi.pathInfo.finalRequestPath,Qr=vi.pathInfo.responsePath,li=ne(mi,"hx-push-url"),po=ne(mi,"hx-replace-url"),Ki=ae(mi).boosted,Lo=null,Ro=null;return li?(Lo="push",Ro=li):po?(Lo="replace",Ro=po):Ki&&(Lo="push",Ro=Qr||Wr),Ro?Ro==="false"?{}:(Ro==="true"&&(Ro=Qr||Wr),vi.pathInfo.anchor&&Ro.indexOf("#")===-1&&(Ro=Ro+"#"+vi.pathInfo.anchor),{type:Lo,path:Ro}):{}}function Mr(mi,vi){var Si=vi.xhr,Mi=vi.target,Oi=vi.etc;vi.requestConfig;var Wr=vi.select;if(ce(mi,"htmx:beforeOnLoad",vi)){if(O(Si,/HX-Trigger:/i)&&_e(Si,"HX-Trigger",mi),O(Si,/HX-Location:/i)){er();var Qr=Si.getResponseHeader("HX-Location"),li;Qr.indexOf("{")===0&&(li=E(Qr),Qr=li.path,delete li.path),Nr("GET",Qr,li).then(function(){tr(Qr)});return}var po=O(Si,/HX-Refresh:/i)&&Si.getResponseHeader("HX-Refresh")==="true";if(O(Si,/HX-Redirect:/i)){location.href=Si.getResponseHeader("HX-Redirect"),po&&location.reload();return}if(po){location.reload();return}O(Si,/HX-Retarget:/i)&&(Si.getResponseHeader("HX-Retarget")==="this"?vi.target=mi:vi.target=ue(mi,Si.getResponseHeader("HX-Retarget")));var Ki=Pr(mi,vi),Lo=Si.status>=200&&Si.status<400&&Si.status!==204,Ro=Si.response,fo=Si.status>=400,aa=Q.config.ignoreTitle,wa=le({shouldSwap:Lo,serverResponse:Ro,isError:fo,ignoreTitle:aa},vi);if(ce(Mi,"htmx:beforeSwap",wa)){if(Mi=wa.target,Ro=wa.serverResponse,fo=wa.isError,aa=wa.ignoreTitle,vi.target=Mi,vi.failed=fo,vi.successful=!fo,wa.shouldSwap){Si.status===286&&at(mi),R(mi,function(oa){Ro=oa.transformResponse(Ro,Si,mi)}),Ki.type&&er();var $a=Oi.swapOverride;O(Si,/HX-Reswap:/i)&&($a=Si.getResponseHeader("HX-Reswap"));var li=wr(mi,$a);li.hasOwnProperty("ignoreTitle")&&(aa=li.ignoreTitle),Mi.classList.add(Q.config.swappingClass);var Ln=null,bn=null,fs=function(){try{var oa=document.activeElement,ln={};try{ln={elt:oa,start:oa?oa.selectionStart:null,end:oa?oa.selectionEnd:null}}catch{}var vs;Wr&&(vs=Wr),O(Si,/HX-Reselect:/i)&&(vs=Si.getResponseHeader("HX-Reselect")),Ki.type&&(ce(re().body,"htmx:beforeHistoryUpdate",le({history:Ki},vi)),Ki.type==="push"?(tr(Ki.path),ce(re().body,"htmx:pushedIntoHistory",{path:Ki.path})):(rr(Ki.path),ce(re().body,"htmx:replacedInHistory",{path:Ki.path})));var Wo=T(Mi);if(je(li.swapStyle,Mi,mi,Ro,Wo,vs),ln.elt&&!se(ln.elt)&&ee(ln.elt,"id")){var fn=document.getElementById(ee(ln.elt,"id")),Pn={preventScroll:li.focusScroll!==void 0?!li.focusScroll:!Q.config.defaultFocusScroll};if(fn){if(ln.start&&fn.setSelectionRange)try{fn.setSelectionRange(ln.start,ln.end)}catch{}fn.focus(Pn)}}if(Mi.classList.remove(Q.config.swappingClass),oe(Wo.elts,function(rn){rn.classList&&rn.classList.add(Q.config.settlingClass),ce(rn,"htmx:afterSwap",vi)}),O(Si,/HX-Trigger-After-Swap:/i)){var Ra=mi;se(mi)||(Ra=re().body),_e(Si,"HX-Trigger-After-Swap",Ra)}var On=function(){if(oe(Wo.tasks,function(ca){ca.call()}),oe(Wo.elts,function(ca){ca.classList&&ca.classList.remove(Q.config.settlingClass),ce(ca,"htmx:afterSettle",vi)}),vi.pathInfo.anchor){var rn=re().getElementById(vi.pathInfo.anchor);rn&&rn.scrollIntoView({block:"start",behavior:"auto"})}if(Wo.title&&!aa){var Sa=C("title");Sa?Sa.innerHTML=Wo.title:window.document.title=Wo.title}if(Cr(Wo.elts,li),O(Si,/HX-Trigger-After-Settle:/i)){var Gn=mi;se(mi)||(Gn=re().body),_e(Si,"HX-Trigger-After-Settle",Gn)}ie(Ln)};li.settleDelay>0?setTimeout(On,li.settleDelay):On()}catch(rn){throw fe(mi,"htmx:swapError",vi),ie(bn),rn}},sa=Q.config.globalViewTransitions;if(li.hasOwnProperty("transition")&&(sa=li.transition),sa&&ce(mi,"htmx:beforeTransition",vi)&&typeof Promise<"u"&&document.startViewTransition){var ma=new Promise(function(oa,ln){Ln=oa,bn=ln}),la=fs;fs=function(){document.startViewTransition(function(){return la(),ma})}}li.swapDelay>0?setTimeout(fs,li.swapDelay):fs()}fo&&fe(mi,"htmx:responseError",le({error:"Response Status Error Code "+Si.status+" from "+vi.pathInfo.requestPath},vi))}}}var Xr={};function Dr(){return{init:function(mi){return null},onEvent:function(mi,vi){return!0},transformResponse:function(mi,vi,Si){return mi},isInlineSwap:function(mi){return!1},handleSwap:function(mi,vi,Si,Mi){return!1},encodeParameters:function(mi,vi,Si){return null}}}function Ur(mi,vi){vi.init&&vi.init(r),Xr[mi]=le(Dr(),vi)}function Fr(mi){delete Xr[mi]}function Br(mi,vi,Si){if(mi==null)return vi;vi==null&&(vi=[]),Si==null&&(Si=[]);var Mi=te(mi,"hx-ext");return Mi&&oe(Mi.split(","),function(Oi){if(Oi=Oi.replace(/ /g,""),Oi.slice(0,7)=="ignore:"){Si.push(Oi.slice(7));return}if(Si.indexOf(Oi)<0){var Wr=Xr[Oi];Wr&&vi.indexOf(Wr)<0&&vi.push(Wr)}}),Br(u(mi),vi,Si)}var Vr=!1;re().addEventListener("DOMContentLoaded",function(){Vr=!0});function jr(mi){Vr||re().readyState==="complete"?mi():re().addEventListener("DOMContentLoaded",mi)}function _r(){Q.config.includeIndicatorStyles!==!1&&re().head.insertAdjacentHTML("beforeend","<style>                      ."+Q.config.indicatorClass+"{opacity:0}                      ."+Q.config.requestClass+" ."+Q.config.indicatorClass+"{opacity:1; transition: opacity 200ms ease-in;}                      ."+Q.config.requestClass+"."+Q.config.indicatorClass+"{opacity:1; transition: opacity 200ms ease-in;}                    </style>")}function zr(){var mi=re().querySelector('meta[name="htmx-config"]');return mi?E(mi.content):null}function $r(){var mi=zr();mi&&(Q.config=le(Q.config,mi))}return jr(function(){$r(),_r();var mi=re().body;zt(mi);var vi=re().querySelectorAll("[hx-trigger='restored'],[data-hx-trigger='restored']");mi.addEventListener("htmx:abort",function(Mi){var Oi=Mi.target,Wr=ae(Oi);Wr&&Wr.xhr&&Wr.xhr.abort()});const Si=window.onpopstate?window.onpopstate.bind(window):null;window.onpopstate=function(Mi){Mi.state&&Mi.state.htmx?(ar(),oe(vi,function(Oi){ce(Oi,"htmx:restored",{document:re(),triggerEvent:ce})})):Si&&Si(Mi)},setTimeout(function(){ce(mi,"htmx:load",{}),mi=null},0)}),Q}()})})(htmx_min);var htmx_minExports=htmx_min.exports;const style="",icons=["atom","water","fire","wind","sun","electricity"];style$1.layers=ignLayers;const map=new maplibreGlExports.Map({container:"map",style:style$1,center:[5,47.2],zoom:5.5,antialias:!0});map.on("load",()=>{icons.forEach(mi=>map.loadImage(`http://localhost:8000/static/sprite/${mi}.png`,(vi,Si)=>{Si&&map.addImage(mi,Si)})),energyLayers().forEach(mi=>map.addLayer(mi)),map.on("click","power_plants_icon",mi=>{if(mi.features===void 0)return;const vi=mi.features[0].properties;console.log(vi);const Si=`/centrale/${vi.gid}`;htmx_minExports.ajax("get",Si,"#panel"),history.pushState(null,"",Si)}),map.on("mouseenter","power_plants_icon",()=>{map.getCanvas().style.cursor="pointer"}),map.on("mouseleave","power_plants_icon",()=>{map.getCanvas().style.cursor="grab"})});window.addEventListener("popstate",function(mi){htmx_minExports.ajax("get",document.location.href,"#panel")});
